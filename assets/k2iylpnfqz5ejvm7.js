import{g as ee,r as j,f as se,j as e,M as d,a5 as te,e as w,b as L,u as re,c as ae}from"./fs6h2trisr1juto6.js";import{kF as z,kG as oe,kH as ne,kI as ie,kJ as N,kK as le,bb as de,kL as me,kM as ce,kN as ue,ga as y,kO as D,di as ge,jH as fe,ah as he}from"./d7a6rc8fexfzu7dt.js";import{er as xe,dn as Me,dp as ye,bZ as je,gy as be,gz as pe,r as ve,gx as we,eP as Ce,P as h,a as x,d as k,bT as I,V as P,c5 as A,bw as q,by as T,R as H,bH as _e,c3 as v,Z as ke}from"./njq6ygky3ttysgdk.js";import{G as Se}from"./en8ogvlmn3lccz09.js";var Re=xe,Ee=Me,Ne="[object RegExp]";function Te(s){return Ee(s)&&Re(s)==Ne}var Oe=Te,Ue=Oe,Ge=je,O=ye,U=O&&O.isRegExp,Be=U?Ge(U):Ue,Fe=Be,Le=be,ze=Le("length"),De=ze,W="\\ud800-\\udfff",Ie="\\u0300-\\u036f",Pe="\\ufe20-\\ufe2f",Ae="\\u20d0-\\u20ff",qe=Ie+Pe+Ae,He="\\ufe0e\\ufe0f",We="["+W+"]",S="["+qe+"]",R="\\ud83c[\\udffb-\\udfff]",$e="(?:"+S+"|"+R+")",$="[^"+W+"]",Z="(?:\\ud83c[\\udde6-\\uddff]){2}",Q="[\\ud800-\\udbff][\\udc00-\\udfff]",Ze="\\u200d",K=$e+"?",Y="["+He+"]?",Qe="(?:"+Ze+"(?:"+[$,Z,Q].join("|")+")"+Y+K+")*",Ke=Y+K+Qe,Ye="(?:"+[$+S+"?",S,Z,Q,We].join("|")+")",G=RegExp(R+"(?="+R+")|"+Ye+Ke,"g");function Je(s){for(var t=G.lastIndex=0;G.test(s);)++t;return t}var Ve=Je,Xe=De,es=z,ss=Ve;function ts(s){return es(s)?ss(s):Xe(s)}var rs=ts,B=pe,as=oe,os=z,ns=ve,is=Fe,ls=rs,ds=ne,ms=we,F=Ce,cs=30,us="...",gs=/\w*$/;function fs(s,t){var i=cs,o=us;if(ns(t)){var r="separator"in t?t.separator:r;i="length"in t?ms(t.length):i,o="omission"in t?B(t.omission):o}s=F(s);var a=s.length;if(os(s)){var n=ds(s);a=n.length}if(i>=a)return s;var m=i-ls(o);if(m<1)return o;var l=n?as(n,0,m).join(""):s.slice(0,m);if(r===void 0)return l+o;if(n&&(m+=l.length-m),is(r)){if(s.slice(m).search(r)){var u,g=l;for(r.global||(r=RegExp(r.source,F(gs.exec(r))+"g")),r.lastIndex=0;u=r.exec(g);)var f=u.index;l=l.slice(0,f===void 0?m:f)}}else if(s.indexOf(B(r),m)!=m){var M=l.lastIndexOf(r);M>-1&&(l=l.slice(0,M))}return l+o}var hs=fs;const xs=ee(hs),Ms=s=>j.createElement("svg",{width:24,height:24,viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},j.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6 1C3.23858 1 1 3.23858 1 6C1 8.76142 3.23858 11 6 11C8.76142 11 11 8.76142 11 6C11 3.23858 8.76142 1 6 1ZM6.75 3.75C6.75 4.16421 6.41421 4.5 6 4.5C5.58579 4.5 5.25 4.16421 5.25 3.75C5.25 3.33579 5.58579 3 6 3C6.41421 3 6.75 3.33579 6.75 3.75ZM6.75 6C6.75 5.58579 6.41421 5.25 6 5.25C5.58579 5.25 5.25 5.58579 5.25 6V8C5.25 8.41421 5.58579 8.75 6 8.75C6.41421 8.75 6.75 8.41421 6.75 8V6Z",fill:"currentColor"})),ys=91,E=100;function js(s){return s<E?"bg-[#fcf6e0] text-yellow-500 dark:bg-yellow-600 dark:text-yellow-100":"bg-[rgba(229,76,66,0.16)] text-[#DC2626] dark:bg-[rgba(202,58,49,0.16)] dark:text-[#DC2626]"}function J(s){return le()&&s!=null&&s>=ys}function bs({memoryFullPct:s,className:t,children:i,showInfoLabel:o}){return J(s)?e.jsx("div",{className:k("rounded-lg border border-token-border-light p-1 text-sm",t),children:e.jsxs(te.div,{className:k("flex items-center overflow-hidden whitespace-nowrap rounded px-2 py-1.5",js(s)),initial:{width:0},animate:{width:`${s}%`},transition:{duration:.5},children:[e.jsx(d,{id:"6D2etG",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:s}}),i,o&&e.jsx(I,{label:s<E?e.jsx(d,{id:"dlUy+j",defaultMessage:"Memory is almost full. Once memory is full, new memories won't be created. You can forget existing memories to make space."}):e.jsx(d,{id:"yeQ/cM",defaultMessage:"Memory is full. New memories won't be created. You can forget existing memories to make space."}),children:e.jsx(Ms,{className:"icon-sm ml-1 text-token-text-secondary"})})]})}):null}function ps({memoryFullPct:s,className:t}){const i=J(s),o=ie(),r=se();if(!i)return null;o&&h.logEventWithStatsig(x.memoryFullWarningUpsellShown,"chatgpt_memory_full_warning_upsell_shown_memory_modal");const a=e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:n=>{n.preventDefault(),h.logEventWithStatsig(x.memoryFullWarningUpsellClicked,"chatgpt_memory_full_warning_upsell_clicked_memory_modal"),de(r,"MemoryUsageWarning Memory Modal Upsell")},children:e.jsx(d,{id:"djYoOr",defaultMessage:"ChatGPT Plus"})});return e.jsxs("div",{className:k("flex flex-col gap-2",t),children:[e.jsx(bs,{memoryFullPct:s}),e.jsx("div",{className:"pl-3 text-sm text-token-text-secondary",children:s<E?o?e.jsx(d,{id:"Nh1AJk",defaultMessage:"<strong>Memory almost full</strong>. Once memory is full, new memories won't be created. Forget existing memories to make space, or get 4x more space with {upsellLink}.",values:{strong:n=>e.jsx("strong",{children:n}),upsellLink:a}}):e.jsx(d,{id:"CLBbS6",defaultMessage:"<strong>Memory almost full</strong>. Once memory is full, new memories won't be created. You can forget existing memories to make space. <a>Learn more</a>.",values:{strong:n=>e.jsx("strong",{children:n}),a:n=>e.jsx("a",{href:N,target:"_blank",rel:"noopener noreferrer",className:"underline",children:n})}}):o?e.jsx(d,{id:"r0KIF1",defaultMessage:"<strong>Memory is full</strong>. New memories won't be created. Forget existing memories to make space, or get 4x more space with {upsellLink}.",values:{strong:n=>e.jsx("strong",{children:n}),upsellLink:a}}):e.jsx(d,{id:"zJUX0Z",defaultMessage:"<strong>Memory is full</strong>. New memories won't be created. You can forget existing memories to make space. <a>Learn more</a>.",values:{strong:n=>e.jsx("strong",{children:n}),a:n=>e.jsx("a",{href:N,target:"_blank",rel:"noopener noreferrer",className:"underline",children:n})}})})]})}function vs({description:s,onClose:t,onConfirm:i}){const o=w();return e.jsx(q,{isOpen:!0,onClose:t,type:"success",title:o.formatMessage({id:"MemoriesModal.resetModalTitle",defaultMessage:"Are you sure?"}),description:s,primaryButton:e.jsx(T.Button,{title:o.formatMessage({id:"MemoriesModal.resetModalConfirm",defaultMessage:"Clear memory"}),color:"danger",onClick:i,"data-testid":"confirm-reset-memories-button"}),secondaryButton:e.jsx(T.Button,{title:o.formatMessage({id:"MemoriesModal.resetModalCancel",defaultMessage:"Cancel"}),color:"secondary",onClick:t})})}function ws({onReset:s,gizmoId:t,memoryName:i}){const[o,r]=j.useState(!1),a=w(),n=P(),m=async()=>{h.logEvent(x.memorySettingsResetButtonConfirmed);try{await H.safeDelete("/settings/clear_account_user_memory",{requestBody:{gizmo_id:t}}),n.success(a.formatMessage({id:"ResetMemoriesButton.resetSuccess",defaultMessage:"Memory cleared."})),s?.(),r(!1)}catch{n.danger(a.formatMessage({id:"ResetMemoriesButton.resetFailed",defaultMessage:"Failed to clear memory."}))}};return e.jsxs(e.Fragment,{children:[e.jsx(A,{color:"danger-outline",onClick:()=>{h.logEvent(x.memorySettingsResetButtonClicked),r(!0)},"data-testid":"reset-memories-button",children:t?e.jsx(d,{id:"ResetMemoriesButton.resetGizmo",defaultMessage:"Clear this GPT's memory"}):e.jsx(d,{id:"ResetMemoriesButton.resetChatGPT",defaultMessage:"Clear ChatGPT's memory"})}),o&&e.jsx(vs,{description:a.formatMessage({id:"MemoriesModal.resetGizmoModalDescription",defaultMessage:"{name} will forget everything it has remembered from your chats. This cannot be undone."},{name:i}),onClose:()=>r(!1),onConfirm:m})]})}function Cs({gizmo:s,memory:t}){const i=w(),o=P(),r=L(),{mutate:a,isPending:n}=ae({mutationFn:async g=>{const{success:f}=await H.safeDelete("/memories/{memory_id}",{parameters:{path:{memory_id:g}},requestBody:{gizmo_id:s?.id}});if(!f)throw new Error("An error occurred while deleting the memory")},onSettled:()=>{r.invalidateQueries({queryKey:D(s?.id)})},onError:()=>{o.danger(i.formatMessage({id:"MemoriesModal.deleteFailed",defaultMessage:"Failed to forget memory"}),{id:"memoryDeleteFailed"})}}),[m,l]=j.useState(!1),u=i.formatMessage({id:"z2CNgB",defaultMessage:"Forget"});return e.jsxs(e.Fragment,{children:[e.jsxs(y.Row,{disabled:n,children:[e.jsx(y.Cell,{children:e.jsx("div",{className:"whitespace-pre-wrap py-2",children:t.content})}),e.jsx(y.Cell,{textAlign:"right",children:e.jsx(y.Actions,{children:e.jsx("button",{onClick:()=>{h.logEvent(x.memoryModalMemoryDeleteClicked),l(!0)},"aria-label":u,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(I,{className:"leading-none",label:u,sideOffset:4,side:"top",children:e.jsx(ge,{className:"icon-sm"})})})})})]}),m&&e.jsx(fe,{isOpen:!0,primaryButtonColor:"danger",title:u,confirmText:i.formatMessage({id:"fCn0ar",defaultMessage:"Forget"}),onConfirm:()=>{h.logEvent(x.memoryModalMemoryDeleteConfirmed),a(t.id),l(!1)},onClose:()=>{l(!1)},children:e.jsx(d,{id:"pZ/TCe",defaultMessage:'{name} will forget "{title}". This cannot be undone. <link>Learn more</link>',values:{name:s?.name??"ChatGPT",title:e.jsx("strong",{children:xs(t.content,{length:130,omission:"..."})}),link:g=>e.jsx("a",{href:"https://help.openai.com/en/articles/8590148-memory-faq#h_41527f643d",target:"_blank",className:"underline",rel:"noreferrer",children:g})}})})]})}function _s({selectedGizmoId:s,onSelect:t,items:i}){const o=i.find(a=>a.id===s);function r(a){return e.jsx(Se,{isFirstParty:a.id===void 0,src:a.iconUrl??null,className:"icon-md"})}return e.jsx("div",{className:"mb-2 inline-flex rounded-md border border-token-border-medium",children:e.jsxs(v.Root,{children:[e.jsx(v.Trigger,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[o?e.jsxs(e.Fragment,{children:[r(o),e.jsx("span",{className:"text-token-text-primary",children:o.name})]}):e.jsx(d,{id:"MemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"}),e.jsx(he,{className:"icon-sm text-token-text-tertiary"})]})}),e.jsx(v.Portal,{children:e.jsx(v.Content,{children:i.map(a=>e.jsxs(v.Item,{className:"flex items-center gap-3",onClick:()=>{t(a.id)},children:[r(a),a.name]},a.id))})})]})})}const _=_e.div`flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-light`;function ks({onClose:s,initialGizmoId:t}){const i=w(),o=L(),r=me(),[a,n]=j.useState(t),m=ce();j.useEffect(()=>{h.logEvent(x.memoryModalShown)},[]);const{data:l,isLoading:u,isError:g,refetch:f}=ue(a,!0,r),M=l?.memories,{data:V,refetch:X}=re({queryKey:["memory_gizmos"],queryFn:()=>ke.getGizmosWithMemory(),refetchOnMount:"always"}),C=[{id:void 0,name:"ChatGPT",iconUrl:null},...V?.items.map(({gizmo:c})=>({id:c.id,name:c.display.name,iconUrl:c.display.profile_picture_url}))??[]],b=C.find(c=>c.id===a);let p;return u?p=e.jsx(_,{children:e.jsx(d,{id:"MemoriesModal.loading",defaultMessage:"Loading..."})}):g?p=e.jsx(_,{children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(d,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx(A,{color:"secondary",onClick:()=>{f()},children:e.jsx(d,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):!M||M.length===0?p=e.jsx(_,{children:e.jsx("div",{className:"max-w-sm text-center",children:r?e.jsx(d,{id:"MemoriesModal.noMemories.1",defaultMessage:"As you chat with {name}, the details and preferences it remembers will be shown here.",values:{name:b?.name??"ChatGPT"}}):e.jsx(d,{id:"MemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or create memories."})})}):p=e.jsx(y.Root,{className:"h-full",size:"compact",bordered:!0,children:e.jsx(y.Body,{children:M.map(c=>e.jsx(Cs,{gizmo:b?{id:b.id,name:b.name}:void 0,memory:c},c.id))})}),e.jsxs(q,{isOpen:!0,onClose:s,size:"custom",className:"max-w-5xl",type:"success",title:i.formatMessage({id:"MemoriesModal.title",defaultMessage:"Memory"}),showCloseButton:!0,children:[m&&C.length>1&&e.jsx("div",{className:"mb-4",children:e.jsx(_s,{selectedGizmoId:a,items:C,onSelect:c=>{o.invalidateQueries({queryKey:D(c)}),n(c)}})}),e.jsx(ps,{memoryFullPct:l?.memoryFullPct,className:"mb-5"}),e.jsx("div",{className:"h-[24rem]",children:p}),e.jsx("div",{className:"mt-5 flex justify-end",children:e.jsx(ws,{onReset:()=>{f(),X(),a&&n(void 0)},gizmoId:a,memoryName:b?.name??"ChatGPT"})})]})}const Ts=Object.freeze(Object.defineProperty({__proto__:null,default:ks},Symbol.toStringTag,{value:"Module"}));export{bs as M,ks as a,Ts as b,J as u};
//# sourceMappingURL=k2iylpnfqz5ejvm7.js.map
