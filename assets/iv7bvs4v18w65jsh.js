const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/b7howrbdmac4j8g3.js","assets/njq6ygky3ttysgdk.js","assets/fs6h2trisr1juto6.js","assets/root-cl538jor.css","assets/lj0prj6na7gf1jpf.js","assets/d7a6rc8fexfzu7dt.js","assets/conversation-small-m9kq0y4e.css","assets/csg4i0wk6hi0jvkd.js","assets/ijutvl794yycgs5p.js","assets/n9whwsbg0rx5cs8k.js","assets/o3d0pfqxdj7nivvr.js","assets/loh8e64j4csffv26.js","assets/kukctmibghbbqwq7.js","assets/gunpso70jnmarvod.js","assets/jyg6m0czwgwjnl3i.js","assets/en8ogvlmn3lccz09.js","assets/gvhvfcdqhc5unmaw.js","assets/wqepkoieaii7q4ep.js","assets/fu6bathgya5b9rdr.js","assets/gfo75oujoeaedm5y.js","assets/crv164w6r8tn71zi.js","assets/dr3h4pxnog1msvu6.js","assets/mi16gkof274z4h73.js","assets/hp3ocwib8mmnarbi.js","assets/jhoqcbqmt1jrh2rh.js","assets/m97sb2fnwj0a6vyo.js","assets/cm0hdcditutj2jz2.js","assets/jcoe6v231ph25bfi.js","assets/jm06rasheqbw3hij.js","assets/btjgsqbipn1ns9gv.js","assets/m3ph5kqqbcm52gd5.js"])))=>i.map(i=>d[i]);
import{d as S,gJ as Pe,Z as Ee,D as le,aF as ce,bT as J,S as R,a as M,P as k,bH as Ne,cL as Se,M as z,c6 as De,y as Te,T as se,bQ as Oe,bR as Le,I as He,gK as Fe,bw as Ze}from"./njq6ygky3ttysgdk.js";import{j as a,a5 as X,e as F,r as i,d as Be,b as ze}from"./fs6h2trisr1juto6.js";import{e4 as We,it as Ue,ch as Ve,lX as Ke,er as Ie,gW as pe,gY as he,bB as ge}from"./d7a6rc8fexfzu7dt.js";import{D as Xe,I as ie,a as xe,b as Ye,u as $e}from"./hp3ocwib8mmnarbi.js";import{C as Qe}from"./jm06rasheqbw3hij.js";import{a as j,I as W}from"./btjgsqbipn1ns9gv.js";import{A as Je}from"./loh8e64j4csffv26.js";import{E as qe}from"./dr3h4pxnog1msvu6.js";import{d as be}from"./mi16gkof274z4h73.js";import{I as et}from"./m3ph5kqqbcm52gd5.js";const Me=({children:e,isDimensionsUnknown:t})=>a.jsxs(X.div,{className:S(["relative max-w-[480px] rounded-2xl",t&&"aspect-square overflow-hidden"]),children:[a.jsx("div",{className:"pointer-events-none absolute inset-0 bg-token-main-surface-secondary"}),a.jsx("div",{className:"relative h-full",children:e})]}),tt=({cotMessages:e,visualPercentComplete:t,isInterrupted:n,state:s})=>{const c=F().formatMessage({id:"imagegen.thinkingHeader.interrupted",defaultMessage:"Stopped creating image"}),o=s===j.Complete||t===1,r=i.useMemo(()=>{if(n)return c;if(!e)return;if(o)return e.complete;if(t){const g=Object.keys(e.generating);for(let u=0;u<g.length;u+=1){const l=parseFloat(g[u]);if(t<l)return e.generating[g[u]]}}else return e.thinking;return e.complete},[e,c,n,o,t]);return r&&a.jsx(Qe,{activeHeadline:r,finishedText:r,isComplete:o||n,isExpandDisabled:!0})};function at({size:e=60,strokeWidth:t=2,arcPercentage:n=.25,ariaMessage:s,children:d}){const c=(e-t)/2,o=2*Math.PI*c,r=o*n,g=`${r} ${o-r}`;return a.jsxs("div",{className:"relative flex items-center justify-center",role:"progressbar","aria-live":"assertive","aria-valuetext":s,children:[a.jsxs(X.svg,{width:e,height:e,viewBox:`0 0 ${e} ${e}`,animate:{rotate:360},transition:{repeat:1/0,duration:1.2,ease:"linear"},children:[a.jsx("circle",{className:"text-[var(--sidebar-surface-secondary)]",stroke:"currentColor",fill:"transparent",strokeWidth:t,cx:e/2,cy:e/2,r:c}),a.jsx("circle",{className:"text-[var(--main-surface-primary-inverse)]",stroke:"currentColor",fill:"transparent",strokeWidth:t,strokeDasharray:g,strokeDashoffset:"0",strokeLinecap:"butt",cx:e/2,cy:e/2,r:c})]}),d&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:d})]})}function ve({withLottie:e}){const n=F().formatMessage({id:"imagegen.progressIndicator.ariaLabel",defaultMessage:"Generating image..."});return a.jsx("div",{className:"absolute left-0 top-0 flex h-full w-full items-center justify-center rounded-full","aria-label":n,children:a.jsx(at,{size:40,arcPercentage:.2,children:a.jsx(Xe,{animate:e,matchTextColor:!0,className:"h-6 w-6"})})})}function nt({messageId:e,serverThreadId:t,rating:n,onClose:s}){const d=F(),c=Object.entries(Pe).map(([r,g])=>({label:d.formatMessage(g),value:r})),o=async r=>{const g=c.map(u=>u.value);try{await Ee.submitMessageFeedback({message_id:e,conversation_id:t,rating:"thumbsDown",text:r.textFeedback??void 0,tags:r.tags,tag_choices:g})}catch(u){le.addError(`Failed to submit ${n} image generation feedback: ${u}`)}s()};return a.jsx("div",{onClick:r=>r.stopPropagation(),children:a.jsx(et,{tagOptions:c,modalOnly:!0,multiple:!0,onSubmit:o})})}const st="ChatGPT Image",it=300,de=1e3;function oe({rightAlign:e=!1,bottomAlign:t=!1,fullWidth:n=!1,justifyBetween:s=!1,children:d}){return a.jsxs("div",{className:S("absolute z-[2] opacity-0 transition-opacity duration-300 focus-within:opacity-100 group-hover/imagegen-image:opacity-100 group-focus/imagegen-image:opacity-100",e?"right-0":"left-0",t?"bottom-0":"top-0",n&&"w-full"),children:[a.jsx("div",{className:S(t?"bg-gradient-to-b":"bg-gradient-to-t","from-transparent to-black/30","h-20 w-full")}),a.jsx("div",{className:S("absolute inset-0 flex",t?"items-end pb-1 pt-3":"items-start pb-3 pt-1",e?"justify-end pr-1":"justify-start pl-1",s&&"justify-between"),children:d})]})}function K({icon:e,selected:t,onClick:n,ariaLabel:s}){return a.jsx("button",{className:S("z-[11] flex h-10 w-10 items-center justify-center rounded-xl hover:bg-token-icon-surface/10 focus:bg-token-icon-surface/10"),onClick:n,disabled:t,"aria-label":s,children:a.jsx(e,{style:{filter:"drop-shadow(0px 2px 4px rgba(0, 0, 0, 0.20))"},className:S("icon-lg",t?"fill-current text-white":"fill-transparent text-white")})})}function q(e){return t=>{t.stopPropagation(),e()}}const ot=({image:e,imageUrl:t,onEditorClick:n,isEditorAvailable:s,messageId:d,serverThreadId:c})=>{const{value:o}=ce("706943082"),r=F(),[g,u]=i.useState(!1),[l,m]=i.useState(null),[I,h]=i.useState(!0),[O,C]=i.useState(!1),_=l===null,x=p=>{_&&(R.logEvent(M.dalleImageRating,p?"like":"dislike",{liked:p?"true":"false",imageUrl:t??"",model:"gpt-4o"}),k.logEvent(M.dalleImageRating,{liked:p,imageUrl:t,model:"gpt-4o"}),R.logEvent("chatgpt_image_rating",p?"like":"dislike",{liked:p?"true":"false",imageUrl:t??"",model:"gpt-4o"}),k.logEvent(M.chatgptImageRating,{liked:p,imageUrl:t,model:"gpt-4o"}),m(p),h(!1),setTimeout(()=>{C(!0)},de))},y=i.useCallback(()=>{const p=new Date,N=r.formatDate(p,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});return`${st} ${N}.png`},[r]),P=We(),E=Ue(),D=E?.type===Ve.Image&&E.image.asset_pointer===e?.asset_pointer;return a.jsxs(a.Fragment,{children:[P?!D&&a.jsx(oe,{rightAlign:!0,fullWidth:!0,children:a.jsx(K,{icon:qe,ariaLabel:r.formatMessage(H.expand)})}):a.jsxs(a.Fragment,{children:[a.jsx(oe,{rightAlign:!0,fullWidth:!0,children:a.jsxs("div",{className:"flex flex-row",children:[s&&!o&&a.jsx(J,{sideOffset:4,label:r.formatMessage({id:"UH0Ly0",defaultMessage:"Edit image"}),side:"top",children:a.jsx(K,{icon:Ke,ariaLabel:r.formatMessage(H.inpaint),onClick:q(()=>{n?.(),R.logEvent(M.dalleImageClickInpaint,"click",{imageUrl:t??"",model:"gpt-4o"}),k.logEvent(M.dalleImageClickInpaint,{imageUrl:t,model:"gpt-4o"}),R.logEvent("chatgpt_image_inpaint_click",void 0,{imageUrl:t??"",model:"gpt-4o"}),k.logEvent(M.chatgptImageInpaintClick,{imageUrl:t,model:"gpt-4o"})})})}),t&&a.jsx(J,{sideOffset:4,label:r.formatMessage({id:"0EYire",defaultMessage:"Download"}),side:"top",children:a.jsx(K,{icon:Ie,ariaLabel:r.formatMessage(H.download),onClick:q(()=>{be({url:t,fileName:y()}),R.logEvent(M.dalleImageDownload,"click",{imageUrl:t??"",model:"gpt-4o"}),k.logEvent(M.dalleImageDownload,{imageUrl:t,model:"gpt-4o"}),R.logEvent("chatgpt_image_download",void 0,{imageUrl:t,model:"gpt-4o"}),k.logEvent(M.chatgptImageDownload,{imageUrl:t,model:"gpt-4o"})})})}),!1]})}),a.jsx(oe,{bottomAlign:!0,rightAlign:!0,fullWidth:!0,justifyBetween:_,children:a.jsxs("div",{className:S("flex w-full items-center justify-between transition-opacity ease-in-out",I?"opacity-100":"opacity-0"),style:{transitionDuration:`${de}ms`},children:[a.jsx("div",{className:"flex items-center pl-4 font-semibold text-white",style:{textShadow:"0px 2px 4px rgba(0, 0, 0, 0.20)"},children:r.formatMessage(l===!0?H.feedbackMessage:H.rateThisImage)}),!O&&a.jsxs("div",{className:S("flex flex-row transition-opacity ease-in-out",l===!0?"opacity-0":"opacity-100"),style:{transitionDuration:`${it}ms`},children:[a.jsx(J,{sideOffset:4,label:r.formatMessage({id:"U99PVw",defaultMessage:"Like"}),side:"top",children:a.jsx(K,{icon:pe,onClick:q(()=>x(!0)),ariaLabel:r.formatMessage(H.thumbsUp)})}),a.jsx(J,{sideOffset:4,label:r.formatMessage({id:"ncGqTt",defaultMessage:"Dislike"}),side:"top",children:a.jsx(K,{icon:he,onClick:q(()=>{x(!1),u(!0)}),ariaLabel:r.formatMessage(H.thumbsDown)})})]})]})})]}),g&&a.jsx(nt,{messageId:d??"",serverThreadId:c??"",rating:l,onClose:()=>u(!1)})]})},H=Be({rateThisImage:{id:"imageGenActionOverlay.rateThisImage",defaultMessage:"Rate this image"},thumbsUp:{id:"imageGenActionOverlay.thumbsUp",defaultMessage:"Like this image"},thumbsDown:{id:"imageGenActionOverlay.thumbsDown",defaultMessage:"Dislike this image"},inpaint:{id:"imageGenActionOverlay.inpaint",defaultMessage:"Enter inpainting mode"},download:{id:"imageGenActionOverlay.download",defaultMessage:"Download this image"},expand:{id:"imageGenActionOverlay.expand",defaultMessage:"Expand this image"},feedbackMessage:{id:"imageGenActionOverlay.feedbackMessage",defaultMessage:"Thanks for your feedback"}}),rt=({metadata:e,assetPointer:t,messageId:n,serverThreadId:s})=>({conversationId:s,messageId:n,generationId:e?.generation?.gen_id,parentGenerationId:e?.generation?.parent_gen_id,fileId:t&&ge(t)}),ue=({liked:e,commonEventMetadata:t})=>{const n=e?"like":"dislike";R.logEvent("chatgpt_imagegen_image_paragen_rating",void 0,{liked:n,hasParent:t.parentGenerationId?"true":"false"}),k.logEvent(M.chatgptImageGenImageParagenRating,{liked:e,...t})},lt=({commonEventMetadata:e})=>{R.logEvent("chatgpt_imagegen_image_paragen_download",void 0,{hasParent:e.parentGenerationId?"true":"false"}),k.logEvent(M.chatgptImageGenImageParagenDownload,{...e})},gt=({commonEventMetadata:e})=>{R.logEvent("chatgpt_imagegen_image_paragen_complete",void 0,{hasParent:e.parentGenerationId?"true":"false"}),k.logEvent(M.chatgptImageGenImageParagenComplete,{...e})},me=Ne.div`invisible absolute top-3 flex gap-1 group-hover/paragen-image:visible z-[2]
  ${({$rightAlign:e})=>e?"right-3":"left-3"}`,ct=({imageUrl:e,commonEventMetadata:t})=>{const[n,s]=i.useState(void 0),d=F(),c=i.useCallback(()=>{const o=new Date;return`${d.formatDate(o,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}.png`},[d]);return a.jsxs("div",{className:"group/paragen-image absolute inset-0 z-[3]",children:[a.jsxs(me,{children:[n!==!1&&a.jsx(ie,{icon:pe,selected:n===!0,onClick:o=>{o.stopPropagation(),ue({liked:!0,commonEventMetadata:t}),s(!0)}}),n!==!0&&a.jsx(ie,{icon:he,selected:n===!1,onClick:o=>{o.stopPropagation(),ue({liked:!1,commonEventMetadata:t}),s(!1)}})]}),a.jsx(me,{$rightAlign:!0,children:a.jsx(ie,{icon:Ie,onClick:o=>{o.stopPropagation(),lt({commonEventMetadata:t}),be({url:e,fileName:c()})}})})]})},dt="data:image/svg+xml;base64,PHN2ZwogIHdpZHRoPSIzNiIKICBoZWlnaHQ9IjM2IgogIHZpZXdCb3g9IjAgMCAzNiAzNiIKICBmaWxsPSJub25lIgogIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKPgogIDxnIGNsaXAtcGF0aD0idXJsKCNjbGlwMF80NjY1XzIzMzApIj4KICAgIDxyZWN0IHdpZHRoPSIzNiIgaGVpZ2h0PSIzNiIgZmlsbD0id2hpdGUiIC8+CiAgICA8cmVjdCB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIGZpbGw9IiMxRTFFMUUiIC8+CiAgICA8cmVjdCB4PSIxOCIgd2lkdGg9IjE4IiBoZWlnaHQ9IjE4IiBmaWxsPSJibGFjayIgLz4KICAgIDxyZWN0IHg9IjE4IiB5PSIxOCIgd2lkdGg9IjE4IiBoZWlnaHQ9IjE4IiBmaWxsPSIjMUUxRTFFIiAvPgogICAgPHJlY3QgeT0iMTgiIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCIgZmlsbD0iYmxhY2siIC8+CiAgPC9nPgogIDxkZWZzPgogICAgPGNsaXBQYXRoIGlkPSJjbGlwMF80NjY1XzIzMzAiPgogICAgICA8cmVjdCB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIGZpbGw9IndoaXRlIiAvPgogICAgPC9jbGlwUGF0aD4KICA8L2RlZnM+Cjwvc3ZnPgo=",ut="data:image/svg+xml;base64,PHN2ZwogIHdpZHRoPSIzNiIKICBoZWlnaHQ9IjM2IgogIHZpZXdCb3g9IjAgMCAzNiAzNiIKICBmaWxsPSJub25lIgogIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKPgogIDxnIGNsaXAtcGF0aD0idXJsKCNjbGlwMF80NjY1XzIzMTkpIj4KICAgIDxyZWN0IHdpZHRoPSIzNiIgaGVpZ2h0PSIzNiIgZmlsbD0id2hpdGUiIC8+CiAgICA8cmVjdCB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIGZpbGw9IiNFRkVGRjAiIC8+CiAgICA8cmVjdCB4PSIxOCIgd2lkdGg9IjE4IiBoZWlnaHQ9IjE4IiBmaWxsPSJ3aGl0ZSIgLz4KICAgIDxyZWN0IHg9IjE4IiB5PSIxOCIgd2lkdGg9IjE4IiBoZWlnaHQ9IjE4IiBmaWxsPSIjRUZFRkYwIiAvPgogICAgPHJlY3QgeT0iMTgiIHdpZHRoPSIxOCIgaGVpZ2h0PSIxOCIgZmlsbD0id2hpdGUiIC8+CiAgPC9nPgogIDxkZWZzPgogICAgPGNsaXBQYXRoIGlkPSJjbGlwMF80NjY1XzIzMTkiPgogICAgICA8cmVjdCB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIGZpbGw9IndoaXRlIiAvPgogICAgPC9jbGlwUGF0aD4KICA8L2RlZnM+Cjwvc3ZnPgo=",Ce=300,mt=1.3,ft=.05,It=/blur\(([\d.]+)px\)/,pt={duration:Ce/1e3,ease:"linear"};function re(e,t,n){e.sort((o,r)=>o.lastSrcReceivedTime-r.lastSrcReceivedTime);const s=new Array(e.length).fill(0);for(let o=0;o<=e.length;o+=1){const r=o-1,g=o,u=e[r]?.availablePercentComplete??0,l=e[g]?.availablePercentComplete??1;if(t>=u&&t<=l&&u!==l){const m=(t-u)/(l-u);s[r]=1-m,s[g]=m}}const d=s[s.length-1],c=s[s.length-2];return d===1&&c===0&&(s[s.length-2]=.01),n&&t<=e[0]?.availablePercentComplete&&(s[0]=1),s}const ht=({alt:e,src:t,availablePercentComplete:n,onAnimationUpdate:s,isInterrupted:d,commonEventMetadata:c,onEditorClick:o,isEditorAvailable:r,ignoreFirstChunk:g=!1,isMultiGen:u=!1,messageId:l,serverThreadId:m,isTransparent:I=!1,dimensions:h,onError:O})=>{const C=Se(),_=i.useMemo(()=>`url(${C?dt:ut})`,[C]),[x,y]=i.useState(!1),[P,E]=i.useState(1e3),[D,p]=i.useState(n??0),[N,b]=i.useState(0),Z=i.useRef(performance.now()),ee=i.useRef(0),te=i.useContext(xe),G=i.useRef([]),[f,w]=i.useState([0]),[L,ae]=i.useState(!1),U=i.useRef(!1),Y=i.useRef(null),$=D===1,T=n===1&&L,B=h?h.width/h.height:1;i.useEffect(()=>{!x&&n&&(y(!0),ee.current=performance.now())},[x,n]),i.useEffect(()=>{const v=G.current[G.current.length-1]?.src;if(t&&t!==v){const A=G.current.findIndex(V=>V.availablePercentComplete===n);A!==-1?G.current[A]={src:t,availablePercentComplete:n??0,lastSrcReceivedTime:performance.now()}:G.current.push({src:t,availablePercentComplete:n??0,lastSrcReceivedTime:performance.now()}),w(re(G.current,D,g))}},[t,D,g,n]);const je=i.useCallback(()=>{Y.current&&n&&(E(T?Ce:(performance.now()-Z.current)*mt),(!g||U.current||n>=ft)&&n!==1&&b(n),U.current=!0,Z.current=performance.now())},[n,T,g]),Ge=i.useCallback(v=>{const A=parseFloat(v.height)/100;s?.(A),p(A),w(re(G.current,parseFloat(v.height)/100,g))},[s,g]),ye=i.useCallback(v=>{const A=v.filter.toString().match(It)?.[1]??"0",Q=(16-parseFloat(A))/16,ke=1-N,ne=N+ke*Q;s?.(ne),p(ne),w(re(G.current,ne,g))},[g,N,s]);if(!x)return d?null:a.jsx(Me,{isDimensionsUnknown:!0,children:a.jsx(ve,{withLottie:!0})});const we={duration:P/1e3,ease:"linear"},Ae=u?"rounded-lg":"rounded-2xl",Re=n!==1||!I;return a.jsxs("div",{tabIndex:0,role:"button",className:S("group/imagegen-image relative z-[0] w-full cursor-pointer overflow-hidden",B<1?"max-w-[400px]":"max-w-[480px]",Ae,!$&&"pointer-events-none",!U.current&&"bg-token-main-surface-secondary"),"aria-label":e,onClick:r?o:void 0,style:{aspectRatio:B},children:[a.jsxs(X.div,{className:"absolute left-0 right-0 top-0 z-[2] w-full overflow-hidden transition-[mask] ease-linear",initial:T?!1:{height:"0%"},animate:$?{height:"100%"}:{height:`${N*100}%`},onUpdate:T?void 0:Ge,transition:T?{duration:0,ease:"linear"}:we,style:$?void 0:{mask:"linear-gradient(rgb(0,0,0) 0%, rgb(0,0,0) calc(100% - 24px), rgba(0,0,0,0) 100%)"},children:[t&&a.jsx("img",{ref:Y,src:t,onLoad:je,onError:O,alt:e,className:"absolute top-0 z-[1] w-full",style:{aspectRatio:B}}),I&&a.jsx("div",{className:"absolute inset-0 z-[0] w-full overflow-hidden opacity-0 transition-opacity duration-300 group-hover/imagegen-image:opacity-100 group-focus/imagegen-image:opacity-100",children:a.jsx("div",{className:"absolute inset-0 bg-repeat",style:{backgroundImage:_,backgroundSize:"auto"}})})]}),a.jsx(X.div,{className:"relative z-[1] w-full overflow-hidden",initial:{filter:"blur(16px)"},animate:T?{filter:"blur(0px)"}:void 0,transition:T?pt:void 0,onUpdate:T?ye:void 0,style:{aspectRatio:B},children:G.current.map((v,A)=>{const V=f[A],Q=v.availablePercentComplete===1;return V!==0||Q?a.jsx("img",{src:v.src,alt:e,style:{opacity:V,willChange:"opacity",aspectRatio:B},className:"absolute top-0 w-full",onLoad:Q?()=>ae(!0):void 0},v.src):null})}),a.jsx(X.div,{className:"absolute inset-0 z-[0] scale-110 overflow-hidden blur-2xl",style:{aspectRatio:B},children:Re&&G.current.filter((v,A)=>f[A]!==0).map(v=>a.jsx("img",{src:v.src,alt:e,className:"absolute top-0 w-full"},v.src))}),$&&(te?a.jsx(ct,{commonEventMetadata:c,imageUrl:t??""}):a.jsx(ot,{image:t?{asset_pointer:t,alt:e,fileId:c.fileId}:void 0,imageUrl:t,onEditorClick:o,isEditorAvailable:r,messageId:l,serverThreadId:m}))]})},fe=2,xt=({pointer:e,altLabel:t,isInterrupted:n,isEditorAvailable:s,onPercentageRendered:d,messageId:c,serverThreadId:o,isMultiGen:r,onEditorClick:g})=>{const u=ze(),[l,m]=i.useState(void 0),I=i.useRef(void 0),h=e.metadata?.generation?.gen_id,O=e?.metadata?.generation?.height??void 0,C=e?.height,_=(O??0)/C,x=i.useRef({}),y=i.useCallback((b=!1)=>{!b&&I.current===e.asset_pointer||(I.current=e.asset_pointer,Je.fetch(u,{asset:e,conversationId:o,force:b}).then(Z=>{m(Z)}).finally(()=>{I.current=void 0}))},[e,u,o]);i.useEffect(()=>{const b=e.asset_pointer!==l?.asset_pointer;(!l||b)&&y()},[l,e.asset_pointer,y]);const P=i.useMemo(()=>rt({metadata:e.metadata,assetPointer:e.asset_pointer,messageId:c,serverThreadId:o}),[e.asset_pointer,e.metadata,c,o]),E=i.useRef(_);i.useEffect(()=>{_===1&&E.current<1&&gt({commonEventMetadata:P})},[_,P]);const D=i.useCallback(()=>{l&&g?.({image:l,messageId:c})},[l,c,g]),p=i.useMemo(()=>({width:e.width,height:e.height}),[e]),N=i.useCallback(()=>{const b=(x.current[e.asset_pointer]??0)+1;if(x.current[e.asset_pointer]=b,x.current[e.asset_pointer]>fe)return le.addAction("image-gen-asset-error",{name:"retries-exhausted",conversation_id:o,asset_pointer:e.asset_pointer,max_retries:fe});le.addAction("image-gen-asset-retry",{name:"retry-attempted",conversation_id:o,asset_pointer:e.asset_pointer,current_retry:b}),x.current[e.asset_pointer]=b,y(!0)},[e.asset_pointer,y,o]);return a.jsx("div",{children:a.jsx(ht,{alt:t,src:l?.url,availablePercentComplete:_,onAnimationUpdate:d,isInterrupted:n,commonEventMetadata:P,onEditorClick:D,isEditorAvailable:s,ignoreFirstChunk:!0,isMultiGen:r,isTransparent:e.metadata?.generation?.transparent_background,messageId:c,serverThreadId:o,dimensions:p,onError:N},h)},h)};function bt(e){const t=e.find(o=>o.author.role==="tool"&&o.author.name===W&&o.content.content_type==="text"),[n,...s]=t?.content.content_type==="text"?t.content.parts:[],d=s.pop(),c=s.length;return n&&d&&s.length>0?{thinking:n,complete:d,generating:s.reduce((o,r,g)=>{const u=(g+1)/c;return o[u.toFixed(2)]=r,o},{})}:void 0}function _e(e){const t=e.filter(s=>s.author.role==="tool"&&s.author.name===W&&s.content.content_type===z.MultimodalText),n=t.flatMap(s=>De.getImageAssetPointers(s));return{imageGenRenderingMessages:t,imageAssetPointers:n}}const Mt=e=>{const t=e.find(l=>l.author.role===Te.Tool&&[z.Error,z.SystemError].includes(l.content.content_type)),{imageAssetPointers:n}=_e(e),s=e.some(l=>{const m=l.author.name===W,I=l.content.content_type===z.MultimodalText,h=!!l.metadata?.is_visually_hidden_from_conversation;return m&&I&&h}),d=e.some(l=>{const m=l.author.name===se.IMAGE_GEN_HALLUCINATED||l.author.name===W,I=l.content.content_type===z.Text,h=!!l.metadata?.is_visually_hidden_from_conversation;return m&&I&&h}),o=!e.some(l=>[W,se.IMAGE_GEN_HALLUCINATED].includes(l.author.name??"")&&l.content.content_type===z.MultimodalText)&&e.some(l=>{const m=[W,se.IMAGE_GEN_HALLUCINATED].includes(l.author.name??""),I=l.recipient==="assistant";return m&&I});let r=0;for(const l of n){const m=l.height,I=l.metadata?.generation?.height??void 0;r+=m!==void 0&&I!==void 0?I/m:0}const g=n.length>0?r/n.length:0,u=t!==void 0;if(s||d||o)return j.Empty;if(u)return j.Errored;if(g){if(g<1)return j.Generating;if(g===1)return j.Complete}else return j.Thinking;return j.Unavailable},vt=e=>{const t=F(),{size:n="image",count:s=1}=e||{};return s>1?{thinking:t.formatMessage({id:"cdnmKo",defaultMessage:"Getting started"}),generating:{"0.33":t.formatMessage({id:"aTbInH",defaultMessage:"Creating images. May take a moment."}),"0.67":t.formatMessage({id:"WRM3Yw",defaultMessage:"Creating images. May take a moment."}),"1.00":t.formatMessage({id:"8ZydRG",defaultMessage:"Creating images. May take a moment."})},complete:t.formatMessage({id:"XQ81dl",defaultMessage:"Images created"})}:n==="xlimage"?{thinking:t.formatMessage({id:"y7op2E",defaultMessage:"Getting started"}),generating:{"0.33":t.formatMessage({id:"cdrDJH",defaultMessage:"Creating image. May take a moment."}),"0.67":t.formatMessage({id:"RP4bRn",defaultMessage:"Adding details"}),"1.00":t.formatMessage({id:"o36MSQ",defaultMessage:"Finishing touches"})},complete:t.formatMessage({id:"QsnnBN",defaultMessage:"Image created"})}:{thinking:t.formatMessage({id:"6c7+kN",defaultMessage:"Getting started"}),generating:{"0.33":t.formatMessage({id:"DP6/8y",defaultMessage:"Creating image"}),"0.67":t.formatMessage({id:"k9y1TT",defaultMessage:"Creating image"}),"1.00":t.formatMessage({id:"GpR7v3",defaultMessage:"Creating image"})},complete:t.formatMessage({id:"l2Izz4",defaultMessage:"Image created"})}},Ct=Oe(async()=>Le(()=>import("./b7howrbdmac4j8g3.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30])).then(e=>e.ImageGenNewEditor)),_t=({messages:e,clientThreadId:t,disableClickThru:n=!1})=>{const{value:s}=ce("2712556596"),d=s?jt:Ye;return a.jsx(d,{messages:e,clientThreadId:t,disableClickThru:n})},jt=({messages:e,clientThreadId:t,disableClickThru:n=!1})=>{const s=He(t),d=F(),c=d.formatMessage({id:"imagegen.message.altLabel",defaultMessage:"Generated image"}),[o,r]=i.useState(!1),[g,u]=i.useState(null),{imageGenRenderingMessages:l,imageAssetPointers:m}=i.useMemo(()=>_e(e),[e]),I=m?.[0]?.metadata?.generation?.gen_size,h=vt({size:I??"image",count:m?.length??1}),O=i.useMemo(()=>bt(e)??h,[e,h]),C=i.useMemo(()=>Mt(e),[e]),_=e[e.length-1],x=i.useMemo(()=>_&&Fe(_),[_]),{value:y}=ce("3058498100"),P=i.useMemo(()=>y?m:m.slice(0,1),[y,m]),E=P.length>1,D=$e({clientThreadId:t}),[p,N]=i.useState(0),b=i.useRef({}),Z=i.useCallback(f=>w=>{b.current[f]=w;const L=Object.keys(b.current).length,ae=Object.values(b.current).reduce((U,Y)=>U+Y,0);N(ae/L)},[]),[ee,te]=i.useState(null),G=i.useCallback(({image:f,messageId:w})=>{u(f),te(w),r(!0),R.logEvent(M.dalleImageViewFull,null,{sourceOperation:f.metadata?.dalle?.edit_op??"none",hasParent:f.metadata?.dalle?.parent_gen_id?"true":"false",model:"gpt-4o"}),k.logEvent(M.dalleImageViewFull,{conversationId:s,messageId:w,generationId:f.metadata?.dalle?.gen_id,parentGenerationId:f.metadata?.dalle?.parent_gen_id,fileId:ge(f.asset_pointer??""),sourceOperation:f.metadata?.dalle?.edit_op,model:"gpt-4o"}),R.logEvent("chatgpt_image_view_full",null,{sourceOperation:f.metadata?.dalle?.edit_op??"none",hasParent:f.metadata?.dalle?.parent_gen_id?"true":"false",model:"gpt-4o"}),k.logEvent(M.chatgptImageViewFull,{conversationId:s,messageId:w,generationId:f.metadata?.dalle?.gen_id,parentGenerationId:f.metadata?.dalle?.parent_gen_id,fileId:ge(f.asset_pointer??""),sourceOperation:f.metadata?.dalle?.edit_op,model:"gpt-4o"})},[s]);return[j.Empty,j.Errored].includes(C)?null:a.jsxs(xe.Provider,{value:n,children:[a.jsxs("div",{className:"flex flex-col",children:[C!==j.Unavailable&&a.jsx("div",{className:"pb-3",children:a.jsx(tt,{cotMessages:O,visualPercentComplete:p,isInterrupted:x,state:C})}),C===j.Thinking&&!x&&a.jsx(Me,{isDimensionsUnknown:!0,children:a.jsx(ve,{withLottie:!0})}),(C===j.Generating||C===j.Complete)&&a.jsx("div",{className:S("grid pb-2",{"grid-cols-2 gap-2":E,"grid-cols-1":!E}),children:P.map((f,w)=>{const L=f.metadata?.generation?.gen_id;return a.jsx(xt,{pointer:f,altLabel:c,isInterrupted:x,isEditorAvailable:D,onPercentageRendered:L?Z(L):void 0,messageId:l[w]?.id,serverThreadId:s,isMultiGen:E,onEditorClick:G},L)})})]}),a.jsx(Ze,{type:"success",size:"fullscreen",isOpen:o,onClose:()=>r(!1),title:d.formatMessage({id:"imagegen.message.contentModalTitle",defaultMessage:"Edit image"}),visuallyHiddenHeader:!0,className:"dark:bg-[--gray-800]",children:g&&a.jsx(Ct,{image:g,isLoadingNewImage:!1,clientThreadId:t,onClose:()=>r(!1),messageId:ee??""})})]})},Tt=Object.freeze(Object.defineProperty({__proto__:null,ImageGenMessage:_t},Symbol.toStringTag,{value:"Module"}));export{nt as I,Tt as i};
//# sourceMappingURL=iv7bvs4v18w65jsh.js.map
