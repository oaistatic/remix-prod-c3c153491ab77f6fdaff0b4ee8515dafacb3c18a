import{al as I,E as q,eQ as R,F as O,d as v,j as K,aG as Q,dE as V,aM as W,a3 as Y,am as X,aq as $,R as B,D as J,n as Z}from"./njq6ygky3ttysgdk.js";import{g3 as ee,M as te,U as re,g4 as N,y as se,g5 as ae,ez as oe,g6 as z,ed as ne,a2 as ie,eA as C,a9 as ce,o as le,e3 as ue,g7 as pe,g8 as L,g9 as me}from"./d7a6rc8fexfzu7dt.js";import{u as de}from"./ijutvl794yycgs5p.js";import{r as y,j as m,a5 as G,u as fe}from"./fs6h2trisr1juto6.js";import{u as he,a as Se,t as ye}from"./csg4i0wk6hi0jvkd.js";function xe(){const{store:e}=ee(),t=he(),{clearSystemHintModeTrigger:u,getSystemHintModeTrigger:r}=Se(),{value:p}=I("1988730211"),c=!te.useDisabledGlobally();return y.useCallback((d,a,h,l)=>{const f=e.getSharedProps();if(!f)return;const{clientThreadId:b,onCreateNewCompletion:w,onResetState:o,conversationMode:s}=f;re.hideThreadHeader();const n=t.has(N.Search),x=n?r(N.Search):void 0,E=q(b),{systemHints:T,extraStreamParams:g}=p?se(Array.from(t)):{systemHints:Array.from(t),extraStreamParams:{}};c&&(g.enableMessageFollowups=!0);const k=ae(),P={is_starter_prompt:!0,suggestion_type:a.type,starter_prompt_id:"id"in a?a.id:void 0};k&&(P.__internal={search_settings:k});const _=R(oe(a),P);w({promptMessage:_,sourceEvent:d,extraStreamParams:g,completionMetadata:{suggestions:h,suggestion:a,suggestionIndex:l,conversationMode:s??E?.mode,systemHints:T,searchSource:x}});const S=O.getCurrentNode(E).message.id;o(),z(a,l,b,S),ne()||ye(),x&&n&&u(N.Search)},[e,t,r,p,u,c])}function _e({suggestions:e,composerController:t,onSelect:u,onChange:r}){const{isUXUpdatesEnabled:p}=ie(),c=xe(),d=y.useCallback((o,s,n,x)=>{u?.(s,n,x),c(o,s,n,x)},[u,c]),[a,h]=y.useState(()=>e.length>0),[l,f]=y.useState(-1),[b,w]=y.useState(!1);return y.useEffect(()=>{const o=s=>{if(!s.isComposing)if(s.key==="ArrowDown"){const n=l===e.length-1?0:l+1;f(n),r?.(n,!0,e[n])}else if(s.key==="ArrowUp"){s.preventDefault();const n=l<=0?e.length-1:l-1;f(n),r?.(n,!0,e[n])}else s.key==="Enter"&&!s.shiftKey&&e[l]&&d(s,e[l],e,l)};return t.subscribe("keydown",o)},[e,l,r,d,t]),y.useEffect(()=>t.subscribe("blur",()=>{f(-1),h(!1),r?.(-1,!1)}),[t,r]),y.useEffect(()=>t.subscribe("focus",()=>h(!0)),[t]),y.useEffect(()=>{if(!b){const o=()=>{w(!0),window.removeEventListener("mousemove",o)};return window.addEventListener("mousemove",o),()=>{window.removeEventListener("mousemove",o)}}},[b]),y.useEffect(()=>{f(-1),r?.(-1,!1),w(!1)},[e,r]),m.jsx(G.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:v("w-full flex-col p-2.5 max-lg:flex-col-reverse",a?"flex":"hidden"),children:e.map((o,s)=>m.jsxs(G.li,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:{delay:s*.03},exit:{opacity:0,translateY:4},className:"w-full",children:[s>0&&m.jsx("div",{className:v("h-[1px] opacity-60 max-lg:hidden",l===s||l===s-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")}),m.jsxs("button",{className:v("flex w-full cursor-pointer items-center justify-start whitespace-pre-wrap rounded-lg px-2.5 py-3 text-start",l===s?"bg-token-main-surface-secondary":p?"bg-transparent":"bg-token-main-surface-primary"),onClick:n=>{n.preventDefault(),d(n,o,e,s)},onMouseDown:n=>{n.preventDefault()},onMouseEnter:()=>{b&&(f(s),r?.(s,!1,o))},onMouseLeave:()=>{f(-1),r?.(-1,!1,o)},children:[o.icon?m.jsx("span",{className:"mr-2 h-[18px] w-[18px] text-token-text-secondary",children:o.icon}):null,m.jsx("span",{className:"whitespace-pre-wrap text-sm",children:o.autocompletionChunks&&o.autocompletionChunks.length>0?m.jsx(m.Fragment,{children:o.autocompletionChunks.map((n,x)=>m.jsx("span",{className:v(n.isMatched?"text-token-text-tertiary":"text-token-text-primary"),children:n.text},x))}):m.jsxs(m.Fragment,{children:[m.jsx("span",{className:v(o.type===C.Starter||o.type===C.Trending?"text-token-text-secondary":"text-token-text-tertiary"),children:o.title}),m.jsx("span",{className:"text-token-text-primary",children:o.body})]})})]}),s>0&&m.jsx("div",{className:v("h-[1px] opacity-60 lg:hidden",l===s||l===s-1?"mx-2 bg-token-main-surface-secondary":"bg-token-border-light")})]},o.id??s))})}function be(e,t){e=e.toLocaleLowerCase();const u=t;t=t.toLocaleLowerCase();const r=[];let p=0;for(let a=0;a<t.length&&(p<e.length&&e[p]===t[a]&&(r.push(a),p++),p!==e.length);a++);const c=[];let d=0;if(r.forEach(a=>{if(a>d){const h=u.slice(d,a);h&&c.push({text:h,isMatched:!1})}c.push({text:u[a],isMatched:!0}),d=a+1}),d<t.length){const a=u.slice(d);a&&c.push({text:a,isMatched:!1})}return Me(c)}function Me(e){if(e.length===0)return e;let t=[e[0]];for(let r=1;r<e.length;r++){const p=t[t.length-1],c=e[r];p.isMatched===c.isMatched?p.text+=c.text:t.push(c)}const u=t.filter(r=>r.isMatched).reduce((r,p)=>r+p.text.trim().length,0);return t.length<=4&&u>=2?t:[{text:t.map(r=>r.text).join(""),isMatched:!1}]}function D(e){return(ce(e)?e.promptStarters:e.gizmo.display.prompt_starters)?.map(t=>({type:C.Starter,title:"",body:t,prompt:t}))}const we=()=>{const{isUnauthenticated:e}=K(),{layer:t}=Q("4031588851"),{layer:u}=V("3533083032");return!(e?u:t).get("web-disable",!1)},Le=({clientThreadId:e,limit:t,shouldBeEnabledForDefaultAssistant:u,isModelLoaded:r,modelSlug:p})=>{const c=de(),d=W(),a=Y(e,i=>i?.mode),h=le(a?.kind===X.GizmoInteraction?a.gizmo_id:void 0).data,{gizmoEditorData:l,mode:f}=ue(),b=we(),w=pe(a),o=$(),s=b&&u&&!w&&!o?.isEnterprisey(),{data:n,isSuccess:x}=fe({queryKey:["promptStarters",e,t,p],queryFn:async()=>{const i=await B.safeGet("/prompt_library/",{parameters:{query:{limit:t,use_v2:!0,model_slug:p}},anonAware:!0});return J.addFirstTiming("load.promptStarters"),i},enabled:s});if(d==null)return{promptStarters:[],isLoading:!0,isSuccess:!1};if(f==="test"&&l)return{promptStarters:D(l)??[],isLoading:!1,isSuccess:!0};if(h!=null)return{promptStarters:D(h),isLoading:!1,isSuccess:!0};if(!s)return{promptStarters:[],isLoading:!1,isSuccess:!0};const E=n?.items.map(i=>({type:C.Starter,id:i.id,title:i.title,body:i.description,prompt:i.prompt,category:i.category,oneliner:i.oneliner,theme:i.theme,requires_file_upload:i.requires_file_upload}))??[],T=(i,S,ge,H)=>{const F=S.title;c.setAutocompletions([]),c.focus(),c.setText(F),requestAnimationFrame(()=>{const A=E.filter(M=>M.theme===S.theme).map(M=>{const j=Z(M.oneliner),U=j.startsWith(M.title);return{...M,title:U?`${M.title} `:"",body:U?M.body:j,autocompletionChunks:be(F,j),type:C.Autocomplete}});c.setAutocompletions(A),A.length>0&&me(A,e),z(S,H,e)})},g=E?.reduce((i,S)=>(S.theme&&!i[S.theme]&&(i[S.theme]=S),i),{}),k=[];if(g)for(const i in g)i!=="For you"&&k.push(g[i]);const P=k.length>0,_=!!(u&&x&&P&&r);return u&&(L.markStart("StarterPromptChips",L.NS_COMPOSER),_&&L.markRendered("StarterPromptChips",L.NS_COMPOSER)),{onSelectStarterPrompt:T,shouldShowStarterPrompts:_,promptStarters:k}};export{_e as A,we as a,Le as b,D as g,xe as u};
//# sourceMappingURL=jyg6m0czwgwjnl3i.js.map
