const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jpl5qao05rdthsry.js","assets/fs6h2trisr1juto6.js"])))=>i.map(i=>d[i]);
import{e as R,r as j,b as Qe,j as e,M as x,n as Z,u as Ve,v as Se,L as Xe}from"./fs6h2trisr1juto6.js";import{bk as Ke,j$ as B,da as Ne,af as xe,dd as We,bE as c,de as $e,df as fe,dg as Ze,d8 as N,dh as Ye,dl as Je,dq as J,di as es,dn as ss,ad as ts,ds as G,du as ns,he as as,k0 as rs,k1 as K,e2 as os,k2 as Ce,jk as is,k3 as we,k4 as _e,d0 as V,c$ as Ie,k5 as Me,jz as ls,k6 as cs,c_ as ds,dy as L,cY as us,cZ as ms,k7 as pe,db as xs,k8 as ee,k9 as fs,cq as ps,ka as se,c4 as hs,kb as gs,kc as js,kd as oe,ke as vs,kf as Y,o as ys,kg as he,hd as bs,kh as ks,ki as Ss,kj as Ns,kk as te,kl as Cs,km as ws,kn as _s,ko as Is,dG as Fe,ek as Ms,fV as Fs,fT as Ps,kp as Ts,d as Es,kq as ge,kr as Ds,ks as Us}from"./d7a6rc8fexfzu7dt.js";import{g as Rs,D as ne,P as Os}from"./kukctmibghbbqwq7.js";import{G as As}from"./ohq33fk3dbalo2mk.js";import{bQ as zs,bR as Bs,bH as q,V as W,aq as Gs,dA as je,bw as ie,c5 as ae,d as C,c3 as P,c4 as Ls,aA as qs,Z as Hs,cD as Pe,eG as Qs,aD as Vs,gv as Xs,by as X,ci as re,aB as Ks,P as le,a as ce,cw as Ws,e8 as Te,cZ as $s,co as Zs,cJ as Ys,a3 as Js,g5 as et}from"./njq6ygky3ttysgdk.js";import{i as st}from"./hg126uudzxua38kv.js";import{P as tt}from"./ijutvl794yycgs5p.js";import{a as ve}from"./bhsw6t55h66bayr8.js";import{F as nt}from"./bkmz6jrk6gvxlvc5.js";import{f as at}from"./m89x2zftpo6hrypr.js";import{G as rt}from"./wqepkoieaii7q4ep.js";import"./lj0prj6na7gf1jpf.js";import"./csg4i0wk6hi0jvkd.js";import"./gunpso70jnmarvod.js";import"./jyg6m0czwgwjnl3i.js";import"./en8ogvlmn3lccz09.js";import"./gvhvfcdqhc5unmaw.js";import"./fu6bathgya5b9rdr.js";import"./gfo75oujoeaedm5y.js";import"./n9whwsbg0rx5cs8k.js";const Ee=zs(()=>Bs(()=>import("./jpl5qao05rdthsry.js"),__vite__mapDeps([0,1])).then(s=>s.DirectorySyncResourceManagedIndication));function ot(s,t){return s.type===N.USER?s.user_id===t.user_id:s.type===N.GROUP?s.group_id===t.group_id:s.type===t.type}function it({gizmo:s,publishedGizmo:t,onClose:a}){const n=R(),r=W(),o=Gs(),d=Ke(),i=B(),[l,u]=j.useState(s.sharing?.subjects??[]),[g,p]=j.useState(!1),v=j.useCallback(()=>!je(s.sharing?.subjects,l),[s.sharing,l]),y=Qe(),f=Ne(s);function k(m){l.find(_=>ot(_,m))||u([...l,m])}function h(m,_,I){return m.type===N.USER&&m.user_id.indexOf("__")===-1?{...m,user_id:m.user_id+"__"+o?.getWorkspaceId()}:m}async function b(m){if(g)return;p(!0);const _=l.map(h);await i.mutateAsync({id:m,update:{sharing:{recipient:xe.Private,subjects:_}}}),p(!1),a(),y.invalidateQueries({queryKey:["gizmos"]}),y.refetchQueries({queryKey:["gizmos","discovery"]}),y.refetchQueries({queryKey:["gizmo",{gizmoId:m}]}),y.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:m}]}),y.invalidateQueries({queryKey:["workspace"]})}const S=!t||dt(t.gizmo.author.user_id.split("__")[0],d?.id);return e.jsx(ie,{type:"success",className:"max-w-[555px]",size:"custom",isOpen:!0,onClose:a,primaryButton:e.jsx(ae,{onClick:()=>b(t.gizmo.id),loading:g,disabled:f.length>0||!st(xe.Private,s.sharingTargets),children:e.jsx(x,{id:"BEKjVh",defaultMessage:"Save"})}),secondaryButton:e.jsxs(e.Fragment,{children:[v()&&e.jsx("div",{className:"absolute bottom-8 left-6 text-sm text-token-text-secondary",children:e.jsx(x,{id:"9CkgC4",defaultMessage:"Unsaved changes"})}),t&&e.jsx(ae,{color:"secondary",onClick:m=>We(t,r,m,n.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(x,{id:"bbhdTf",defaultMessage:"Copy link"})})]}),title:n.formatMessage(c.projectShareTitle),showCloseButton:!0,children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx(ct,{onAdd:m=>k(m),publishedGizmo:t}),e.jsx("h3",{className:"text-base font-semibold",children:e.jsx(x,{id:"bNQXcV",defaultMessage:"Share with..."})}),e.jsxs("div",{className:"max-h-[200px] space-y-2 overflow-y-auto",children:[e.jsxs("div",{className:"mb-4 flex flex-row items-center justify-between space-x-3",children:[e.jsx("div",{className:"shrink-0 grow-0 self-start",children:S?e.jsx($e,{user:d,size:"gizmoConversation",roundedStyle:"rounded-full"}):e.jsx(fe,{name:t.gizmo.author.display_name??"User",initialsCount:2,size:"gizmoConversation"})}),e.jsx("div",{className:"grow text-base font-semibold",children:S?e.jsxs("div",{className:"flex flex-col",children:[e.jsx(x,{id:"U7tzof",defaultMessage:"{userName} (you)",values:{userName:d?.name}}),e.jsx("span",{className:"-mt-1 text-sm text-token-text-secondary",children:d?.email})]}):e.jsx(x,{id:"FBF0QC",defaultMessage:"{userName} (owner)",values:{userName:t.gizmo.author.display_name}})})]}),l.map((m,_)=>Ze(m)&&e.jsxs("div",{className:"mb-4 flex flex-row items-center justify-between space-x-3",children:[e.jsx(fe,{name:m.type===N.GROUP?m.group_name:`${m.user_name} ${m.user_email}`,initialsCount:m.type===N.USER?2:1,size:"gizmoConversation",className:C("shrink-0 grow-0",m.type===N.USER&&"self-start")}),e.jsxs("div",{className:"flex grow flex-col",children:[e.jsxs("span",{className:"flex flex-row",children:[e.jsx("span",{className:"mr-2 text-base font-semibold",children:m.type===N.GROUP?m.group_name:m.user_name}),m.type===N.GROUP&&m.is_scim_managed&&e.jsx(Ee,{})]}),m.type===N.USER&&e.jsx("span",{className:"-mt-1 text-sm text-token-text-secondary",children:m.user_email})]}),e.jsxs(P.Root,{children:[e.jsxs(P.Trigger,{className:"whitespace-nowrap text-base text-token-text-secondary",children:[e.jsx(x,{...De(m.capabilities)}),e.jsx(Ye,{className:"icon-md"})]}),e.jsx(P.Portal,{children:e.jsxs(P.Content,{className:"max-w-[320px]",children:[[Je,J].map((I,H)=>e.jsx(lt,{capabilities:I,selected:je(I,m.capabilities),onClick:()=>{u(l.map(O=>O===m?{...O,capabilities:I}:O))}},H)),e.jsx(P.Separator,{className:"my-2"}),e.jsx(P.Item,{onClick:()=>u(l.filter(I=>I!==m)),color:"danger",icon:es,children:e.jsx(x,{id:"NU0BOB",defaultMessage:"Remove"})})]})})]})]},_))]}),e.jsx("hr",{className:"border-token-border-medium"}),e.jsx("div",{className:"text-sm text-token-text-secondary",children:e.jsx(x,{id:"GkuPg+",defaultMessage:"Project conversations are private regardless of these settings."})})]})})}function De(s){return s.can_write?Z({id:"vsUknl",defaultMessage:"Can edit"}):s.can_view_config?Z({id:"4ceJzB",defaultMessage:"Can chat"}):Z({id:"x2E8ET",defaultMessage:"Unknown"})}function lt({capabilities:s,selected:t,onClick:a}){let n=null;s.can_write?n=G:s.can_view_config&&(n=ns);const r=s.can_write?e.jsx(x,{id:"r5Iods",defaultMessage:"Chat, edit files & instructions, and duplicate"}):e.jsx(x,{id:"bIM51p",defaultMessage:"Chat, view files & instructions, and duplicate"});return e.jsxs(P.Item,{className:"flex h-auto flex-row items-center px-3 py-3",onClick:a,icon:n,children:[e.jsxs("div",{className:"mr-1 flex grow flex-col",children:[e.jsx("span",{className:"mb-0.5 text-base leading-tight",children:e.jsx(x,{...De(s)})}),e.jsx("span",{className:"text-xs text-token-text-secondary",children:r})]}),e.jsx(Ls,{className:C("icon-lg shrink-0",!t&&"invisible")})]})}const ye=q.li`flex flex-col rounded-sm p-1 hover:bg-token-main-surface-secondary`;function ct({onAdd:s,publishedGizmo:t}){const a=R(),n=qs(),[r,o]=j.useState(""),d=ss(n?.id,0,r,5),i=n?.data?.name??"your workspace",l=d.data?.items.filter(h=>h.account_user_id!==t?.gizmo.author.user_id),{data:u}=Ve({queryKey:[n?.id,"groups","filtered",r],queryFn:n?()=>Hs.getWorkspaceGroups(n.id,{query:r,orderby:"@score"}):void 0,enabled:r.trim()!==""&&n!=null&&!!n.getWorkspaceId()}),g=(l?.length??0)>0||(u?.items.length??0)>0,[p,v]=j.useState(!1);function y(h,b,S){s({type:N.GROUP,group_id:h,group_name:b,capabilities:{...J},is_scim_managed:S}),o("")}function f(h,b,S){n&&(s({type:N.USER,user_id:h,user_name:b,user_email:S,capabilities:{...J}}),o(""))}const k=n?.isEnterprisey()?a.formatMessage({id:"72/DBb",defaultMessage:"Add people and groups from {workspaceName}"},{workspaceName:i}):a.formatMessage({id:"xF0Ixa",defaultMessage:"Add people from {workspaceName}"},{workspaceName:i});return e.jsx("div",{className:"flex w-full flex-row space-x-3",children:e.jsxs(ve,{as:"div",className:"group relative z-10 grow",children:[e.jsx(ts,{ariaLabel:k,list:"suggested-choices",name:"share-with-input",placeholder:k,value:r,onChange:h=>o(h.target.value),onFocus:()=>v(!0),onBlur:()=>v(!1)}),e.jsx(tt,{show:r.trim()!==""&&g&&p,children:e.jsx(ve.Panel,{static:!0,className:"absolute top-8 ml-0 w-full cursor-pointer overflow-y-auto rounded-lg rounded-t-none border border-t-0 border-token-border-light bg-token-main-surface-primary px-1 py-1 group-has-[:focus]:border-token-border-xheavy",children:r.trim()!==""&&e.jsxs("ul",{id:"suggested-choices",children:[l&&l.map(h=>e.jsxs(ye,{tabIndex:0,className:"rounded-sm p-1 text-sm hover:bg-token-main-surface-secondary",onClick:()=>f(h.account_user_id,h.name??"Unknown User",h.email??""),children:[e.jsx("span",{className:"w-full font-semibold",children:h.name}),e.jsx("span",{className:"text-sm text-token-text-secondary",children:h.email})]},h.id)),u?.items&&u.items.slice(0,5).map(h=>e.jsx(ye,{tabIndex:0,onClick:()=>y(h.id,h.name,h.is_scim_managed??!1),children:e.jsxs("span",{className:"flex flex-col",children:[e.jsxs("span",{className:"flex flex-row",children:[e.jsx("span",{className:"mr-2 font-semibold",children:h.name}),h.is_scim_managed&&e.jsx(Ee,{})]}),e.jsx("span",{className:"text-sm text-token-text-secondary",children:e.jsx(x,{id:"r3Rx6X",defaultMessage:"{numMembers, plural, one {1 member} other {# members}}",values:{numMembers:h.num_members}})})]})},h.id))]})})})]})})}function dt(s,t){return s===void 0||t===void 0?!1:s.split("__")[0]===t.split("__")[0]}const ut=[null,"#F14D42","#E36E30","#B98618","#DB9F1E","#3DCB40","#30A633","#27C0A6","#16B7DB","#6490F0","#0088FF","#1D53BF","#512AEB","#875BE1","#EE4D83","#E659C2"];function mt({color:s,active:t,onClick:a}){const n=R();return e.jsx("button",{onClick:()=>a(s),className:"flex h-10 w-10 items-center justify-center rounded-full bg-token-text-primary can-hover:hover:scale-110 can-hover:active:scale-100","aria-label":s??n.formatMessage(c.defaultColor),style:{backgroundColor:s??void 0},children:t&&e.jsx(rs,{className:"h-6 w-6 text-token-main-surface-primary"})})}function xt({currentTheme:s,onSelect:t}){return e.jsx("div",{className:"m-4 grid grid-cols-4 gap-4",children:ut.map(a=>e.jsx(mt,{active:a===s,color:a,onClick:n=>{t(n)}},a))})}const ft=({currentTheme:s,isPopoverOpen:t,disabled:a,...n},r)=>e.jsxs("button",{ref:r,disabled:a,...n,className:C("group relative flex h-[60px] w-[60px] items-center justify-center",a&&"pointer-events-none"),children:[e.jsx("div",{className:C("absolute flex h-full w-full items-center justify-center rounded-full",s&&"opacity-10",!s&&"bg-token-main-surface-secondary"),style:{backgroundColor:s??void 0}}),e.jsx("div",{className:"relative flex h-full w-full items-center justify-center",children:e.jsx(as,{className:C("icon-lg duration-200 ease-out can-hover:group-hover:scale-110",a&&"text-token-text-tertiary"),style:{color:s}})}),e.jsx("div",{className:C("absolute bottom-0 right-0 flex h-6 w-6 scale-0 items-center justify-center rounded-full border border-token-border-light bg-token-main-surface-primary text-token-text-secondary opacity-0 drop-shadow-sm duration-200 ease-out group-hover:scale-100 group-hover:opacity-100",t&&"scale-100"),children:e.jsx(G,{className:"h-[18px] w-[18px] rounded-full text-token-text-secondary"})})]}),Ue=j.forwardRef(ft);function de({file:s,fileName:t,fileId:a,gizmoId:n}){const r=K(t)&&a!=null,o=os(s&&Ce(s)?s:null,t,a,n,void 0);return r?e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-[#129FBF] bg-cover bg-center text-white",style:{backgroundImage:`url(${o})`},children:!o&&e.jsx(is,{className:"icon-lg"})}):null}function pt({gizmoId:s,gizmoName:t,canEdit:a,pendingFiles:n,files:r,modelCapacityUsed:o,interpreterOnlyFileIds:d,onAddFiles:i,removePendingFile:l,pendingFileUpsertMutationsRef:u}){return n.length===0&&r.length===0?e.jsx("div",{className:"h-full pb-6",children:e.jsx(vt,{gizmoName:t,onAddFiles:i,canEdit:a})}):e.jsx("div",{className:"pb-6",children:e.jsx(ht,{canEdit:a,gizmoId:s,modelCapacityUsed:o,files:r,pendingFiles:n,interpreterOnlyFileIds:d,removePendingFile:l,pendingFileUpsertMutationsRef:u})})}function ht({gizmoId:s,modelCapacityUsed:t,files:a,pendingFiles:n,interpreterOnlyFileIds:r,removePendingFile:o,pendingFileUpsertMutationsRef:d,canEdit:i}){const l=B();return a.length===0&&n.length===0?null:e.jsxs("div",{className:"overflow-hidden rounded-lg border border-token-border-light",children:[t&&t>1?e.jsxs("div",{className:"border-b border-token-border-light bg-gray-50 px-4 py-3 text-xs text-token-text-secondary dark:bg-gray-750",children:[e.jsx("div",{className:"font-medium",children:e.jsx(x,{...c.tooManyFilesTitle})}),e.jsx("div",{children:e.jsx(x,{...c.tooManyFilesDescription})})]}):null,a.map(u=>e.jsx(jt,{gizmoId:s,gizmoFile:u,interpreterOnly:r.includes(u.file_id),canEdit:i,onDelete:async()=>{const g=new Promise(v=>{d.current.push({id:s,mutationId:Se(),update:y=>{const f=y.files.filter(k=>k.file_id!==u.file_id);return{...y,files:f}},onSuccess:v})});return we(s)({gizmoId:s,upsertProjectMutation:l,pendingFileUpsertMutationsRef:d}),g}},u.file_id)),n.map(u=>e.jsx(gt,{canEdit:i,interpreterOnly:r.includes(u.tempId),pendingFile:u,onDelete:async()=>o(u.tempId)},u.tempId))]})}function Re(){return e.jsx("div",{className:"truncate",children:e.jsx(x,{...c.interpreterOnlyLabel})})}function gt({pendingFile:s,onDelete:t,interpreterOnly:a,canEdit:n}){const r=s.file.name,d=(Ce(s.file)&&s.file?.type.startsWith("image/")||K(r))&&e.jsx(de,{file:s.file,fileName:r,fileId:s.fileId??void 0,gizmoId:s.gizmoId??void 0});return e.jsx(Oe,{interpreterOnly:a,onDelete:t,canEdit:n,children:e.jsx(_e,{icon:d,fileName:s.file.name,loadingPercentage:s.status===V.Uploading?s.progress:void 0,customFileDescription:a?e.jsx(Re,{}):void 0})})}function jt({gizmoFile:s,gizmoId:t,interpreterOnly:a,onDelete:n,canEdit:r}){const o=s.name,i=K(o)&&s.file_id!=null&&e.jsx(de,{fileName:o,fileId:s.file_id,gizmoId:t});return e.jsx(Oe,{interpreterOnly:a,onDelete:n,canEdit:r,children:e.jsx(_e,{icon:i,fileName:s.name,customFileDescription:a?e.jsx(Re,{}):void 0})})}function Oe({children:s,onDelete:t,canEdit:a,interpreterOnly:n}){const[r,o]=j.useState(!1);return e.jsxs("div",{className:C("group flex w-full justify-between border-b border-token-border-light p-3 text-sm last:border-b-0",n&&"grayscale"),children:[e.jsx("div",{className:"w-10/12 can-hover:w-full can-hover:group-hover:w-11/12",children:s}),a&&e.jsx("div",{className:C("flex shrink-0 grow-0 bg-token-main-surface-primary pl-1 can-hover:group-hover:flex",!r&&"can-hover:hidden"),children:r?e.jsx("div",{className:"flex h-full w-6 items-center justify-center",children:e.jsx(Pe,{})}):e.jsx("button",{onClick:async()=>{t&&(o(!0),await t(),o(!1))},children:e.jsx(Qs,{className:"text-token-secondary rounded-full hover:bg-token-main-surface-secondary dark:hover:bg-token-main-surface-tertiary"})})})]})}function vt({gizmoName:s,onAddFiles:t,canEdit:a}){return e.jsx("div",{className:"flex h-full cursor-pointer items-center justify-center rounded-lg border border-token-border-light px-4 py-3 pb-6 active:bg-token-main-surface-tertiary",onClick:t,children:e.jsxs("div",{className:"flex flex-col items-center gap-2 py-4 text-sm text-token-text-secondary",children:[a?e.jsx(Ie,{}):e.jsx(Me,{}),e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"max-w-100 text-token-text-secondary",children:e.jsx(x,{...c.emptyFileInstructions,values:{gizmoNameText:e.jsx("span",{className:"font-bold",children:e.jsx(x,{...c.emptyFileGizmoName,values:{gizmoName:s}})},"gizmoNameText")}})})})]})})}const Ae=q.div`text-sm text-red-500`,yt=q.textarea`w-full overflow-y-auto overflow-x-clip rounded-lg border px-3 py-2 focus:ring-2 focus:ring-token-text-primary border-token-border-medium bg-token-main-surface-primary`,Q=20;function ze({onClose:s,gizmo:t}){const a=R(),[n,r]=j.useState(t?.gizmo?.instructions||""),o=B(),d=W(),i=[];n?.length>ee&&i.push(a.formatMessage(c.instructionsTooLong,{length:ee}));const l=f=>{r(f.target.value)},u=()=>{s()},g=async()=>{try{await o.mutateAsync({update:{instructions:n??""},id:t.gizmo.id}),s()}catch(f){const k=Te(f);d.danger(k??"Error",{duration:2})}},p=e.jsx(X.Button,{title:a.formatMessage(c.save),color:"primary",onClick:g,loading:o.isPending,disabled:i.length>0}),v=e.jsx(X.Button,{title:a.formatMessage(c.cancel),color:"secondary",onClick:u,disabled:o.isPending}),y=L(t);return e.jsx(ie,{className:"min-h-[50dvh] max-w-[820px]",isOpen:!0,showCloseButton:!o.isPending,hideSeparator:!0,noPadding:!0,size:"custom",type:"success",title:e.jsx("div",{className:"h-8",children:a.formatMessage(c.editCustomInstructionsTitle)}),onClose:()=>{o.isPending||s()},children:e.jsxs("div",{className:"flex h-full flex-col px-6 pb-7 pt-0",children:[e.jsx("div",{className:"text-sm font-medium",children:a.formatMessage(y?c.editCustomInstructionsSubtitle:c.readOnlyCustomInstructionsTitle)}),e.jsx("div",{className:"text-sm text-token-text-secondary",children:a.formatMessage(y?c.editCustomInstructionsDescription:c.readOnlyCustomInstructionsDescription)}),e.jsx(yt,{autoFocus:!0,placeholder:a.formatMessage(c.projectInstructionsPlaceholder),className:"mb-1 mt-4 min-h-24 w-full flex-grow resize-none rounded-md bg-token-main-surface-primary",onChange:l,value:n,disabled:o.isPending||!y}),i.map(f=>e.jsx(Ae,{className:"mt-1",children:f},f)),y&&e.jsx(X.Actions,{primaryButton:p,secondaryButton:v})]})})}function bt({gizmoId:s,gizmoName:t,canEdit:a,gizmoEditorData:n,openFileDialog:r,pendingFiles:o,setVersion:d,pendingFileUpsertMutationsRef:i,currentModelConfig:l}){const u=n?.files?.reduce((b,S)=>b+(S.file_size_tokens??0),0)??0,g=n?.contextStuffingBudget;let p;g&&(p=u/g,u>0&&p<.01&&(p=.01));const v=n?.files??[],y=Array.from(o.current.values()).filter(b=>v.every(S=>S.file_id!==b.fileId)),f=y.filter(b=>l!=null&&se(l,b.file.type,b.file.name)===re.CodeInterpreter),k=v.filter(b=>l!=null&&b.type!=null&&se(l,b.type,b.name)===re.CodeInterpreter),h=[...f.map(b=>b.tempId),...k.map(b=>b.file_id)];return e.jsx(pt,{gizmoId:s,gizmoName:t,canEdit:a,pendingFiles:y,pendingFileUpsertMutationsRef:i,files:v,modelCapacityUsed:p,interpreterOnlyFileIds:h,onAddFiles:r,removePendingFile:b=>{o.current.delete(b),d(S=>S+1)}})}const kt=j.forwardRef(function({gizmo:t,showInstructions:a=!0},n){const r=R(),[o,d]=j.useState(!1),i=B(),l=ls(t),u=Ne(l),{data:g}=Vs(),p=g?.models.get(Xs)??(g&&at(g.models.values(),T=>T.tags.includes(Ks.GPT_4o))),v=W(),[y,f]=j.useState(0),k=j.useRef(new Map),h=j.useRef([]),b=cs(p,void 0),S=T=>{T.some(({errors:E})=>E.length!==1||E[0]?.code!==pe.TooManyFiles)?v.danger(r.formatMessage(c.unknownError),{duration:2}):v.danger(r.formatMessage(c.dragTooManyFilesError,{MAX_FILES_PER_PROJECT:Q}),{duration:2})},m=async T=>{le.logEvent(ce.uploadFile,{client:"web",eventSource:"mouse",intent:"gizmo"});const E=l.id;T.length>0&&await Promise.all(T.map(D=>{const $=hs(D);k.current.set($,{tempId:$,gizmoId:E,file:D,status:V.Uploading,progress:1,fileId:null,cdnUrl:null}),gs($,D,r,v,{kind:Ws.Gizmo,gizmoId:E},{onFileUploaded:async(w,F,A,U)=>{const M=k.current.get(w);M?.fileId&&M?.fileId&&(h.current.push({id:t.gizmo.id,mutationId:Se(),update:z=>{if(!M.fileId)return z;const He=[...z.files??[],{file_id:M.fileId,name:M.file.name,size:M.file.size,type:U?.mimeType??js(M.file),last_modified:M.file.lastModified,file_size_tokens:U?.fileTokenSize}];return{...z,files:He}},onSuccess:()=>{k.current.delete(w),f(z=>z+1)}}),we(t.gizmo.id)({gizmoId:t.gizmo.id,upsertProjectMutation:i,pendingFileUpsertMutationsRef:h}))},onFileCreated:(w,F,A)=>{k.current.set(w,{tempId:w,gizmoId:E,file:D,status:V.Uploading,progress:1,...k.current.get(w),fileId:F,cdnUrl:A}),f(U=>U+1)},onFileUploadProgress:(w,F)=>{const A=k.current.get(w);A?.status===V.Uploading&&k.current.set(w,{...A,progress:F>95?95:F}),f(U=>U+1)},onError:w=>{k.current.delete(w),f(F=>F+1)}},{usesRetrievalIndex:p!=null&&se(p,D.type,D.name)===re.Retrieval})}))},_=ds(b),I=Rs(_),H=k.current.size+l.files.length,O=L(t),{open:me,getInputProps:Be,getRootProps:Ge,isDragAccept:Le,isDragReject:qe}=us({noClick:!0,noDragEventsBubbling:!0,onDropAccepted:m,onDropRejected:S,multiple:!0,maxSize:ms,maxFiles:Q-H,validator:()=>H>=Q?{code:pe.TooManyFiles,message:"Too many files"}:null,..._});return j.useImperativeHandle(n,()=>({openFileDialog:me})),e.jsxs("div",{...Ge({className:"h-full px-6"}),children:[e.jsx("input",{...Be()}),a&&e.jsxs(nt,{children:[e.jsx("button",{className:"w-full",onClick:()=>d(!0),children:e.jsx("div",{className:"w-full rounded-lg border border-token-border-light text-left text-sm",children:l?.instructions?.length?e.jsx("div",{className:"mx-4 my-3 line-clamp-4",children:l.instructions}):e.jsxs("div",{className:"flex h-full w-full items-center px-4 py-3 text-token-text-secondary",children:[e.jsx("div",{className:"flex-1",children:e.jsx(x,{...c.addCustomInstructions})}),e.jsx(G,{className:"icon-sm"})]})})}),u.includes(xs.GizmoInstructionsTooLong)?e.jsx(Ae,{className:"mt-1",children:e.jsx(x,{...c.instructionsTooLong,values:{length:ee}})}):null]}),o&&e.jsx(ze,{gizmo:t,onClose:()=>{d(!1)}}),e.jsx(bt,{gizmoId:t.gizmo.id,gizmoName:t.gizmo.display.name,canEdit:O,gizmoEditorData:l,openFileDialog:me,pendingFiles:k,pendingFileUpsertMutationsRef:h,setVersion:f,currentModelConfig:p}),Le&&e.jsxs(ne,{children:[e.jsx(fs,{}),e.jsx("h3",{children:e.jsx(x,{...c.dragInstructions})}),e.jsx("h4",{className:"w-2/3 text-center",children:I.length>0?I.join(", "):e.jsx(x,{...c.dragAllAccepted})})]}),qe&&e.jsxs(ne,{children:[e.jsx(ps,{className:"icon-2xl"}),e.jsx("h3",{children:e.jsx(x,{...c.dragTooManyFiles})}),e.jsx("h4",{className:"w-2/3 text-center",children:e.jsx(x,{...c.dragTooManyFilesDescription,values:{MAX_FILES_PER_PROJECT:Q}})})]})]})});function St({gizmo:s,onClose:t}){const a=j.useRef(null),n=j.useCallback(()=>{a.current?.openFileDialog()},[a]),r=L(s);return e.jsx(e.Fragment,{children:e.jsx(ie,{className:"min-h-72 max-w-[820px]",isOpen:!0,showCloseButton:!0,hideSeparator:!0,noPadding:!0,size:"custom",type:"success",onClose:()=>{t()},children:e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsx(X.TitleBar,{$hasSeparator:!1,children:e.jsxs("div",{className:"flex w-full items-center gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx($s,{className:"text-lg font-semibold leading-6 text-token-text-primary",children:e.jsx(x,{...c.projectFilesModalTitle})})}),r&&e.jsx(ae,{color:"secondary",onClick:n,children:e.jsx(x,{...c.addFilesButtonLabel})}),e.jsx(Zs,{asChild:!0,className:"sm:mt-0",children:e.jsx(Ys,{onClick:t})})]})}),e.jsx("div",{className:"h-[50dvh] flex-grow overflow-y-auto pt-0",children:e.jsx(kt,{ref:a,gizmo:s,showInstructions:!1})})]})})})}function Nt({gizmo:s}){return e.jsx("div",{className:"mt-6 grid grid-cols-1 items-start gap-5 xs:grid-cols-2",children:s?e.jsxs(e.Fragment,{children:[e.jsx(Ct,{gizmo:s}),e.jsx(_t,{gizmo:s})]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{}),e.jsx(be,{})]})})}function ue({header:s,context:t,contextClassName:a="",icon:n,modal:r,onClick:o,disabled:d=!1,isModalOpen:i=!1}){return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:o,className:C("group/snorlax-control-tile relative h-full rounded-2xl border border-token-border-xlight bg-token-main-surface-primary shadow-xxs hover:bg-token-main-surface-secondary active:bg-token-main-surface-tertiary active:drop-shadow-none",d&&"pointer-events-none opacity-50"),children:e.jsxs("div",{className:"relative mx-5 my-4 flex items-center justify-between gap-3 overflow-hidden",children:[e.jsxs("div",{className:"w-full grow text-left",children:[e.jsx("div",{className:"text-sm font-medium",children:s}),e.jsx("div",{className:C("text-xs text-token-text-secondary",a),children:t})]}),n]})}),i&&r]})}function be(){return e.jsx(ue,{disabled:!0,header:e.jsx("div",{className:"my-2 h-2 w-48 rounded-full bg-token-main-surface-secondary"}),context:e.jsx("div",{className:"my-2 h-2 w-32 rounded-full bg-token-main-surface-secondary"})})}function Ct({gizmo:s}){const{files:t}=s,a=!t.length,n=oe(s),[r,o]=j.useState(!1),d=r&&e.jsx(St,{gizmo:s,onClose:()=>{o(!1)}}),i=()=>o(!0);let l,u,g;const p=L(s);if(a)l=e.jsx(x,{...p?c.addFilesButtonLabel:c.viewFilesButtonLabel}),u=e.jsx(x,{...p?c.filesControlDescription:c.noFilesReadOnlyDescription}),g=e.jsxs("div",{className:"relative flex h-10 w-10 shrink-0 items-center justify-center rounded-full",children:[e.jsx("div",{className:"absolute h-full w-full rounded-full bg-token-main-surface-secondary opacity-5",style:{backgroundColor:n??void 0}}),p?e.jsx(Ie,{className:"icon-md h-5 w-5",style:{color:n}}):e.jsx(Me,{className:"icon-md h-5 w-5",style:{color:n}})]});else{const y=t.slice(0,3);l=e.jsx(x,{...c.projectFilesModalTitle}),u=e.jsx(x,{...c.filesCount,values:{count:t.length}}),g=e.jsx("div",{className:"relative flex h-10 w-20 shrink-0 items-center justify-center rounded-full",children:y.toReversed().map((f,k)=>e.jsx(wt,{file:f,index:k,gizmoId:s.gizmo.id},f.id))})}return e.jsx(ue,{isModalOpen:r,modal:d,onClick:i,header:l,context:u,icon:g,disabled:a&&!p})}function wt({file:s,index:t,gizmoId:a}){const n=s.name,o=K(n)&&s.file_id!=null&&e.jsx(de,{fileName:n,fileId:s.file_id,gizmoId:a});return e.jsx("div",{className:"absolute right-0 top-0 h-10 w-10 overflow-hidden rounded-xl border-2 border-token-main-surface-primary group-hover/snorlax-control-tile:border-token-main-surface-secondary",style:{transform:`translateX(${t*-20}px)`},children:o||e.jsx(vs,{className:"h-9 w-9 flex-shrink-0",filename:s.name,contextConnectorInfo:void 0})})}function _t({gizmo:s}){const{instructions:t}=s.gizmo,a=!t.length,n=oe(s),[r,o]=j.useState(!1),d=r&&e.jsx(ze,{gizmo:s,onClose:()=>{o(!1)}}),i=()=>o(!0);let l,u,g,p;const v=L(s);return a?(l=e.jsx(x,{...v?c.customInstructionsTitle:c.customInstructionsReadOnlyTitle}),u=e.jsx(x,{...v?c.customInstructionsDescription:c.customInstructionsReadOnlyDescription}),g=e.jsxs("div",{className:"relative flex h-10 w-10 shrink-0 items-center justify-center rounded-full",children:[e.jsx("div",{className:"absolute h-full w-full rounded-full bg-token-main-surface-secondary opacity-5",style:{backgroundColor:n??void 0}}),e.jsx(G,{className:"icon-md h-5 w-5",style:{color:n}})]})):(l=e.jsx(x,{...c.editCustomInstructionsTitle}),p="overflow-hidden text-ellipsis whitespace-nowrap",u=t),e.jsx(ue,{isModalOpen:r,modal:d,onClick:i,header:l,context:u,icon:g,contextClassName:p,disabled:a&&!v})}function It(s){return{id:s.gizmo.id,instructions:s.gizmo.instructions,name:s.gizmo.display.name,description:s.gizmo.display.description??"",emoji:s.gizmo.display.emoji??void 0,theme:s.gizmo.display.theme??void 0,profilePictureId:s.gizmo.display.profile_pic_id??void 0,profilePictureUrl:s.gizmo.display.profile_picture_url??void 0,promptStarters:s.gizmo.display.prompt_starters??[],tools:Y(s.tools),files:Y(s.files),sharing:Mt(s.gizmo.sharing),trainingDisabled:s.gizmo.training_disabled??!1,sharingRecipient:s.gizmo.share_recipient,sharingTargets:Y(s.gizmo.sharing_targets),liveVersion:s.gizmo.live_version??0,contextStuffingBudget:s.gizmo.context_stuffing_budget}}function Mt(s){return{subjects:s.subjects.map(t=>{switch(t.type){case N.USER:return{type:t.type,user_id:t.user_id,capabilities:t.capabilities,user_name:t.user_name,user_email:t.user_email};case N.GROUP:return{type:t.type,group_id:t.group_id,group_name:t.group_name,capabilities:t.capabilities};default:throw new Error(`Unknown subject type: ${t.type}`)}}),recipient:s.recipient}}const Ft=q.h3`p4 overflow-hidden text-ellipsis break-all py-3 px-4 text-xs font-semibold text-token-text-secondary`,Pt=q.div`h-24 w-full rounded-3xl bg-token-main-surface-secondary`,Tt=()=>e.jsx("div",{className:"ml-1 mt-3 h-10",children:e.jsx("div",{className:"my-[15px] h-[10px] w-48 rounded-full bg-token-main-surface-secondary"})}),ke=new Map;function Et(s){const t=ke.get(s);if(t)return t;const a=Es(Dt,2e3,{trailing:!0});return ke.set(s,a),a}async function Dt({gizmoId:s,upsertProjectMutation:t,toaster:a}){const n=Us,r=ge(n.getState(),"theme",s);try{r!==void 0&&await t.mutateAsync({id:s,update:{theme:r??void 0}}),ge(n.getState(),"theme",s)===r&&Ds(s,"theme")}catch(o){const d=Te(o);a.warning(d??"Error",{duration:2})}}function Ut({gizmoId:s,theme:t,upsertProjectMutation:a,toaster:n}){Ts(s,"theme",t),Et(s)({gizmoId:s,upsertProjectMutation:a,toaster:n})}function Rt({gizmo:s}){const t=oe(s),a=B(),[n,r]=j.useState(!1),o=W(),d=i=>{i!==t&&(le.logEvent(ce.projectsThemeChange,{theme:i??"default"}),Ut({gizmoId:s.gizmo.id,theme:i,upsertProjectMutation:a,toaster:o}))};return e.jsx(Ms,{open:n,sideOffset:4,alignOffset:7,side:"bottom",alignAgainstAnchor:"start",size:"none",modal:!0,onOpenChange:i=>r(i),triggerButton:e.jsx(Ue,{currentTheme:t,isPopoverOpen:n}),children:e.jsx(xt,{currentTheme:t,onSelect:d})})}function Ot({gizmo:s}){return e.jsxs("div",{className:"mb-6 flex w-full flex-col px-4",children:[s?e.jsx(Rt,{gizmo:s}):e.jsx(Ue,{disabled:!0,currentTheme:null,isPopoverOpen:!1}),s?e.jsxs("button",{className:"group ml-1 mt-3 self-start text-balance text-left text-4xl font-semibold hover:text-token-text-secondary",onClick:()=>{te.setShowProjectSettingsModal(!0)},children:[s.gizmo.display.name,e.jsx(G,{className:"icon-lg ml-2.5 inline-block text-token-text-secondary opacity-0 can-hover:group-hover:opacity-100 motion-safe:transition-opacity motion-safe:duration-100"})]}):e.jsx(Tt,{})]})}function At({children:s}){return e.jsx("div",{className:"group relative flex flex-col gap-1 p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Fe,{className:"icon-md text-token-sidebar-icon"}),s]})})}function zt({conversation:s,gizmo:t}){const a=Js(s.id,i=>i?.title)??s.title,[n,r]=j.useState(!1);j.useEffect(()=>et(rt,{editTitleInMainScreen:({serverThreadId:i})=>{i===s.id&&r(!0)}}),[s.id]);const{snippet:o}=s,d=e.jsxs(At,{children:[e.jsxs("div",{className:"flex-grow overflow-hidden can-hover:group-hover:mr-5",children:[n?e.jsx(Fs,{conversationId:s.id,historyConversationResponse:s,onClose:()=>{r(!1)}}):e.jsx("div",{className:"text-sm font-medium",children:a}),o&&e.jsx("div",{className:"truncate text-sm text-token-text-secondary",children:o})]}),!n&&e.jsx(Bt,{conversation:s})]});return n?d:e.jsx(Xe,{to:Ps(s.id,t),draggable:!1,children:d})}function Bt({conversation:s}){const[t,a]=j.useState(!1);return e.jsx("div",{className:C("absolute bottom-0 top-0 items-center gap-1.5 pr-4 ltr:right-0 rtl:left-0",t?"flex":"hidden can-hover:group-hover:flex"),onClick:n=>{n.preventDefault()},children:e.jsx(As,{conversation:s,onOpenChange:n=>{a(n),n&&le.logEvent(ce.conversationHistoryItemOpenMenu,{conversationId:s.id})},inMainScreen:!0,isActiveConversation:!1})})}function Gt({gizmo:s}){_s(s.gizmo.id);const{items:t,hasNextPage:a,fetchNextPage:n,isLoading:r,isFetching:o,isFetchingNextPage:d}=Is(s.gizmo.id),i=j.useRef(null),l=j.useCallback(g=>{r||g==null||(i.current?.disconnect(),i.current=new IntersectionObserver(p=>{p[0].isIntersecting&&a&&!o&&n()}),i.current.observe(g))},[r,a,n,o]);j.useEffect(()=>()=>{i.current?.disconnect()},[]);const u=t.length;return e.jsxs("div",{className:"mb-14 mt-6",children:[u||r?e.jsx(qt,{gizmo:s,items:t??[],hasNextPage:a,infiniteScrollTriggerElementRef:l}):e.jsx(Lt,{}),d&&e.jsx("div",{className:"m-4 mb-5 flex justify-center",children:e.jsx(Pe,{})})]})}function Lt(){return e.jsxs("div",{className:"mt-20 flex flex-col items-center font-medium",children:[e.jsx(Fe,{className:"icon-lg mb-2 text-token-icon-secondary"}),e.jsx("div",{className:"text-sm text-token-text-secondary",children:e.jsx(x,{...c.emptyChatsInProjectTitle})})]})}function qt({gizmo:s,items:t,hasNextPage:a,infiniteScrollTriggerElementRef:n}){const r=t.length;return e.jsxs(e.Fragment,{children:[e.jsx(Ft,{children:e.jsx(x,{...c.chatsInProjectTitle})}),e.jsx("ol",{children:t.map((o,d)=>{const i=a&&d===t.length-3?n:void 0;return e.jsx("li",{ref:i,className:C("first:rounded-t-lg last:rounded-b-lg hover:bg-token-main-surface-secondary",d!==r-1&&"border-b border-token-border-xlight"),children:e.jsx(zt,{conversation:o,gizmo:s})},o.id)})})]})}function mn({clientThreadId:s,gizmoId:t,currentModelId:a,onRequestCompletion:n}){const r=R(),{data:o}=ys(t),d=he(f=>f.showProjectSettingsModal),i=he(f=>f.showShareModal),[l,u]=j.useState(!1),g=bs(),p=ks(),v=p!=null&&p.kind==="conversation"&&(p.gizmoId==null||p.gizmoId!==t),y=j.useRef(0);return e.jsx("div",{onDragOver:f=>{f.preventDefault(),v&&u(!0)},onDrop:f=>{f.preventDefault(),v&&(y.current=0,u(!1),g({newGizmoId:t,conversation:p.conversation,previousGizmoId:p.gizmoId??null}))},onDragEnter:f=>{f.preventDefault(),v&&(y.current+=1)},onDragLeave:f=>{f.preventDefault(),v&&(y.current-=1,y.current===0&&u(!1))},className:"flex max-h-full flex-col md:pt-header-height",children:e.jsx(Ss,{isStaticSharedThread:!1,verticalPadding:"none",horizontalPadding:"standard",overflowY:"auto",fullHeight:!0,children:e.jsxs(Ns,{column:!0,shouldRemoveGap:!0,children:[e.jsx(Ot,{gizmo:o}),o?e.jsx(Os,{clientThreadId:s,isNewThread:!0,currentModelId:a,onRequestCompletion:n,hideHeader:!0}):e.jsx(Pt,{}),e.jsx(Nt,{gizmo:o}),o&&e.jsx(Gt,{gizmo:o}),o&&i&&e.jsx(it,{gizmo:It(o),publishedGizmo:o,onClose:()=>{te.setShowShareModal(!1)}},t),d&&e.jsx(Cs,{submitButtonTitle:r.formatMessage(c.projectSettingsSubmitButton),gizmo:o,onClose:()=>{te.setShowProjectSettingsModal(!1)}},t),l&&e.jsxs(ne,{children:[e.jsx(ws,{className:"h-12 w-12",style:{color:"#3C46FF"}}),e.jsx("h3",{className:"text-center",children:e.jsx(x,{...c.addConversationToNamedSnorlax,values:{projectName:o?.gizmo.display.name??"project"}})}),e.jsx("h4",{className:"text-center",children:e.jsx(x,{...c.moveConversation})})]})]})})})}export{mn as SnorlaxSplashScreen};
//# sourceMappingURL=dovb6uj5wq2l3q5b.js.map
