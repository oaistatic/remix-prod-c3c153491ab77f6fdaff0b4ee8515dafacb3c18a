import{f9 as E,bv as P,P as r,a as l,c5 as _,fg as v,R as M,A as b}from"./njq6ygky3ttysgdk.js";import{r as f,A as T,c as U,j as e,e as L,M as c}from"./fs6h2trisr1juto6.js";import{N as p,U as h,S,C as W,W as R,a as I}from"./oqua45lf4ts278pi.js";import{k as O,A as $}from"./d7a6rc8fexfzu7dt.js";function H(t,s){setTimeout(()=>{window.location.href=s},t*1e3)}const V=E(function(){const s=O(),[u,o]=f.useState(!1),{session:d,isLoading:m}=P(),{phoneNumber:n,proof:j,nextAction:g,entityId:C}=T(),k=g===p.Authenticate,y=g===p.LinkAccount&&!u,N=g===p.LinkAccount&&u,{mutate:A,isPending:w}=U({mutationFn:async a=>{try{if(a===h.Cancel)return{success:!1};if(!d||m)return{success:!1,errorCode:v.SessionExpired};const{success:x,error_code:i}=await M.safePost("/moodeng/account_linking",{requestBody:{proof:j,identifier:n},authOption:b.Required});return{success:x,errorCode:i}}catch{return{success:!1}}},onSuccess:(a,x)=>{if(!a.success&&x===h.Cancel){window.location.href=R;return}else if(!a.success){const i=new URLSearchParams;i.set("reason",a.errorCode??""),i.set("wid",C??""),window.location.href=`/account-link/error?${i.toString()}`;return}return o(!0),H(2,I)}});return f.useEffect(()=>{if(k){if(!n)return;r.logEventWithStatsig(l.chatgptAccountLinkRedirectAuthenticate,"chatgpt_account_link_redirect_authenticate"),s({authType:"signup",callbackUrl:`${location.pathname}${location.search}${location.hash}`,additionalAuthParams:{[$]:"true"}})}},[k,s,n]),e.jsxs("div",{className:"mx-auto w-full max-w-sm sm:max-w-md",children:[y&&e.jsx(q,{phoneNumber:n,onAllowClick:()=>A(h.Allow),onCancelClick:()=>A(h.Cancel),isOnAllowClickPending:w,isOnCancelClickPending:w}),N&&e.jsx(B,{})]})});function q({phoneNumber:t,onAllowClick:s,onCancelClick:u,isOnAllowClickPending:o,isOnCancelClickPending:d}){const m=L();return f.useEffect(()=>{r.logEventWithStatsig(l.chatgptAccountLinkConfirmUiShown,"chatgpt_account_link_confirm_ui_shown")},[]),e.jsxs("div",{className:"flex w-full flex-col items-center justify-center px-4 py-10",children:[e.jsx("header",{className:"oai-header",children:e.jsx(S,{alt:m.formatMessage({id:"login.openAiLogo",defaultMessage:"OpenAI Logo"}),className:"h-10 w-10"})}),e.jsx("h1",{className:"mt-10 text-center text-3xl font-semibold",children:e.jsx(c,{id:"account-link.confirm.title",defaultMessage:"Confirm account linking"})}),e.jsx("p",{className:"mt-6 text-center text-token-text-secondary",children:e.jsx(c,{id:"account-link.confirm-link.description",defaultMessage:'By clicking "Allow", your WhatsApp number {phoneValue} and conversations will be linked to your ChatGPT account and subject to data cotrols in your account settings. <learnMoreLink>Learn more.</learnMoreLink>',values:{phoneValue:t,learnMoreLink:n=>e.jsx("a",{href:W,target:"_blank",rel:"noopener noreferrer",className:"text-token-link hover:text-token-link-hover",children:n})}})}),e.jsxs("div",{className:"mt-6 flex w-full flex-col gap-3",children:[e.jsx(_,{className:"w-full rounded-md",color:"green",type:"submit",onClick:()=>{r.logEventWithStatsig(l.chatgptAccountLinkAllowClicked,"chatgpt_account_link_allow_clicked"),s()},disabled:o||d,loading:o,children:e.jsx(c,{id:"account-link.confirm.button",defaultMessage:"Allow"})}),e.jsx(_,{className:"w-full rounded-md",color:"secondary",onClick:()=>{r.logEventWithStatsig(l.chatgptAccountLinkCancelClicked,"chatgpt_account_link_cancel_clicked"),u()},disabled:d||o,children:e.jsx(c,{id:"account-link.confirm.cancel",defaultMessage:"Cancel"})})]})]})}function B(){const t=L();return f.useEffect(()=>{r.logEventWithStatsig(l.chatgptAccountLinkSuccess,"chatgpt_account_link_success")},[]),e.jsxs("div",{className:"flex w-full flex-col items-center justify-center px-4 py-10",children:[e.jsx("header",{className:"oai-header",children:e.jsx(S,{alt:t.formatMessage({id:"login.openAiLogo",defaultMessage:"OpenAI Logo"}),className:"h-10 w-10"})}),e.jsx("h1",{className:"mt-10 text-center text-3xl font-semibold",children:e.jsx(c,{id:"account-link.success.title",defaultMessage:"Successfully linked your ChatGPT account"})}),e.jsx("p",{className:"mt-6 text-center text-token-text-secondary",children:e.jsx(c,{id:"account-link.success.description",defaultMessage:"You can now close this window and return to WhatsApp, or you will be automatically redirected momentarily."})})]})}export{V as default};
//# sourceMappingURL=oyquvkaz81eepyvn.js.map
