const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/m6yoxe4391nbtmyg.js","assets/fs6h2trisr1juto6.js","assets/o3d0pfqxdj7nivvr.js","assets/njq6ygky3ttysgdk.js","assets/root-cl538jor.css","assets/d7a6rc8fexfzu7dt.js","assets/conversation-small-m9kq0y4e.css","assets/loh8e64j4csffv26.js","assets/gunpso70jnmarvod.js","assets/csg4i0wk6hi0jvkd.js","assets/lj0prj6na7gf1jpf.js","assets/cm0hdcditutj2jz2.js","assets/jcoe6v231ph25bfi.js","assets/ijutvl794yycgs5p.js","assets/n9whwsbg0rx5cs8k.js","assets/etqj4xq4j5wad3vw.js","assets/dxyq241jyvrm1jhv.js","assets/me7hwew6rs0aw56z.js","assets/hp3ocwib8mmnarbi.js","assets/jhoqcbqmt1jrh2rh.js","assets/dr3h4pxnog1msvu6.js","assets/fu6bathgya5b9rdr.js","assets/iv7bvs4v18w65jsh.js","assets/jm06rasheqbw3hij.js","assets/btjgsqbipn1ns9gv.js","assets/mi16gkof274z4h73.js","assets/m3ph5kqqbcm52gd5.js","assets/c0j16vcme5fz1uuf.js","assets/gqh4w3ycaaim4pak.js","assets/n53kueinnquhe6fx.js","assets/hjb02wgbg97lpn2f.js","assets/l0wwz9fs2x6psnxm.js","assets/lmwoqrh0f0q9nw7i.js","assets/emjevy1zmzft3tmm.js","assets/hrv8rdfcz5e1nz3e.js","assets/gvhvfcdqhc5unmaw.js","assets/ora9zmv2zdoi2bvo.js","assets/o3ku8s79rgxxgin3.js","assets/p32qvzx3ml1odktp.js","assets/bpkxn0v1y9w6s1vy.js","assets/kwmvqoiudcqyu1fy.js","assets/no4qfibpbbv193yj.js","assets/iqgzc83lat3a2v2u.js","assets/onz2j6p63wwkp7m6.js","assets/e3bj8idaaiic9lls.js","assets/hi1g9go8t53qsjy9.js","assets/grccwfqkma7x81tr.js","assets/ng8iludi91g2bys9.js","assets/gfo75oujoeaedm5y.js","assets/f25rpzpqicaw21n1.js","assets/b8zlh79k7yo0fu3r.js","assets/FormattedText-ecwyy7s8.css","assets/o77dlyy0lhhjntje.js","assets/cot-message-lf3q5fj1.css","assets/hp061s6r7n3gqzr2.js","assets/jfi01owl9mian83i.js","assets/edg5hvjy1aurqrkw.js","assets/tqebddvnlsjnw3aa.js","assets/omlauz9an8wu57gp.js","assets/navzvmlqmmmpvnl2.js"])))=>i.map(i=>d[i]);
import{cG as ke,a3 as R,F as P,dv as Ae,B as te,T as ue,gA as Me,E as we,a as Q,l as ge,aT as fe,bE as De,bS as B,X as Re,d as T,fC as Oe,y as xe,c5 as J,eQ as Le,am as z,P as Pe,cH as Ie,bH as pe,gB as X,eW as Fe,eX as Ue,c1 as Ve,ee as ae,ed as Be,aF as _e,D as He,g0 as ze,bQ as E,bR as S,eq as Je,ef as p,J as We,bM as Ke}from"./njq6ygky3ttysgdk.js";import{j as s,M as v,r as f,e as $,a7 as V,a5 as D,b as Qe}from"./fs6h2trisr1juto6.js";import{kP as Xe,j7 as Ye,gG as $e,kQ as qe,i$ as Ze,kR as Ge,e6 as es,kS as he,iX as ye,kT as L,kU as ss,g4 as je,kV as ts,kW as as,Y as be,d$ as ns,e0 as os,bO as W,kX as is,kY as rs,kZ as Y,k_ as ls,k$ as cs,l0 as ms,l1 as ne,l2 as ds,l3 as us,l4 as gs,l5 as oe,l6 as ve,d1 as fs,l7 as xs,l8 as ps,l9 as _s,la as hs,ai as ys,ah as js,fZ as bs,bH as vs,eL as Es,fr as Ss,lb as Cs,lc as Ns,jm as Ts,kA as ks,je as As,el as Ms,em as ws,ld as Ds,le as Rs,lf as Os,hm as Ls,lg as Ps,iP as Is,fF as Fs,lh as Us,d3 as Vs,li as Bs}from"./d7a6rc8fexfzu7dt.js";import{u as Hs}from"./gunpso70jnmarvod.js";import{a as Ee,u as zs}from"./csg4i0wk6hi0jvkd.js";import{u as Js}from"./lj0prj6na7gf1jpf.js";import{a as Ws}from"./cm0hdcditutj2jz2.js";import{N as Ks}from"./jcoe6v231ph25bfi.js";import{k as Qs}from"./ijutvl794yycgs5p.js";const Xs=(e,n)=>{const t=R(e,o=>P.getLastMessageSystemHints(o).includes(Ae.CANVAS)),a=Hs({clientThreadId:e}),i=Xe(e),r=te(te(n)?.messages)?.id,m=n.some(o=>o.messages.some(c=>c.metadata?.canvas?.canvas_opt_in));return{isVisible:!t&&!i&&!m&&!!r,onClick:async o=>{if(!r)return;o.stopPropagation(),Ye();const c=[ue.CANMORE];a({sourceEvent:o,nodeId:r,appendMessages:[Me("The user has requested the canvas tool be disabled for this conversation. You should not call the tool again.",{disable_tool_ids:c,exclude_after_next_user_message:!0})]});const u=we(e),x=P.getConversationTurns(u,r).length,g=P.getParentPromptNode(u,r)?.message.id;$e.logEventWithStatsig(Q.canvasOptOutClicked,"chatgpt_canvas_opt_out_clicked",{num_turns:String(x),conversation_id:ge(e),message_id:g}),fe(e,h=>{h.disabledToolIds=c})}}},Ys=({clientThreadId:e,groupedMessages:n})=>{const{isVisible:t,onClick:a}=Xs(e,n);return t?s.jsx("button",{onClick:a,className:"mb-2 w-full text-token-text-secondary hover:text-token-text-primary",children:s.jsxs("div",{className:"flex items-center rounded-xl",children:[s.jsx(v,{id:"aa5Dyk",defaultMessage:"Answer in chat instead"}),s.jsx(ke,{className:"icon-md text-token-text-secondary"})]})}):null},$s=({messages:e,isRequestActive:n,isFinalTurn:t,allGroupedMessages:a,clientThreadId:i,isUserTurn:r=!1})=>{const m=f.useMemo(()=>qe(e),[e]),l=f.useMemo(()=>m?m.map(([o,c])=>Ze(n,o,c)).filter(Boolean):[],[m,n]);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex flex-col gap-2",children:l.map(o=>s.jsx(Ge,{toolCall:o,clientThreadId:i,isRequestActive:n},o.messageId))}),s.jsx(es,{featureType:De.CANVAS_SUPPORTED,isUserTurn:r,clientThreadId:i}),t&&s.jsx(Ys,{clientThreadId:i,groupedMessages:a})]})};function qs(e,n,t){const a=he(o=>!!(e&&o.tasks[e])),{openThreadSidebar:i}=B(),r=ye("caterpillar"),m=R(t,o=>P.findNode(o,c=>c.message.metadata?.async_task_id===e&&(c.message.metadata?.b1de6e2_rm===!0||c.message.metadata?.is_async_task_result_message===!0))!=null),{clearSystemHintModeTrigger:l}=Ee();f.useEffect(()=>{if(a||!e||!n)return;const{async_task_created_at:o,async_task_prompt:c,async_task_title:u}=n.metadata??{};if(!o||!c||!u)return;const g={originalConversationId:ge(t)??t,taskId:e,title:u,prompt:c,createdAt:o,updatedAt:o,status:L.UNDETERMINED};ss.setTask(e,g),l(je.Research)},[a,e,n,t,i,r,l,m])}const K={div:e=>{const{node:n,children:t,...a}=e;return s.jsx("div",{...a,className:"text-red-500",children:t})},p:e=>{const{node:n,children:t,...a}=e;return s.jsx("p",{...a,className:"text-start leading-6 text-token-text-primary",children:t})},a:e=>{const{node:n,children:t,...a}=e;return s.jsx("a",{...a,className:"font-sm leading-6 !text-token-text-primary",children:t})}},Zs=1e3*60*2,Gs=30;function Se({onClick:e,statusMessage:n,showSources:t,includeMargin:a,sources:i,progressBar:r}){const m=be();return s.jsx("button",{onClick:()=>m&&e(),className:T("mt-4 flex w-4/5 max-w-[416px] items-start justify-start gap-[18px] rounded-2xl border border-black/10 bg-token-main-surface-primary px-5 py-4 shadow dark:border-white/10",m?"cursor-pointer hover:bg-token-main-surface-secondary":"cursor-auto"),children:s.jsxs("div",{className:"flex w-full flex-col gap-3",children:[s.jsxs("div",{className:T("flex flex-col items-start justify-start self-stretch md:h-7 md:flex-row md:items-center md:justify-between",t?"h-12":"h-6"),children:[s.jsx("div",{className:T("font-sm w-full flex-1 truncate text-start leading-7 text-token-text-primary md:w-0",a&&"mr-[30px]"),children:n}),t&&i]}),s.jsx("div",{className:"flex w-full items-center justify-start gap-4 self-stretch pb-2",children:r})]})})}function q({toggleSidebar:e,openSidebar:n,startTime:t}){const a=$(),[i,r]=f.useState(!1),m=ts();return f.useEffect(()=>{if(!t)return;const l=Date.now()-t,o=Zs-l;if(o>0){const c=setTimeout(()=>{r(!0),n()},o);return()=>clearTimeout(c)}else r(!0),n()},[t,n]),s.jsx(Se,{onClick:e,statusMessage:i?a.formatMessage({id:"T2SbxC",defaultMessage:"Waiting…"}):s.jsx("div",{className:"text-pretty text-sm font-medium text-token-text-primary",children:m.startingMessage}),progressBar:s.jsx(as,{className:"h-2 w-full"}),showSources:!1})}function et(e,n,t){const a=e.formatMessage({id:"Bs+OcV",defaultMessage:"Thinking…"});if(n.length<2)return t?.initial??a;const i=n[n.length-2];return i.type==="summary"?i.title:i.type==="search"?i.query:i?.type==="websiteOpen"?s.jsx(W,{componentOverrides:K,children:i.activeRowText}):i.type==="fileOpen"?s.jsx(W,{componentOverrides:K,children:i.activeRowText}):i.type==="pythonAnalysis"?s.jsx(W,{componentOverrides:K,children:i.analysisSummary}):a}function st({task:e,clientThreadId:n,caterpillarRows:t,messageWithTaskMetadata:a,totalSources:i,handleToggleCaterpillarSidebar:r}){const m=$(),l=be(),o=et(m,t,a.metadata?.async_task_status_messages),c=(e?.expectedDurationMinutes??Gs)*60*1e3,u=ns(t[1]?.created_at?t[1].created_at*1e3:Date.now(),c),x=t[1]&&t[1].created_at?u:0;f.useEffect(()=>{fe(n,y=>{y.async_status=Re.STREAMING})},[n]);const{openThreadSidebar:g}=B();f.useEffect(()=>{t.length===2&&l&&g({type:"caterpillar",caterpillarId:e.taskId,initialTab:"activity",clientThreadId:n})},[t.length,g,e.taskId,n,l]);const h=f.useCallback(()=>{g({type:"caterpillar",caterpillarId:e.taskId,initialTab:"activity",clientThreadId:n})},[g,e.taskId,n]);return t.length<=1?s.jsx(q,{toggleSidebar:()=>r("activity"),openSidebar:h,startTime:new Date(e.createdAt).getTime()}):s.jsx(Se,{onClick:()=>r("activity"),statusMessage:o,showSources:!0,includeMargin:i>0,sources:i===0?s.jsx("div",{className:"text-pretty text-sm text-token-text-tertiary",children:s.jsx(v,{id:"zfwUjs",defaultMessage:"Looking for sources…"})}):s.jsxs("button",{onClick:y=>{y.stopPropagation(),r("sources")},className:T("flex shrink-0 gap-1 text-[13px] leading-[18px] text-[#0285ff]",l?"cursor-pointer hover:text-[#0285ff]/80":"cursor-auto"),children:[s.jsx("div",{className:"relative",children:s.jsx(V,{initial:!1,children:s.jsx(D.span,{initial:{opacity:0,rotateX:-90,translateY:20},animate:{opacity:1,rotateX:0,translateY:0},exit:{opacity:0,rotateX:90,translateY:-20},transition:{duration:.35},className:"absolute left-0 md:right-0",children:i},i)})}),s.jsx("div",{className:T("md:pr-0",i>0&&"pl-2",i>9&&"pl-[14px]",i>99&&"pl-[22px]"),children:i>1?s.jsx(v,{id:"zN+MuO",defaultMessage:" sources"}):s.jsx(v,{id:"dMowmJ",defaultMessage:" source"})})]}),progressBar:s.jsx("div",{className:"flex h-2 shrink grow basis-0 items-start justify-start gap-2.5 overflow-hidden rounded-[10px] bg-token-main-surface-tertiary",children:s.jsx(os,{percentage:x,barClassName:"bg-token-text-primary",backgroundClassName:"bg-token-main-surface-tertiary"})})})}function ie({task:e,clientThreadId:n,messageWithTaskMetadata:t,totalSources:a,handleToggleCaterpillarSidebar:i}){const r=is(e),m=!1,l=R(n,c=>rs(c,e?.taskId)),{clearSystemHintModeTrigger:o}=Ee();return f.useEffect(()=>{e?.status===L.COMPLETED&&!l&&!m&&(r(),o(je.Research))},[e?.status,m,l,r,o]),s.jsx(Y,{message:s.jsxs(s.Fragment,{children:[t.metadata?.async_task_status_messages?.completed_with_time??t.metadata?.async_task_status_messages?.completed_no_time??s.jsx(v,{id:"4d0xZc",defaultMessage:"Completed"}),a===0?s.jsx(v,{id:"VggF2B",defaultMessage:" · 0 sources"}):a===1?s.jsx(v,{id:"zkkdKV",defaultMessage:" · 1 source"}):s.jsx(v,{id:"qcKt3q",defaultMessage:" · {sourcesCount} sources",values:{sourcesCount:a}})]}),handleToggleCaterpillarSidebar:()=>i("activity")})}function tt({messages:e,clientThreadId:n}){const t=e.find(c=>c.metadata?.b1de6e2_s&&c.metadata?.async_task_id),a=t?.metadata?.async_task_id,i=e.find(c=>c.recipient===ue.START_RESEARCH_TASK),r=R(n,c=>ls(c,i?.id)),m=Oe({clientThreadId:n}),[l,o]=f.useState(m);return f.useEffect(()=>{const c=setTimeout(()=>{o(r&&m)},3e3);return()=>clearTimeout(c)},[m,r]),!t||!a?l?s.jsx(q,{toggleSidebar:()=>{},openSidebar:()=>{},startTime:new Date().getTime()}):null:s.jsx(at,{clientThreadId:n,payloadTaskId:a,messageWithTaskMetadata:t})}function at({payloadTaskId:e,messageWithTaskMetadata:n,clientThreadId:t}){qs(e,n,t);const a=he(x=>e?x.tasks[e]:null),i=$(),r=a?.status,m=f.useMemo(()=>a?.rows?a.rows:[],[a?.rows]),{toggleThreadSidebar:l}=B(),{totalSources:o}=f.useMemo(()=>{if(!m)return{uniqueSources:[],totalSources:0};const x=cs(m),g=x.reduce((h,y)=>h+y.count,0);return{uniqueSources:x,totalSources:g}},[m]),c=ye("caterpillar"),u=f.useCallback(x=>{e&&l({type:"caterpillar",caterpillarId:e,initialTab:x,clientThreadId:t},c)},[l,e,c,t]);return ms(e),n.metadata?.async_task_status_messages?.completed_with_time?s.jsx(ie,{task:a,clientThreadId:t,messageWithTaskMetadata:n,totalSources:o,handleToggleCaterpillarSidebar:u}):!a||!r||r===L.UNDETERMINED?s.jsx(q,{toggleSidebar:()=>{},openSidebar:()=>{},startTime:new Date().getTime()}):a.status===L.COMPLETED?s.jsx(ie,{task:a,clientThreadId:t,messageWithTaskMetadata:n,totalSources:o,handleToggleCaterpillarSidebar:u}):a.status===L.FAILED?s.jsx(Y,{message:n.metadata?.async_task_status_messages?.error??i.formatMessage({id:"at6zk8",defaultMessage:"Failed to think"}),handleToggleCaterpillarSidebar:()=>u("activity")}):a.status===L.CANCELLED?s.jsx(Y,{message:n.metadata?.async_task_status_messages?.cancelled??i.formatMessage({id:"u1rIr5",defaultMessage:"Task Cancelled"}),handleToggleCaterpillarSidebar:()=>u("activity")}):s.jsx(st,{task:a,clientThreadId:t,caterpillarRows:m,messageWithTaskMetadata:n,totalSources:o,handleToggleCaterpillarSidebar:u})}function nt(e,n,t){const a=n.elements.length;if(a===0)return;const i=Object.entries(e).reduce((r,[m,l])=>Array.isArray(l)?l.length>0?r+1:r:l!==""?r+1:r,0);Pe.logEventWithStatsig("dynamic-form-submission","chatgpt_dyanmic_form_submission",{...Ie({clientThreadId:t}),totalItems:a.toString(),completedItems:i.toString(),ratio:(i/a).toString()})}function ot(e,n){let t="";return n.elements.forEach(a=>{const i=a.scope.split("/").pop(),r=i&&e[i],m=r?Array.isArray(r)?r.join(", "):r:"Any",l=a.label??i;t+=`${l}: ${m}
`}),t}function it({messages:e,clientThreadId:n,isLastMessage:t}){const a=e.find(j=>j.author.role===xe.Assistant),i=e.find(j=>j.metadata?.json_form),r=i?.metadata?.json_form,[m,l]=f.useState({}),[o,c]=f.useState(),[u,x]=f.useState(),g=zs(),h=Js(n);f.useEffect(()=>{r&&(c(r.json_form_ui),x(r.json_form_data))},[r]);const y=f.useCallback(()=>{if(l({}),o){const j={...o,elements:o.elements.filter(O=>O.scope!=="#/properties/AdditionalInfo")};c(j)}u&&(delete u.properties.AdditionalInfo,x(u))},[l,c,x,o,u]),b=f.useCallback(()=>{if(o){const j={...o,elements:[...o.elements,{type:"Control",scope:"#/properties/AdditionalInfo",label:"Additional Info",placeholder:"Any other details..."}]};c(j)}if(u){const j={...u.properties,AdditionalInfo:{type:"string"}};x({...u,properties:j})}},[c,x,o,u]),C=o?.elements.some(j=>j.scope.endsWith("#/properties/AdditionalInfo")),A=R(n,P.getCurrentLeafId),N=i?.id!==A;if(!i||!u||!o)return a?.status==="in_progress"&&t?s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx(ne,{className:"h-[26px] w-full"}),s.jsx(ne,{className:"h-[26px] w-3/4"}),s.jsx(ds,{})]}):null;if(N)return null;const U=async j=>{const O=ot(m,o);nt(m,o,n),h({sourceEvent:j,promptMessage:Le(O),completionMetadata:{systemHints:[...g],conversationMode:{kind:z.PrimaryAssistant}}})};return s.jsxs(us,{children:[s.jsx(rt,{formData:m,dataSchema:u,uiSchema:o,setData:l,readOnly:N}),s.jsxs("div",{className:"flex w-full justify-between",children:[C?s.jsx("div",{}):s.jsx(J,{disabled:N,onClick:b,color:"secondary",className:"text-token-text-secondary",children:s.jsx(v,{id:"Sen69P",defaultMessage:"Add a detail"})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(J,{disabled:N,onClick:y,color:"secondary",className:"text-token-text-secondary",children:s.jsx(v,{id:"Uqo7UD",defaultMessage:"Reset"})}),s.jsx(J,{disabled:N,onClick:U,children:s.jsx(v,{id:"FVou++",defaultMessage:"Start"})})]})]})]})}function rt({dataSchema:e,uiSchema:n,setData:t,readOnly:a,formData:i}){return s.jsx("div",{children:s.jsx(gs,{formData:i,readOnly:a,schema:e,uiSchema:n,onChange:r=>t(r)})})}const lt=2e3,Ce=.4,ct=.45,mt=.2,dt=.1,ut=.25;var I=(e=>(e[e.Running=0]="Running",e[e.Finished=1]="Finished",e[e.Error=2]="Error",e[e.Stopped=3]="Stopped",e[e.Paused=4]="Paused",e))(I||{});function Qt({conversationMessages:e,icon:n,status:t,text:a,estimatedToolDurationMs:i,animationLoopDurationMs:r=lt,shouldPersistAfterFinished:m=!1}){const[l,o]=f.useState(t===0?0:t===1&&!m?7:1),[c,u]=f.useState(0);f.useEffect(()=>{t===2?o(8):t===3?o(9):t===4?o(10):t===1?o(l===2?3:7):t===0&&l===10&&(o(2),u(g=>g+1))},[t]);const x=xt(l);return f.useEffect(()=>{const g=e[0].id;if(x)return oe.addDelayedRenderingMessage(g),()=>{oe.removeDelayedRenderingMessage(g)}},[x]),ve(()=>{F(l)&&u(g=>g+1)},r),l===7&&!m?null:s.jsxs("div",{className:"my-2.5 flex items-center gap-2.5",children:[s.jsx(gt,{icon:n,status:t,uiState:l,estimatedToolDurationMs:i,animationLoopCounter:c,shouldPersistAfterFinished:m,onFillProgressBarAnimationComplete:()=>o(4),onFinishAnimationComplete:()=>{o(5),setTimeout(()=>{o(m?7:6)},dt*1e3)},onHideAnimationComplete:()=>o(7)}),s.jsx(ft,{text:a,uiState:l,animationLoopCounter:c,onEnterAnimationComplete:()=>o(2)})]})}const re=50;function gt({icon:e,status:n,uiState:t,estimatedToolDurationMs:a,animationLoopCounter:i,shouldPersistAfterFinished:r,onFillProgressBarAnimationComplete:m,onFinishAnimationComplete:l,onHideAnimationComplete:o}){const[c,u]=f.useState(0);ve(()=>{F(t)?u(N=>N+re):t===10&&u(0)},re);let x,g,h;F(t)||t===10?(x="running",g=s.jsx(e,{animationLoopCounter:i}),h="bg-transparent"):t===4||t===5||t===7&&r?(x="finished",g=s.jsx(xs,{}),h="bg-brand-purple"):n===2?(x="error",g=s.jsx(ps,{}),h="bg-orange-500"):n===3&&(x="stopped",g=s.jsx(_s,{}),h="bg-gray-300");let y={opacity:0,scale:0,rotate:-180,x:0},b={type:"spring",bounce:.3,duration:ct},C={opacity:0,scale:.6,rotate:0,x:0};t===0?(y={opacity:0,scale:.5,rotate:-180,x:-8},b={type:"spring",bounce:.3,duration:Ce}):t===1?y=!1:t===5&&(C={opacity:0,scale:0,rotate:0,x:0},b={type:"spring",bounce:.3,duration:ut});const A=hs(c,a);return s.jsx("div",{className:"relative h-5 w-5 shrink-0",children:s.jsx(V,{onExitComplete:()=>{t===6&&o()},children:x!=null&&s.jsxs(D.div,{className:T("absolute left-0 top-0 flex h-full w-full items-center justify-center rounded-full text-white",h),initial:y,animate:{opacity:1,scale:1,rotate:0,x:0},exit:C,transition:b,onAnimationComplete:()=>{t===4&&l()},children:[g,(F(t)||t===10)&&s.jsx(fs,{percentage:t===3?100:A,thickness:1.5/23,className:"absolute left-1/2 top-1/2 h-[23px] w-[23px] -translate-x-1/2 -translate-y-1/2 text-brand-purple",backgroundStrokeClassName:"stroke-brand-purple/25 dark:stroke-brand-purple/50",transitionDuration:t===3?`${(100-A)/100*mt}s`:void 0,transitionTimingFunction:t===3?"cubic-bezier(0.55, 0, 1, 1)":void 0,onTransitionEnd:()=>{t===3&&m()}})]},x)})})}function ft({text:e,uiState:n,animationLoopCounter:t,onEnterAnimationComplete:a}){const[i,r]=f.useState(e);f.useEffect(()=>{n===2&&r(e)},[t]),f.useEffect(()=>{F(n)||r(e)},[n,e]);let m={opacity:0,x:0,y:15},l={type:"spring",bounce:.3,opacity:{duration:.15},y:{duration:.3}};n===0?(m={opacity:0,x:-8,y:0},l={type:"spring",bounce:.3,duration:Ce,delay:.15}):n===1&&(m=!1);const o=i??void 0;return s.jsx("div",{className:T("relative h-5 w-full leading-5",n===8||n===9?"text-token-text-tertiary":"text-token-text-secondary"),children:s.jsx(V,{children:o!=null&&s.jsx(D.div,{className:"absolute left-0 top-0 line-clamp-1 overflow-visible",initial:m,animate:{opacity:1,x:0,y:0},exit:{opacity:0,x:0,y:-15},transition:l,onAnimationComplete:()=>{n===0&&a()},children:o},o.toString())})})}function F(e){return e===0||e===2||e===3}function xt(e){return F(e)||e===4||e===5||e===6||e===10}const le=pe.div`group left-0 top-0 mr-1.5 overflow-hidden mt-1 text-start`,pt=({highlightedCommand:e,status:n,children:t,showWorkUserSetting:a=!1,hideOnlyIfNotInteractedWith:i=!1,defaultExpanded:r=!1,onOpenAnalytics:m,onClick:l,...o},c)=>{const u=t!=null||l!=null,[x]=f.useState(a),[g,h]=f.useState(a||r),[y,b]=f.useState(!1),C=n===I.Finished||n===I.Error,A=i?x?!1:!y:!1,N=n===I.Running&&"loading-shimmer";return C&&A?null:u?s.jsxs(s.Fragment,{children:[s.jsx(ce,{ref:c,$canShowWork:!0,...o,children:s.jsx(V,{children:s.jsx(le,{children:s.jsx(D.button,{onClick:U=>{g||m?.(),h(j=>!j),b(!0),l?.(U)},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:T(N),children:s.jsxs("div",{className:"flex items-center justify-start gap-1",children:[s.jsx("span",{className:"text-start",children:e}),!l&&(g?s.jsx(ys,{className:"icon-md"}):s.jsx(js,{className:"icon-md"}))]})},e?.toString())})})}),s.jsx(V,{children:g&&t&&s.jsx(D.div,{initial:"collapsed",animate:"reveal",exit:"collapsed",variants:{collapsed:{translateY:-20,opacity:0,height:0},reveal:{translateY:0,opacity:1,height:"auto"}},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:t})})]}):s.jsx(ce,{ref:c,$canShowWork:!1,...o,children:s.jsx(le,{className:T(N),children:e})})},ce=pe.span`block first:mt-0 relative
${({$canShowWork:e})=>e?"text-token-text-secondary hover:text-token-text-primary my-1.5":"text-token-text-secondary"}`,_t=f.forwardRef(pt),ht=3,yt=.1,me=[0,.26,.4];function jt({nextMessage:e,isLastMessage:n,isRequestActive:t,isLastTurnInConversation:a,clientThreadId:i,turnIndex:r}){let m=n||!e||e&&!X(e);const l=f.useRef(!1),o=Qe(),c=R(i,P.getGizmoId);f.useEffect(()=>{e&&X(e)&&!l.current&&(l.current=!0,bs(o,c))},[e,o,c]);const u=Fe(e),x=Ue(e);e?.id&&Qs(e?.id);const g=[];if(x?.[0]?.type==="navigation"&&e&&g.push(s.jsx(bt,{clientThreadId:i,turnIndex:r,nextMessage:e,isRequestActive:t,isLastTurnInConversation:a,navigationCitation:x[0]},"fast-nav")),m){const h=Ve(u.slice(0,ht).map(b=>b.entries[0].url)),y=t?s.jsxs("div",{className:"flex items-center gap-1",children:[h.map((b,C)=>s.jsx(D.div,{className:T("-ml-1.5 first:ml-0 last:mr-1.5","relative"),initial:{width:C===0?0:6,opacity:0},animate:{width:20,opacity:1},transition:{duration:yt,delay:me[Math.min(C,me.length-1)]},children:s.jsx("div",{className:T("flex h-[22px] w-[22px] items-center overflow-hidden rounded-full","border-2 border-token-main-surface-primary bg-token-main-surface-primary"),children:s.jsx(vs,{url:b,size:32,minSize:16,className:"icon-md rounded-full"})})},b)),s.jsx(v,{id:"jjx8Qg",defaultMessage:"Searching the web"})]}):s.jsx(v,{id:"fssXGM",defaultMessage:"Error while searching"});g.push(s.jsx(_t,{highlightedCommand:y,status:t?I.Running:I.Error},"search-gpt-query"))}return g.length?s.jsx(s.Fragment,{children:g}):null}const bt=({clientThreadId:e,turnIndex:n,nextMessage:t,isRequestActive:a,isLastTurnInConversation:i,navigationCitation:r})=>{const{scrollToHeader:m}=ae("searchSources")??{},l=Be(),o=ae("searchSources"),{openThreadSidebar:c}=B(),{value:u}=_e("756982148");return f.useEffect(()=>{He.addFirstTiming("render.fastNavigation")},[]),f.useEffect(()=>{l&&o&&c({type:"searchSources",scrollToHeader:m,clientThreadId:e,turnIndex:n,messageId:t?.id??""})},[]),f.useEffect(()=>{const x=t,g=x.metadata?.search_source,h=r.domains.map(y=>y.url);Es.logEvent(Q.searchToolRequestTimeToFastNav,e,x.id,{search_source:g,urls:h},()=>{g===ze.InstantQuery&&Ss.logEvent(Q.searchToolPageLoadTimeToFastNav,{message_id:x.id,urls:h,search_source:g})})},[e,t,r]),a&&i&&u?s.jsx(D.div,{initial:{opacity:a?0:1,height:a?0:"auto"},animate:{opacity:1,height:"auto"},children:s.jsx(de,{clientThreadId:e,turnIndex:n,nextMessage:t,navigationCitation:r})}):s.jsx(de,{clientThreadId:e,turnIndex:n,nextMessage:t,navigationCitation:r})},de=({clientThreadId:e,turnIndex:n,nextMessage:t,navigationCitation:a})=>{const{toggleThreadSidebar:i}=B(),{value:r}=_e("756982148"),m=f.useMemo(()=>({clientThreadId:e,turnIndex:n,messageId:t?.id}),[e,n,t?.id]),l=f.useCallback((c,u)=>{i({type:"searchSources",scrollToHeader:u,clientThreadId:e,turnIndex:n,messageId:t?.id??""})},[i,e,n,t?.id]),o=Cs(m);return r?s.jsx(Ks,{navigation:a,onShowSearchResults:l,trackContentReferenceEvent:o}):s.jsx(Ns,{tldr:{type:"tldr",status:"done",display_title:a.domains[0].title,url:a.domains[0].url,matched_text:"",start_idx:0,end_idx:0,page_title:"",breadcrumbs:[a.domains[0].domain],refs:[]},trackContentReferenceEvent:o})},vt=E(()=>S(()=>import("./m6yoxe4391nbtmyg.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),Et=E(()=>S(()=>import("./etqj4xq4j5wad3vw.js"),__vite__mapDeps([15,1,3,4,16]))),St=E(()=>S(()=>import("./me7hwew6rs0aw56z.js"),__vite__mapDeps([17,1,3,4,11,5,6,8,9]))),Ct=E(()=>S(()=>import("./hp3ocwib8mmnarbi.js").then(e=>e.c),__vite__mapDeps([18,1,3,4,19,5,6,20,2,7,21,10,9]))),Nt=E(async()=>()=>null),Tt=E(async()=>(await S(()=>import("./iv7bvs4v18w65jsh.js").then(n=>n.i),__vite__mapDeps([22,3,1,4,5,6,18,19,20,2,7,21,10,9,23,24,25,26]))).ImageGenMessage),kt=E(()=>S(()=>import("./c0j16vcme5fz1uuf.js"),__vite__mapDeps([27,1,3,4,5,6,8,9,10,11,12,13,14]))),At=E(()=>S(()=>import("./gqh4w3ycaaim4pak.js"),__vite__mapDeps([28,1,3,4,5,6,8,9,10,11,12,13,14])).then(e=>e.BrowsingMessage)),Mt=E(()=>S(()=>import("./n53kueinnquhe6fx.js"),__vite__mapDeps([29,1,3,4,5,6])).then(e=>e.SearchResultMessage)),wt=E(()=>S(()=>import("./hjb02wgbg97lpn2f.js"),__vite__mapDeps([30,1,3,4,5,6,31,8,9,10,11,12,13,14])).then(e=>e.JITPluginMessage)),Dt=E(()=>S(()=>import("./lmwoqrh0f0q9nw7i.js"),__vite__mapDeps([32,3,1,4,33,5,6,34,35,36,8,9,10,11,12,13,14])).then(e=>e.DataAnalysisMessage)),Rt=E(()=>S(()=>import("./o3ku8s79rgxxgin3.js"),__vite__mapDeps([37,1,3,4,5,6,38]))),Ot=E(()=>S(()=>import("./bpkxn0v1y9w6s1vy.js"),__vite__mapDeps([39,1,23,3,4,5,6,40,10,9,41,42,43,44,45,19,46,34,35,36,47,48,49,12,50,51,52,53])).then(e=>e.CoTMessage)),Lt=E(()=>S(()=>import("./hp061s6r7n3gqzr2.js"),__vite__mapDeps([54,1,5,3,4,6,55,56,57,58,59])).then(e=>e.JawboneMessage));function Xt({groupedMessagesToRender:e,allMessages:n,allGroupedMessages:t,clientThreadId:a,isUserTurn:i,isCompletionRequestInProgress:r,isFeedbackEnabled:m,isFinalTurn:l,isFinalUserTurn:o,turnIndex:c,hasActiveRequest:u,onRequestCompletion:x,shouldGrowContainer:g=!0,isParagen:h=!1,renderingView:y="chat"}){const{showDebugConversationTurns:b}=Ts(),[C]=R(a,d=>[d?.mode]),A=Je(a),N=ks(),U=t.some(d=>d.type===p.Browsing||d.type===p.RetrievalBrowsing||d.type===p.SearchGPTQuery),j=As(()=>Ms.count(ws.DEFAULT,"conversation_turn_grouped_messages.attempted_render_missing_type_f959b8c")),O=e.map((d,_)=>{const k=_===t.length-1,Z=_===0?void 0:e[_-1],G=Z?.type,ee=Z?.messages,Te=d&&!X(d.messages[0]),se=U&&Te?null:s.jsx(Ws,{className:"min-h-8",message:d.messages[0],isFeedbackEnabled:m,isFinalUserTurn:o,isCompletionInProgress:k&&r,hasActiveRequest:u,turnIndex:c,clientThreadId:a,isUserTurn:i,prevGroupedMessageType:G,prevGroupedMessages:ee});switch(d.type){case p.Text:case p.MultiText:return d.type===p.Text?s.jsxs(f.Fragment,{children:[se,s.jsx(Ps,{isUserTurn:i,message:d.messages[0]})]},"group-"+d.messages[0].id):d.type===p.MultiText?s.jsx(St,{clientThreadId:a,messages:d.messages,isCompletionInProgress:k&&r,isFeedbackEnabled:m,hasActiveRequest:u,prevGroupedMessageType:G,prevGroupedMessages:ee},"multitext-"+(d.messages[0]?.id??_)):d.type;case p.Browsing:case p.RetrievalBrowsing:{const M=C!=null&&[z.GizmoInteraction,z.GizmoMagicCreate,z.GizmoTest].includes(C.kind),w=A?Ls(A):!1;return s.jsx(At,{messages:d.messages,isRequestActive:u,isLastMessageInTurn:k,isUsingGizmo:M,isUsingSnorlax:w,isRetrieval:d.type===p.RetrievalBrowsing},"browsing-"+(d.messages[0]?.id??_))}case p.SearchGPTQuery:{const M=t.slice(_+1).find(({type:H})=>H===p.Text),w=M?.type===p.Text?M:void 0;return s.jsx(jt,{clientThreadId:a,turnIndex:c,isRequestActive:u,isLastMessage:k,isLastTurnInConversation:l,nextMessage:w?.messages[0]},"searchquery-"+(d.messages[0]?.id??_))}case p.a8km123:{if(!d.messages.some(w=>w.metadata?.model_slug==="o1-pro")){const w=We(n,H=>H.author.role===xe.Assistant&&H.recipient==="all");return s.jsx(Ot,{clientThreadId:a,turnIndex:c,isStreaming:(k||w<_)&&r,messages:d.messages},"sum-"+(d.messages[0]?.id??_))}return s.jsx(Rt,{messages:d.messages,isStreaming:k&&r,isLastMessage:k,clientThreadId:a,currentGroupedMessageIndex:_,turnIndex:c},"sum-"+(d.messages[0]?.id??_))}case p.f959b8c:return j(),null;case p.is_loading_message:return k&&r?s.jsx(Os,{},"loading-message-"+_):null;case p.c12k321:return null;case p.l1p9k3u:return null;case p.b1de6e2_c:return s.jsx(it,{messages:d.messages,clientThreadId:a,isLastMessage:k},"b1de6e2-"+(d.messages[0]?.id??_));case p.b1de6e2_s:return s.jsx(tt,{messages:d.messages,clientThreadId:a},"b1de6e2_s-"+(d.messages[0]?.id??_));case p.b1de6e2_d:return null;case p.b1de6e2_rm:return s.jsx(Rs,{messages:d.messages,clientThreadId:a,renderingView:y,children:se},"b1de6e2_rm-"+(d.messages[0]?.id??_));case p.de1d73e:if(N){const M=_+1<t.length?t[_+1]:void 0;return s.jsx(Lt,{clientThreadId:a,currentGroupedMessage:d,nextMessage:M&&M.type===p.Text?M.messages[0]:void 0,isLastMessage:k,isRequestActive:u},"jawbone-"+(d.messages[0]?.id??_))}else return null;case p.ParallelBrowsing:return s.jsx(kt,{messages:d.messages},"parallel-"+(d.messages[0]?.id??_));case p.CodeInterpreter:return s.jsx(Dt,{messages:d.messages,isRequestActive:u,clientThreadId:a},"ada-"+(d.messages[0]?.id??_));case p.JITPlugin:return s.jsx(wt,{messages:d.messages,clientThreadId:a,isLastTurnInConversation:l,onRequestCompletion:x},"jit-"+(d.messages[0]?.id??_));case p.t2uay3k:return s.jsx(Tt,{messages:d.messages,clientThreadId:a,disableClickThru:h},"t2uay3k-"+(d.messages[0]?.id??_));case p.Dalle:return s.jsx(Ct,{messages:d.messages,clientThreadId:a,disableClickThru:h},"dalle-"+(d.messages[0]?.id??_));case p.GizmoEditor:return s.jsx(vt,{messages:d.messages},"gizmo-editor-"+(d.messages[0]?.id??_));case p.oiw209h:return s.jsx(Nt,{messages:d.messages,clientThreadId:a},"oiw209h-"+(d.messages[0]?.id??_));case p.Canmore:return s.jsx($s,{messages:d.messages,allGroupedMessages:e,isFinalTurn:l,isRequestActive:u,clientThreadId:a,isUserTurn:i},"canmore-"+(d.messages[0]?.id??_));case p.Oboe:return null;case p.Debug:return b?s.jsx(Et,{message:d.messages[0]},"debug-"+d.messages[0].id):null;case p.SearchResult:return s.jsx(Mt,{messages:d.messages},"search-result-"+(d.messages[0]?.id??_));default:Ds(d.type)}}),Ne=Bs();return s.jsx("div",{className:T({"flex max-w-full flex-col":!0,"flex-grow":g}),children:s.jsx(Ke,{name:"GroupedMessages",fallback:Pt,children:i?O:s.jsxs(Is,{isDisabled:i||!l||!r,children:[Fs()&&l&&s.jsx(Us,{isStreaming:r,debug:Ne}),O]},n[0]?.id)})})}function Pt(){return s.jsx(Vs,{type:"danger",children:s.jsx(v,{id:"5eGo3w",defaultMessage:"Unable to display this message due to an error."})})}export{Xt as C,de as F,I as T,_t as a,Qt as b};
//# sourceMappingURL=m97sb2fnwj0a6vyo.js.map
