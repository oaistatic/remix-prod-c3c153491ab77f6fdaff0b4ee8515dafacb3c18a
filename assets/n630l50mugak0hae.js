const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/juzp60xgrr7p9ek9.js","assets/fs6h2trisr1juto6.js","assets/njq6ygky3ttysgdk.js","assets/root-cl538jor.css","assets/d7a6rc8fexfzu7dt.js","assets/conversation-small-m9kq0y4e.css","assets/d9mfjso63mrxiny3.js","assets/joa8jajuiu4xqpzn.js"])))=>i.map(i=>d[i]);
import{bH as B,l as Q,d as N,c7 as Z,V as W,c5 as J,ei as Y,bT as $,S as M,P as T,a as P,cG as ee,bQ as te,bR as ne,a3 as ae,ge as I,gd as A,M as se,c6 as oe,F as ie,D as re}from"./njq6ygky3ttysgdk.js";import{r as u,e as y,j as e,a5 as V,M as C,b as le,n as ce}from"./fs6h2trisr1juto6.js";import{F as de}from"./fj65uqnkvh37vl4n.js";import{is as H,j8 as ue,er as me,j9 as U,bi as G,cg as E,ek as ge,a3 as pe,z as fe,E as R,bB as F,dp as he,ja as xe,bC as je,iV as be,jb as we,jc as Ce,ch as z}from"./d7a6rc8fexfzu7dt.js";import{I as ve,f as ke}from"./o3d0pfqxdj7nivvr.js";import{U as Ie,R as Ee,P as ye}from"./dr3h4pxnog1msvu6.js";import{R as De,T as Se,a as Ne,b as _e}from"./48b1r0bzghcb5a9u.js";import"./fu6bathgya5b9rdr.js";import"./lj0prj6na7gf1jpf.js";import"./csg4i0wk6hi0jvkd.js";import"./kukctmibghbbqwq7.js";import"./ijutvl794yycgs5p.js";import"./n9whwsbg0rx5cs8k.js";import"./gunpso70jnmarvod.js";import"./jyg6m0czwgwjnl3i.js";import"./en8ogvlmn3lccz09.js";import"./gvhvfcdqhc5unmaw.js";import"./wqepkoieaii7q4ep.js";import"./gfo75oujoeaedm5y.js";import"./n1h3bv0q1kp4dflt.js";import"./o634nz6bc7e8bevz.js";import"./ohq33fk3dbalo2mk.js";import"./cffgjlidl1olpt2q.js";import"./i6ze5suolzahci5v.js";import"./npeck75bz46c490i.js";import"./m97sb2fnwj0a6vyo.js";import"./cm0hdcditutj2jz2.js";import"./jcoe6v231ph25bfi.js";import"./mfnl9tbidoj0ik29.js";import"./loh8e64j4csffv26.js";function Me(){const[t,n]=u.useState({undoStack:[],currentIndex:-1});function s(a){n(c=>({undoStack:[...c.undoStack.slice(0,c.currentIndex+1),a],currentIndex:c.currentIndex+1}))}function r(){n(a=>({undoStack:a.undoStack,currentIndex:Math.max(a.currentIndex-1,-1)}))}function o(){n(a=>({undoStack:a.undoStack,currentIndex:Math.min(a.currentIndex+1,a.undoStack.length-1)}))}function i(){n({undoStack:[],currentIndex:-1})}return{currentDrawnShape:t.undoStack.length>0?t.undoStack[t.currentIndex]:null,onNewDrawnShape:s,canUndoDrawing:t.currentIndex>=0,undoDrawing:r,canRedoDrawing:t.currentIndex<t.undoStack.length-1,redoDrawing:o,clearAllDrawings:i}}var m=(t=>(t[t.Default=0]="Default",t[t.Inpaint=1]="Inpaint",t))(m||{});function Te({imageAsset:t,mode:n,setMode:s,clientThreadId:r,messageId:o,cursorWidth:i,setCursorWidth:a,inpaintingDrawingState:c,isLoadingNewImage:l}){const g=Q(r),{canUndoDrawing:d,undoDrawing:j,canRedoDrawing:h,redoDrawing:x,clearAllDrawings:b}=c,w=y();return e.jsxs(V.div,{className:"flex h-16 w-full justify-between px-4",...H,children:[e.jsx("div",{className:"flex items-center",children:n===m.Inpaint&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:N("flex items-center gap-3",l&&"opacity-50"),children:[e.jsx(L,{className:"h-[11px] w-[11px]"}),e.jsxs(De,{className:"relative flex w-[90px] items-center",min:32,max:240,step:.01,value:[i],onValueChange:v=>a(v[0]),disabled:l,children:[e.jsx(Se,{className:"relative h-[2px] grow bg-token-text-quaternary",children:e.jsx(Ne,{className:"absolute h-full bg-token-text-secondary"})}),e.jsx(_e,{className:"block h-[11px] w-[11px] rounded-full bg-token-text-secondary"})]}),e.jsx(L,{className:"h-6 w-6"})]}),e.jsx(O,{}),e.jsx(f,{disabled:!d||l,onClick:j,children:e.jsx(Ie,{})}),e.jsx(f,{disabled:!h||l,onClick:x,children:e.jsx(Ee,{})}),e.jsx(O,{}),e.jsx(f,{disabled:!d||l,onClick:b,children:e.jsx(C,{id:"imageEditorControls.clearSelectionButtonLabel",defaultMessage:"Clear selection"})})]})}),e.jsx("div",{className:"flex items-center",children:n===m.Inpaint?e.jsx(f,{onClick:()=>s(m.Default),disabled:l,children:e.jsx(C,{id:"imageEditorControls.cancelButtonLabel",defaultMessage:"Cancel"})}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{imageAsset:t,setMode:s,messageId:o,serverThreadId:g}),e.jsx(f,{tooltip:w.formatMessage({id:"imageEditorControls.downloadButtonTooltip",defaultMessage:"Save"}),onClick:()=>ue(t,g,o),children:e.jsx(me,{})}),e.jsx(Pe,{prompt:U(t),children:e.jsx(f,{tooltip:w.formatMessage({id:"imageEditorControls.promptButtonTooltip",defaultMessage:"Prompt"}),children:e.jsx(G,{})})}),e.jsx(f,{tooltip:w.formatMessage({id:"imageEditorControls.closeButtonTooltip",defaultMessage:"Close"}),onClick:E.close,children:e.jsx(Z,{className:"icon-lg"})})]})})]})}function Pe({prompt:t,children:n}){const[s,r]=u.useState(!1),o=y(),i=W();return e.jsx(ge,{sideOffset:4,alignAgainstAnchor:"end",triggerButton:e.jsx("div",{className:"group",children:n}),className:"z-10",size:"none",children:e.jsxs("div",{className:"flex max-w-sm flex-col gap-3 p-4",children:[e.jsx("div",{className:"text-token-text-secondary",children:e.jsx(C,{id:"imageEditorControls.promptPopoverLabel",defaultMessage:"Prompt"})}),e.jsx("div",{children:t}),e.jsx("div",{children:e.jsx(J,{color:"secondary",disabled:s,onClick:a=>{r(!0),pe(t,i,a),setTimeout(()=>r(!1),2e3)},icon:Y,children:s?o.formatMessage({id:"imageEditorControls.copiedButtonLabel",defaultMessage:"Copied!"}):o.formatMessage({id:"imageEditorControls.copyButtonLabel",defaultMessage:"Copy"})})})]})})}function f({children:t,tooltip:n,disabled:s,onClick:r}){const o=e.jsx("button",{className:N("rounded p-2 font-semibold hover:bg-token-main-surface-tertiary group-radix-state-open:bg-token-main-surface-tertiary",s?"text-token-text-quaternary":"text-token-text-secondary"),disabled:s,onClick:r,children:t});return n!=null?e.jsx($,{label:n,sideOffset:4,children:o}):o}function Ae({imageAsset:t,setMode:n,messageId:s,serverThreadId:r,disabled:o}){const i=y(),a=fe(R.DalleEditingOnboarding),c=a.eligible&&!a.isLoading,l=e.jsx(f,{tooltip:c?void 0:i.formatMessage({id:"imageEditorControls.inpaintButtonTooltip",defaultMessage:"Select"}),onClick:()=>{n(m.Inpaint),M.logEvent("chatgpt_dalle_inpaint_click",null,{sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id!=null?"true":"false",model:"dalle"}),T.logEvent(P.dalleImageClickInpaint,{conversationId:r,messageId:s,generationId:t.metadata?.dalle?.gen_id,fileId:F(t.asset_pointer),parentGenerationId:t.metadata?.dalle?.parent_gen_id,sourceOperation:t.metadata?.dalle?.edit_op,model:"dalle"}),M.logEvent("chatgpt_image_inpaint_click",null,{sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id!=null?"true":"false",model:"dalle"}),T.logEvent(P.chatgptImageInpaintClick,{conversationId:r,messageId:s,generationId:t.metadata?.dalle?.gen_id,fileId:F(t.asset_pointer),parentGenerationId:t.metadata?.dalle?.parent_gen_id,sourceOperation:t.metadata?.dalle?.edit_op,model:"dalle"})},disabled:o,children:e.jsx(ye,{})});return c?e.jsx(he,{announcementKey:R.DalleEditingOnboarding,show:!0,side:"bottom",sideOffset:0,title:i.formatMessage({id:"imageEditorNUX.title",defaultMessage:"Select area of the image to edit"}),description:i.formatMessage({id:"imageEditorNUX.description",defaultMessage:"Highlight the area and describe changes in chat."}),onDismiss:a.markAsViewed,children:e.jsx("div",{children:l})}):l}const O=B.div`mx-3 w-[1px] h-6 bg-token-border-light`,L=B.div`rounded-full border-2 border-token-text-secondary`;function Re({mode:t,imageIndex:n,allImages:s,onSwitchImage:r,isLoadingNewImage:o}){const i=n>0,a=u.useCallback(()=>{i&&r(s[n-1])},[i,s,n,r]),c=n<s.length-1,l=u.useCallback(()=>{c&&r(s[n+1])},[c,s,n,r]);return u.useEffect(()=>{function g(d){d.target instanceof HTMLTextAreaElement||t===m.Default&&(d.key==="ArrowLeft"?a():d.key==="ArrowRight"&&l())}return document.addEventListener("keydown",g),()=>{document.removeEventListener("keydown",g)}},[t,a,l]),e.jsx("div",{className:"flex h-16 w-full items-center justify-center gap-3 font-semibold text-token-text-secondary",children:t===m.Inpaint?!o&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(C,{id:"imageEditor.selectArea",defaultMessage:"Select an area to edit"}),e.jsx("a",{href:"https://help.openai.com/en/articles/9055440",target:"_blank",rel:"noreferrer",children:e.jsx(G,{className:"icon-md"})})]}):s.length>1?e.jsxs(e.Fragment,{children:[e.jsx("button",{disabled:!i,className:"disabled:text-token-text-tertiary",onClick:a,children:e.jsx(xe,{className:"icon-lg"})}),e.jsx("div",{children:e.jsx(C,{id:"imageEditor.imageNumber",defaultMessage:"Image {num} of {numImages}",values:{num:n+1,numImages:s.length}})}),e.jsx("button",{disabled:!c,className:"disabled:text-token-text-tertiary",onClick:l,children:e.jsx(ee,{className:"icon-lg"})})]}):null})}const Fe=0,Oe=64;function Le({imageAsset:t,children:n,containerDimensions:s,isLoadingNewImage:r}){return e.jsxs(V.div,{className:"absolute",style:Be(t,s),...H,children:[n,e.jsx("div",{className:N("absolute inset-0 flex items-center justify-center bg-token-main-surface-primary transition-opacity duration-1000",r?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]})}function Be(t,n){const{width:s,height:r}=t,{width:o,height:i}=n,a=o-2*Fe,c=i-2*Oe,l=s/r,g=a/c,d=l>g,j=d?a:c*l,h=d?a/l:c,x=(i-h)/2,b=(o-j)/2;return{top:x,left:b,width:j,height:h}}const We=te(()=>ne(()=>import("./juzp60xgrr7p9ek9.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(t=>t.DynamicDrawingCanvas));function jt({clientThreadId:t,messageId:n,image:s,allImages:r}){const o=ae(t,ie.getCurrentNode),i=[I.Dalle,I.t2uay3k].includes(A(o.message))&&!je(o.message),a=le();return u.useEffect(()=>{async function c(l,g){try{const d=await ke(a,l);E.setFocusedObject({type:z.Image,image:d[0],allImages:d,messageId:g})}catch(d){re.addError(new Error("Failed to load newly created images:",{cause:d}))}}if(o!=null&&[I.Dalle,I.t2uay3k].includes(A(o.message))&&o.message.content.content_type===se.MultimodalText){const l=oe.getImageAssetPointers(o.message);c(l,o.id)}},[a,o]),e.jsx(Ve,{image:s,allImages:r,isLoadingNewImage:i,clientThreadId:t,messageId:n})}function Ve({image:t,allImages:n,isLoadingNewImage:s,clientThreadId:r,messageId:o}){const[i,a]=u.useState(m.Default),[c,l]=u.useState({width:window.innerWidth-de,height:window.innerHeight}),g=u.useRef(null),[d,j]=u.useState(136),h=Me(),{currentDrawnShape:x,onNewDrawnShape:b,clearAllDrawings:w}=h,v=u.useRef(null),D=y(),_=W(),{setTargetedContent:k}=be();u.useEffect(()=>{const p=new ResizeObserver(S=>{const{width:X,height:K}=S[0].contentRect;l({width:X,height:K})});return g.current&&p.observe(g.current),()=>{p.disconnect()}},[]),u.useEffect(()=>{function p(S){S.key==="Escape"&&(i===m.Inpaint?a(m.Default):E.close())}return document.addEventListener("keydown",p),()=>{document.removeEventListener("keydown",p)}},[i]),u.useEffect(()=>(x==null?k({type:"object",placeholderTextOverride:ce({id:"imageEditor.transformationTextareaPlaceholder",defaultMessage:"Edit imageâ€¦"}),shouldPersistAcrossMessages:!0,isFocusedViewContent:!0,createNewCompletionParams:p=>we(p,t)}):k({type:"object",label:D.formatMessage({id:"imageEditor.inpaintingTargetedContentLabel",defaultMessage:"Edit selection"}),isFocusedViewContent:!0,createNewCompletionParams:async p=>await Ce(p,t,v.current?.getImageData(),D,_),onCleared:()=>a(m.Default)}),()=>{k(void 0)}),[t,D,k,x,_]),u.useEffect(()=>{i!==m.Inpaint&&w()},[i]),u.useEffect(()=>{a(m.Default)},[t]);const q=n.findIndex(p=>p.asset_pointer===t.asset_pointer);return e.jsxs("div",{ref:g,className:"flex h-full w-full flex-col justify-between",children:[e.jsx(Te,{imageAsset:t,mode:i,setMode:a,clientThreadId:r,messageId:o,cursorWidth:d,setCursorWidth:j,inpaintingDrawingState:h,isLoadingNewImage:s}),e.jsx(Re,{mode:i,imageIndex:q,allImages:n,onSwitchImage:p=>{E.setFocusedObject({type:z.Image,image:p,allImages:n,messageId:o})},isLoadingNewImage:s}),e.jsxs(Le,{imageAsset:t,containerDimensions:c,isLoadingNewImage:s,children:[e.jsx(ve,{className:"h-full w-full",alt:U(t),src:t.url,width:t.width,height:t.height,fadeIn:!1}),i===m.Inpaint&&e.jsx("div",{className:"absolute inset-0",children:e.jsx(We,{drawingCanvasRef:v,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:d,canvasWidth:t.width,canvasHeight:t.height,currentDrawnShape:x,onNewDrawnShape:b})})]})]})}export{jt as ImageEditor};
//# sourceMappingURL=n630l50mugak0hae.js.map
