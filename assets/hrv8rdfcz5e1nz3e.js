const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/eavho0ga46bbwzuv.js","assets/fs6h2trisr1juto6.js"])))=>i.map(i=>d[i]);
import{e as p,j as t,M as w,r as m,R as J,u as q,d as X}from"./fs6h2trisr1juto6.js";import{bF as Z,bT as K,bH as j,c0 as Q,V as Y,a0 as ee,x as te,l as se,cN as M,d as I,bR as ae,ch as C,Z as ne,cL as oe,M as F,D as R}from"./njq6ygky3ttysgdk.js";import{j4 as re,hG as ie,hH as le,jf as ce,gG as de,gH as ue,iR as N,gI as me,jg as ge,iS as pe,jh as xe,a3 as _,ji as fe,dP as he,bN as Ce,hr as ye,jj as be,N as Se,jk as we,bB as je,jl as ve}from"./d7a6rc8fexfzu7dt.js";import{S as Te}from"./gvhvfcdqhc5unmaw.js";import{C as Ee}from"./ora9zmv2zdoi2bvo.js";function Me(e){return"children"in e?A(e):"value"in e?e.value:""}function Ne(e){return e.type==="text"?e.value:"children"in e?A(e):""}function A(e){let a=-1;const s=[];for(;++a<e.children.length;)s[a]=Ne(e.children[a]);return s.join("")}const _e=({content:e,codeLanguage:a,codeSnippetRef:s,clientThreadId:n})=>{const r=p(),o=re(),i=ie(n);if(!le(i,Z.Canvas))return null;function d(){de.logButtonClick(ue.EDIT_IN_CANVAS_CODE_SNIPPET),o&&N.removeTempTextdoc(o.textdocId),s?.current&&me(s.current);const g=N.createTempTextdoc(e,r.formatMessage({id:"9e0Zzr",defaultMessage:"New document"}),ge.MESSAGE_CODE_SNIPPET,a);requestAnimationFrame(()=>{pe(g)})}return t.jsx(K,{label:t.jsx(w,{id:"EditInCanvasButton.editTooltip",defaultMessage:"Edit in canvas"}),sideOffset:0,children:t.jsxs("button",{className:"flex select-none items-center gap-1 px-4 py-1",onClick:d,children:[t.jsx(ce,{className:"icon-xs"}),r.formatMessage({id:"5k0sSJ",defaultMessage:"Edit"})]})})},D=m.createContext({isWithinDataAnalysisToolMessage:!1}),ke=te(()=>ae(()=>import("./eavho0ga46bbwzuv.js"),__vite__mapDeps([0,1]))),Ie=J.memo(function({htmlSegment:a}){return t.jsx("span",{dangerouslySetInnerHTML:{__html:a}})}),Fe=e=>{if(e instanceof Element)return e.closest("[data-message-id]")?.getAttribute("data-message-id")??void 0};function Re({wrapperClassName:e,codeClassName:a,language:s,content:n,shouldWrapCode:r,clientThreadId:o,removeTopBorderRadius:i}){const l=Q(),d=m.useRef(null),g=Y(),f=ee(),h=xe(),L=m.useCallback(c=>{c.preventDefault(),c.stopPropagation();const u=window.getSelection()?.toString();u&&_(u,void 0,c)},[]),U=m.useCallback(c=>{const u=(z,T,G)=>{if(f||o==null||T===void 0)return;const E=se(o);E!=null&&fe(l,{source:z,type:"copy",messageId:T,serverThreadId:E,selectedText:G,location:"code-snippet"})},W=Fe(c.target);_(n,g,c),u("mouse",W,n)},[l,n,g,f,o]),v=p(),{isWithinDataAnalysisToolMessage:H}=m.useContext(D),[x,B]=m.useState(null);m.useEffect(()=>{ke().then(c=>{if(c!=null)try{B(c.highlightCode(n,s))}catch(u){if(!(u instanceof Error&&/Unknown language/i.test(u.message)))throw u}})},[n,s]);const $=s==="svg"||(s==="xml"||s==="html")&&He(n),y=m.useMemo(()=>x?.html.split(/(<span[^>]*>.*?<\/span>)/g).filter(Boolean),[x?.html]),V=$?t.jsx(Te,{svgString:n}):y&&y.length>0?t.jsx("span",{children:y.map((c,u)=>t.jsx(Ie,{htmlSegment:c},u))}):x?.html?t.jsx("span",{dangerouslySetInnerHTML:{__html:x.html}}):t.jsx("span",{children:n});return t.jsx(De,{ref:d,title:x?.language??s,shouldWrapCode:r,stickyTitleRightContent:t.jsxs("div",{className:"flex items-center rounded bg-token-sidebar-surface-primary px-2 font-sans text-xs text-token-text-secondary dark:bg-token-main-surface-secondary",children:[H&&t.jsx(Ae,{}),t.jsx(Ee,{buttonText:h?v.formatMessage({id:"6NJu7m",defaultMessage:"Copy"}):v.formatMessage({id:"zIa6ZQ",defaultMessage:"Copy code"}),onCopy:U,className:h?"px-4 py-1":"py-1",iconClassName:h?"icon-xs":"icon-sm"}),o&&h&&t.jsx(_e,{content:n,codeLanguage:s??"",codeSnippetRef:d,clientThreadId:o})]}),codeClassName:a,onCopy:L,className:e,removeTopBorderRadius:i,children:V})}function Ae(){const a=he(!0),{data:s=!1}=Ce(M.ShowExpandedCodeView),n=p();return t.jsxs("div",{className:"mr-2 flex items-center gap-2 border-r border-token-border-medium pr-2",children:[t.jsx("label",{htmlFor:"ada-always-show",children:t.jsx(w,{defaultMessage:"Always show details",id:"message.tools.codeInterpreter.alwaysShowAnalysis"})}),t.jsx(ye,{id:"ada-always-show",size:"small",onChange:r=>{a.mutate({setting:M.ShowExpandedCodeView,value:r})},enabled:s,label:s?n.formatMessage({defaultMessage:"Toggle to always expand detail view for code analysis on",id:"message.tools.codeInterpreter.alwaysShowAnalysis.enabled"}):n.formatMessage({defaultMessage:"Toggle to always expand detail view for code analysis off",id:"message.tools.codeInterpreter.alwaysShowAnalysis.disabled"})})]})}function De({children:e,title:a,stickyTitleRightContent:s,shouldWrapCode:n=!1,className:r,codeContainerClassName:o,codeClassName:i,ref:l,onCopy:d,removeTopBorderRadius:g}){return t.jsxs(Oe,{className:r,children:[t.jsx(Pe,{$removeTopBorderRadius:g,children:a}),t.jsx("div",{className:"sticky top-9",children:t.jsx("div",{className:"absolute bottom-0 right-0 flex h-9 items-center pr-2",children:s})}),t.jsx(Le,{ref:l,className:o,children:t.jsx(Ue,{$shouldWrap:n,className:i,onCopy:d,children:e})})]})}const Oe=j.div`contain-inline-size rounded-md border-[0.5px] border-token-border-medium relative bg-token-sidebar-surface-primary`,Pe=j.div`flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary dark:bg-token-main-surface-secondary select-none ${e=>e.$removeTopBorderRadius?"":"rounded-t-[5px]"}`,Le=function({children:a,className:s,ref:n}){return t.jsx("div",{ref:n,className:I("overflow-y-auto p-4",s),dir:"ltr",children:a})},Ue=j.code`${e=>e.$shouldWrap?"!whitespace-pre-wrap":"!whitespace-pre"}`;function He(e){return e.trim().startsWith("<svg")}function Be({node:e,className:a,wrapperClassName:s,children:n,inline:r,clientThreadId:o,removeTopBorderRadius:i,...l}){if(r)return t.jsx("code",{className:a,...l,children:n});{const d=a?.split(" ").find(f=>f.startsWith("language-"))?.split("-")[1],g=e?Me(e):"";return t.jsx(Re,{clientThreadId:o,language:d,wrapperClassName:s,codeClassName:a,content:g,removeTopBorderRadius:i})}}function O(e){return e.type==="element"}function $e(e){return O(e)?e.tagName==="code":!1}function st(){return function(e){be(e,"element",function(a,s,n){$e(a)&&(n&&O(n)&&n.tagName==="pre"?a.properties.inline=!1:a.properties.inline=!0)})}}function Ve({jupyterMessage:e}){const a=Se(),s=p();if(a)return t.jsxs("div",{className:"my-1 flex h-52 w-full max-w-xs flex-col items-center justify-center gap-2 rounded-md border-black/5 bg-gray-100 p-7 text-center text-token-text-tertiary dark:border-white/10",children:[t.jsx(we,{className:"icon-lg"}),t.jsx(w,{...S.imageNotSupported})]});if(e.image_payload!=null)return t.jsx("img",{className:"my-1",src:`data:image/png;base64,${e.image_payload}`,alt:s.formatMessage(S.altText)});if(e.image_url!=null){const n=je(e.image_url);return t.jsx(Ge,{fileId:n})}return null}const We=30*1e3,P=100,b=1.5,ze=Math.log(1-We*(1-b)/P)/Math.log(b);function Ge({fileId:e}){const a=p(),{data:s,isLoading:n,refetch:r}=q({queryKey:["getFileDownloadLink",e],queryFn:()=>ne.getFileDownloadLink(e),refetchInterval:o=>{const i=o.state.dataUpdateCount;return o.state.data?.status===C.Success||i>ze||o.state.status===C.Error?!1:Math.pow(b,i)*P}});return m.useEffect(()=>{if(s?.status===C.Success){const i=new URL(s.download_url,location.toString()).searchParams.get("se");i!=null&&!n&&new Date>new Date(i)&&r()}},[s,n,r]),s?.status!==C.Success?null:t.jsx("img",{src:s.download_url,className:"my-1 max-h-full max-w-full",alt:a.formatMessage(S.altText)})}const S=X({imageNotSupported:{id:"CodeExecutionOutputImage.imageNotSupported",defaultMessage:"Image output is not supported in a shared chat"},altText:{id:"CodeExecutionOutputImage.altText",defaultMessage:"Output image"}});function at({FormattedText:e,message:a,codeRendererClassName:s,removeTopBorderRadius:n}){const r=oe();return t.jsx(D.Provider,{value:{isWithinDataAnalysisToolMessage:!0},children:t.jsx(e,{className:I("markdown prose w-full break-words dark:prose-invert",r?"dark":"light"),componentOverrides:{code:o=>t.jsx(Be,{...o,wrapperClassName:s,removeTopBorderRadius:n})},children:Je(a)})})}function Je(e){function a(s,n){return`\`\`\`${n}
${s}
\`\`\``}if(e.content.content_type==="code")return a(e.content.text,"python");if(e.recipient==="python"){if(e.content.content_type!=="text")throw new Error("Unexpected content type for code message");const s=e.content.parts;if(s.length!==1||typeof s[0]!="string")throw new Error("Unexpected parts for code message");return a(s[0],"python")}throw new Error("Unexpected code message format")}function nt({message:e}){const a=p();if(e.content.content_type!==F.ExecutionOutput)return null;const s=e.metadata?.aggregate_result;if(!s)return R.addError("Corrupt code execution result message"),null;const n=s.messages.filter(Xe),r=n.length>0,o=s.final_expression_output!=null,i=s.in_kernel_exception!=null;return t.jsxs(t.Fragment,{children:[r&&t.jsx(k,{label:"STDOUT/STDERR",output:n.map((l,d)=>t.jsx("span",{className:l.stream_name==="stderr"?"text-red-500":"",children:l.text},`${d}`))}),o&&t.jsx(k,{label:a.formatMessage({id:"codeInterpreterMessage.resultLabel",defaultMessage:"Result"}),output:s.final_expression_output}),i&&t.jsx(qe,{traceback:s.in_kernel_exception.traceback.join("")})]})}function k({label:e,output:a}){return t.jsxs("div",{className:"bg-gray-700 p-4 text-xs",children:[t.jsx("div",{className:"mb-1 text-gray-400",children:e}),t.jsx("div",{className:"prose flex flex-col-reverse text-white",children:t.jsx("pre",{className:"shrink-0",children:a})})]})}function qe({traceback:e}){return t.jsx("div",{className:"overflow-auto border-t border-gray-500 bg-black text-white",children:t.jsx("div",{className:"border-l-4 border-red-500 p-2 text-xs",children:t.jsx("div",{className:"scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-700 flex max-h-64 flex-col-reverse",children:t.jsx("pre",{className:"shrink-0",children:e})})})})}function ot({message:e}){if(e.content.content_type!==F.ExecutionOutput)return null;const a=e.metadata?.aggregate_result;return a?t.jsx(t.Fragment,{children:a.messages.filter(Ze).map((s,n)=>t.jsx(Ve,{jupyterMessage:s},n))}):(R.addError("Corrupt code execution result message"),null)}function Xe(e){return e.message_type==="stream"}function Ze(e){return e.message_type==="image"||"image_url"in e&&ve(e.image_url+"")}export{ot as C,at as a,nt as b,Ve as c,Be as d,Je as g,Ze as i,st as r};
//# sourceMappingURL=hrv8rdfcz5e1nz3e.js.map
