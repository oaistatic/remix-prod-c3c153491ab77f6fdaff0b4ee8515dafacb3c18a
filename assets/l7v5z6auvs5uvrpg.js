const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mbebmpz9wmc7vznv.js","assets/njq6ygky3ttysgdk.js","assets/fs6h2trisr1juto6.js","assets/root-cl538jor.css","assets/d7a6rc8fexfzu7dt.js","assets/conversation-small-m9kq0y4e.css","assets/e8xv89i2w2jwxlj7.js","assets/64hudxlbh9qkzkbr.js","assets/fzrn137102spawew.js","assets/e9lafxuzyeh4418f.js","assets/ktvbjknz372ja7i7.js","assets/loh8e64j4csffv26.js","assets/ora9zmv2zdoi2bvo.js","assets/btjgsqbipn1ns9gv.js","assets/bfysuc3e9dcrn5qg.js","assets/hi6ookkndgtqt4im.js","assets/l4ce2zdnnawhaijx.js","assets/npeck75bz46c490i.js","assets/gfo75oujoeaedm5y.js","assets/cw7s5l0nt7rrqvcw.js","assets/c1p22j8o7hm9vv5x.js","assets/o77dlyy0lhhjntje.js","assets/dlgpg6875dx673ge.js","assets/o3m65hw8d23edpzw.js","assets/gy64pge8qevmvg7e.js","assets/lj0prj6na7gf1jpf.js","assets/csg4i0wk6hi0jvkd.js","assets/hiayljqmnpspmyun.js","assets/au5ozv27zrqgic7w.js","assets/n9whwsbg0rx5cs8k.js","assets/kpohf9e68vj4dpvk.js","assets/m97sb2fnwj0a6vyo.js","assets/gunpso70jnmarvod.js","assets/cm0hdcditutj2jz2.js","assets/jcoe6v231ph25bfi.js","assets/ijutvl794yycgs5p.js","assets/mz766tu1yyo45fp0.js","assets/nikuofry28tl503c.js","assets/bk8slwxjkdlmxjxm.js","assets/ms40jzicf31mvoix.js","assets/ngj3h1w6uuxrb6ri.js","assets/no4qfibpbbv193yj.js","assets/btagl6w1gub4aw61.js","assets/oup4desc8vdmka1t.js","assets/gyif1j2ovuhfzvqr.js","assets/mzkxlhrlmxhntkvn.js","assets/bkmz6jrk6gvxlvc5.js","assets/n0uw1tdsn3tnvms3.js","assets/koxewv8brsagv80m.js","assets/eq34zwf9q18c17ro.js","assets/hg126uudzxua38kv.js","assets/en8ogvlmn3lccz09.js","assets/bhsw6t55h66bayr8.js","assets/m89x2zftpo6hrypr.js","assets/wqepkoieaii7q4ep.js","assets/cffgjlidl1olpt2q.js","assets/i6ze5suolzahci5v.js","assets/jyg6m0czwgwjnl3i.js","assets/kukctmibghbbqwq7.js","assets/gvhvfcdqhc5unmaw.js","assets/fu6bathgya5b9rdr.js","assets/edu70w7ha0obetrt.js","assets/bsxrqnfqv5abpjom.js","assets/f426ftnka0mj72hs.js","assets/nfsyatvjas08jshp.js","assets/o634nz6bc7e8bevz.js","assets/ohq33fk3dbalo2mk.js"])))=>i.map(i=>d[i]);
import{dA as Be,gA as ae,F as ne,E as de,Z as De,ch as We,D as ze,eg as Ys,$ as Ks,am as te,c6 as Zs,bQ as Me,bR as we,c1 as He,aU as Xs,aT as $e,du as Js,gC as et,y as st,M as tt,aV as it,aW as at,V as ie,dv as W,aM as Ve,al as Pe,bw as qe,c5 as pe,ei as fs,el as nt,c4 as rt,bH as Qe,d as re,gD as ot,aA as lt,dC as ps,c3 as V,cD as Ye,cw as hs,ci as Ce,P as xs,a as vs,aq as Ke,bG as he,c7 as ct,bT as js,b as dt,e8 as ys,fk as ut,dx as xe,l as mt,g5 as bs,eQ as gt,aD as ft,gv as pt,aB as ht,aZ as xt,g as ts,L as is,gl as vt,w as jt,G as yt,f9 as bt,fa as Mt,ff as wt,fY as Pt,fX as Tt}from"./njq6ygky3ttysgdk.js";import{R as Ms,r as c,j as e,e as H,b as ws,M as u,d as oe,f as ue,ae as St,a7 as kt,a5 as Ps,z as _t,k as Ct}from"./fs6h2trisr1juto6.js";import{bB as It,ln as Nt,kc as Ts,kf as Ss,H as ks,lo as _s,U as ce,d0 as O,b as Cs,cI as ye,cJ as Is,dA as Ze,dm as At,d9 as Gt,cB as Rt,d7 as Ee,af as G,da as Te,db as ee,dr as ve,dk as je,dd as Xe,bt as Ns,lp as Lt,bx as As,by as zt,lq as Et,hk as se,dc as Ut,lr as Ue,dE as Ft,kw as Ot,di as Bt,dw as Dt,dv as Wt,dI as Ht,cY as Gs,c5 as $t,cZ as Rs,c_ as Ls,d2 as Vt,ls as qt,d1 as Qt,dD as Yt,d4 as Kt,c4 as Fe,d5 as Zt,k6 as Xt,lt as as,ka as Ie,kb as Jt,gR as ns,lu as ei,cM as zs,lv as si,lw as ti,k8 as ii,lx as ai,cN as ni,gs as ri,ly as rs,bi as oi,T as li,fq as ci,lz as di,dB as ui,lA as mi,bk as gi,dy as fi,jz as os,o as pi,lB as hi,lC as xi,d as vi,lD as ji,lE as ls,lF as cs,lG as yi,eM as bi,hm as ds,F as Mi}from"./d7a6rc8fexfzu7dt.js";import{M as Es,A as le,G as wi,a as Pi,b as us,s as Ti,S as Si,c as ki,g as _i,d as Ci}from"./koxewv8brsagv80m.js";import{f as Ii}from"./m89x2zftpo6hrypr.js";import{u as Ni}from"./wqepkoieaii7q4ep.js";import{M as Us}from"./cffgjlidl1olpt2q.js";import{u as Fs}from"./lj0prj6na7gf1jpf.js";import{i as Oe}from"./edu70w7ha0obetrt.js";import{S as Ai}from"./nikuofry28tl503c.js";import{S as Os}from"./ms40jzicf31mvoix.js";import{S as Gi}from"./e8xv89i2w2jwxlj7.js";import{G as Bs}from"./en8ogvlmn3lccz09.js";import{G as Ri}from"./bsxrqnfqv5abpjom.js";import{i as Li}from"./hg126uudzxua38kv.js";import{S as zi}from"./f426ftnka0mj72hs.js";import{h as Ei}from"./kukctmibghbbqwq7.js";import{F as K,a as Z,b as Ne,c as Ui,G as Fi}from"./bkmz6jrk6gvxlvc5.js";import{G as Oi}from"./nfsyatvjas08jshp.js";import{S as Bi}from"./o634nz6bc7e8bevz.js";import{G as Di}from"./i6ze5suolzahci5v.js";function Wi(s,t){const i=de(s),a=ne.getTree(i),n=[];let r=ne.getCurrentNode(i);for(;r!=null&&(t==null||r.id!==t);)n.unshift(r.message),r=r.parentId!==""?a.getNodeByIdOrMessageId(r.parentId):void 0;return n}function Hi(s){return s.filter(a=>a.recipient==="gizmo_editor.update_behavior").flatMap(a=>a.content.content_type==="text"?a.content.parts:a.content.content_type==="code"?[a.content.text]:[]).map(a=>JSON.parse(a)).reduce((a,n)=>({...a,...n}),{})}async function $i(s){let t;for(const i of s)if(i.author.name==="gizmo_editor.generate_profile_pic"){const a=Zs.getImageAssetPointers(i);a.length>0&&(t=a.at(-1))}if(t!=null){const i=It(t.asset_pointer),a=await De.getFileDownloadLink(i);if(a.status===We.Success)return{id:i,permalink:a.download_url}}}async function Vi(s,t,i,a){const n=Wi(t,a),r=Hi(n);let d=await $i(n);if(Oe(r)&&d==null)return;const{name:l,context:m,description:o,profile_pic_file_id:x,prompt_starters:M}=r;if(x!=null)try{const h=await De.getFileDownloadLink(x,s.id);h.status===We.Success&&(d={id:x,permalink:h.download_url})}catch(h){ze.addError(new Error("Error while retrieving profile pic in update",{cause:h})),i.warning("Something went wrong updating your GPT's profile picture.",{duration:3})}const f={name:typeof l=="string"?l:void 0,description:typeof o=="string"?o:void 0,instructions:typeof m=="string"?m:void 0,promptStarters:Array.isArray(M)?M:void 0,profilePictureId:d?.id,profilePictureUrl:d?.permalink};return Ys(f,h=>h!=null)}function qi(s){const t=new Set;for(const m of s.tools)t.add(m.type);const i=s.name??"",a=s.description??"",n=s.instructions??"",r=Array.from(t).join(","),d=i===""&&a===""&&n==="",l=s.profilePictureUrl!=null;return d?`The GPT you are about to has the following abilities: ${r}.`:`This is the GPT's current set of fields:

name: ${i}

description: ${a}

context: ${n}

abilities: ${r}

${l?"The GPT has a profile picture.":"This GPT does not have a profile picture. You must generate a profile picture when you next update your behavior."}
`}const Qi=10;function Ds(s,t){const i=s.current,a=t.current;if(Be(i,a))return;const n={};i.name!==a?.name&&(n.name=i.name),(i.description??"")!==(a?.description??"")&&(n.description=i.description??""),i.instructions!==(a?.instructions??"")&&(n.context=i.instructions??"");const r=new Set(a?.files?.map(x=>x.file_id)??[]),d=new Set(i.files?.map(x=>x.file_id)??[]),l=(i.files??[]).filter(x=>!r.has(x.file_id)),m=(a?.files??[]).filter(x=>!d.has(x.file_id));if(Oe(n)&&l.length===0&&m.length===0)return;const o=[];if(!Oe(n)){const x=`Explicitly update the GPT's behavior to the following exact fields:

    ${JSON.stringify(n,null,2)}

    "Do not call update_behavior yet. Instead, use these updated fields as the GPT's current behavior, and in the next call to update_behavior, incorporate these changes."
    `;o.push(ae(x))}if(m.length>0&&o.push(ae(`The user has removed the following files from the GPT. You can no longer reference these files: ${m.map(x=>x.file_id).join(", ")}`)),l.length>0){const x=l.slice(0,Qi);o.push(ae(`The user is adding these files to the GPT. The GPT may reference these files. The file IDs are: ${x.map(M=>M.file_id).join(", ")}`,{attachments:x.map(M=>({id:M.file_id,name:M.name,size:M.size}))}))}return o}function Yi(s){if(s.length===0)return;const t=`The user is uploading files in their next message. If you need to reference these in calls to update_behavior, you will use the following File ID(s), in order: ${s.map(i=>`"${i.fileId}"`).join(", ")}`;return[ae(t)]}function Ki(s){const t="Remember, you should be calling either update_behavior or generate_profile_pic after most messages from the user. Your personality should be neutral and separate from the GPT you are creating.";if(!ne.findNode(de(s),a=>a.message.content.content_type==="text"&&a.message.content.parts[0]===t))return[ae(t)]}function Zi(s,t){Ks.initThread(s,{kind:te.GizmoMagicCreate,gizmo_id:void 0,behavior_overrides:t});const i=Fs(s);return async(n,r,d,l)=>{i({sourceEvent:n,promptMessage:ae(l),prependMessages:Ds(r,d),completionMetadata:{conversationMode:{kind:te.GizmoMagicCreate,gizmo_id:r.current.id,behavior_overrides:t}}})}}const Xi="Generate a new profile picture for this GPT using gizmo_editor generate_profile_pic. Do not prompt the user for any clarification. Do not send extra text outside of the tool function call. DO NOT CALL update_behavior or otherwise update GPT behavior in your response.",Ji=Me(()=>we(()=>import("./mbebmpz9wmc7vznv.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13])).then(s=>s.DebugConversationSidebar));function ea(s,t){c.useEffect(()=>{ne.findNode(de(s),a=>et(a.message)||a.message.author.role===st.System&&a.message.content.content_type===tt.Text)||$e(s,a=>{it.updateTree(a,(n,r)=>{const d=n.findNode(l=>l.message.clientMetadata?.isPlaceholderTemplateAssistantWelcomeMessage===!0,r);return d&&(d.id===r&&(r=n.rootId),n.deleteNode(d.id)),t?n.addMessageNode(r,at(t,void 0,{isPlaceholderTemplateAssistantWelcomeMessage:!0})):r})})},[s,t])}function sa(s,t,i){Cs(s,{kind:te.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:i}),c.useEffect(()=>{$e(s,n=>{n.mode={kind:te.GizmoMagicCreate,gizmo_id:t.id,behavior_overrides:Js(i)}})},[s,t.id,i]);const[a]=c.useState(()=>{const n=t.id==null,r=t.id!=null&&t.name!==""&&t.description!=null&&t.instructions!==""&&t.profilePictureUrl!=null;return n?`Hi! I'll help you build a new GPT. You can say something like, "make a creative who helps generate visuals for new products" or "make a software engineer who helps format my code."

What would you like to make?`:r?`Welcome back! Is there anything ${t.name} should be doing better? Anything you'd like to change?`:"You're back! Let's continue where we left off..."});ea(s,a)}function ta({gizmoEditorData:s,updateGizmo:t,clientThreadId:i,gizmoEditorDataRef:a,magicMakerBehaviorOverrides:n,magicMakerConversationGizmoEditorDataRef:r,requireGizmoId:d}){const l=c.useRef(d);l.current=d;const m=c.useMemo(()=>({gizmoEditorData:s,gizmoId:s.id,mode:"magic",behaviorOverrides:n,getGizmoId:l.current}),[s,n]),o=Nt(f=>f.files.filter(h=>h.status===O.Ready&&h.gizmoId!=null)),x=c.useCallback(f=>{if(t(h=>({...h,files:[...h.files??[],...He(o.map(g=>g.fileId!=null&&{file_id:g.fileId,name:g.file.name,size:g.file.size,type:Ts(g.file),last_modified:g.file.lastModified,file_size_tokens:g.fileSpec?.fileTokenSize}))]})),r.current=Ss(a.current),!f.completionType||f.completionType===Xs.Next){const h=ne.getCurrentNode(de(i)),g=h.message.clientMetadata?.isPlaceholderTemplateAssistantWelcomeMessage?h.message:void 0;g&&(f.existingMessages=[g]),f.prependMessages=[...Yi(o)??[],...Ds(a,r)??[],...Ki(i)??[],...f.prependMessages??[]]}return f},[i,o,a,r,t]),M=ks(f=>f.activeSidebar);return e.jsx(_s.Provider,{value:m,children:e.jsxs("div",{className:"relative flex h-full grow overflow-auto",children:[e.jsx("div",{className:"grow",children:e.jsx(Us,{clientThreadId:i,getGizmosCompletionParams:x,hideHeader:!0,hideAppLaunchers:!0})}),M==="debug"&&e.jsx(Ji,{clientThreadId:i,slideOver:!1,onClose:()=>ce.toggleActiveSidebar("debug"),isOpen:!0})]})})}const ia=Ms.memo(ta);function aa({gizmo:s,updateGizmo:t,publishedGizmo:i,promoteGizmo:a,appealGizmo:n,setAppealState:r,showActionsModal:d,shareOnly:l,onClose:m}){const[o,x]=c.useState({type:"privacy"});return o.type==="privacy"?e.jsx(ra,{gizmo:s,updateGizmo:t,publishedGizmo:i,promoteGizmo:a,appealGizmo:n,setAppealState:r,setStep:x,showActionsModal:d,shareOnly:l,onClose:m}):e.jsx(oa,{publishedGizmo:o.publishedGizmo,onClose:m})}function na(s){return s?G.Workspace:G.Link}function ra({gizmo:s,publishedGizmo:t,updateGizmo:i,promoteGizmo:a,appealGizmo:n,setAppealState:r,setStep:d,showActionsModal:l,shareOnly:m,onClose:o}){const[x,M]=c.useState(!1),f=ye(Is.isBusinessWorkspace),h=H(),g=ie(),[w,S]=c.useState(Ze(s)?na(!!f):s.sharingRecipient),_=ws(),k=Li(w,s.sharingTargets),{data:b,isLoading:R}=At(),j=Gt(),[p,T]=c.useState(t!=null&&t.gizmo.display.categories.length>0?j.data?.categories.find(y=>y.id===t.gizmo.display.categories[0])?.id:void 0);c.useEffect(()=>{T(t?.gizmo.display.categories[0])},[t?.gizmo.display.categories]);const[C,E]=c.useState(void 0),A=c.useRef(Rt((y,I)=>Ee.generateCategory(y,I),1e3)),U=b?.is_verified?void 0:h.formatMessage({id:"qUMu4e",defaultMessage:"To publish your GPTs to the Explore GPTs page, set up your builder profile in the user settings page."});w===G.Marketplace&&U!=null&&!R&&S(G.Link);const B=f&&!s.sharingTargets?.some(y=>y.recipient===G.Link),L=Te(s,w,p),F=L.includes(ee.MissingPublicActionPrivacyPolicyURL),Q=s.tools.find(y=>y.type===W.JIT_PLUGIN&&!y.metadata.privacy_policy_url),$=ye(y=>y.currentWorkspace),Y=Ve();c.useEffect(()=>{let y=!0;return(async()=>{try{if(p!=null)return;const I=await A.current(s.name,s.instructions);y&&p==null&&(I?T(I.id):E(!0))}catch{y&&p==null&&E(!0)}})(),()=>{y=!1}},[s.instructions,s.name,Y,p]);const{value:me}=Pe("4226692983");return e.jsx(qe,{type:"success",isOpen:!0,onClose:o,title:e.jsx(u,{id:"9viumf",defaultMessage:"Share GPT"}),showCloseButton:!0,primaryButton:k?e.jsx(pe,{color:"primary",disabled:L.length>0,loading:x,onClick:async()=>{try{if(M(!0),m){if(!t?.gizmo.id){g.danger(h.formatMessage({id:"QYVEx8",defaultMessage:"Error sharing GPT"}));return}const y=await Ee.shareGizmo(t.gizmo.id,p?{sharing:ve(w,[],je),categories:[p]}:{sharing:ve(w,[],je)});y.error?(g.warning(h.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})),i({sharingTargets:y.sharing_targets}),r({gizmoId:t.gizmo.id,sharingRecipient:w,categories:t.gizmo.display.categories,moderationType:Es.PublishBlocked,sharingTargets:y.sharing_targets,showModal:le.AppealAvailable})):(_.setQueryData(["gizmo",{gizmoId:t.gizmo.id},{draft:!1}],I=>y.resource),i(I=>({...I,sharingRecipient:w})),g.success(h.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),o())}else{const y=await a({recipient:w,subjects:ve(w,[],je)},p);y?(d({type:"published",publishedGizmo:y}),i(I=>({...I,id:y.gizmo.id,sharingRecipient:w})),y.gizmo.live_version!=null&&i({liveVersion:y.gizmo.live_version}),g.success(h.formatMessage({id:"R5zko1",defaultMessage:"GPT published"}),{testId:"gpt-published-toast"})):(g.warning(h.formatMessage({id:"uf7WYw",defaultMessage:"Unable to publish GPT"})),o())}}finally{M(!1)}},"data-testid":"save-gizmo-button",children:e.jsx(u,{id:"SW4DG4",defaultMessage:"Save"})}):me?e.jsx(e.Fragment,{children:e.jsx(pe,{color:"primary",onClick:async()=>{await n(w,p)},children:e.jsx(u,{id:"bBmLUr",defaultMessage:"Appeal"})})}):null,secondaryButton:t?e.jsx(pe,{color:"secondary",onClick:y=>Xe(t,g,y,h.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(u,{id:"wvL15a",defaultMessage:"Copy link"})}):null,children:e.jsxs("div",{className:"mx-[-16px] flex flex-col gap-3 text-sm",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsxs(Ns,{value:w,onValueChange:y=>S(y),children:[s.sharingTargets&&s.sharingTargets.map((y,I)=>e.jsx(Ae,{value:y.recipient,disabled:y.recipient===G.Marketplace&&U!=null,tooltipText:y.recipient===G.Marketplace?U??h.formatMessage({id:"0Rcb4e",defaultMessage:"Your GPT will appear in the Explore GPTs page"}):void 0,shareLevel:y.recipient},I)),B&&e.jsxs(e.Fragment,{children:[e.jsx(Ae,{value:G.Link,disabled:!0,tooltipText:h.formatMessage(ms.workspaceDisabledHint),shareLevel:G.Link,workspaceName:$?.name}),e.jsx(Ae,{value:G.Link,disabled:!0,tooltipText:h.formatMessage(ms.workspaceDisabledHint),shareLevel:G.Marketplace,workspaceName:$?.name})]})]})}),F&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(u,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:y=>e.jsx("button",{onClick:()=>{l(Q?.metadata.action_id)},className:"underline",children:y})}})}),w!==G.Private&&e.jsx(wi,{gizmo:s,category:p,categories:w===G.Marketplace?j.data?.categories??[]:void 0,onCategoryChange:w===G.Marketplace?y=>T(y.id):void 0}),w===G.Marketplace&&(C?e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(u,{id:"tpC3ui",defaultMessage:"There was an error updating the list of categories"})}):null),!k&&me&&e.jsx("div",{className:"flex items-center justify-between text-sm text-token-text-secondary",children:e.jsx(u,{id:"jLCMMV",defaultMessage:"Because this GPT previously may have violated our policies, you will have to submit an appeal to make it available at this level."})})]})})}function oa({publishedGizmo:s,onClose:t}){const i=Lt(s),a=H(),n=ie();return e.jsx(qe,{type:"success",isOpen:!0,onClose:t,title:e.jsx(u,{id:"rCRRmx",defaultMessage:"Settings Saved"}),showCloseButton:!0,primaryButton:e.jsx(pe,{color:"primary",as:"link",to:i,children:e.jsx(u,{id:"lyZz44",defaultMessage:"View GPT"})}),children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex gap-1 rounded bg-token-main-surface-secondary px-2 py-1",children:[e.jsx("div",{className:"line-clamp-1 text-ellipsis break-all",children:i}),e.jsx("button",{onClick:r=>{Xe(s,n,r,a.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"}))},className:"text-token-text-secondary transition hover:text-token-text-primary","data-testid":"copy-saved-gpt-url-button",children:e.jsx(fs,{className:"icon-sm"})})]})})})}const ms=oe({workspaceDisabledHint:{id:"gizmo.workspaceDisabledHint",defaultMessage:"Your workspace administrator has disabled this setting"}});function Ae({shareLevel:s,workspaceName:t,value:i,disabled:a=!1,tooltipText:n}){const r=c.useId();return e.jsx(nt,{disabled:n==null,label:n,side:"top",children:e.jsxs(As,{id:r,value:i,disabled:a,className:"flex h-14 w-full cursor-pointer flex-row items-center justify-between gap-2 rounded-md px-3 py-4 font-semibold hover:bg-token-main-surface-secondary",children:[e.jsx("label",{htmlFor:r,className:"flex cursor-pointer items-center gap-1",children:e.jsx(Pi,{shareLevel:s,workspaceName:t??"",hasInviteSharing:!1})}),e.jsx(zt,{children:e.jsx(rt,{className:"icon-lg mr-1"})})]})})}function be(s){return!!(s&&typeof s=="object"&&"gizmo"in s)}function Ws(s){window.history.length>1?s(-1):s(Et())}function la({gizmo:s,publishedGizmo:t,isUpsertLoading:i,isPromoteLoading:a,isUploadingProfilePic:n,isGeneratingProfilePic:r,updateGizmo:d,promoteGizmo:l,appealGizmo:m,setAppealState:o,showActionsModal:x}){const M=lt(),f=s!=null?Te(s):[];(s==null||a||i)&&f.push(ee.Loading),n&&f.push(ee.UploadingProfilePic),r&&f.push(ee.GeneratingProfilePic);const h=Ze(s),[g,w]=c.useState(!1),[S,_]=c.useState(!1),k=s.sharingRecipient?us[s.sharingRecipient]:us.private,b=a||i;return e.jsxs(e.Fragment,{children:[h?e.jsx(se,{color:"primary",onClick:()=>w("promote"),loading:i,disabled:b||s.id===void 0||f.length>0,tooltip:f.length>0?f.map(Ue).join(`
`):void 0,"data-testid":"gizmo-editor-create-gpt-button",children:e.jsx(u,{id:"svUGIb",defaultMessage:"Create"})}):e.jsxs(e.Fragment,{children:[e.jsx(se,{color:"secondary",loading:a||!t,disabled:b,icon:k,onClick:()=>w("share"),children:e.jsx(u,{id:"aXKW4G",defaultMessage:"Share"})}),e.jsx(se,{color:"primary",onClick:async()=>{let R=s.sharing.subjects.map(Ti);const j=Ut(s.sharing.subjects);R=ve(s.sharing.recipient,R,j?.capabilities??je);const p=t&&be(t)?t.gizmo.display.categories[0]:void 0;await l({recipient:s.sharing.recipient,subjects:R},p)&&_(!0)},loading:i||!t,disabled:b||f.length>0,tooltip:f.length>0?f.map(Ue).join(`
`):void 0,children:e.jsx(u,{id:"84QVoj",defaultMessage:"Update"})})]}),g&&(M?.getWorkspaceId()==null?e.jsx(aa,{gizmo:s,publishedGizmo:t,promoteGizmo:l,appealGizmo:m,setAppealState:o,showActionsModal:x,updateGizmo:d,shareOnly:g==="share",onClose:()=>w(!1)}):e.jsx(Si,{gizmo:s,publishedGizmo:t,promoteGizmo:l,appealGizmo:m,setAppealState:o,showActionsModal:x,updateGizmo:d,onClose:()=>w(!1),shareOnly:g==="share"})),S&&t&&e.jsx(ki,{publishedGizmo:t,sharing:be(t)?t.gizmo.sharing:void 0,onClose:()=>_(!1),workspaceName:M?.data.name??""})]})}function ca({gizmoEditorData:s,publishedGizmo:t,revertDraft:i}){const a=H(),n=ie(),r=ue(),[d,l]=c.useState(!1),m=Ve(),{value:o}=Pe("3645668434"),x=t&&be(t)?t.gizmo.current_user_permission?.can_delete:!1;return!(t||i||s?.id&&o&&s.liveVersion>0||x||m?.includes("debug"))?null:e.jsxs(e.Fragment,{children:[e.jsxs(ps,{side:"top",contentAlign:"end",sideOffset:8,triggerButton:e.jsx(se,{color:"ghost",icon:Ft}),children:[t!=null&&e.jsxs(V.Item,{onClick:f=>{Xe(t,n,f)},children:[e.jsx(Os,{className:"icon-sm"}),e.jsx(u,{...q.copyLink})]}),i!=null&&e.jsxs(V.Item,{onClick:()=>{window.confirm(a.formatMessage(q.revertConfirm))&&i()},children:[e.jsx(Ot,{className:"icon-sm"}),e.jsx(u,{id:"W2blnV",defaultMessage:"Revert..."})]}),s?.id!=null&&o&&s.liveVersion>0&&e.jsxs(e.Fragment,{children:[e.jsxs(V.Item,{onClick:()=>{r(`/g/${s.id}/view`)},children:[e.jsx(Ai,{className:"icon-sm"}),e.jsx(u,{id:"gizmo.versionHistory",defaultMessage:"Version History"})]}),e.jsxs(V.Item,{onClick:async()=>{const f=await Ee.copyGizmo({gizmoId:s.id});f.gizmo.id&&r(`/gpts/editor/${f.gizmo.id}`)},children:[e.jsx(fs,{className:"icon-sm"}),e.jsx(u,{id:"GizmoInformation.copyGizmoLabel",defaultMessage:"Duplicate GPT"})]})]}),t&&be(t)&&t.gizmo.current_user_permission?.can_delete&&e.jsxs(V.Item,{color:"danger",onClick:()=>{l(!0)},children:[e.jsx(Bt,{className:"icon-sm"}),e.jsx(u,{id:"tNrOLG",defaultMessage:"Delete GPT"})]}),m?.includes("debug")&&e.jsxs(e.Fragment,{children:[e.jsx(V.Separator,{}),e.jsxs(V.Item,{onClick:()=>{ce.toggleActiveSidebar("debug")},children:[e.jsx(Gi,{className:"icon-sm"}),e.jsx(u,{id:"gizmo.debugButton",defaultMessage:"Debug (Internal only)"})]})]})]}),d&&e.jsx(Ri,{gizmoId:s?.id||"",onSuccess:()=>Ws(r),onClose:()=>{l(!1)}})]})}const fe=Qe.div`flex items-center gap-1`;function da({gizmoEditorData:s}){const t=ye(i=>i.currentWorkspace?.name);switch(s.sharingRecipient){case G.Private:return e.jsxs(fe,{children:[e.jsx(Ht,{className:"icon-xs"}),e.jsx(u,{...q.onlyMe})]});case G.Link:return e.jsxs(fe,{children:[e.jsx(Os,{className:"icon-xs"}),e.jsx(u,{...q.anyoneWithLink})]});case G.Workspace:return e.jsxs(fe,{children:[e.jsx(Wt,{className:"icon-xs"}),t]});case G.Marketplace:return e.jsxs(fe,{children:[e.jsx(Dt,{className:"icon-xs"}),e.jsx(u,{...q.public})]});default:return e.jsx("div",{})}}function ua({gizmoEditorData:s}){return e.jsxs("div",{className:"flex items-center gap-2",children:[s.profilePictureUrl!=null?e.jsx(Bs,{isFirstParty:!1,src:s.profilePictureUrl,className:"h-8 w-8"}):e.jsx("div",{className:"h-8 w-8 rounded-full border-2 border-dashed border-token-border-medium"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:s.name||e.jsx(u,{...q.newGPT})}),e.jsx("div",{className:"text-xs text-token-text-secondary",children:Ze(s)?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-token-text-tertiary"}),e.jsx(u,{...q.draft})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-brand-green"}),s.sharingRecipient===G.Marketplace?e.jsx(u,{...q.published}):e.jsx(u,{id:"gizmoEditorHeader.live",defaultMessage:"Live"}),e.jsx(u,{...q.dotSeparator,tagName:"span"}),e.jsx(da,{gizmoEditorData:s})]})})]})]})}const ma=Qe.div`
  cursor-pointer
  border-b
  pb-[1px]
  pt-[2px]
  text-sm
  text-token-text-secondary
  hover:border-token-border-xheavy
  hover:text-token-text-primary
  mx-2
`;function ga({gizmoEditorData:s,isUpsertLoading:t,isPromoteLoading:i,isUploadingProfilePic:a,isGeneratingProfilePic:n,publishedGizmo:r,updateGizmo:d,promoteGizmo:l,appealGizmo:m,setAppealState:o,revertDraft:x,draftMessage:M,className:f,hasUnpublishedChanges:h,showActionsModal:g}){const w=ue();return e.jsxs("div",{className:re("relative flex h-14 w-full items-center justify-between gap-2 border-b border-token-border-medium px-3",f),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("a",{className:"cursor-pointer text-token-text-primary",onClick:()=>Ws(w),children:e.jsx(ot,{className:"icon-lg"})}),e.jsx(ua,{gizmoEditorData:s})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r&&(r?.gizmo?.live_version??0)>1&&e.jsx(ma,{onClick:()=>w(`/g/${s.id}/view`),children:e.jsx(u,{id:"P0Ri/k",defaultMessage:"Last edited {date}",values:{date:e.jsx(St,{value:r.gizmo.updated_at,day:"numeric",month:"short",year:new Date(r.gizmo.updated_at).getFullYear()===new Date().getFullYear()?void 0:"numeric"})}})}),M,e.jsx(ca,{gizmoEditorData:s,publishedGizmo:r,revertDraft:x}),e.jsx(la,{gizmo:s,publishedGizmo:r,isUpsertLoading:t,isPromoteLoading:i,isUploadingProfilePic:a,isGeneratingProfilePic:n,updateGizmo:d,promoteGizmo:l,appealGizmo:m,setAppealState:o,hasUnpublishedChanges:h,showActionsModal:g})]})]})}const q=oe({onlyMe:{id:"gizmo.onlyMe",defaultMessage:"Only me"},anyoneWithLink:{id:"gizmo.anyoneWithLink",defaultMessage:"Anyone with a link"},public:{id:"gizmo.public",defaultMessage:"Everyone"},newGPT:{id:"gizmo.newGPT",defaultMessage:"New GPT"},draft:{id:"gizmo.draft",defaultMessage:"Draft"},published:{id:"gizmo.published",defaultMessage:"Published"},revertConfirm:{id:"gizmo.revertConfirm",defaultMessage:"Are you sure you want to revert to the last saved version?"},copyLink:{id:"gizmo.copyLink",defaultMessage:"Copy link"},dotSeparator:{id:"gizmo.dotSeparator",defaultMessage:"·"}}),fa=512;function pa(){return e.jsx("div",{className:"relative flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(Ye,{className:"h-1/4 w-1/4"})})}function ha({gizmoEditorData:s,onFileChange:t,generateProfilePic:i,isGeneratingProfilePic:a,setIsGeneratingProfilePic:n}){const r=H(),d=ie(),[l,m]=c.useState(void 0),o=c.useRef(t);c.useEffect(()=>{o.current=t});async function x(h){if(h.length>0){n(!1);const g=await Kt(h[0],fa),w=Fe(g);m({tempId:w,file:g,status:O.Uploading,progress:1,fileId:null,cdnUrl:null}),o.current("uploading"),Zt(w,g,r,d,hs.ProfilePicture,{onFileCreated(S,_,k){m(b=>b!=="initial"&&b?.tempId===S&&b.status===O.Uploading?{...b,progress:10,fileId:_,cdnUrl:k}:b)},onFileUploadProgress(S,_){m(k=>k!=="initial"&&k?.tempId===S&&k.status===O.Uploading?{...k,progress:_}:k)},onFileUploaded(S,_,k){m(b=>b!=="initial"&&b?.tempId===S?(o.current(b),{...b,status:O.Ready,progress:100,fileSpec:{name:b.file.name,id:b.fileId,size:b.file.size,...k??{}}}):b)},onError(S){m(_=>{if(_!=="initial"&&_?.tempId===S){o.current(void 0);return}return _})}})}}const{open:M,getInputProps:f}=Gs({disabled:!1,noClick:!0,onDropAccepted:x,onDropRejected:h=>Ei(h,r,d,$t.ProfilePicture),multiple:!0,maxSize:Rs,...Ls(Vt)});return e.jsxs("div",{className:"flex w-full items-center justify-center gap-4",children:[e.jsxs(ps,{sideOffset:8,triggerButton:e.jsx("button",{className:"h-20 w-20",children:a?e.jsx(pa,{}):l!=null&&l!="initial"&&l.status!=O.Ready?e.jsxs("div",{className:"relative h-full w-full overflow-hidden rounded-full",children:[e.jsx(qt,{file:l.file}),l.status===O.Uploading&&l.progress<90?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/5 text-white",children:e.jsx(Qt,{percentage:l.progress,className:"h-6 w-6"})}):null]}):s?.profilePictureUrl!=null&&s?.profilePictureUrl!==""?e.jsx(Bs,{isFirstParty:!1,src:s.profilePictureUrl}):e.jsx("div",{className:"flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium",children:e.jsx(Yt,{className:"text-4xl"})})}),children:[e.jsx(V.Item,{onClick:M,children:e.jsx(u,{id:"ERQwXg",defaultMessage:"Upload Photo"})}),e.jsx(V.Item,{onClick:i,children:e.jsx(u,{id:"NXAog/",defaultMessage:"Use DALL·E"})})]}),e.jsx("input",{...f()})]})}function xa({gizmoEditorData:s,requireGizmoId:t,currentModelConfig:i,updateGizmo:a}){const n=H(),r=ie(),[d,l]=c.useState(0),m=c.useRef(new Map),o=Xt(i,void 0),x=async p=>{xs.logEvent(vs.uploadFile,{client:"web",eventSource:"mouse",intent:"gizmo"});const T=await t();p.length>0&&await Promise.all(p.map(C=>{const E=Fe(C);m.current.set(E,{tempId:E,gizmoId:T,file:C,status:O.Uploading,progress:1,fileId:null,cdnUrl:null}),Jt(Fe(C),C,n,r,{kind:hs.Gizmo,gizmoId:T},{onFileUploaded:(A,U,B,L)=>{const F=m.current.get(A);F==null||F.fileId==null||(a(Q=>({...Q,files:[...Q.files??[],{file_id:F.fileId,name:F.file.name,size:F.file.size,type:L?.mimeType??Ts(C),last_modified:F.file.lastModified,file_size_tokens:L?.fileTokenSize}]})),m.current.delete(A),l(Q=>Q+1))},onFileCreated:(A,U,B)=>{m.current.set(A,{tempId:A,gizmoId:T,file:C,status:O.Uploading,progress:1,...m.current.get(A),fileId:U,cdnUrl:B}),l(L=>L+1)},onFileUploadProgress:(A,U)=>{const B=m.current.get(A);B?.status===O.Uploading&&m.current.set(A,{...B,progress:U}),l(L=>L+1)},onError:A=>{m.current.delete(A)}},{usesRetrievalIndex:i!=null&&Ie(i,C.type,C.name)===Ce.Retrieval})}))},{getInputProps:M,open:f}=Gs({disabled:!1,noClick:!0,onDropAccepted:x,multiple:!0,maxSize:Rs,maxFiles:10,...Ls(o)}),h=s?.files??[];function g(p){return e.jsx(ns,{onRemoveFileClick:()=>{m.current.delete(p.tempId),l(T=>T+1)},file:p.file,loadingPercentage:p.status===O.Uploading?p.progress:void 0},p.tempId)}function w(p){return e.jsx(ns,{file:p.name,fileId:p.file_id,onRemoveFileClick:()=>a(T=>({...T,files:T?.files?.filter(C=>C.file_id!==p.file_id)})),gizmoId:s?.id},p.file_id)}const S=Array.from(m.current.values()).filter(p=>h.every(T=>T.file_id!==p.fileId)),[_,k]=as(S,p=>i!=null&&Ie(i,p.file.type,p.file.name)===Ce.CodeInterpreter),[b,R]=as(h,p=>i!=null&&p.type!=null&&Ie(i,p.type,p.name)===Ce.CodeInterpreter),j=c.useRef(b.length);return c.useEffect(()=>{b.length>j.current&&a(p=>p.tools?.some(T=>T.type===W.PYTHON)?p:{...p,tools:[...p.tools??[],{type:W.PYTHON}]}),j.current=b.length},[b.length]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"rounded-lg text-token-text-tertiary",children:e.jsx(u,{...va.knowledgeWarning})}),k.length>0||R.length>0?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[k.map(g),R.map(w)]}):null,_.length>0||b.length>0?e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xs text-token-text-tertiary",children:e.jsx(u,{id:"i/QurZ",defaultMessage:"The following files are only available for Code Interpreter:"})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[_.map(g),b.map(w)]})]}):null,e.jsx("div",{children:e.jsxs(se,{onClick:f,children:[e.jsx("input",{...M()}),e.jsx(u,{id:"sr8Qp/",defaultMessage:"Upload files"})]})})]})}const va=oe({knowledgeWarning:{id:"gizmo.knowledgeWarning",defaultMessage:"If you upload files under Knowledge, conversations with your GPT may include file contents. Files can be downloaded when Code Interpreter is enabled"}});function ja({placeholder:s,text:t,onChange:i,onClose:a}){return e.jsx(qe,{className:"!max-h-[100vh] !max-w-[80vw]",type:"success",isOpen:!0,onClose:a,primaryButton:e.jsx(se,{onClick:a,children:e.jsx(u,{id:"FeFVdS",defaultMessage:"Close"})}),children:e.jsx("textarea",{className:"h-[70vh] w-full resize-none rounded-lg bg-token-main-surface-primary dark:border-gray-700",value:t,onChange:n=>{i(n.target.value)},placeholder:s})})}const Ge=Qe.div`text-sm text-red-500`;function ya({children:s,collapsed:t,initial:i}){return e.jsx(kt,{initial:i,children:!t&&e.jsx(Ps.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:s})})}function ba({gizmo:s,onShowActionsEditor:t,isDisabled:i}){const a=H(),n=ie(),r=e.jsxs("div",{className:"space-y-1",children:[s?.tools?.map((d,l)=>d.type!==W.JIT_PLUGIN?null:e.jsxs("div",{children:[e.jsx(Fi,{isDisabled:i,actionTool:d,onShowActionsEditor:()=>t(d.metadata.domain)}),d.metadata.auth?.type==="oauth"&&e.jsx(ri,{label:a.formatMessage(z.callbackUrlLabel),value:`https://chat.openai.com/aip/${d.metadata.action_id}/oauth/callback`,onCopied:()=>{n.success("Copied to clipboard",{duration:3})}})]},l)),(s?.tools?.filter(d=>d.type===W.JIT_PLUGIN)??[]).length>=rs?e.jsx("div",{children:a.formatMessage(z.maxActionsReached,{number:rs})}):e.jsx(se,{disabled:i,onClick:()=>{t("Unknown domain")},className:"mt-2",children:e.jsx(u,{...z.createActionLabel})})]});return i?e.jsx(js,{side:"top",label:a.formatMessage(z.disabledCustomActionsTooltip),children:r}):r}function Ma(s){return(s.files?.length??0)>0||s?.tools?.some(t=>t.type===W.JIT_PLUGIN)}function wa({gizmoEditorData:s,updateGizmo:t,currentModelConfig:i,generateProfilePic:a,setIsUploadingProfilePic:n,isGeneratingProfilePic:r,setIsGeneratingProfilePic:d,requireGizmoId:l,onShowActionsEditor:m}){const o=s?.tools??[],[x,M]=c.useState(!1),[f,h]=c.useState(!0),g=s?.promptStarters??[],w=[...g,...g.length<ei?[""]:[]],S=Te(s),k=Ke()?.isWorkspaceAccount(),b=zs(he.WorkspaceGPTCustomActions),R=H();return e.jsxs("div",{className:"flex h-full grow flex-col overflow-y-auto px-2 pt-6 text-sm",children:[e.jsxs("div",{className:"grow",children:[e.jsxs(K,{children:[e.jsx(ha,{gizmoEditorData:s,generateProfilePic:a,isGeneratingProfilePic:r,setIsGeneratingProfilePic:d,onFileChange:async j=>{if(j!=null&&j!=="uploading"&&j.fileId!=null){const p=await De.getFileDownloadLink(j.fileId);p.status===We.Success&&t({profilePictureId:j.fileId!=null?j.fileId:void 0,profilePictureUrl:p.download_url})}else t({profilePictureId:void 0,profilePictureUrl:void 0});n(j==="uploading")}}),e.jsx(Z,{label:e.jsx(u,{id:"M4dZms",defaultMessage:"Name"}),description:e.jsx(u,{id:"+Gkni2",defaultMessage:"The name of your GPT"})}),e.jsx(Ne,{type:"text",placeholder:R.formatMessage(z.gptNamePlaceholder),value:s?.name??"",onChange:j=>{t({name:j.target.value})},onBlurCapture:()=>t(j=>({...j,name:j.name.trim()})),"data-testid":"gizmo-name-input"}),S.includes(ee.GizmoNameTooLong)?e.jsx(Ge,{className:"mt-1",children:e.jsx(u,{...z.nameTooLong,values:{length:si}})}):null]}),e.jsxs(K,{className:"mt-4",children:[e.jsx(Z,{label:e.jsx(u,{id:"YDzNvf",defaultMessage:"Description"}),description:e.jsx(u,{id:"dpxCw8",defaultMessage:"Short description of what this GPT does"})}),e.jsx(Ne,{type:"text",placeholder:R.formatMessage(z.descriptionPlaceholder),value:s?.description??"",onChange:j=>t({description:j.target.value}),onBlurCapture:()=>t(j=>({...j,description:j.description?.trim()??""})),"data-testid":"gizmo-description-input"}),S.includes(ee.GizmoDescriptionTooLong)?e.jsx(Ge,{className:"mt-1",children:e.jsx(u,{...z.descriptionTooLong,values:{length:ti}})}):null]}),e.jsxs(K,{children:[e.jsx(Z,{label:e.jsx(u,{id:"2SO0RJ",defaultMessage:"Instructions"}),description:R.formatMessage(z.instructionsSubtitle)}),e.jsxs("div",{className:"relative",children:[e.jsx(Ui,{className:"resize-none",rows:8,value:s?.instructions,onChange:j=>t({instructions:j.target.value}),onBlurCapture:()=>t(j=>({...j,instructions:j.instructions.trim()})),placeholder:R.formatMessage(z.instructionsSubtitle),"data-testid":"gizmo-instructions-input"}),e.jsx("button",{className:"absolute bottom-3 right-2 text-token-text-tertiary",onClick:()=>M(!0),children:e.jsx(zi,{className:"icon-sm"})})]}),S.includes(ee.GizmoInstructionsTooLong)?e.jsx(Ge,{className:"mt-1",children:e.jsx(u,{...z.instructionsTooLong,values:{length:ii}})}):null]}),e.jsxs(K,{children:[e.jsx(Z,{label:e.jsx(u,{id:"6rfYOX",defaultMessage:"Conversation starters"}),description:e.jsx(u,{id:"OSOIpd",defaultMessage:"Examples for the user to start the conversation"})}),e.jsx("div",{className:"flex flex-col gap-1",children:w.map((j,p)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ne,{className:"rounded-r-none",value:j,type:"text",maxLength:ai,onChange:T=>{const C=T.target.value;t(E=>({...E,promptStarters:He(p>=(g.length??0)?[...g??[],C]:g.map((A,U)=>U===p?C===""?void 0:C:A))}))}}),e.jsx("button",{className:"flex h-9 w-9 items-center justify-center rounded-lg rounded-l-none border border-l-0 border-token-border-medium",onClick:()=>t(T=>({...T,promptStarters:g.filter((C,E)=>E!==p)})),children:e.jsx(ct,{className:"icon-sm"})})]},p))})]}),e.jsxs(K,{children:[e.jsx(Z,{label:e.jsx(u,{id:"bwXSkU",defaultMessage:"Knowledge"}),description:R.formatMessage(z.knowledgeExplanation)}),e.jsx(xa,{gizmoEditorData:s,requireGizmoId:l,currentModelConfig:i,updateGizmo:t})]}),e.jsxs(K,{children:[e.jsx(Z,{label:e.jsx(u,{id:"mcAwDU",defaultMessage:"Capabilities"}),description:e.jsx(u,{id:"2exQT6",defaultMessage:"Functionality this GPT can use"})}),e.jsx(Oi,{enabledTools:o,onEnabledToolsChange:j=>t({tools:j})})]}),e.jsxs(K,{children:[e.jsx(Z,{label:e.jsx(u,{id:"7r7v+u",defaultMessage:"Actions"}),description:e.jsx(u,{id:"fBln7I",defaultMessage:"APIs this GPT can use"})}),e.jsx(ba,{isDisabled:!!(k&&!b),gizmo:s,onShowActionsEditor:m})]}),!k&&Ma(s)&&e.jsxs(K,{children:[e.jsx(Z,{label:e.jsx(u,{id:"R3KeU7",defaultMessage:"Additional Settings"}),collapsed:!!f,onClick:()=>{h(j=>!j)}}),e.jsx(ya,{collapsed:f,initial:!1,children:e.jsx(ni,{className:"mx-3 my-1",labelClassName:"w-full cursor-pointer",label:e.jsx(u,{id:"tZgwFW",defaultMessage:"Use conversation data in your GPT to improve our models"}),id:"improve-chatgpt",checked:!s.trainingDisabled,onChange:()=>{t({trainingDisabled:!s.trainingDisabled})}})})]})]}),x&&e.jsx(ja,{text:s.instructions??"",onChange:j=>{t({instructions:j})},onClose:()=>M(!1),placeholder:R.formatMessage(z.instructionsSubtitle)})]})}const z=oe({nameTooLong:{id:"gizmo.nameTooLong",defaultMessage:"GPT names cannot be longer than {length} characters."},knowledgeExplanation:{id:"gizmo.knowledgeExplanation",defaultMessage:"Additional files for this GPT to reference."},descriptionTooLong:{id:"gizmo.descriptionTooLong",defaultMessage:"GPT descriptions cannot be longer than {length} characters."},instructionsTooLong:{id:"gizmo.instructionsTooLong",defaultMessage:"GPT instructions cannot be longer than {length} characters."},disabledCustomActionsTooltip:{id:"gizmo.disabledCustomActionsTooltip",defaultMessage:"Custom actions are disabled for your workspace. Contact your admin to enable them."},createActionLabel:{id:"gizmo.createActionLabel",defaultMessage:"Create new action"},maxActionsReached:{id:"gizmo.maxActionsReached",defaultMessage:"GPTs can have a maximum of {number} actions"},descriptionPlaceholder:{id:"gizmo.descriptionPlaceholder",defaultMessage:"Add a short description about what this GPT does"},instructionsSubtitle:{id:"gizmo.instructionsSubtitle",defaultMessage:"What does this GPT do? How does it behave? What should it avoid doing?"},gptNamePlaceholder:{id:"gizmo.gptNamePlaceholder",defaultMessage:"Name your GPT"},callbackUrlLabel:{id:"gizmo.callbackUrlLabel",defaultMessage:"Callback URL"}});function Pa(s,t){const i=ys(s);if(!Array.isArray(s.detail))return i;const a=He(s.detail.map(n=>{if(n.type==="value_error.any_str.max_length")switch(n.loc[1]){case"display":{switch(n.loc[2]){case"name":return t.formatMessage(z.nameTooLong,{length:n.ctx.limit_value});case"description":return t.formatMessage(z.descriptionTooLong,{length:n.ctx.limit_value})}break}case"instructions":return t.formatMessage(z.instructionsTooLong,{length:n.ctx.limit_value})}if(typeof n.msg=="string")return n.msg}));return a.length>0?a.join(`
`):i}function Ta({upsertDraftError:s}){const t=H(),i=Pa(s,t);return e.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[e.jsx("div",{children:e.jsx(u,{...Hs.errorSavingDraft})}),i!=null&&e.jsx(js,{label:i,children:e.jsx(oi,{className:"icon-sm"})})]})}function Sa({isPublished:s,isSavingDraft:t,hasUnpublishedChanges:i,upsertDraftError:a,className:n}){return a instanceof dt?e.jsx(Ta,{upsertDraftError:a}):i?e.jsxs("div",{className:re("flex items-center gap-2",n),children:[e.jsx("span",{className:"text-token-text-secondary",children:s?e.jsx(u,{id:"gizmoEditor.draftUnpublished",defaultMessage:"Unpublished changes"}):e.jsx(u,{id:"gizmoEditor.draftPending",defaultMessage:"Updates pending"})}),e.jsx("div",{className:"w-4 text-token-text-tertiary",children:t&&e.jsx(Ye,{})})]}):null}const Hs=oe({errorSavingDraft:{id:"gizmo.errorSavingDraft",defaultMessage:"Error saving draft"}}),ka=Me(()=>we(()=>import("./bfysuc3e9dcrn5qg.js"),__vite__mapDeps([14,2,4,1,3,5,15,16,17,18,19,20,21,22,23,24,12,25,26,27,28,29,30,8,10,31,32,33,34,35,36,37,38,39,40,41,42])).then(s=>s.CanvasFocusedViewManager)),_a=Me(()=>we(()=>import("./mbebmpz9wmc7vznv.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13])).then(s=>s.DebugConversationSidebar));var Ca=(s=>(s.TestGizmoAction="test_gizmo_action",s))(Ca||{});const Ia=new ut;function Na({gizmoEditorData:s,isSavingDraft:t,showTitle:i=!0}){const[a,n]=c.useState(()=>xe());Cs(a,{kind:te.GizmoTest,gizmo_id:s.id}),c.useEffect(()=>{$e(a,g=>{g.mode={kind:te.GizmoTest,gizmo_id:s.id}})},[a,s.id]);const r=s.files?.map(g=>g.file_id).join();c.useEffect(()=>{mt(a)!=null&&n(xe())},[s.id,s.instructions,s.tools,r,a]);const d=ks(g=>g.activeSidebar),l=c.useMemo(()=>({gizmoEditorData:s,mode:"test"}),[s]),[m,o]=c.useState(0),x=()=>{o(g=>g-360)},M=s.id,f=Aa(a);c.useEffect(()=>bs(Ia,{test_gizmo_action:({rootDomain:g,operationName:w})=>{M&&f(M,g,w)}}),[f,M]);const h=c.useCallback(()=>e.jsx("div",{className:"h-full w-full",children:e.jsx(Di,{gizmo:s,hideOwner:!0,showStarterPrompts:!0})}),[s]);return e.jsx(_s.Provider,{value:l,children:e.jsx(li,{clientThreadId:a,children:e.jsxs("div",{className:re("flex h-full w-full",t&&"cursor-wait opacity-80 transition"),children:[e.jsxs("div",{className:"flex grow flex-col",children:[e.jsx("div",{className:"relative mb-2 flex-shrink-0",children:e.jsx("div",{className:"flex justify-center py-1",children:i&&e.jsxs("div",{className:"group flex items-center gap-2 text-lg font-semibold",children:[e.jsx("div",{className:"icon-md"}),e.jsxs("button",{onClick:()=>{x(),n(xe())},className:"flex items-center gap-2",children:[e.jsx(u,{id:"2u/6Ja",defaultMessage:"Preview"}),e.jsx(Ps.div,{className:"text-token-text-primary",animate:{rotate:m},transition:{duration:.3},children:e.jsx(ci,{className:"icon-md invisible group-hover:visible"})})]})]})})}),e.jsxs("div",{className:re("relative grow overflow-auto px-2",t&&"pointer-events-none"),children:[e.jsx(Us,{clientThreadId:a,hideHeader:!0,renderEmptyState:h(),hideAppLaunchers:!0}),e.jsx(Bi.Sidebars,{children:e.jsx(ka,{clientThreadId:a,overrideWidth:0,isAutoFocusDisabled:!0})})]})]}),d==="debug"&&e.jsx(_a,{clientThreadId:a,slideOver:!1,onClose:()=>ce.toggleActiveSidebar("debug"),isOpen:!0})]})})})}const gs=Ms.memo(Na);function Aa(s){const t=Fs(s);return c.useCallback((a,n,r)=>{t({eventSource:"url",promptMessage:gt(`Call the ${n} API with the ${r} operation`,{jit_plugin_data:{from_client:{type:"test",operation:r,tool_name:di(n)}}}),completionMetadata:{conversationMode:{kind:te.GizmoTest,gizmo_id:a}}})},[t])}const Ga=Me(()=>we(()=>import("./oup4desc8vdmka1t.js"),__vite__mapDeps([43,2,1,3,44,4,5,45,46,47,48,39,49,35,26,25,29,50,51,52,53,54,55,56,57,58,32,59,60,18,17,31,33,34,61,37,6,62,63,64,65,66])).then(s=>s.GizmoActionsEditor));var $s=(s=>(s.MAGIC_MAKER="magic",s.ADVANCED="advanced",s.PREVIEW="preview",s))($s||{});function Re({value:s,label:t,testId:i}){return e.jsx(As,{value:s,className:"text-md w-1/3 flex-grow rounded-lg border-token-border-light p-1.5 font-semibold text-token-text-tertiary transition hover:text-token-text-primary radix-state-checked:border radix-state-checked:bg-token-main-surface-primary radix-state-checked:text-token-text-primary radix-state-checked:shadow-[0_0_2px_rgba(0,0,0,.03)] md:w-1/2","data-testid":i,children:t})}function Ra({className:s,editorTab:t,setEditorTab:i}){const a=H(),{value:n}=Pe("1393076427");return e.jsxs(Ns,{className:re("flex w-full overflow-hidden rounded-xl bg-token-main-surface-secondary p-1.5 md:w-1/2",s),value:t,onValueChange:r=>{i(r)},children:[n&&e.jsx(Re,{value:"magic",label:a.formatMessage(Le.magicMakerLabel)}),e.jsx(Re,{value:"advanced",label:a.formatMessage(Le.configureLabel),testId:"gizmo-editor-configure-button"}),e.jsx("div",{className:"flex w-1/3 md:hidden",children:e.jsx(Re,{value:"preview",label:a.formatMessage(Le.previewLabel)})})]})}function La(s,t){return s.length!==t.length?!1:s.every(i=>t.some(a=>a.type===i.type))}function za(s,t){return s.name===t.gizmo.display.name&&s.description===t.gizmo.display.description&&s.instructions===t.gizmo.instructions&&La(s.tools,t.tools)&&Be(s.files?.map(i=>i.file_id)??[],t.files?.map(i=>i.file_id)??[])&&s.profilePictureUrl==t.gizmo.display.profile_picture_url&&s.profilePictureId==t.gizmo.display.profile_pic_id}const Vs=({gizmo:s,onNewGizmoId:t})=>{const i=ws(),a=Ve(),n=zs(he.BrowsingAvailable),r=a?.includes(he.GizmoCanvasToggle)&&a?.includes(he.Canvas),d=H(),l=ie(),m=()=>{const v=[];return n&&v.push({type:W.BROWSER}),r&&v.push({type:W.CANVAS}),{...cs,tools:[...cs.tools,...v]}},o=c.useRef(s!=null?os(s):m()),x=c.useRef(s),M=c.useRef(o.current),[f,h]=c.useState(()=>o.current),[g,w]=c.useState(()=>xe()),[S]=c.useState(()=>({context_message:qi(o.current),model_slug:"unused",enabled_tools:[{tool_id:s!=null?"gizmo_editor":"gizmo_creator"}]}));sa(g,M.current,S);const{data:_}=ft(),k=_?.models.get(pt)??(_&&Ii(_.models.values(),v=>v.tags.includes(ht.GPT_4o))),{data:b}=pi(o.current.id),R=hi(),{isPending:j,error:p}=R,T=xi(),C=c.useMemo(()=>b!=null&&!za(f,b),[f,b]),E=async()=>{const v=o.current;try{const P=await R.mutateAsync({editorData:v,gizmoId:v.id});if(x.current=P,o.current.id==null){const N=P.gizmo.id;o.current={...o.current,id:N,sharingTargets:P.gizmo.sharing_targets},h(o.current),t?.(N)}for(const N of P.tools.filter(D=>D.type===W.JIT_PLUGIN)){const D=o.current.tools.find(X=>X.type===W.JIT_PLUGIN&&X.metadata.domain===N.metadata.domain);D&&D.metadata.action_id!==N.metadata.action_id&&(D.metadata={...D.metadata,action_id:N.metadata.action_id},h(o.current))}return P}catch(P){const N=ys(P)??d.formatMessage(Hs.errorSavingDraft);throw l.warning(N,{duration:2}),P}},A=c.useRef(void 0),U=async()=>o.current.id!=null?o.current.id:(A.current==null&&(A.current=E().then(v=>v.gizmo.id).catch(v=>{throw A.current=void 0,v})),A.current),[B]=c.useState(()=>vi(()=>E(),2e3,{trailing:!0})),L=c.useCallback((v,P=!0)=>{const N=typeof v=="function"?v(o.current):ji(o.current,v);Be(N,o.current)||(o.current=N,h(o.current),P&&B())},[B]),F=c.useRef(void 0);c.useEffect(()=>bs(xt,{completionFinished:async v=>{const P=v.serverThreadId;if(P==null){ge(!1);return}try{const N=await Vi(o.current,P,l,F.current);N!=null&&(L(N),M.current=Ss(o.current))}catch(N){ze.addError(N),l.warning("Something went wrong generating your GPT",{duration:3})}finally{F.current=ne.getCurrentNode(de(P)).message.id,ge(!1)}}}),[l,L]);const Q=Zi(g,S),[$,Y]=c.useState(void 0);c.useEffect(()=>{Y(_i(s))},[s?.gizmo.id]);const me=async(v,P)=>{const N=Te(o.current,v.recipient,P);if(N.length>0){l.warning(`Could not save GPT:

${N.map(J=>`- ${Ue(J)}`).join(`
`)}`,{duration:3});return}const D=await E(),X=D.gizmo.id;try{return xs.logEvent(vs.promoteGizmo,{gizmo_id:D.gizmo.id,sharing_recipient:v.recipient,editor_tab:I}),await T.mutateAsync({gizmoId:D.gizmo.id,data:{sharingSubjects:v.subjects,sharingRecipient:v.recipient,categories:P==null?void 0:[P]}},{onSuccess(_e){i.setQueryData(ls(i,X).queryKey,_e),i.invalidateQueries({queryKey:["gizmos"]}),i.invalidateQueries({queryKey:["gizmo",{gizmoId:X}]}),i.invalidateQueries({queryKey:["gizmo","userActionSettings",{gizmoId:X}]})}})}catch(J){if(J instanceof yi)Y({gizmoId:X,sharingRecipient:v.recipient,moderationType:Es.PublishBlocked,sharingTargets:J.response?.sharing_targets,showModal:le.AppealAvailable});else{ze.addError(J);const _e=J.detail??"An unknown error occurred";l.warning("Error saving GPT - "+_e,{duration:6})}}},{value:y}=Pe("1393076427"),[I,Je]=c.useState(()=>{if(!y)return"advanced";const v=ts.getItem(is.GizmoEditorTab);return Object.values($s).includes(v)?v:"magic"}),Se=vt.useState(({windowWidth:v})=>v);c.useEffect(()=>{Se!=null&&Se>=768&&I==="preview"&&Je("magic")},[Se,I]);const[qs,Qs]=c.useState(!1),[es,ge]=c.useState(!1),[ss,ke]=c.useState(void 0);return e.jsxs("div",{className:"flex h-screen w-full flex-col items-center",children:[e.jsx(ga,{gizmoEditorData:f,isUpsertLoading:R.isPending,isPromoteLoading:T.isPending,hasUnpublishedChanges:C,isUploadingProfilePic:qs,isGeneratingProfilePic:es,publishedGizmo:b,updateGizmo:L,promoteGizmo:async(v,P)=>{const N=await me(v,P);return o.current={...o.current,sharingRecipient:v.recipient},h(o.current),ts.setItem(is.GizmoEditorTab,I),N},appealGizmo:async(v,P)=>{$!=null&&Y({...$,sharingRecipient:v,categories:P==null?void 0:[P],showModal:le.AppealAvailable})},setAppealState:Y,revertDraft:b!=null&&C?()=>{const v=i.getQueryData(ls(i,o.current.id).queryKey);if(v!=null){const P=os(v);o.current=P,h(P),E()}}:void 0,draftMessage:e.jsx(Sa,{isPublished:b!=null&&(b.gizmo.share_recipient==="marketplace"||b.gizmo.share_recipient==="workspace"),hasUnpublishedChanges:C,isSavingDraft:j,upsertDraftError:p,className:"text-sm"}),showActionsModal:v=>{ke(v)},className:"flex-shrink-0"}),$&&e.jsx(Ci,{appealState:$,onAppealClose:()=>Y({...$,showModal:le.None}),onAppealSubmitted:()=>Y({...$,showModal:le.AppealSent})}),e.jsxs("div",{className:"relative flex w-full grow overflow-hidden",children:[e.jsx("div",{className:"flex w-full justify-center md:w-1/2",children:e.jsx("div",{className:"h-full grow overflow-hidden",children:ss!==void 0?e.jsx(Ga,{currentlyEditingActionDomain:ss,gizmoEditorData:f,updateGizmo:L,onClose:()=>{ke(void 0)}}):e.jsxs("div",{className:"flex h-full flex-col px-2 pt-2",children:[e.jsx("div",{className:"flex w-full flex-row justify-center",children:e.jsx(Ra,{editorTab:I,setEditorTab:Je,className:"mb-2 flex-shrink-0 self-center"})}),e.jsx("div",{className:"grow overflow-hidden",children:I==="magic"?e.jsx("div",{className:"h-full w-full",children:e.jsx(ia,{gizmoEditorData:f,updateGizmo:L,clientThreadId:g,gizmoEditorDataRef:o,magicMakerBehaviorOverrides:S,magicMakerConversationGizmoEditorDataRef:M,requireGizmoId:U},g)}):I==="advanced"?e.jsx(wa,{gizmoEditorData:f,updateGizmo:L,currentModelConfig:k,generateProfilePic:v=>{ge(!0),Q(v,o,M,Xi)},setIsUploadingProfilePic:Qs,isGeneratingProfilePic:es,setIsGeneratingProfilePic:ge,requireGizmoId:U,onShowActionsEditor:v=>{ke(v)}}):e.jsx(gs,{gizmoEditorData:f,isSavingDraft:j,showTitle:!1})})]})})}),e.jsx("div",{className:re("hidden w-1/2 justify-center border-l border-token-border-medium bg-token-main-surface-secondary pt-4",I!=="preview"&&"md:flex"),children:e.jsx("div",{className:"flex-grow",children:e.jsx(gs,{gizmoEditorData:f,isSavingDraft:j})})})]})]})};function Ea({gizmoId:s,version:t}){const{data:i}=mi({gizmoId:s,draft:!0,version:t}),a=ye(Is.accountUserId),r=gi()?.id,d=i!=null&&a!=null&&r!=null&&fi(i);return i==null||!d?null:e.jsx(Vs,{gizmo:i})}function Ua({onNewGizmoId:s}){return e.jsx(Vs,{onNewGizmoId:s})}const Fa=({gizmoId:s,remixSourceId:t,version:i})=>{const a=ue(),n=Ke(),r=c.useRef(void 0);c.useEffect(()=>(ce.enterGizmoEditor(),()=>{ce.exitGizmoEditor()}),[]);let d=s;return s!=null&&r.current===s&&(d=void 0),Ni({resetThreadAction:()=>{a("/")}}),n?d!==void 0?e.jsx(Ea,{gizmoId:d,version:i},d):e.jsx(Ua,{remixSourceId:t,onNewGizmoId:l=>{r.current=l,window.history.replaceState(window.history.state,"",ui(l))}}):e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx(Ye,{})})},Le=oe({magicMakerLabel:{id:"gizmo.magicMakerLabel",defaultMessage:"Create"},configureLabel:{id:"gizmo.advancedLabel",defaultMessage:"Configure"},previewLabel:{id:"gizmo.previewLabel",defaultMessage:"Preview"}});function Oa(s){const t=ue();c.useEffect(()=>{s||t(jt(yt.NO_ACCESS))},[s,t])}const cn=()=>(Mt(),null),dn=bt(function(){const t=Ke(),i=!!t?.hasPlusFeatures();Oa(t==null||i);const a=_t(),[n]=Ct(),r=ue(),d=a.slug,l=n.get("version"),m=d?wt(d):void 0,o=n.get("remixFrom");return c.useEffect(()=>{Pt(!0).then(x=>{bi.initializeAndGatherData(x),Tt.initializeAndGatherData(x)})},[]),c.useEffect(()=>{t!=null&&!i&&r("/")},[t,r,i]),c.useEffect(()=>{m&&ds(m)&&r(`/g/${d}/project`)},[m,r,d]),!i||m&&ds(m)?null:e.jsx(Mi,{children:e.jsx(Fa,{gizmoId:m,remixSourceId:o??void 0,version:l!=null?Number(l):void 0})})});export{Ia as G,Ca as a,cn as c,dn as g};
//# sourceMappingURL=l7v5z6auvs5uvrpg.js.map
