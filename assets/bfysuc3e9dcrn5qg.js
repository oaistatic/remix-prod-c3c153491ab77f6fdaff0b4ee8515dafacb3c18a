import{r as l,ah as G,k as B,e as q,j as i,a5 as g,a7 as Y}from"./fs6h2trisr1juto6.js";import{iQ as K,iR as X,iS as $,C as v,iT as Q,iU as Z,iV as J,iW as ee,iX as te,iY as se,iZ as ae,gI as oe,i_ as ie,i$ as ne,j0 as re,j1 as _,j2 as O,gG as ce,H as de,j3 as le,j4 as ue,gm as me,j5 as pe,u as he,j6 as N,U as W,j7 as M}from"./d7a6rc8fexfzu7dt.js";import{gl as y,g as F,a3 as fe,F as b,a4 as ge,B as xe,ef as ve,bM as Ce,fI as be,d as Te,gi as we}from"./njq6ygky3ttysgdk.js";import{L as Se,u as Ie}from"./hi6ookkndgtqt4im.js";import{u as ye}from"./o77dlyy0lhhjntje.js";import{T as Ee}from"./dlgpg6875dx673ge.js";import{g as Ae}from"./btagl6w1gub4aw61.js";import"./l4ce2zdnnawhaijx.js";import"./npeck75bz46c490i.js";import"./gfo75oujoeaedm5y.js";import"./cw7s5l0nt7rrqvcw.js";import"./c1p22j8o7hm9vv5x.js";import"./o3m65hw8d23edpzw.js";import"./gy64pge8qevmvg7e.js";import"./ora9zmv2zdoi2bvo.js";import"./lj0prj6na7gf1jpf.js";import"./csg4i0wk6hi0jvkd.js";import"./hiayljqmnpspmyun.js";import"./au5ozv27zrqgic7w.js";import"./n9whwsbg0rx5cs8k.js";import"./kpohf9e68vj4dpvk.js";import"./fzrn137102spawew.js";import"./ktvbjknz372ja7i7.js";import"./m97sb2fnwj0a6vyo.js";import"./gunpso70jnmarvod.js";import"./cm0hdcditutj2jz2.js";import"./jcoe6v231ph25bfi.js";import"./ijutvl794yycgs5p.js";import"./mz766tu1yyo45fp0.js";import"./nikuofry28tl503c.js";import"./bk8slwxjkdlmxjxm.js";import"./ms40jzicf31mvoix.js";import"./ngj3h1w6uuxrb6ri.js";import"./no4qfibpbbv193yj.js";const D="oai/apps/canmoreSidebarWidth",je=.25,Re=400,k=400;function L(e){return e-Re}function S(e,s){return G(k,L(e),s??je*e)}function _e(){const e=y.useState(y.selectWindowWidth),s=S(e,K(F.DANGER_SECRET_FOLDERS_ONLY_getItem(D))),a=P(),[t,r]=l.useState(s);l.useEffect(()=>{(t<k||t>L(e))&&r(S(e,t))},[e]);function n(c){r(h=>S(e,h+=c.delta.x))}function o(c){r(c),F.DANGER_SECRET_FOLDERS_ONLY_setItem(D,c)}function u(){const c=S(e,void 0);o(c)}const p=`calc(100vw - ${t}px)`;return a?{chatWidth:t,canvasWidth:e-t,canvasWidthCalc:p,viewportWidth:e,handleDrag:n,handleDoubleClick:u,persist:o}:{chatWidth:0,canvasWidth:e,canvasWidthCalc:"100vw",viewportWidth:e,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function P(e){const s=y.useState(y.selectWindowWidth);return(e??s)>1e3}const j="sharedCanvas";function Ne(){const[e,s]=B(),a=e.get(j),t=q();l.useEffect(()=>{const r=a&&X.createRemixTempTextdoc(a,t);if(!r)return;requestAnimationFrame(()=>{$(r)});const n=new URLSearchParams(e);n.delete(j),s(n);const o=new URL(window.location.href);o.searchParams.delete(j),history.replaceState(null,"",o)},[a,e,s,t])}function We(e,s){let a;return s?.type===v.Textdoc&&(s.textdocId.startsWith(Q)||(a={type:"canvas_textdoc",id:s.textdocId})),Z(e,{promptMessage:{metadata:{open_in_canvas_view:a}}})}const U=({isFullScreen:e=!1,clientThreadId:s,focusedObject:a,onClose:t,isAnimating:r=!1,width:n})=>{const{setTargetedContent:o}=J(),u=l.useRef(!1);if(l.useEffect(()=>(u.current&&o(void 0),u.current=!0,()=>{u.current=!1}),[a]),a==null)return null;switch(a.type){case v.Textdoc:return i.jsx(Ee,{isFullScreen:e,onClose:t,clientThreadId:s,focusedTextdoc:a,isAnimating:r,width:n});case v.ADAVisualization:return null}},Me=300,Fe=e=>{switch(e?.type){case v.Textdoc:return e.textdocId;default:return null}};function De(e,s){const[a,t,r,n]=fe(e,d=>[b.getRequestId(d),b.getConversationLastTurn(d),b.isMessageTurnEnded(d),b.getTree(d).getAllSiblingIds(b.getCurrentLeafId(d)).length>1]),o=ge(a),u=ee(),[p,c]=l.useMemo(()=>{if(t&&n)return[void 0,null];if(s===!0)return[void 0,null];let d;return!r&&t&&(d=xe(t.messageGroups)),Oe({groupedMessage:d,isRequestActive:o,latestTextdocId:u})},[r,t,n,s,o,u]),h=c!=null,C=Fe(c),E=te("canvas");l.useEffect(()=>{if(c&&p&&!se()&&(E(),ae(c,p),c.type===v.Textdoc)){const{textdocId:d}=c,x=Ae(d);oe(document.getElementById(x))}},[h,C])}function Oe({groupedMessage:e,isRequestActive:s,latestTextdocId:a}){switch(e?.type){case ve.Canmore:{const[t,r]=e.messages;if(!ie(t))break;const n=ne(s,t,r??null),o=n.textdocId??a;if(o&&(n.function===re.CreateTextdoc?(n.content??"").length>Me||n.status===_.WAITING:n.status===_.STREAMING))return[n.messageId,{type:v.Textdoc,textdocId:o}];break}}return[void 0,null]}const ke=260,I={type:"spring",bounce:.12,duration:.64},Le={type:"spring",bounce:0,duration:.58},Pe=({clientThreadId:e,focusedObject:s,onClose:a})=>{const{chatWidth:t,canvasWidthCalc:r,handleDrag:n,handleDoubleClick:o,persist:u}=_e(),[p,c]=l.useState(!0),[h,C]=l.useState(!1),E=de(m=>m.activeSidebar),d=le(({rect:m})=>m),{windowHeight:x,windowWidth:T}=be(m=>m,{windowWidth:0,windowHeight:0});let f=d??{top:0,left:t,width:T-t,height:x},R=!1;if(d&&(f.top<0||f.top+f.height>x)){R=!0;const m={width:(T-t)*.75,height:x*.75};f={top:x/2-m.height/2,left:(T-t-m.width)/2+t,width:m.width,height:m.height}}const w=d?.borderRadius,A=ue(),H=A?.history!=null||A?.showChangesAtVersion!=null,V=me();return i.jsxs(i.Fragment,{children:[H&&i.jsx(Se,{onClick:()=>pe(A.textdocId),zIndexKey:"chatOverlay"}),i.jsxs(g.div,{initial:{marginRight:V?0:-ke},animate:{marginRight:0},transition:Le,children:[i.jsx(g.div,{initial:{opacity:1},animate:{opacity:0},exit:{opacity:[1,0]},transition:{...I,delay:.22},className:"pointer-events-none absolute left-0 top-0 z-20 h-full w-full bg-token-main-surface-primary"}),i.jsx(g.div,{className:"relative z-20 h-full",style:{width:r},exit:{width:0},transition:{type:"spring",bounce:0,duration:.1}})]}),i.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"pointer-events-none absolute left-0 top-0 z-10 h-full w-full bg-black/[0.025] dark:bg-transparent"}),i.jsx(g.div,{className:Te("absolute z-20 h-full overflow-hidden transition-shadow",E==="debug"?"md:left-[-250px] lg:left-[-300px] xl:left-[-350px] 2xl:left-[-400px]":"left-0"),initial:{borderRadius:w,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)",opacity:R?0:1,x:f.left,y:f.top,height:f.height,width:f.width},animate:{opacity:1,x:t,y:0,width:r,height:x,borderRadius:0,boxShadow:"0px 0px 18px rgba(0,0,0,0.075)"},exit:{scale:.64,opacity:0,filter:"blur(12px)",transition:{opacity:{duration:.14,bounce:.1}},borderRadius:w,boxShadow:"0px 12px 32px 0px rgba(0, 0, 0, 0.064)"},transition:h?{duration:0}:I,onAnimationComplete:()=>c(!1),children:i.jsx(g.div,{className:"h-full overflow-hidden border-l border-gray-100 dark:border-token-border-medium",initial:{borderRadius:w},animate:{borderRadius:0},exit:{borderRadius:w},transition:I,children:i.jsxs("div",{className:"h-full",children:[i.jsx(g.div,{drag:"x",className:"absolute left-[-2px] z-10 h-full w-[4px] cursor-ew-resize bg-token-text-quaternary opacity-0",whileHover:{opacity:.5},whileDrag:{opacity:.75,width:"8px",left:"-4px"},transition:{type:"tween",duration:.1},style:{x:0,y:0,transform:"translateX(0px)"},dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onPointerDown:()=>C(!0),onPointerUp:()=>C(!1),onDrag:(m,z)=>n(z),onDragEnd:()=>{C(!1),u(t)},onDoubleClick:()=>o()}),h&&i.jsx("div",{className:"absolute inset-0 z-10"}),i.jsx(U,{onClose:a,clientThreadId:e,isAnimating:p,focusedObject:s,width:T-t})]})})})]})},Ue=l.memo(Pe),He=({clientThreadId:e,focusedObject:s,onClose:a})=>i.jsx(we,{children:i.jsx(g.div,{className:"fixed inset-0 z-40 overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:{scale:.98},animate:{scale:1},transition:I,children:i.jsx(U,{isFullScreen:!0,clientThreadId:e,focusedObject:s,onClose:a})})}),Ve=({clientThreadId:e,overrideWidth:s,isAutoFocusDisabled:a=!1})=>{const t=P(s),r=ye(e),n=Ie();De(e,a||n),Ne();const o=he();l.useEffect(()=>{O()},[e]);const u=o&&(t?i.jsx(Ue,{clientThreadId:e,onClose:M,focusedObject:o},"canvas-sidebar"):i.jsx(He,{clientThreadId:e,onClose:M,focusedObject:o},"canvas-modal"));l.useEffect(()=>{if(o)return N(h=>We(h,o)),()=>N(null)},[o]);const p=u!=null;return l.useEffect(()=>(W.setActiveStageSidebar(p),()=>{p&&W.setActiveStageSidebar(!1)}),[p]),r!==e?null:i.jsx(Y,{children:u})},St=e=>{const s=l.useRef(null);return i.jsx(Ce,{ref:s,onError:(a,t)=>{O(),setTimeout(()=>{s.current?.resetErrorBoundary()}),ce.logError("Error boundary hit",a,{componentStack:t})},name:"canmore-focused-view",children:i.jsx(Ve,{...e})})};export{St as CanvasFocusedViewManager};
//# sourceMappingURL=bfysuc3e9dcrn5qg.js.map
