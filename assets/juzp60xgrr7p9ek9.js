import{j as g,r as o}from"./fs6h2trisr1juto6.js";import{n as D}from"./njq6ygky3ttysgdk.js";import{cB as O}from"./d7a6rc8fexfzu7dt.js";import{p as t}from"./d9mfjso63mrxiny3.js";import"./joa8jajuiu4xqpzn.js";function G({drawingCanvasRef:n,...r}){return g.jsx(B,{ref:n,...r})}const B=o.forwardRef(function({color:r,dashedOutlineColor:l,cursorWidth:f,canvasWidth:v,canvasHeight:m,currentDrawnShape:s,onNewDrawnShape:j},A){const u=o.useRef(null),i=o.useRef(null),[w,h]=o.useState(),[I,z]=o.useState(!1);o.useImperativeHandle(A,()=>({getImageData:()=>{const e=c(u);s!=null&&($(s),t.view.update());const a=e.getContext("2d")?.getImageData(0,0,e.width,e.height);if(a==null)throw new Error("Failed to get image data from canvas");return s!=null&&l!=null&&M(s,new t.Color(l)),a}}));const d=o.useMemo(()=>O(e=>{if(i.current!=null){const a=T(e.point,c(u)),R=N(i.current.prevPoint,a,f);if(i.current.shape!=null){const _=i.current.shape;i.current.shape=i.current.shape.unite(R),_.remove(),R.remove()}else i.current.shape=R;i.current.shape.fillColor=new t.Color(r),i.current.prevPoint=a}},50),[r,f]),C=o.useCallback(e=>d(e),[d]),x=o.useCallback(()=>{if(d.cancel(),i.current?.shape!=null){const e=new t.Path.Rectangle({point:[0,0],size:t.view.size}),a=i.current.shape.intersect(e);a.fillColor=new t.Color(r),l!=null&&M(a,new t.Color(l)),j(a),i.current.shape.remove(),e.remove()}i.current=null,z(!1)},[d,r,l,j]),P=o.useCallback(e=>{let a=null;s!=null&&(a=s.clone(),$(a),s.remove()),i.current={shape:a,prevPoint:T(e.point,c(u))},z(!0)},[s]),E=o.useCallback(()=>{s!=null&&s.dashArray.length>0&&(s.dashOffset+=.2)},[s]),b=o.useCallback(e=>{e.preventDefault()},[]),k=o.useCallback(e=>{e.pointerType==="mouse"&&h(new t.Point([e.offsetX,e.offsetY]))},[]),y=o.useCallback(e=>{e.pointerType==="mouse"&&h(new t.Point([e.offsetX,e.offsetY]))},[]),L=o.useCallback(e=>{e.pointerType==="mouse"&&h(void 0)},[]);o.useEffect(()=>{t.setup(c(u)),t.view.viewSize=new t.Size(v,m)},[]),o.useEffect(()=>{t.project.activeLayer.removeChildren(),s!=null&&t.project.activeLayer.addChild(s)},[s]),o.useEffect(()=>{const e=c(u);return e.addEventListener("pointerover",k),e.addEventListener("pointermove",y),e.addEventListener("pointerout",L),e.addEventListener("touchstart",b),()=>{e.removeEventListener("pointerover",k),e.removeEventListener("pointermove",y),e.removeEventListener("pointerout",L),e.removeEventListener("touchstart",b)}},[k,y,L,b]),o.useEffect(()=>(t.view.on("mousedown",P),t.view.on("mousedrag",C),t.view.on("mouseup",x),t.view.on("frame",E),()=>{t.view.off("mousedown",P),t.view.off("mousedrag",C),t.view.off("mouseup",x),t.view.off("frame",E)}),[P,C,x,E]);const p=u.current?F(f,u.current):f;return g.jsxs("div",{className:"relative h-full w-full cursor-none",children:[g.jsx("canvas",{ref:u,width:v,height:m,className:"h-full w-full","data-paper-hidpi":"off"}),w&&g.jsx("div",{className:"pointer-events-none absolute left-0 top-0 rounded-full border-[3px] shadow-[0_2px_3px_0_rgba(0,0,0,0.25)]",style:{width:`${p}px`,height:`${p}px`,transform:`translate(${w.x-p/2}px, ${w.y-p/2}px) scale(${I?1:1.05})`}})]})});function c(n){return D(n.current)}function F(n,r){return n*r.offsetWidth/r.width}function T(n,r){return n.multiply(r.width/r.offsetWidth)}function N(n,r,l){const f=n.getDistance(r),v=new t.Rectangle(n.subtract([l/2,l/2]),new t.Size(f+l,l)),m=new t.Size(l/2,l/2),s=new t.Path.Rectangle(v,m);return s.rotate(r.subtract(n).angle,n),s}function M(n,r){n.strokeColor=r,n.strokeWidth=2,n.strokeCap="round",n.dashArray=[6,8],n.dashOffset=0}function $(n){n.strokeColor=null,n.strokeWidth=0,n.dashArray=[],n.dashOffset=0}export{G as DynamicDrawingCanvas};
//# sourceMappingURL=juzp60xgrr7p9ek9.js.map
