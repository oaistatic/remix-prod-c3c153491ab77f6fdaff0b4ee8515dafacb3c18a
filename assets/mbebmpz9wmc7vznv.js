const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/fmzyosh0sdm62591.js","assets/njq6ygky3ttysgdk.js","assets/fs6h2trisr1juto6.js","assets/root-cl538jor.css","assets/ora9zmv2zdoi2bvo.js","assets/d7a6rc8fexfzu7dt.js","assets/conversation-small-m9kq0y4e.css","assets/lpyam22iponprayw.js","assets/onz2j6p63wwkp7m6.js","assets/p32qvzx3ml1odktp.js","assets/o0kxre2a6am6klyc.js","assets/uer8rn1m59xnpdct.js","assets/grccwfqkma7x81tr.js","assets/e8xv89i2w2jwxlj7.js","assets/bv3kqivv4ik9nk26.js","assets/bavyq65q76tkwr25.js","assets/jhoqcbqmt1jrh2rh.js","assets/kw64vopcohpxfq7m.js"])))=>i.map(i=>d[i]);
import{bH as V,a3 as fe,F as E,M as X,V as be,bT as ve,c5 as $,E as je,y as D,d as Z,z as J,aT as ke,aV as De,cJ as Me,bQ as te,bR as se,aM as ye,l as Y,bw as W,go as y,c6 as L,gp as Pe,Z as Oe,gq as Se,K as Re}from"./njq6ygky3ttysgdk.js";import{j as e,r as d,e as Ce,M as Ae,d as Te,b as G}from"./fs6h2trisr1juto6.js";import{jm as ae,jn as f,jo as oe,jp as ie,d as Le,c6 as C,fq as Ee,E as Fe,U as Ie,eo as Ve,ep as $e,eq as le,es as ce,a3 as Ue,hb as qe,er as Be,jq as Je,jr as ze,js as Ge}from"./d7a6rc8fexfzu7dt.js";import{S as we}from"./e8xv89i2w2jwxlj7.js";import{S as B,c as _e,_ as He,a as de,b as K,v as We,d as ue,g as Ke,e as Qe,u as Xe,f as Ze}from"./64hudxlbh9qkzkbr.js";import{A as ne}from"./loh8e64j4csffv26.js";import{_ as Ye}from"./fzrn137102spawew.js";import{C as et}from"./ora9zmv2zdoi2bvo.js";import{I as tt}from"./btjgsqbipn1ns9gv.js";import"./e9lafxuzyeh4418f.js";import"./ktvbjknz372ja7i7.js";function st(){const t=ae();return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:["Force Use Search",!1]}),e.jsx(B,{id:"force-use-search",options:[{label:"Default",value:"default"},{label:"Force",value:"true"},{label:"Disable",value:"false"}],name:"force-use-search",className:"mt-1 shadow-none dark:text-gray-800",value:t.forceUseSearch==null?{value:"default",label:"Default"}:t.forceUseSearch?{value:"true",label:"Force"}:{value:"false",label:"Disable"},isMulti:!1,components:{Input:at},onChange:s=>{f({forceUseSearch:(s?.value??"default")==="default"?null:s?.value==="true"})}})]})})}const at=t=>e.jsx(_e.Input,{...t,inputClassName:"focus:ring-0"});var nt=["allowCreateWhileLoading","createOptionPosition","formatCreateLabel","isValidNewOption","getNewOptionData","onCreateOption","options","onChange"],me=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,i=String(s).toLowerCase(),r=String(a.getOptionValue(o)).toLowerCase(),c=String(a.getOptionLabel(o)).toLowerCase();return r===i||c===i},Q={formatCreateLabel:function(s){return'Create "'.concat(s,'"')},isValidNewOption:function(s,o,a,i){return!(!s||o.some(function(r){return me(s,r,i)})||a.some(function(r){return me(s,r,i)}))},getNewOptionData:function(s,o){return{label:o,value:s,__isNew__:!0}}};function rt(t){var s=t.allowCreateWhileLoading,o=s===void 0?!1:s,a=t.createOptionPosition,i=a===void 0?"last":a,r=t.formatCreateLabel,c=r===void 0?Q.formatCreateLabel:r,n=t.isValidNewOption,l=n===void 0?Q.isValidNewOption:n,u=t.getNewOptionData,g=u===void 0?Q.getNewOptionData:u,x=t.onCreateOption,m=t.options,h=m===void 0?[]:m,b=t.onChange,v=He(t,nt),_=v.getOptionValue,j=_===void 0?Ke:_,p=v.getOptionLabel,R=p===void 0?Qe:p,S=v.inputValue,F=v.isLoading,A=v.isMulti,P=v.value,T=v.name,N=d.useMemo(function(){return l(S,de(P),h,{getOptionValue:j,getOptionLabel:R})?g(S,c(S)):void 0},[c,g,R,j,S,l,h,P]),U=d.useMemo(function(){return(o||!F)&&N?i==="first"?[N].concat(K(h)):[].concat(K(h),[N]):h},[o,i,F,N,h]),H=d.useCallback(function(M,k){if(k.action!=="select-option")return b(M,k);var I=Array.isArray(M)?M:[M];if(I[I.length-1]===N){if(x)x(S);else{var w=g(S,S),O={action:"create-option",name:T,option:w};b(We(A,[].concat(K(de(P)),[w]),w),O)}return}b(M,k)},[g,S,A,T,N,x,b,P]);return ue(ue({},v),{},{options:U,onChange:H})}var ot=d.forwardRef(function(t,s){var o=Xe(t),a=rt(o);return d.createElement(Ze,Ye({ref:s},a))}),it=ot;function lt({children:t,sidebarOpen:s,onClose:o}){return e.jsx(oe.Root,{show:s,as:d.Fragment,children:e.jsxs(ie,{as:"div",className:"relative z-10",onClose:o,children:[e.jsx("div",{className:"fixed inset-0"}),e.jsx("div",{className:"fixed inset-0 overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:e.jsx("div",{className:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10",children:e.jsx(oe.Child,{as:d.Fragment,enter:"transform transition ease-in-out duration-100 sm:duration-300",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"transform transition ease-in-out duration-300 sm:duration-500",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",children:e.jsx(ie.Panel,{className:"pointer-events-auto w-screen max-w-md border-l border-gray-100 dark:border-gray-700",children:e.jsx("div",{className:"h-full overflow-y-auto bg-token-main-surface-primary shadow-xl",children:t})})})})})})]})})}function ct({clientThreadId:t}){const{rebaseSystemMessageContent:s,showDebugConversationTurns:o}=ae(),[a,i]=d.useState(()=>s?JSON.stringify(s,null,2):void 0),[r,c]=d.useState(!!s),l=fe(t,m=>E.findNode(m,h=>h.message.content.content_type===X.SystemContent))?.message.content??null,u=()=>{i(l?JSON.stringify(l,null,2):"")},g=be(),x=d.useMemo(()=>Le(m=>{try{m?f({rebaseSystemMessageContent:{...JSON.parse(m),content_type:X.SystemContent}}):f({rebaseSystemMessageContent:null}),g.closeAll()}catch{g.danger("The System Message is not valid JSON")}},500),[g]);return d.useEffect(()=>{r?x(a):(x.cancel(),f({rebaseSystemMessageContent:null}))},[x,r,a]),e.jsxs("div",{className:"flex flex-col gap-3 px-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(ve,{label:"Enable to apply this system message to the current conversation.",children:e.jsx(C,{id:"enabled",label:"Enabled",checked:r,onChange:m=>c(m.currentTarget.checked)})}),e.jsx(C,{id:"show-internal-conversation-turns",label:"Conversation debug mode",checked:o,onChange:()=>{f({showDebugConversationTurns:!o})}})]}),e.jsx($,{disabled:!l,className:"mt-2",onClick:u,size:"small",children:"Load active system message"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"System Message"}),e.jsx(dt,{disabled:!r,placeholder:l?"Press `Load active system message` to pre-populate this":"Start a conversation and then press `Load active system message` to pre-populate this",className:"min-h-[75vh] rounded-md border border-gray-400 p-1 font-mono",value:a,onChange:m=>i(m.target.value)})]})]})}const dt=V.textarea`w-full rounded-lg border border-token-border-light bg-token-main-surface-primary text-sm text-token-text-primary focus:border-token-text-primary focus:shadow-none focus:outline-none focus:ring-token-text-primary disabled:bg-token-main-surface-tertiary`;function ut({clientThreadId:t}){const[s,o]=d.useState([]),a=je(t),i=E.getCurrentLeafId(a),r=E.getConversationTurns(a),c=l=>{ke(t,u=>{De.setCurrentBranch(u,l)})},n=l=>{o(u=>[...u,i]),c(l)};return e.jsxs(e.Fragment,{children:[s.length>0&&e.jsxs($,{className:"absolute left-2 top-2",color:"secondary",onClick:()=>{const l=s[s.length-1];c(l),o(u=>u.slice(0,-1))},children:[e.jsx(Ee,{className:"icon-sm"}),"Go back to ",s[s.length-1]]}),e.jsx("div",{className:"flex flex-col items-center gap-4 overflow-auto p-4 text-xs",children:r.map((l,u)=>{const g=l.messages[0].id,x=E.getTree(a),m=u!==0?x.getParent(g):null,h=m!=null?m.children.findIndex(p=>g===p):0,b=m!=null?m.children:[],v=b.slice(0,h),_=b.slice(h+1);let j;switch(l.role){case D.User:j="bg-blue-500";break;case D.Assistant:j="bg-gray-600";break;default:j="bg-gray-400";break}return e.jsxs("div",{className:Z("relative p-2",j),children:[e.jsx("div",{className:"absolute bottom-0 left-0 -ml-2 flex -translate-x-full gap-2 pl-2",children:v.map(p=>e.jsx(ge,{variantId:p,onChangeItemInView:n},p))}),e.jsx("div",{className:"absolute left-full top-0 ml-2 flex gap-2 pr-2",children:_.map(p=>e.jsx(ge,{variantId:p,onChangeItemInView:n},p))}),e.jsx("div",{className:"flex flex-col gap-2",children:l.messages.map(p=>e.jsxs("div",{className:"h-14 w-32 truncate bg-gray-200 p-1 text-black",children:[e.jsx("div",{className:"font-semibold",children:p.id}),e.jsx("div",{className:"italic text-token-text-tertiary",children:p.author.role}),e.jsx("div",{children:J(p)})]},p.id))})]},u)})})]})}function ge({variantId:t,onChangeItemInView:s}){return e.jsx("button",{className:"w-32 truncate bg-gray-400 p-2 text-black opacity-50 hover:opacity-100",onClick:()=>{s(t)},children:e.jsx("span",{className:"bg-gray-200 p-2",children:t})},t)}const mt=te(()=>se(()=>import("./fmzyosh0sdm62591.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])).then(t=>t.DebugModalContents)),gt=te(()=>se(()=>import("./bavyq65q76tkwr25.js"),__vite__mapDeps([15,2,1,3,16,5,6])).then(t=>t.FramesViewer)),pt=te(()=>se(()=>import("./kw64vopcohpxfq7m.js"),__vite__mapDeps([17,2,1,3])).then(t=>t.ImageEditingViewer)),pe=Object.values(Fe);function Vt(){return e.jsx("button",{"data-testid":"open-debug-sidebar-button",className:"flex h-6 w-6 items-center justify-center rounded-full border border-token-border-light text-xs text-token-text-secondary",onClick:()=>{Ie.setActiveSidebar("debug")},children:e.jsx(we,{className:"icon-xs"})})}function xt({children:t,title:s,icon:o,isOpen:a,slideOver:i,onClose:r}){const c=e.jsxs(Nt,{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 text-lg font-semibold text-gray-900 dark:text-white",children:[e.jsx(o,{className:"icon-sm"}),s]}),e.jsx("div",{className:"mr-2 mt-2 flex h-7 items-center",children:e.jsx(Me,{onClick:r})})]}),t]});return i?e.jsx(lt,{sidebarOpen:a,onClose:r,children:c}):a?c:null}function ht({nodes:t,setDebugNodeIndex:s,setFrameSrc:o,conversationId:a}){const i=t.map((r,c)=>{const n=r.message,{role:l,name:u}=n.author,g=u&&u!==l,x=y(n,"metadata.__internal.model_id"),m=y(n,"metadata.__internal.s2s_vm_id"),h=y(n,"metadata.__internal.agent.settings.completion_api.engine"),b=m??h,v=y(n,"metadata.__internal.model_experiment_name"),_=y(n,"metadata.__internal.model_experiment_treatment"),j=y(n,"metadata.__internal.alternative_model_selection_rule"),p=y(n,"metadata.__internal.model_experiment_group_name"),R=y(n,"metadata.__internal.model_experiment_group_params"),S=y(n,"metadata.__internal.model_experiment_override"),F=y(n,"metadata.__internal.model_experiment_eval_seq"),A=y(n,"metadata.__internal.raw_tokens")?.length,P=y(n,"metadata.request_id"),T=y(n,"metadata.__internal.search_settings"),N=L.getAudio(n),U=L.getAudioAssetPointers(n),H=L.getFrameAssetPointers(n),M=L.getVideoContainerAssetPointers(n),k=L.getImageOperationFileIds(n),I=y(n,"metadata.__internal.sonic_debug");if(I){const w=J(n);return e.jsxs(he,{role:"button",onClick:()=>s(c),children:[e.jsxs("div",{className:Z("flex items-center gap-1 break-words text-xs font-semibold uppercase","text-token-text-tertiary"),children:["search (",I,")"]}),e.jsx("div",{className:"line-clamp-12 text-xs",children:w})]},n.id)}return e.jsxs(he,{role:"button",onClick:()=>s(c),children:[e.jsxs("div",{className:Z("flex items-center gap-1 break-words text-xs font-semibold uppercase",l===D.User?"text-token-text-primary":"text-token-text-tertiary"),children:[l===D.User&&e.jsx(Je,{className:"icon-sm"}),l,g&&` (${u})`,n.recipient&&" -> ",Pe(n)]}),(n.author.role!==D.System||P)&&e.jsxs("div",{className:"text-xs text-token-text-tertiary",children:[e.jsxs("div",{children:["ID: ",n.id]}),r.id!==n.id&&e.jsxs("div",{children:["UI Node ID: ",r.id]}),e.jsxs("div",{children:["Req ID: ",P||"Reload page to see ID"]})]}),e.jsx("div",{className:"line-clamp-6",children:J(n)}),(A||x||b||v||_||j||p||R||S||F||T)&&e.jsxs("div",{className:"mt-4 w-full self-start rounded-xl bg-blue-200 px-3 py-0.5 text-xs text-black",children:[A!==void 0&&e.jsxs("div",{children:[e.jsx("b",{children:"Tokens Count:"})," ",A]}),x&&e.jsxs("div",{children:[e.jsx("b",{children:"Model ID:"})," ",x]}),b&&e.jsxs("div",{children:[e.jsx("b",{children:"Engine:"})," ",b]}),v&&e.jsxs("div",{children:[e.jsx("b",{children:"Experiment:"})," ",v]}),_&&e.jsxs("div",{children:[e.jsx("b",{children:"Treatment:"})," ",_]}),j&&e.jsxs("div",{children:[e.jsx("b",{children:"Alternative Model Rule:"})," ",j]}),p&&e.jsxs("div",{children:[e.jsx("b",{children:"Group Name:"})," ",p]}),R&&e.jsxs("div",{children:[e.jsx("b",{children:"Group Params:"}),e.jsx("div",{children:JSON.stringify(R,null,2)})]}),S&&e.jsxs("div",{children:[e.jsx("b",{children:"Above Params are Overridden By:"})," ",S]}),F&&e.jsxs("div",{children:[e.jsx("b",{children:"Experiment Eval Seq:"})," click to see"]}),T&&e.jsxs("div",{children:[e.jsx("b",{children:"Search Settings:"}),e.jsx("div",{children:JSON.stringify(T,null,2)})]})]}),n.author.name===tt&&n.content.content_type===X.MultimodalText?e.jsx(St,{message:n,conversationId:a}):null,N.length||U.length||M.length||k?e.jsxs("div",{className:"mt-4 flex flex-col flex-nowrap gap-2",children:[k&&e.jsx(wt,{operation:k.operation,originalFileId:k.originalFileId,maskFileId:k.maskFileId,conversationId:a}),e.jsx(yt,{frameAssets:H,setFrameSrc:o},c),N.map((w,O)=>e.jsx(z,{audio:w,conversationId:a},`audio-asset-${O}`)),U.map((w,O)=>e.jsx(z,{assetPointer:w,conversationId:a},`audio-${O}`)),M.map((w,O)=>e.jsx(_t,{assetPointer:w,conversationId:a},`video-asset-${O}`))]}):null]},n.id)});return e.jsx(kt,{children:i})}const q=t=>e.jsx(_e.Input,{...t,inputClassName:"focus:ring-0"});function ft(){const t=ae(),o=ze().map(r=>({label:r.name,options:r.options.flatMap(c=>"options"in c?c.options.map(n=>({label:n.value,value:n.value})):[{label:`${c.value} (${c.name})`,value:c.value}])})),[a,i]=d.useState(pe[0]);return e.jsxs("div",{className:"mt-2 flex flex-col justify-around gap-3 px-4 py-1 text-xs font-semibold",children:[e.jsx(C,{id:"enable-inferred-juice",label:e.jsx("span",{children:"Use inferred juice"}),checked:t.enableInferredJuice,onChange:()=>{f({enableInferredJuice:!t.enableInferredJuice})}}),e.jsx(C,{id:"f-conversation",label:e.jsx("span",{children:"Use f/conversation endpoint ðŸš€"}),checked:t.enableFConversationEndpoint,onChange:()=>{f({enableFConversationEndpoint:!t.enableFConversationEndpoint})}}),e.jsx(C,{id:"showCompletionPerfData",label:e.jsx("span",{children:"Show turn perf stats"}),checked:t.showCompletionPerfData,onChange:()=>{f({showCompletionPerfData:!t.showCompletionPerfData})}}),e.jsx(C,{id:"force-paragen",label:"Force Parallel Gen",checked:t.forceParagen,onChange:()=>{f({forceParagen:!t.forceParagen})}}),e.jsx(it,{options:o,name:"force-paragen-model",className:"shadow-none dark:text-gray-800",isDisabled:!t.forceParagen,isLoading:o.length===0,value:t.forceParagenModel,isClearable:!0,isMulti:!1,components:{Input:q},onChange:r=>{f({forceParagenModel:r??Ge})}}),t.forceParagen?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:"Paragen Stream Type:"}),e.jsx(B,{options:[{label:"Do Not Override",value:"none"},{label:"Force Classic Stream Behavior",value:"default"},{label:"Wait for Assistant",value:"wait_for_assistant"},{label:"Interleave",value:"interleave"}],name:"paragen-stream-type",className:"shadow-none dark:text-gray-800",value:t.paragenStreamType==="none"?{value:"none",label:"Do Not Override"}:t.paragenStreamType==="default"?{value:"default",label:"Force Classic Stream Behavior"}:t.paragenStreamType==="wait_for_assistant"?{value:"wait_for_assistant",label:"Wait for Assistant"}:{value:"interleave",label:"Interleave"},isMulti:!1,components:{Input:q},onChange:r=>{f({paragenStreamType:r?.value??"none"})}})]}):null,t.forceParagen?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:"Show CoT in Paragen:"}),e.jsx(B,{options:[{label:"Allow",value:"allow"},{label:"Hide CoT for Alter Model",value:"hide_alter"},{label:"Hide",value:"hide"}],name:"paragen-stream-type",className:"shadow-none dark:text-gray-800",value:t.paragenCotSummaryDisplay==="allow"?{value:"allow",label:"Allow"}:t.paragenCotSummaryDisplay==="hide_alter"?{value:"hide_alter",label:"Hide CoT for Alter Model"}:{value:"hide",label:"Hide"},isMulti:!1,components:{Input:q},onChange:r=>{f({paragenCotSummaryDisplay:r?.value??"allow"})}})]}):null,e.jsx(C,{id:"show-paragen-metadata",label:"Show Paragen Metadata",checked:t.showParagenMetadata,onChange:()=>{f({showParagenMetadata:!t.showParagenMetadata})}}),e.jsx(st,{}),e.jsx(C,{id:"record-rendering",label:"Record Rendering",checked:t.recordRendering,onChange:()=>{f({recordRendering:!t.recordRendering})}}),e.jsx(C,{id:"force-rate-limit",label:"Force Rate Limit",checked:t.forceRateLimit,onChange:()=>{f({forceRateLimit:!t.forceRateLimit})}}),e.jsx(C,{id:"reset-rate-limit",label:"Reset Rate Limits",checked:t.resetRateLimits,onChange:()=>{f({resetRateLimits:!t.resetRateLimits})}}),e.jsx(ve,{label:"Enabling this will show debug conversation messages in the chat",children:e.jsx(C,{id:"show-internal-conversation-turns",label:"Conversation debug mode",checked:t.showDebugConversationTurns,onChange:()=>{f({showDebugConversationTurns:!t.showDebugConversationTurns})}})}),e.jsx(C,{id:"force-show-convo-rating",label:"Force Show Conversation Rating",checked:t.forceShowConvoRating,onChange:()=>{f({forceShowConvoRating:!t.forceShowConvoRating})}}),e.jsx("hr",{}),e.jsx("div",{children:"Reset announcement:"}),e.jsx(B,{options:pe.map(r=>({label:r.replace("oai/apps/",""),value:r})),name:"reset-announcement",className:"break-all font-mono shadow-none dark:text-gray-800",value:{label:a,value:a},isMulti:!1,components:{Input:q},onChange:r=>{r?.value&&i(r?.value)}}),e.jsx($,{onClick:()=>Oe.resetAnnouncement(a),children:"Reset"})]})}const xe=V.div`px-3 pb-2 text-xs font-semibold uppercase border-b-2 ${({$isSelected:t})=>t?"border-black dark:border-white":"border-transparent"}`;function $t({clientThreadId:t,isOpen:s,slideOver:o,onClose:a}){const i=Ce(),r=ye(),[c,n]=d.useState("conversation");return r?.includes("debug")?e.jsx(xt,{icon:we,title:i.formatMessage(re.debugTitle),isOpen:s,slideOver:o,onClose:a,children:e.jsxs(Ve,{orientation:"vertical",defaultValue:c,onValueChange:l=>n(l),children:[e.jsxs($e,{className:"mb-4 flex items-center justify-center gap-2 px-2 py-1 text-xs",children:[e.jsx(le,{value:"conversation",children:e.jsx(xe,{$isSelected:c==="conversation",children:"Conversation"})}),e.jsx(le,{value:"system-message-editor",children:e.jsx(xe,{$isSelected:c==="system-message-editor",children:"System Message"})}),!1]}),e.jsx(ce,{value:"conversation",children:e.jsx(bt,{clientThreadId:t})}),e.jsx(ce,{value:"system-message-editor",children:e.jsx(ct,{clientThreadId:t})}),!1]})}):null}function bt({clientThreadId:t}){const s=Ce(),o=fe(t,E.getBranch).filter(b=>b.message.author.role!==D.Root),[a,i]=d.useState(),r=ye(),c=d.useCallback(()=>{i(void 0)},[]),n=be(),l=d.useCallback(b=>{const _=E.getBranch(je(t)).filter(j=>![D.Root,D.System,D.Developer].includes(j.message.author.role)).map(j=>J(j.message)).join(`

`);Ue(_,n,b)},[t,n]),[u,g]=d.useState(!1),[x,m]=d.useState(void 0);return r?.includes("debug")?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-2 flex items-center justify-around px-4 py-1 text-xs font-semibold uppercase",children:e.jsx(jt,{clientThreadId:t,messages:o.map(b=>b.message)})}),!1,e.jsxs("div",{className:"flex items-center justify-around gap-2 px-4 py-1 text-xs font-semibold uppercase",children:[e.jsx("div",{children:e.jsx(et,{onCopy:l,buttonText:s.formatMessage(re.copyText)})}),e.jsxs("button",{className:"flex items-center justify-center gap-2",onClick:()=>g(!0),children:[e.jsx(qe,{className:"icon-sm rotate-90"}),"View tree"]})]}),e.jsx(ft,{}),null,e.jsx(ht,{nodes:o,setDebugNodeIndex:i,setFrameSrc:m,conversationId:Y(t)}),a!==void 0&&e.jsx(W,{type:"success",size:"fullscreen",noPadding:!0,isOpen:!0,onClose:c,children:e.jsx(mt,{threadId:o[a].message.metadata?.__internal?.sonic_thread_id??o[a].message.metadata?.debug_sonic_thread_id,threadUserId:o[a].message.metadata?.__internal?.sonic_user_id,onClose:c,message:o[a].message})},`DebugMessageModal-${a}`),u&&e.jsx(W,{isOpen:!0,onClose:()=>g(!1),type:"success",size:"custom",noPadding:!0,children:e.jsx(ut,{clientThreadId:t})},"DebugTreeViewer"),x&&e.jsx(W,{size:"normal",isOpen:!0,onClose:()=>m(void 0),type:"success",children:e.jsx("img",{src:x,alt:"debug image"})},"DebugFrameViewer")]}):null}function vt(t,s){const o=JSON.stringify({conversation_id:Y(t),messages:s},null,2),a=new Blob([o],{type:"application/json"}),i=URL.createObjectURL(a),r=document.createElement("a");r.href=i,r.download=`messages-${Y(t)}.json`,r.click(),URL.revokeObjectURL(i)}function jt({clientThreadId:t,messages:s}){const o=d.useCallback(()=>{vt(t,s)},[t,s]);return e.jsx($,{onClick:o,color:"primary",size:"small",icon:Be,children:e.jsx(Ae,{...re.downloadRawConversation})})}function yt(t){const[s,o]=d.useState([]),a=G(),{frameAssets:i}=t;return d.useEffect(()=>{async function r(){const c=i.map(async({image_asset_pointer:n,timestamp:l})=>{const u={asset:n};return{src:(await ne.fetch(a,u)).url,timestamp:l}});return Promise.all(c)}i.length>0&&r().then(o)},[i,a]),e.jsx(gt,{frames:s,setFrameSrc:t.setFrameSrc})}async function ee({queryClient:t,conversationId:s,fileId:o}){const a={asset:{content_type:Re.ImageAssetPointer,asset_pointer:o},conversationId:s},{url:i}=await ne.fetch(t,a);return i}function St({message:t,conversationId:s}){const o=L.getImageAssetPointers(t),a=t.metadata?.__internal?.image_gen_telemetry,[i,r]=d.useState("pointers"),c=d.useMemo(()=>o.map(l=>{const{gen_size:u,gen_id:g,height:x,width:m,parent_gen_id:h}=l.metadata?.generation??{};return e.jsxs("div",{className:"mt-4 w-full self-start rounded-xl bg-blue-200 px-3 py-0.5 text-xs text-black",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Size:"})," ",u]}),e.jsxs("div",{children:[e.jsx("strong",{children:"ID:"})," ",g," ",h?`(Parent: ${h})`:null]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Dimensions:"})," ",m," x ",x]}),e.jsx("div",{className:"pb-2",children:e.jsx(Ct,{fileId:l.asset_pointer,conversationId:s})})]},l.asset_pointer)}),[s,o]),n=d.useMemo(()=>e.jsx("div",{className:"mt-4 w-full self-start overflow-scroll whitespace-nowrap rounded-xl bg-blue-200 px-3 py-0.5 font-sans text-xs font-extralight text-black",children:a?.map(l=>e.jsx("div",{children:e.jsxs("div",{children:[e.jsx("strong",{children:l.id}),": ",l.timestamp.toFixed(2)," ",l.duration_ms&&`(${l.duration_ms?.toPrecision(2)}ms)`]})},l.id))}),[a]);return e.jsxs("div",{className:"flex flex-col justify-center",children:[e.jsxs($,{onClick:l=>{l.stopPropagation(),r(i==="pointers"?"telemetry":"pointers")},children:["Show ",i==="pointers"?"telemetry":"pointers"]}),i==="pointers"?c:n]})}function Ct({fileId:t,conversationId:s}){const o=G(),[a,i]=d.useState(void 0);return d.useEffect(()=>{ee({queryClient:o,conversationId:s,fileId:t}).then(i)},[t,o,s]),a&&e.jsx("img",{src:a,alt:t})}function wt({operation:t,originalFileId:s,maskFileId:o,conversationId:a}){const i=G(),[r,c]=d.useState(void 0),[n,l]=d.useState(void 0);return d.useEffect(()=>{r||ee({queryClient:i,conversationId:a,fileId:s}).then(c)},[r,s,a,i]),d.useEffect(()=>{!n&&o&&ee({queryClient:i,conversationId:a,fileId:o}).then(l)},[n,o,a,i]),r?e.jsx(pt,{operation:t,originalFileSrc:r,maskFileSrc:n}):null}function z(t){const s=Ne(t.assetPointer,t.conversationId),o=z.useAudioSource(t.audio),a=s??o,r=Se("3230069703").config.value.expirySeconds,[c,n]=d.useState(Date.now()),l=d.useRef(null);return d.useEffect(()=>{const u=setInterval(()=>{l.current&&l.current.currentTime>0&&!l.current.paused&&!l.current.ended&&l.current.readyState>2||n(Date.now())},r*1e3);return()=>clearInterval(u)},[r]),a?e.jsx("audio",{ref:l,controls:!0,src:a,className:"w-full"},c):null}function Ne(t,s){const[o,a]=d.useState(null),i=G();return d.useEffect(()=>{t&&ne.fetch(i,{asset:t,conversationId:s}).then(r=>{a(r.url)})},[i,t,s]),o}z.useAudioSource=t=>{const[s,o]=d.useState(null);return d.useEffect(()=>{if(t){const a=atob(t.payload),i=new Uint8Array(a.length);for(let n=0;n<a.length;n++)i[n]=a.charCodeAt(n);const r=new Blob([i],{type:`audio/${t.format}`}),c=URL.createObjectURL(r);return o(c),()=>{URL.revokeObjectURL(c)}}},[t]),s};function _t(t){const s=Ne(t.assetPointer,t.conversationId),a=Se("3230069703").config.value.expirySeconds,[i,r]=d.useState(Date.now()),c=d.useRef(null);return d.useEffect(()=>{const n=setInterval(()=>{c.current&&c.current.currentTime>0&&!c.current.paused&&!c.current.ended&&c.current.readyState>2||r(Date.now())},a*1e3);return()=>clearInterval(n)},[a]),s?e.jsx("video",{ref:c,controls:!0,src:s,className:"w-full"},i):null}const Nt=V.div`overflow-y-auto h-full md:w-[250px] lg:w-[300px] xl:w-[350px] 2xl:w-[400px] md:border-l md:border-gray-100 md:dark:border-gray-700 popover bg-token-main-surface-primary`,kt=V.pre`whitespace-pre-wrap text-sm`,he=V.div`px-6 py-4 flex flex-col gap-1 hover:bg-gray-50 dark:hover:bg-gray-500/10 cursor-pointer border-b dark:border-white/10 border-gray-200`,re=Te({debugTitle:{id:"DebugSidebar.debugTitle",defaultMessage:"Debug"},copyText:{id:"DebugSidebar.copyText",defaultMessage:"Copy text"},downloadRawConversation:{id:"DebugSidebar.downloadRawConversation",defaultMessage:"Download raw conversation"},uploadRawConversation:{id:"DebugSidebar.uploadRawConversation",defaultMessage:"Upload conversation dump"},closeSidebar:{id:"DebugSidebar.closeSidebar",defaultMessage:"Close sidebar"}});export{$t as DebugConversationSidebar,Vt as OpenDebugSidebarButton,xt as default};
//# sourceMappingURL=mbebmpz9wmc7vznv.js.map
