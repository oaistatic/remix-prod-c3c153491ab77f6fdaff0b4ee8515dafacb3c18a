const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/oky3t682ronc73v4.js","assets/fs6h2trisr1juto6.js","assets/njq6ygky3ttysgdk.js","assets/root-cl538jor.css","assets/d7a6rc8fexfzu7dt.js","assets/conversation-small-m9kq0y4e.css","assets/d9mfjso63mrxiny3.js","assets/joa8jajuiu4xqpzn.js"])))=>i.map(i=>d[i]);
import{cG as H,d as S,bH as P,l as U,c7 as B,bT as G,S as z,P as q,a as X,bQ as K,bR as Q,a3 as Z,M as $,c6 as J,V as Y,F as ee,ge as T,gd as te,D as ne}from"./njq6ygky3ttysgdk.js";import{r as u,j as e,M as v,a5 as R,e as N,b as se,n as ae}from"./fs6h2trisr1juto6.js";import{F as oe}from"./fj65uqnkvh37vl4n.js";import{bi as ie,ja as re,is as F,er as ce,cg as y,z as le,E as M,bB as de,dp as ue,bC as me,iV as ge,jb as fe,jc as he,ch as O,j9 as pe}from"./d7a6rc8fexfzu7dt.js";import{I as xe,f as we}from"./o3d0pfqxdj7nivvr.js";import{U as je,R as be,P as Ce}from"./dr3h4pxnog1msvu6.js";import{d as Ie}from"./mi16gkof274z4h73.js";import{R as ke,T as ve,a as ye,b as Ee}from"./48b1r0bzghcb5a9u.js";import"./fu6bathgya5b9rdr.js";import"./lj0prj6na7gf1jpf.js";import"./csg4i0wk6hi0jvkd.js";import"./kukctmibghbbqwq7.js";import"./ijutvl794yycgs5p.js";import"./n9whwsbg0rx5cs8k.js";import"./gunpso70jnmarvod.js";import"./jyg6m0czwgwjnl3i.js";import"./en8ogvlmn3lccz09.js";import"./gvhvfcdqhc5unmaw.js";import"./wqepkoieaii7q4ep.js";import"./gfo75oujoeaedm5y.js";import"./n1h3bv0q1kp4dflt.js";import"./o634nz6bc7e8bevz.js";import"./ohq33fk3dbalo2mk.js";import"./cffgjlidl1olpt2q.js";import"./i6ze5suolzahci5v.js";import"./npeck75bz46c490i.js";import"./m97sb2fnwj0a6vyo.js";import"./cm0hdcditutj2jz2.js";import"./jcoe6v231ph25bfi.js";import"./mfnl9tbidoj0ik29.js";import"./loh8e64j4csffv26.js";function De(){const[t,n]=u.useState({undoStack:[],currentIndex:-1});function a(s){n(c=>({undoStack:[...c.undoStack.slice(0,c.currentIndex+1),s],currentIndex:c.currentIndex+1}))}function l(){n(s=>({undoStack:s.undoStack,currentIndex:Math.max(s.currentIndex-1,-1)}))}function o(){n(s=>({undoStack:s.undoStack,currentIndex:Math.min(s.currentIndex+1,s.undoStack.length-1)}))}function i(){n({undoStack:[],currentIndex:-1})}return{currentDrawnShape:t.undoStack.length>0?t.undoStack[t.currentIndex]:null,onNewDrawnShape:a,canUndoDrawing:t.currentIndex>=0,undoDrawing:l,canRedoDrawing:t.currentIndex<t.undoStack.length-1,redoDrawing:o,clearAllDrawings:i}}var m=(t=>(t[t.Default=0]="Default",t[t.Inpaint=1]="Inpaint",t))(m||{});function Se({mode:t,imageIndex:n,allImages:a,onSwitchImage:l,isLoadingNewImage:o}){const i=n>0,s=u.useCallback(()=>{i&&l(a[n-1])},[i,a,n,l]),c=n<a.length-1,r=u.useCallback(()=>{c&&l(a[n+1])},[c,a,n,l]);return u.useEffect(()=>{function f(d){d.target instanceof HTMLTextAreaElement||t===m.Default&&(d.key==="ArrowLeft"?s():d.key==="ArrowRight"&&r())}return document.addEventListener("keydown",f),()=>{document.removeEventListener("keydown",f)}},[t,s,r]),e.jsx("div",{className:"flex h-16 w-full items-center justify-center gap-3 font-semibold text-token-text-secondary",children:t===m.Inpaint?!o&&e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(v,{id:"imageEditor.selectArea",defaultMessage:"Select an area to edit"}),e.jsx("a",{href:"https://help.openai.com/en/articles/9055440",target:"_blank",rel:"noreferrer",children:e.jsx(ie,{className:"icon-md"})})]}):a.length>1?e.jsxs(e.Fragment,{children:[e.jsx("button",{disabled:!i,className:"disabled:text-token-text-tertiary",onClick:s,children:e.jsx(re,{className:"icon-lg"})}),e.jsx("div",{children:e.jsx(v,{id:"imageEditor.imageNumber",defaultMessage:"Image {num} of {numImages}",values:{num:n+1,numImages:a.length}})}),e.jsx("button",{disabled:!c,className:"disabled:text-token-text-tertiary",onClick:r,children:e.jsx(H,{className:"icon-lg"})})]}):null})}const Ne=0,Te=64;function Me({imageAsset:t,children:n,containerDimensions:a,isLoadingNewImage:l}){return e.jsxs(R.div,{className:"absolute",style:_e(t,a),...F,children:[n,e.jsx("div",{className:S("absolute inset-0 flex items-center justify-center bg-token-main-surface-primary transition-opacity duration-1000",l?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]})}function _e(t,n){const{width:a,height:l}=t,{width:o,height:i}=n,s=o-2*Ne,c=i-2*Te,r=a/l,f=s/c,d=r>f,j=d?s:c*r,h=d?s/r:c,p=(i-h)/2,C=(o-j)/2;return{top:p,left:C,width:j,height:h}}function Ae({imageAsset:t,mode:n,setMode:a,clientThreadId:l,messageId:o,cursorWidth:i,setCursorWidth:s,inpaintingDrawingState:c,isLoadingNewImage:r}){const f=U(l),{canUndoDrawing:d,undoDrawing:j,canRedoDrawing:h,redoDrawing:p,clearAllDrawings:C}=c,b=N(),I=u.useCallback(()=>{const x=new Date;return`${b.formatDate(x,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}.png`},[b]);return e.jsxs(R.div,{className:"flex h-16 w-full justify-between px-4",...F,children:[e.jsx("div",{className:"flex items-center",children:n===m.Inpaint&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:S("flex items-center gap-3",r&&"opacity-50"),children:[e.jsx(A,{className:"h-[11px] w-[11px]"}),e.jsxs(ke,{className:"relative flex w-[90px] items-center",min:32,max:240,step:.01,value:[i],onValueChange:x=>s(x[0]),disabled:r,children:[e.jsx(ve,{className:"relative h-[2px] grow bg-token-text-quaternary",children:e.jsx(ye,{className:"absolute h-full bg-token-text-secondary"})}),e.jsx(Ee,{className:"block h-[11px] w-[11px] rounded-full bg-token-text-secondary"})]}),e.jsx(A,{className:"h-6 w-6"})]}),e.jsx(_,{}),e.jsx(w,{disabled:!d||r,onClick:j,children:e.jsx(je,{})}),e.jsx(w,{disabled:!h||r,onClick:p,children:e.jsx(be,{})}),e.jsx(_,{}),e.jsx(w,{disabled:!d||r,onClick:C,children:e.jsx(v,{id:"imageEditorControls.clearSelectionButtonLabel",defaultMessage:"Clear selection"})})]})}),e.jsx("div",{className:"flex items-center",children:n===m.Inpaint?e.jsx(w,{onClick:()=>a(m.Default),disabled:r,children:e.jsx(v,{id:"imageEditorControls.cancelButtonLabel",defaultMessage:"Cancel"})}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{imageAsset:t,setMode:a,messageId:o,serverThreadId:f}),e.jsx(w,{tooltip:b.formatMessage({id:"imageEditorControls.downloadButtonTooltip",defaultMessage:"Save"}),onClick:()=>{Ie({url:t.url,fileName:I()})},children:e.jsx(ce,{})}),e.jsx(w,{tooltip:b.formatMessage({id:"imageEditorControls.closeButtonTooltip",defaultMessage:"Close"}),onClick:y.close,children:e.jsx(B,{className:"icon-lg"})})]})})]})}function w({children:t,tooltip:n,disabled:a,onClick:l}){const o=e.jsx("button",{className:S("rounded p-2 font-semibold hover:bg-token-main-surface-tertiary group-radix-state-open:bg-token-main-surface-tertiary",a?"text-token-text-quaternary":"text-token-text-secondary"),disabled:a,onClick:l,children:t});return n!=null?e.jsx(G,{label:n,sideOffset:4,children:o}):o}function Pe({imageAsset:t,setMode:n,messageId:a,serverThreadId:l}){const o=N(),i=le(M.DalleEditingOnboarding),s=i.eligible&&!i.isLoading,c=e.jsx(w,{tooltip:s?void 0:o.formatMessage({id:"imageEditorControls.inpaintButtonTooltip",defaultMessage:"Select"}),onClick:()=>{n(m.Inpaint),z.logEvent("chatgpt_dalle_inpaint_click",null,{sourceOperation:t.metadata?.dalle?.edit_op??"none",hasParent:t.metadata?.dalle?.parent_gen_id!=null?"true":"false"}),q.logEvent(X.dalleImageClickInpaint,{conversationId:l,messageId:a,generationId:t.metadata?.dalle?.gen_id,fileId:de(t.asset_pointer),parentGenerationId:t.metadata?.dalle?.parent_gen_id,sourceOperation:t.metadata?.dalle?.edit_op})},children:e.jsx(Ce,{})});return s?e.jsx(ue,{announcementKey:M.DalleEditingOnboarding,show:!0,side:"bottom",sideOffset:0,title:o.formatMessage({id:"imageEditorNUX.title",defaultMessage:"Select area of the image to edit"}),description:o.formatMessage({id:"imageEditorNUX.description",defaultMessage:"Highlight the area and describe changes in chat."}),onDismiss:i.markAsViewed,children:e.jsx("div",{children:c})}):c}const _=P.div`mx-3 w-[1px] h-6 bg-token-border-light`,A=P.div`rounded-full border-2 border-token-text-secondary`,Re=K(()=>Q(()=>import("./oky3t682ronc73v4.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(t=>t.DynamicDrawingCanvas));function ft({clientThreadId:t,messageId:n,image:a,allImages:l}){const o=Z(t,c=>{const r=ee.getCurrentNode(c).message;if([T.Dalle,T.t2uay3k].includes(te(r)))return r}),i=o!=null&&!me(o),s=se();return u.useEffect(()=>{async function c(r,f){try{const d=await we(s,r);y.setFocusedObject({type:O.Image,image:d[0],allImages:d,messageId:f})}catch(d){ne.addError(new Error("Failed to load newly created images:",{cause:d}))}}if(o?.content.content_type===$.MultimodalText){const r=J.getImageAssetPointers(o);c(r,o.id)}},[s,o]),e.jsx(Fe,{image:a,allImages:l,isLoadingNewImage:i,clientThreadId:t,messageId:n})}function Fe({image:t,allImages:n,isLoadingNewImage:a,clientThreadId:l,messageId:o}){const[i,s]=u.useState(m.Default),[c,r]=u.useState({width:window.innerWidth-oe,height:window.innerHeight}),f=u.useRef(null),[d,j]=u.useState(136),h=De(),{currentDrawnShape:p,onNewDrawnShape:C,clearAllDrawings:b}=h,I=u.useRef(null),x=N(),E=Y(),{setTargetedContent:k}=ge();u.useEffect(()=>{const g=new ResizeObserver(D=>{const{width:W,height:V}=D[0].contentRect;r({width:W,height:V})});return f.current&&g.observe(f.current),()=>{g.disconnect()}},[]),u.useEffect(()=>{function g(D){D.key==="Escape"&&(i===m.Inpaint?s(m.Default):y.close())}return document.addEventListener("keydown",g),()=>{document.removeEventListener("keydown",g)}},[i]),u.useEffect(()=>(p==null?k({type:"object",placeholderTextOverride:ae({id:"imageEditor.transformationTextareaPlaceholder",defaultMessage:"Edit imageâ€¦"}),shouldPersistAcrossMessages:!0,isFocusedViewContent:!0,createNewCompletionParams:g=>fe(g,t)}):k({type:"object",label:x.formatMessage({id:"imageEditor.inpaintingTargetedContentLabel",defaultMessage:"Edit selection"}),isFocusedViewContent:!0,createNewCompletionParams:async g=>await he(g,t,I.current?.getImageData(),x,E),onCleared:()=>s(m.Default)}),()=>{k(void 0)}),[t,x,k,p,E]),u.useEffect(()=>{i!==m.Inpaint&&b()},[i]),u.useEffect(()=>{s(m.Default)},[t]);const L=n.findIndex(g=>g.asset_pointer===t.asset_pointer);return e.jsxs("div",{ref:f,className:"flex h-full w-full flex-col justify-between",children:[e.jsx(Ae,{imageAsset:t,mode:i,setMode:s,clientThreadId:l,messageId:o,cursorWidth:d,setCursorWidth:j,inpaintingDrawingState:h,isLoadingNewImage:a}),e.jsx(Se,{mode:i,imageIndex:L,allImages:n,onSwitchImage:g=>{y.setFocusedObject({type:O.Image,image:g,allImages:n,messageId:o})},isLoadingNewImage:a}),e.jsxs(Me,{imageAsset:t,containerDimensions:c,isLoadingNewImage:a,children:[e.jsx(xe,{className:"h-full w-full",alt:pe(t),src:t.url,width:t.width,height:t.height,fadeIn:!1}),i===m.Inpaint&&e.jsx("div",{className:"absolute inset-0",children:e.jsx(Re,{drawingCanvasRef:I,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:d,canvasWidth:t.width,canvasHeight:t.height,currentDrawnShape:p,onNewDrawnShape:C})})]})]})}export{ft as ImageGenEditor};
//# sourceMappingURL=kjfpfp7cny491i17.js.map
