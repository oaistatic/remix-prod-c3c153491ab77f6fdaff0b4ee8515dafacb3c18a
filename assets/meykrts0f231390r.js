import{d as vn,r as E,x as Pn,v as Sn,j as ce,e as Tn}from"./fs6h2trisr1juto6.js";import{a7 as Lt,d as me,n as De,fb as Rn,db as Dn,hM as le,D as Vt,B as $t,a as re,dA as In,V as An,cL as Bn,hN as On,c8 as _n}from"./njq6ygky3ttysgdk.js";import{Z as Ge,U as Ln,W as Vn,_ as it,J as $n,G as Un,Q as zn,E as Hn,A as Fn,$ as Kn,B as jn,C as Gn,V as Wn,a0 as We,a1 as _,a2 as Ut,a3 as qn,a4 as Xn,a5 as Yn,v as Zn,H as Jn,a6 as Qn,a7 as er,a8 as be,a9 as Oe,u as zt,y as tr,aa as Ht,X as nr,Y as Ft,ab as rr}from"./j74ui1ngt8ov9uvf.js";import{ai as ge,v as at,j as ct,E as lt,s as sr,aj as or,a3 as B,ak as Ie,al as ir,am as ar,a5 as cr,an as lr,ao as ur,ap as dr}from"./o3m65hw8d23edpzw.js";import{a as z,P as U,T as j,b as oe,D as A,A as pr,j as hr,M as Kt,l as qe,N as fr,m as ut,w as mr,o as gr,q as jt,r as Mr,t as $e,u as Ue,f as Nr,F as D,v as ye,x as Me,y as Gt,z as kr,c as wr,B as Xe,C as Wt,h as yr,k as Ye,S as xr,R as Cr,G as qt,H as Er,e as Xt,I as br,g as vr,E as Yt,J as Pr,i as Sr}from"./n9whwsbg0rx5cs8k.js";import{d as Tr,bq as dt,jK as Zt,iQ as pt,t as ht,jj as Jt,q0 as Rr,bF as Dr,gG as J,nm as Ir,m5 as Ar,u2 as Br,nH as ft,lY as Ze,lZ as Qt,g$ as Or,h0 as _r}from"./d7a6rc8fexfzu7dt.js";import{D as Lr,Z as Vr}from"./l4ce2zdnnawhaijx.js";import{i as en,f as mt,a as $r,p as Ur,h as zr,r as Hr,b as Fr,c as Kr,d as jr,e as Gr,k as Wr,g as qr}from"./iqgzc83lat3a2v2u.js";import{d as Xr,r as Yr,u as Zr}from"./hi1g9go8t53qsjy9.js";const Jr=()=>Lt("924611523");class tn extends ge{unistNodeName(){return"link"}static proseMirrorMarkName(){return"link"}proseMirrorMarkSpec(){return{attrs:{href:{},title:{default:null},disabled:{default:!0}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs(e){return{href:e.getAttribute("href"),title:e.getAttribute("title")}}}],toDOM(e){return["a",{...e.attrs,...e.attrs.disabled?{href:void 0}:{}}]}}}unistNodeToProseMirrorNodes({node:e,convertedChildren:t,schema:n}){const{url:s,title:o}=e;return t.map(i=>i.mark(i.marks.concat([n.marks[this.proseMirrorMarkName()].create({href:s,title:o})])))}processConvertedUnistNode(e,t){return{type:this.unistNodeName(),url:t.attrs.href,...t.attrs.title!=null&&{title:t.attrs.title},children:[e]}}}function Qr(r,e){const t=[];return r.descendants((n,s)=>{n.marks.forEach(o=>{o.type===e&&t.push({from:s,to:s+n.nodeSize,mark:o})})}),t}function es(r,e,t){const n=e.mark.type,s={...e.mark.attrs,disabled:t};return r.removeMark(e.from,e.to,n),r.addMark(e.from,e.to,n.create(s)),r}const Je=new z("disableUnsafeLinks");function ts(r,e){return r.setMeta(Je,{safeUrls:e})}function ns(r){return r.getMeta(Je)??null}function rs(r=new Set){return new U({key:Je,state:{init(e){return{safeUrls:r}},apply(e,t){const n=ns(e);if(n==null)return t;const{safeUrls:s}=n;return{...t,safeUrls:s}}},appendTransaction(e,t,n){const s=this.getState(n),o=n.tr,i=n.schema.marks[tn.proseMirrorMarkName()],a=Qr(n.doc,i);let c=!1;return a.forEach(u=>{const l=u.mark.attrs.href,d=s.safeUrls.has(l),h=u.mark.attrs.disabled===!0;d===h&&(es(o,u,!d),c=!0)}),c?o:null}})}const Pe=new z("placeholder");function ss(r,e){return r.setMeta(Pe,{isDisabled:e})}function os(r){return r.getMeta(Pe)??null}function is(r,e=!1){return new U({key:Pe,state:{init(){return{isDisabled:e}},apply(t,n){const s=os(t);return s?.isDisabled!=null?{...n,isDisabled:s.isDisabled}:n}},props:{decorations(t){const{doc:n,selection:s}=t;if(Pe.getState(t).isDisabled||!(s instanceof j&&s.empty))return null;const{$cursor:i}=s;if(!i||!r)return null;const a=i.start();if(!((i.parent.isTextblock||i.parent.type.name==="doc")&&i.pos===a&&i.node().content.size===0))return null;const u=oe.widget(a,()=>{const l=document.createTextNode(r.formatMessage(as.placeholder)),d=document.createElement("span");return d.className="text-token-text-tertiary dark:text-gray-500 pointer-events-none select-none",d.style.position="absolute",d.appendChild(l),d});return A.create(n,[u])}}})}const as=vn({placeholder:{id:"n2B51U",defaultMessage:"Write something..."}}),cs={"override-strong-color":"_override-strong-color_y6grp_1"};function nn({isHovered:r,isRejected:e,isTextAcive:t}){return me({"line-through":!t,"filter grayscale-[0.6]":e&&!t,"opacity-60":e&&!t,"bg-opacity-50 dark:bg-opacity-50":e&&r,"bg-opacity-10 dark:bg-opacity-10":e&&!r,"bg-opacity-60 dark:bg-opacity-60":!e&&!r})}function ls({isHovered:r,isRejected:e,isReplacement:t}){return me("bg-red-100 dark:bg-red-600",nn({isHovered:r,isRejected:e,isTextAcive:e}),{"dark:bg-red-800":e,"text-red-500 dark:text-red-200":!e,"border border-red-400 rounded-l border-r-0":e&&t,"border border-red-400 rounded":e&&!t})}function us({isHovered:r,isRejected:e,isReplacement:t}){const n=!e;return me(cs["override-strong-color"],"text-green-600 dark:text-green-200 bg-green-100 dark:bg-green-600",nn({isHovered:r,isRejected:e,isTextAcive:n}),{"dark:bg-green-800":e,"border border-green-500 rounded-r border-l-0":e&&t,"border border-green-500 rounded":e&&!t})}const ze=new z("edit"),gt=(r,e,t,n)=>{const s=[];for(const{start:o,end:i,editId:a}of e)s.push(oe.inline(o,i,{class:ls({isHovered:!1,isRejected:!1,isReplacement:!1}),"data-edit-id":a}));for(const{start:o,end:i,editId:a}of r)s.push(oe.inline(o,i,{class:us({isHovered:!1,isRejected:!1,isReplacement:!0}),"data-edit-id":a}));return s},ds=(r,e)=>new U({key:ze,state:{init(){const n=new Set;return{decorations:gt(r,e),hoveredEditId:null,rejectedEdits:n}},apply(t,n){const s=t.getMeta(ze)??null,{hoveredEditId:o,rejectedEdits:i}=s??n;return{decorations:gt(r,e),hoveredEditId:o,rejectedEdits:i}}},props:{decorations(t){const n=this.getState(t);return n?A.create(t.doc,n.decorations.concat()):A.empty},editable(){return!1},attributes(){return{class:"cursor-default",style:"--text-primary:var(--text-secondary)"}}}});class ee{constructor(e,t){this.length=e,this.step=t}cut(e){return e===this.length?this:new ee(e,this.step)}static slice(e,t,n){if(t===n)return ee.none;if(t===0&&n===ee.len(e))return e;const s=[];for(let o=0,i=0;i<n;o++){const a=e[o],c=i+a.length,u=Math.min(n,c)-Math.max(t,i);u>0&&s.push(a.cut(u)),i=c}return s}static join(e,t,n){if(e.length===0)return t;if(t.length===0)return e;const s=n(e[e.length-1].step,t[0].step);if(s==null)return e.concat(t);const o=e.slice(0,e.length-1);o.push(new ee(e[e.length-1].length+t[0].length,s));for(const i of t)o.push(i);return o}static len(e){let t=0;for(const n of e)t+=n.length;return t}static none=[]}class ps{constructor(e,t,n,s,o,i){this.fromA=e,this.toA=t,this.fromB=n,this.toB=s,this.deleted=o,this.inserted=i}get lenA(){return this.toA-this.fromA}get lenB(){return this.toB-this.fromB}}const Mt=(r,e,t,n,s)=>new ps(r,e,t,n,r===e?ee.none:[new ee(e-r,s)],t===n?ee.none:[new ee(n-t,s)]);class Se{constructor(e,t){this.doc=e,this.changes=t}static create(e){return new Se(e,[])}addSteps(e,t){const n=[];for(const o of t){let i=0;if(o.getMap().forEach((a,c,u,l)=>{n.push(Mt(a+i,c+i,u,l,o)),i=l-u-(c-a)}),o instanceof pr||o instanceof hr){const{from:a,to:c}=o;n.push(Mt(a,c,a,c,o))}}if(n.length===0)return this;const s=this.changes.concat(n);return new Se(e,s)}}const ke=new z("changeset"),He=new z("highlightChanges"),rn=r=>ke.getState(r),hs=r=>{const{state:e}=r,t=e.tr.setMeta(ke,!0);r.updateState(e.apply(t))},fs=r=>{const{state:e}=r,t=rn(e);if(!t)return;const{maps:n,steps:s}=t,o=new Kt(n),i=e.tr;for(let c=s.length-1;c>=0;c--){const u=s[c].map(o.slice(c+1));if(!u)continue;i.maybeStep(u).doc&&o.appendMap(u.getMap(),c)}const a=e.apply(i.setMeta(ke,!0));r.updateState(a)},ms=()=>{const r=n=>({changeset:Se.create(n),maps:[],steps:[]}),e=new U({key:ke,state:{init:(n,{doc:s})=>r(s),apply:(n,s,o,i)=>{const{doc:a}=i;if(n.getMeta(ke))return r(a);const{docChanged:u,mapping:l,steps:d,docs:h}=n;if(!u)return s;const{changeset:p,maps:f,steps:g}=s,{maps:k}=l,b=d.map((y,x)=>y.invert(h[x]));return{changeset:p.addSteps(a,d),maps:f.concat(k),steps:g.concat(b)}}}}),t=new U({key:He,state:{init(){return{deco:A.empty,show:!1}},apply(n,s,o,i){const a=e.getState(i);if(!a)return s;const{changeset:c}=a,{doc:u}=i,{changes:l}=c,d=l.map(({fromB:p,toB:f})=>oe.inline(p,f,{class:"blame-marker"})),h=n.getMeta(He);return{deco:A.create(u,d),show:h??s.show}}},props:{decorations(n){const s=this.getState(n);if(!s?.show)return A.empty;const{deco:o}=s;return o}}});return[e,t]},ie=(r,e,t)=>{E.useEffect(()=>{const n=e.current;if(!n)return;const{state:s}=n,o=r(s.tr);o&&n.dispatch(o)},t)},fe=new z("autocomplete");function Nt(r,e){return r.setMeta(fe,{suggestion:e})}function gs(r){return r.getMeta(fe)}function kt(r){if(!(r instanceof j))return null;const{$cursor:e}=r;if(!e)return null;const t=e.end();return e.pos===t?t:null}function Ms(r=null){return new U({key:fe,state:{init(){return{suggestion:r}},apply(e,t){const n=gs(e);return n===void 0?t:{...t,suggestion:n.suggestion??null}}},props:{decorations(e){const{doc:t,selection:n}=e,{suggestion:s}=fe.getState(e);if(!s)return null;const o=kt(n);if(o==null)return A.empty;const i=oe.widget(o,()=>{const a=document.createTextNode(s),c=document.createElement("span");return c.className="text-token-text-tertiary dark:text-gray-500 pointer-events-none select-none",c.appendChild(a),c});return A.create(t,[i])},handleDOMEvents:{keydown:(e,t)=>{const{state:n}=e,s=fe.getState(n),o=kt(n.selection);t.key==="Tab"&&s.suggestion&&o!=null&&(t.preventDefault(),e.dispatch(n.tr.insert(o,n.schema.text(s.suggestion))))}}}})}const Ns=(r,e)=>{const t=E.useRef(!1),n=E.useRef(null),s=E.useRef(e);s.current=e;const o=E.useCallback(Tr(async i=>{t.current=!1;const a=crypto.randomUUID();n.current=a;const c=await s.current?.(i());!t.current&&c!==void 0&&r.current&&n.current===a&&r.current.dispatch(Nt(r.current.state.tr,c))},200),[]);return E.useCallback(i=>{t.current=!0;const a=De(r.current);a.dispatch(Nt(a.state.tr,null)),o(i)},[o,r])};var we=(r=>(r.PROSEMIRROR_CONTEXT_CHILDREN="prosemirror-context-children",r.PROSEMIRROR_EDITOR_CONTAINER="prosemirror-editor-container",r))(we||{});function ks(r,e){return{x:dt(e.x,r.left,r.right),y:dt(e.y,r.top,r.bottom)}}function sn(r){let e=r.selection.$from.pos-1;if(e<0)return null;let t=r.doc.nodeAt(e);for(;(t==null||t.type.name===Ge.proseMirrorNodeName())&&e>0;)e-=1,t=r.doc.nodeAt(e);return t!=null?{node:t,pos:e}:t}function ws(r,e){const t=sn(r);if(t==null)return!1;const{node:n,pos:s}=t,o=s+n.nodeSize,i=r.tr,c=r.schema.nodes.paragraph.create(null);i.insert(o,c);const u=o+c.nodeSize-1,l=i.doc.resolve(u),d=new j(l);return i.setSelection(d),e(i),!0}function ys(r,e){const t=sn(r);if(t==null)return!1;const{node:n,pos:s}=t,o=r.tr;return o.deleteRange(s,s+n.nodeSize),e(o),!0}const wt=(r,e)=>{if(r===e)return null;let t=0,n=r.length,s=e.length;for(;t<n&&r.charCodeAt(t)===e.charCodeAt(t);)t+=1;for(;n>t&&s>t&&r.charCodeAt(n-1)===e.charCodeAt(s-1);)n-=1,s-=1;return{from:t,to:n,text:e.slice(t,s)}},yt=Ln({settings:{background:"var(--gray-100)"}});class Qe{constructor(e,t,n,s){this.pmView=t,this.getPos=n,this.node=e;const o=[{key:"ArrowUp",run:this.maybeEscape("line",-1)},{key:"ArrowLeft",run:this.maybeEscape("char",-1)},{key:"ArrowDown",run:this.maybeEscape("line",1)},{key:"ArrowRight",run:this.maybeEscape("char",1)},{key:"Backspace",run:this.handleBackspace},{key:"Shift-Enter",run:this.handleShiftEnter}];this.languageCompartment=new at,this.themeCompartment=new at;const i=Vn(e.attrs.lang),a=ct.create({doc:this.node.textContent,extensions:[this.themeCompartment.of(s?it:yt),lt.theme({"&":{borderRadius:"4px",padding:"0.5rem"},"&.cm-focused":{outline:"none"}}),sr.of([...o,...$n,...Un,zn]),Hn(),Fn(),Kn(),or(),jn(Gn),this.languageCompartment.of(i!=null?[i]:[]),ct.changeFilter.of(c=>(!c.docChanged&&!this.updating&&this.forwardSelection(),!0))]});this.cm=new lt({state:a,dispatch:this.dispatch}),i==null&&this.setLanguage(e.attrs.lang)}node;updating=!1;cm;languageCompartment;themeCompartment;get pmSchema(){return this.pmView.state.schema}get dom(){return this._setIsCodeBlockView(),this.cm.dom}setLanguage=async e=>{const t=await Wn(e);t&&this.cm.dispatch({effects:this.languageCompartment.reconfigure(t)})};setTheme=e=>{const t=e?it:yt;this.cm.dispatch({effects:this.themeCompartment.reconfigure(t)})};handleBackspace=e=>{const{selection:t}=e.state;if(!(t.main.empty&&t.main.from===0)||this.cm.state.doc.length>0)return!1;const n=ys(this.pmView.state,this.pmView.dispatch);return this.pmView.focus(),n};handleShiftEnter=()=>{const e=ws(this.pmView.state,this.pmView.dispatch);return this.pmView.focus(),e};dispatch=e=>{if(this.cm.update([e]),this.updating)return;const t=(this.getPos()??0)+1,n=e.state.doc.toString(),s=wt(this.node.textContent,n);if(s){const{text:o,from:i,to:a}=s,c=o?this.pmSchema.text(o):null,u=this.pmView.state.tr.replaceWith(i+t,a+t,c);this.pmView.dispatch(u)}this.forwardSelection()};update=e=>{if(e.type!==this.node.type)return!1;e.attrs.lang!==this.node.attrs.lang&&this.setLanguage(e.attrs.lang),e.attrs.isDarkMode!=null&&e.attrs.isDarkMode!==this.node.attrs.isDarkMode&&this.setTheme(e.attrs.isDarkMode),this.node=e;const t=wt(this.cm.state.doc.toString(),e.textContent);if(t){const{text:n,from:s,to:o}=t;this.updating=!0,this.cm.dispatch({changes:{from:s,to:o,insert:n}}),this.updating=!1}return!0};asProseMirrorSelection=e=>{const t=(this.getPos()??0)+2,{anchor:n,head:s}=this.cm.state.selection.main;return j.create(e,n+t,s+t)};forwardSelection=()=>{if(!this.cm.hasFocus)return;const{state:e}=this.pmView,t=this.asProseMirrorSelection(e.doc);t.eq(e.selection)||this.pmView.dispatch(e.tr.setSelection(t))};maybeEscape=(e,t)=>n=>{const{state:s}=n,{selection:o}=s,a=(()=>{const p=o.main.from,{number:f,from:g}=s.doc.lineAt(p);return{line:f,ch:p-g}})(),c=s.selection.ranges.some(p=>!p.empty),u=1,l=s.doc.lineAt(s.doc.length).number;if(c||a.line!==(t<0?u:l)||e==="char"&&a.ch!==(t<0?0:s.doc.line(a.line).length))return!1;const d=(this.getPos()??0)+(t<0?0:this.node.nodeSize),h=qe.near(this.pmView.state.doc.resolve(d),t);return this.pmView.dispatch(this.pmView.state.tr.setSelection(h).scrollIntoView()),this.pmView.focus(),!0};setSelection=(e,t)=>{this.focus(),this.updating=!0,this.cm.dispatch({selection:{anchor:e,head:t}}),this.updating=!1};focus=()=>{this.cm.focus(),this.forwardSelection()};selectNode=()=>{this.focus()};stopEvent=()=>!0;destroy=()=>{this.cm.destroy()};_setIsCodeBlockView=()=>{this.cm.dom.dataset.isCodeBlockView="true"};static _getIsCodeBlockView=e=>e.dataset.isCodeBlockView==="true";static isInCodeBlockView(e){return e instanceof HTMLElement?e.closest("[data-is-code-block-view]")!=null:!1}}function xs(r,e,t){try{return e instanceof j?j.create(r,e.anchor,e.head):e instanceof fr?j.create(r,e.from,e.to):e instanceof ut?new ut(r):void 0}catch{return j.create(r,0)}}class Cs extends B{unistNodeName(){return"blockquote"}static proseMirrorNodeName(){return"blockquote"}proseMirrorNodeSpec(){return{content:"block+",group:"block",parseDOM:[{tag:"blockquote"}],toDOM(){return["blockquote",0]}}}proseMirrorInputRules(e){return[We(/^\s{0,3}>\s$/,e.nodes[this.proseMirrorNodeName()])]}proseMirrorKeymap(e){return{"Mod->":mr(e.nodes[this.proseMirrorNodeName()])}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:n}){return _(this.proseMirrorNodeName(),e,t,n)}proseMirrorNodeToUnistNodes(e,t){return[{type:this.unistNodeName(),children:t}]}}function Es(r,e,t,n){for(let s=0;s<e.length;s++){let{$from:o,$to:i}=e[s],a=o.depth===0?r.inlineContent&&r.type.allowsMarkType(t):!1;if(r.nodesBetween(o.pos,i.pos,(c,u)=>{if(a||!n)return!1;a=c.inlineContent&&c.type.allowsMarkType(t)}),a)return!0}return!1}function xt(r){return/^\s*/.exec(r)?.[0]?.length??0}function Ct(r){return/\s*$/.exec(r)?.[0]?.length??0}function bs(r,e,t){for(;e>0;){const n=e-1;if(!r.rangeHasMark(n,e,t))break;e=n}return e}function vs(r,e,t){for(;e<r.content.size&&r.rangeHasMark(e,e+1,t);)e+=1;return e}function Ps(r,e,t,n=null){const{selection:s}=r;if(!(s instanceof j))return!1;let{empty:o,$cursor:i,ranges:a}=s;if(o&&!i||!Es(r.doc,a,t,!0))return!1;if(i)t.isInSet(r.storedMarks||i.marks())?e(r.tr.removeStoredMark(t)):e(r.tr.addStoredMark(t.create(n)));else{let c=r.tr;const u=!a.some(l=>r.doc.rangeHasMark(l.$from.pos,l.$to.pos,t));for(let l=0;l<a.length;l++){let{$from:d,$to:h}=a[l],p=d.pos,f=h.pos;const g=r.doc.textBetween(p,f,`
`);if(/^\s*$/.test(g))continue;const k=d.nodeBefore?.text??"",b=d.nodeAfter?.text??"",y=h.nodeBefore?.text??"",x=h.nodeAfter?.text??"";if(u){let w=xt(b),v=Ct(y);p+w<f&&(p+=w,f-=v),p=bs(r.doc,p,t),f=vs(r.doc,f,t),c.removeMark(p,f,r.schema.marks[Ie.proseMirrorMarkName()]),c.addMark(p,f,t.create(n))}else{const w=Ct(k),v=xt(x);p-=w,f+=v,c.removeMark(p,f,t)}}e(c.scrollIntoView())}return!0}function Et(r,e=null){return(t,n)=>n?Ps(t,n,r,e):!0}class te extends Ut{markType;constructor(e,t){super(e,(n,s,o,i)=>this.markHandler(n,s,o,i)),this.markType=t}static markApplies(e,t,n){for(const s of t){const{$from:o,$to:i}=s;let a=o.depth===0?e.type.allowsMarkType(n):!1;if(e.nodesBetween(o.pos,i.pos,c=>a?!1:(a=c.inlineContent&&c.type.allowsMarkType(n),!0)),a)return!0}return!1}markHandler(e,t,n,s){if(!(e.selection instanceof j))return null;const o=e.doc.resolve(n),i=e.doc.resolve(s),a=[new gr(o,i)];if(!te.markApplies(e.doc,a,this.markType))return null;const c=e.doc.nodeAt(n)?.marks.map(l=>l.type)??[];c.push(this.markType);const u=e.tr.replaceWith(n,s,this.markType.schema.text(t[1]));for(const l of c)u.addMark(u.mapping.map(n),u.mapping.map(s),l.create(null));for(const l of c)u.removeStoredMark(l);return u.insertText(t[2])}}class Ss extends ge{unistNodeName(){return"strong"}static proseMirrorMarkName(){return"strong"}proseMirrorMarkSpec(){return{parseDOM:[{tag:"b"},{tag:"strong"},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}],toDOM(){return["strong"]}}}proseMirrorInputRules(e){return[new te(/\*\*([^\s](?:.*[^\s])?)\*\*([\s\S])$/,e.marks[this.proseMirrorMarkName()]),new te(/__([^\s](?:.*[^\s])?)__([\s\S])$/,e.marks[this.proseMirrorMarkName()])]}proseMirrorKeymap(e){const t=e.marks[this.proseMirrorMarkName()];return{"Mod-b":Et(t),"Mod-B":Et(t)}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:n}){return t.map(s=>s.mark(s.marks.concat([e.marks[this.proseMirrorMarkName()].create(n)])))}processConvertedUnistNode(e){return{type:this.unistNodeName(),children:[e]}}}const on=92,Ts=10,Te="backslashEscape";function Rs(r,e,t){function n(s){return s==null||s===Ts?(r.exit(Te),e(s)):t(s)}return s=>s!==on?t(s):(r.enter(Te),r.consume(s),n)}function Ds(){return{text:{[on]:{name:Te,tokenize:Rs}}}}function Is(){const r=this.data();r.micromarkExtensions??=[],r.micromarkExtensions.push(Ds()),r.fromMarkdownExtensions??=[],r.fromMarkdownExtensions.push({enter:{[Te](e){this.enter({type:"break"},e),this.exit(e)}}})}class As extends B{unistNodeName(){return"break"}static proseMirrorNodeName(){return"hard_break"}proseMirrorNodeSpec(){return{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],marks:Ie.proseMirrorMarkName(),toDOM(){return["br"]}}}proseMirrorKeymap(e){const t=jt(Mr,(s,o)=>(o&&o(s.tr.replaceSelectionWith(e.nodes[this.proseMirrorNodeName()].create()).scrollIntoView()),!0)),n=Rn()||Dn();return{"Mod-Enter":t,"Shift-Enter":t,...n&&{"Ctrl-Enter":t}}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:n}){return _(this.proseMirrorNodeName(),e,t,n)}proseMirrorNodeToUnistNodes(){return[{type:this.unistNodeName()}]}unifiedInitializationHook(e){return e.use(Is)}}const Ae="code_block",bt="```\n";function Bs(r,e){const{start:t,end:n}=r;return t==null||n==null?null:{start:t+bt.length+(e.lang??"").length,end:n-bt.length}}class Fe extends B{dependencies(){return[new Ge]}unistNodeName(){return"code"}static proseMirrorNodeName(){return Ae}proseMirrorNodeSpec(){return{content:"text*",group:"block",code:!0,defining:!0,marks:[Ie.proseMirrorMarkName()].join(" "),attrs:{lang:{default:null},isDarkMode:{default:null}},parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM(){return["pre",["code",0]]}}}proseMirrorInputRules(e){return[qn(/^\s{0,3}```$/,e.nodes[this.proseMirrorNodeName()])]}unistNodeToProseMirrorNodes({node:e,attrs:t,schema:n}){const{lang:s}=e;return _(this.proseMirrorNodeName(),n,Zt(e,n,{...t,...Bs(t,e)??{}}),{lang:s,...t})}proseMirrorNodeToUnistNodes(e,t){return[{type:this.unistNodeName(),value:t.map(n=>n.type==="startend"?n.children.map(s=>s.value).join(""):n.value).join(""),lang:e.attrs.lang}]}}class an extends B{unistNodeName(){return"textDirective"}customDirectiveName(){return le}static proseMirrorNodeName(){return le}proseMirrorNodeSpec(){return{group:"inline",inline:!0,content:"inline*",atom:!0,attrs:{index:{default:null},displayLayout:{default:"inline"}},toDOM:e=>["span",{"data-type":"content-reference","data-content-reference-index":e.attrs.index,"data-display-layout":e.attrs.displayLayout},`:contentReference[oaicite:${e.attrs.index}]{index="${e.attrs.index}" displayLayout="${e.attrs.displayLayout}"}`],parseDOM:[{tag:'span[data-type="content-reference"]',getAttrs(e){return{index:e.getAttribute("data-index"),displayLayout:e.getAttribute("data-display-layout")||"inline"}}}]}}unistNodeToProseMirrorNodes({node:e,schema:t,convertedChildren:n}){if(!en(e)||e.name!==le||e.type!==this.unistNodeName())return Vt.addError("ContentReferenceExtension: unistNodeToProseMirrorNodes: node is not a directive node or name is not contentReference",e),null;const s={index:e.attributes?.index,displayLayout:e.attributes?.displayLayout??"inline"};return t.nodes.contentReference.create(s,n)}proseMirrorNodeToUnistNodes(e,t){if(t.length!==1)return console.warn("ContentReferenceExtension: proseMirrorNodeToUnistNodes: convertedChildren.length != 1",t),[];const o=[{type:"text",value:t[0].children[0].value}];return[{type:"textDirective",name:le,attributes:{index:e.attrs.index,displayLayout:e.attrs.displayLayout},children:o,data:{hName:le,hProperties:{displayLayout:e.attrs.displayLayout,index:e.attrs.index}}}]}}class Os extends B{unistNodeName(){return"thematicBreak"}static proseMirrorNodeName(){return"horizontal_rule"}proseMirrorNodeSpec(){return{group:"block",parseDOM:[{tag:"hr"}],toDOM(){return["div",["hr"]]}}}proseMirrorInputRules(e){return[new Ut(/^\s{0,3}(?:\*\*\*|---|___)\n$/,(t,n,s,o)=>t.tr.replaceWith(s,o,_(this.proseMirrorNodeName(),e,[])??[]))]}proseMirrorKeymap(e){return{"Mod-_":(t,n)=>(n&&n(t.tr.replaceSelectionWith(e.nodes[this.proseMirrorNodeName()].create()).scrollIntoView()),!0)}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:n}){return _(this.proseMirrorNodeName(),e,t,n)}proseMirrorNodeToUnistNodes(){return[{type:this.unistNodeName()}]}}class _s extends ge{unistNodeName(){return"inlineCode"}static proseMirrorMarkName(){return"code"}proseMirrorMarkSpec(){return{inclusive:!1,parseDOM:[{tag:"code"}],toDOM(){return["code"]}}}proseMirrorInputRules(e){return[new te(/`([^\s](?:.*[^\s])?)`([\s\S])$/,e.marks[this.proseMirrorMarkName()])]}proseMirrorKeymap(e){const t=e.marks[this.proseMirrorMarkName()];return{"Ctrl-`":$e(t)}}unistNodeToProseMirrorNodes({node:e,schema:t,attrs:n}){const s=Zt(e,t,n,[t.marks[this.proseMirrorMarkName()].create(n)]);return s?[s]:[]}processConvertedUnistNode(e){return{type:this.unistNodeName(),value:e.value}}}class Ls extends B{unistNodeName(){return"inlineMath"}static proseMirrorNodeName(){return"inline_math"}proseMirrorNodeSpec(){return{group:"inline",inline:!0,content:"text*",atom:!0,attrs:{latex:{default:null}},parseDOM:[{tag:"span.inline-math",getAttrs(e){return{latex:e.getAttribute("latex")}}}],toDOM(){return["span",{class:"inline-math"},0]}}}unistNodeToProseMirrorNodes({node:e,schema:t,convertedChildren:n,attrs:s}){const{value:o}=e;return _(this.proseMirrorNodeName(),t,n,{...s,latex:o})}proseMirrorNodeToUnistNodes(e){return[{type:this.unistNodeName(),value:e.attrs.latex}]}}class Vs extends ge{unistNodeName(){return"emphasis"}static proseMirrorMarkName(){return"em"}proseMirrorMarkSpec(){return{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style",getAttrs:e=>e==="italic"&&null}],toDOM(){return["em"]}}}proseMirrorInputRules(e){try{return[new te(new RegExp("(?<!\\*)\\*([^\\s*](?:.*[^\\s])?)\\*([^*])$"),e.marks[this.proseMirrorMarkName()]),new te(new RegExp("(?<!_)_([^\\s_](?:.*[^\\s])?)_([^_])$"),e.marks[this.proseMirrorMarkName()])]}catch(t){return Vt.addError(t),[]}}proseMirrorKeymap(e){const t=e.marks[this.proseMirrorMarkName()];return{"Mod-i":$e(t),"Mod-I":$e(t)}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:n}){return t.map(s=>s.mark(s.marks.concat([e.marks[this.proseMirrorMarkName()].create(n)])))}processConvertedUnistNode(e){return{type:this.unistNodeName(),children:[e]}}}function cn(r){return"children"in r}const he="lineEndingBlank";function vt(r){return r.type===he}const $s=({startIndex:r,endIndex:e,depth:t,isLastChild:n,parent:s=null})=>{const o=e-r;return t>0&&s?.type!=="list"?o:n||r===0?o-Math.floor((o+1)/2):o-Math.floor((o-1)/2)};function Us(){const r=this.data();r.fromMarkdownExtensions??=[],r.fromMarkdownExtensions.push({enter:{lineEndingBlank(t){this.enter({type:he},t)}},exit:{lineEndingBlank(t){this.exit(t)}}});const e=(t,n=0)=>{if(!cn(t))return;const{children:s}=t;let o=0,i=null,a=null;const c=s.length;for(let u=0;u<c;u++){const l=s[u-o];e(l,n+1);const{type:d}=l,p=u===c-1&&d===he;if(d===he&&i==null?i=u:d!==he&&i!=null?a=u:p&&i!=null&&(a=u+1),i!=null&&a!=null){const f=$s({startIndex:i,endIndex:a,depth:n,isLastChild:p,parent:t});s.splice(i-o,f),i=null,a=null,o+=f}}};return t=>{e(t)}}class zs extends B{unistNodeName(){return he}static proseMirrorNodeName(){return"paragraph"}proseMirrorNodeSpec(){return Xn}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:n}){return _(this.proseMirrorNodeName(),e,t,n)}proseMirrorNodeToUnistNodes(e,t){return[{type:Yn,children:t}]}unifiedInitializationHook(e){return e.use(Us)}}function ln(r,e=null){return function(t,n){let{$from:s,$to:o}=t.selection,i=s.blockRange(o),a=!1,c=i;if(!i)return!1;if(i.depth>=2&&s.node(i.depth-1).type.compatibleContent(r)&&i.startIndex==0){if(s.index(i.depth-1)==0)return!1;let l=t.doc.resolve(i.start-2);c=new Ue(l,l,i.depth),i.endIndex<i.parent.childCount&&(i=new Ue(s,t.doc.resolve(o.end(i.depth)),i.depth)),a=!0}let u=Nr(c,r,e,i);return u?(n&&n(Hs(t.tr,i,u,a,r).scrollIntoView()),!0):!1}}function Hs(r,e,t,n,s){let o=D.empty;for(let l=t.length-1;l>=0;l--)o=D.from(t[l].type.create(t[l].attrs,o));r.step(new ye(e.start-(n?2:0),e.end,e.start,e.end,new Me(o,0,0),t.length,!0));let i=0;for(let l=0;l<t.length;l++)t[l].type==s&&(i=l+1);let a=t.length-i,c=e.start+t.length-(n?2:0),u=e.parent;for(let l=e.startIndex,d=e.endIndex,h=!0;l<d;l++,h=!1)!h&&Gt(r.doc,c,a)&&(r.split(c,a),c+=2*a),c+=u.child(l).nodeSize;return r}function Fs(r,e){return function(t,n){let{$from:s,$to:o,node:i}=t.selection;if(i&&i.isBlock||s.depth<2||!s.sameParent(o))return!1;let a=s.node(-1);if(a.type!=r)return!1;if(s.parent.content.size==0&&s.node(-1).childCount==s.indexAfter(-1)){if(s.depth==3||s.node(-3).type!=r||s.index(-2)!=s.node(-2).childCount-1)return!1;if(n){let d=D.empty,h=s.index(-1)?1:s.index(-2)?2:3;for(let b=s.depth-h;b>=s.depth-3;b--)d=D.from(s.node(b).copy(d));let p=s.indexAfter(-1)<s.node(-2).childCount?1:s.indexAfter(-2)<s.node(-3).childCount?2:3;d=d.append(D.from(r.createAndFill()));let f=s.before(s.depth-(h-1)),g=t.tr.replace(f,s.after(-p),new Me(d,4-h,0)),k=-1;g.doc.nodesBetween(f,g.doc.content.size,(b,y)=>{if(k>-1)return!1;b.isTextblock&&b.content.size==0&&(k=y+1)}),k>-1&&g.setSelection(qe.near(g.doc.resolve(k))),n(g.scrollIntoView())}return!0}let c=o.pos==s.end()?a.contentMatchAt(0).defaultType:null,u=t.tr.delete(s.pos,o.pos),l=c?[null,{type:c}]:void 0;return Gt(u.doc,s.pos,2,l)?(n&&n(u.split(s.pos,2,l).scrollIntoView()),!0):!1}}function Ks(r){return function(e,t){let{$from:n,$to:s}=e.selection,o=n.blockRange(s,i=>i.childCount>0&&i.firstChild.type==r);return o?t?n.node(o.depth-1).type==r?js(e,t,r,o):Gs(e,t,o):!0:!1}}function js(r,e,t,n){let s=r.tr,o=n.end,i=n.$to.end(n.depth);o<i&&(s.step(new ye(o-1,i,o,i,new Me(D.from(t.create(null,n.parent.copy())),1,0),1,!0)),n=new Ue(s.doc.resolve(n.$from.pos),s.doc.resolve(i),n.depth));const a=kr(n);if(a==null)return!1;s.lift(n,a);let c=s.mapping.map(o,-1)-1;return wr(s.doc,c)&&s.join(c),e(s.scrollIntoView()),!0}function Gs(r,e,t){let n=r.tr,s=t.parent;for(let p=t.end,f=t.endIndex-1,g=t.startIndex;f>g;f--)p-=s.child(f).nodeSize,n.delete(p-1,p+1);let o=n.doc.resolve(t.start),i=o.nodeAfter;if(n.mapping.map(t.end)!=t.start+o.nodeAfter.nodeSize)return!1;let a=t.startIndex==0,c=t.endIndex==s.childCount,u=o.node(-1),l=o.index(-1);if(!u.canReplace(l+(a?0:1),l+1,i.content.append(c?D.empty:D.from(s))))return!1;let d=o.pos,h=d+i.nodeSize;return n.step(new ye(d-(a?1:0),h+(c?1:0),d+1,h-1,new Me((a?D.empty:D.from(s.copy(D.empty))).append(c?D.empty:D.from(s.copy(D.empty))),a?0:1,c?0:1),a?0:1)),e(n.scrollIntoView()),!0}function Ws(r){return function(e,t){let{$from:n,$to:s}=e.selection,o=n.blockRange(s,u=>u.childCount>0&&u.firstChild.type==r);if(!o)return!1;let i=o.startIndex;if(i==0)return!1;let a=o.parent,c=a.child(i-1);if(c.type!=r)return!1;if(t){let u=c.lastChild&&c.lastChild.type==a.type,l=D.from(u?r.create():null),d=new Me(D.from(r.create(null,D.from(a.type.create(null,l)))),u?3:1,0),h=o.start,p=o.end;t(e.tr.step(new ye(h-(u?3:1),p,h,p,d,1,!0)).scrollIntoView())}return!0}}class et extends B{unistNodeName(){return"listItem"}static proseMirrorNodeName(){return"regular_list_item"}proseMirrorNodeSpec(){return{content:"paragraph block*",defining:!0,group:"list_item",parseDOM:[{tag:"li"}],toDOM(){return["li",0]}}}unistToProseMirrorTest(e){return e.type===this.unistNodeName()&&(!("checked"in e)||typeof e.checked!="boolean")}proseMirrorKeymap(e){const t=e.nodes[this.proseMirrorNodeName()];return{Enter:Fs(t),"Shift-Tab":Ks(t),Tab:Ws(t)}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:n}){return _(this.proseMirrorNodeName(),e,t,n)}proseMirrorNodeToUnistNodes(e,t){return[{type:this.unistNodeName(),children:t}]}}class qs extends B{unistNodeName(){return"math"}static proseMirrorNodeName(){return"math_block"}proseMirrorNodeSpec(){return{group:"block",content:"text*",atom:!0,code:!0,attrs:{latex:{default:null}},parseDOM:[{tag:"div.math-block",getAttrs(e){return{latex:e.getAttribute("latex")}}}],toDOM(){return["div",{class:"math-block"},0]}}}unistNodeToProseMirrorNodes({node:e,schema:t,convertedChildren:n,attrs:s}){const{value:o}=e;return _(this.proseMirrorNodeName(),t,n,{...s,latex:o})}proseMirrorNodeToUnistNodes(e){return[{type:this.unistNodeName(),value:e.attrs.latex}]}}class Xs extends B{dependencies(){return[new et]}unistNodeName(){return"list"}unistToProseMirrorTest(e){return e.type===this.unistNodeName()&&e.ordered===!0}static proseMirrorNodeName(){return"ordered_list"}proseMirrorNodeSpec(){return{content:"list_item+",group:"block",attrs:{spread:{default:!1},startingNumber:{default:1}},parseDOM:[{getAttrs(e){const t=e.getAttribute("start");return{spread:e.getAttribute("data-spread")==="true",startingNumber:t!=null?parseInt(t):1}},tag:"ol"}],toDOM(e){return["ol",{"data-spread":e.attrs.spread,start:e.attrs.startingNumber},0]}}}proseMirrorInputRules(e){return[We(/^\s{0,3}(\d+)\.\s$/,e.nodes[this.proseMirrorNodeName()],t=>({startingNumber:+t[1]}),(t,n)=>n.childCount+n.attrs.startingNumber===+t[1])]}proseMirrorKeymap(e){return{"Shift-Mod-9":ln(e.nodes[this.proseMirrorNodeName()])}}unistNodeToProseMirrorNodes({node:e,schema:t,convertedChildren:n,attrs:s}){const{spread:o,start:i}=e;return _(this.proseMirrorNodeName(),t,n,{...s,spread:o,startingNumber:i??1})}proseMirrorNodeToUnistNodes(e,t){const n=e.attrs.spread;return[{type:this.unistNodeName(),ordered:!0,spread:n,start:e.attrs.startingNumber,children:t.map(s=>(s.spread=n,s))}]}}class Ys extends ge{unistNodeName(){return"delete"}static proseMirrorMarkName(){return"strikethrough"}proseMirrorMarkSpec(){return{parseDOM:[{tag:"s"},{tag:"del"},{style:"text-decoration",getAttrs:e=>/(^|[\s])line-through([\s]|$)/.test(e)&&null}],toDOM(){return["s"]}}}proseMirrorInputRules(e){return[new te(/~([^\s](?:.*[^\s~])?)~([^~])$/,e.marks[this.proseMirrorMarkName()]),new te(/~~([^\s](?:.*[^\s])?)~~([\s\S])$/,e.marks[this.proseMirrorMarkName()])]}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t}){return t.map(n=>n.mark(n.marks.concat([e.marks[this.proseMirrorMarkName()].create()])))}processConvertedUnistNode(e){return{type:this.unistNodeName(),children:[e]}}}function Zs(){return r=>{let e=-1;function t(s,o){if(s.type==="tableRow"&&e++,s.type==="tableCell"){const i=s;i.data={...i.data??{},rowIndex:e,columnIndex:o}}}function n(s){if(cn(s))for(let o=0;o<s.children.length;o++){const i=s.children[o];t(i,o),n(i)}}n(r)}}class un extends B{unistNodeName(){return"tableCell"}unistToProseMirrorTest(e){return e.type===this.unistNodeName()}static proseMirrorNodeName(){return"table_cell"}proseMirrorNodeSpec(){return{content:"inline*",attrs:{rowIndex:{default:null},columnIndex:{default:null},colspan:{default:1},rowspan:{default:1}},tableRole:"cell",isolating:!0,parseDOM:[{tag:"td",getAttrs(e){const t=e;return{colspan:pt(t.getAttribute("colspan"),1),rowspan:pt(t.getAttribute("rowspan"),1)}}}],toDOM(e){const{colspan:t,rowspan:n}=e.attrs,s={colspan:t!==1?ht(t,void 0):void 0,rowspan:n!==1?ht(n,void 0):void 0};return[e.attrs.rowIndex==null||e.attrs.rowIndex>0?"td":"th",s,0]}}}proseMirrorInputRules(e){return[]}proseMirrorKeymap(e){return{}}unistNodeToProseMirrorNodes({node:e,schema:t,convertedChildren:n,attrs:s}){return _(this.proseMirrorNodeName(),t,n,{...s,colspan:1,rowspan:1,rowIndex:e.data?.rowIndex,columnIndex:e.data?.columnIndex})}proseMirrorNodeToUnistNodes(e,t){return[{type:this.unistNodeName(),children:t,data:{rowIndex:e.attrs.rowIndex,columnIndex:e.attrs.columnIndex}}]}}class dn extends B{dependencies(){return[new un]}unistNodeName(){return"tableRow"}static proseMirrorNodeName(){return"table_row"}proseMirrorNodeSpec(){return{content:"(table_cell+)",tableRole:"row",parseDOM:[{tag:"tr"}],toDOM(){return["tr",0]}}}proseMirrorInputRules(e){return[]}proseMirrorKeymap(e){return{}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:n}){return _(this.proseMirrorNodeName(),e,t,n)}proseMirrorNodeToUnistNodes(e,t){return[{type:this.unistNodeName(),children:t}]}}class Js extends B{dependencies(){return[new dn]}unistNodeName(){return"table"}static proseMirrorNodeName(){return"table"}proseMirrorNodeSpec(){return{content:"(table_row+)",tableRole:"table",isolating:!0,group:"block",parseDOM:[{tag:"table"}],toDOM(){return["table",["tbody",0]]}}}proseMirrorInputRules(e){return[]}proseMirrorKeymap(e){return{}}unistNodeToProseMirrorNodes({schema:e,convertedChildren:t,attrs:n}){return _(this.proseMirrorNodeName(),e,t,n)}proseMirrorNodeToUnistNodes(e,t){return[{type:this.unistNodeName(),align:[],children:t}]}unifiedInitializationHook(e){return e.use(Zs)}}class Qs extends B{dependencies(){return[new et]}unistNodeName(){return"list"}unistToProseMirrorTest(e){return e.type===this.unistNodeName()&&e.ordered!==!0}static proseMirrorNodeName(){return"list"}proseMirrorNodeSpec(){return{content:"list_item+",group:"block",attrs:{spread:{default:!1}},parseDOM:[{getAttrs(e){return{spread:e.getAttribute("data-spread")==="true"}},tag:"ul"}],toDOM(e){return["ul",{"data-spread":e.attrs.spread},0]}}}proseMirrorInputRules(e){return[We(/^\s{0,3}([-+*])\s$/,e.nodes[this.proseMirrorNodeName()])]}proseMirrorKeymap(e){return{"Shift-Mod-8":ln(e.nodes[this.proseMirrorNodeName()])}}unistNodeToProseMirrorNodes({node:e,schema:t,convertedChildren:n,attrs:s}){const{spread:o}=e;return _(this.proseMirrorNodeName(),t,n,{...s,spread:o})}proseMirrorNodeToUnistNodes(e,t){const n=e.attrs.spread;return[{type:this.unistNodeName(),ordered:!1,spread:n,children:t.map(s=>(s.spread=n,s))}]}}function Pt(r,e){if(!(r==null||e==null))return{start:{...r},end:{...e}}}const eo=()=>r=>{Jt(r,"list",(e,t,n)=>{if(n==null||t==null)return;const s=[];let o=[],i=0;for(;i<e.children.length;){const a=e.children[i];if(vt(a)){const c=[];for(;i<e.children.length&&vt(e.children[i]);)c.push(e.children[i]),i++;if(o.length===0)throw new Error("Unexpected state: currentListItems is empty after encountering blank lines.");const u=o[0],l=De($t(o)),d=Pt(u.position?.start??e.position?.start,l.position?.end??e.position?.end),h={type:"list",ordered:e.ordered,start:e.start,spread:e.spread,children:o,position:d};s.push(h),o=[],s.push(...c.map(p=>({type:"lineEndingBlank",position:p.position})))}else o.push(a),i++}if(o.length>0){const a=o[0],c=o[o.length-1],u=Pt(a.position?.start??e.position?.start,c.position?.end??e.position?.end),l={type:"list",ordered:e.ordered,start:e.start,spread:e.spread,children:o,position:u};s.push(l)}n.children.splice(t,1,...s)})};var St={}.hasOwnProperty;function to(r,e){var t=e||{};function n(s){var o=n.invalid,i=n.handlers;if(s&&St.call(s,r)&&(o=St.call(i,s[r])?i[s[r]]:n.unknown),o)return o.apply(this,arguments)}return n.handlers=t.handlers||{},n.invalid=t.invalid,n.unknown=t.unknown,n}const no={}.hasOwnProperty;function pn(r,e){let t=-1,n;if(e.extensions)for(;++t<e.extensions.length;)pn(r,e.extensions[t]);for(n in e)if(no.call(e,n))switch(n){case"extensions":break;case"unsafe":{Tt(r[n],e[n]);break}case"join":{Tt(r[n],e[n]);break}case"handlers":{ro(r[n],e[n]);break}default:r.options[n]=e[n]}return r}function Tt(r,e){e&&r.push(...e)}function ro(r,e){e&&Object.assign(r,e)}const so=[oo];function oo(r,e,t,n){if(e.type==="code"&&mt(e,n)&&(r.type==="list"||r.type===e.type&&mt(r,n)))return!1;if("spread"in t&&typeof t.spread=="boolean")return r.type==="paragraph"&&(r.type===e.type||e.type==="definition"||e.type==="heading"&&$r(e,n))?void 0:t.spread?1:0}const ae=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"],io=[{character:"	",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",before:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"\r",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:`
`,inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:" ",after:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",before:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"!",after:"\\[",inConstruct:"phrasing",notInConstruct:ae},{character:'"',inConstruct:"titleQuote"},{atBreak:!0,character:"#"},{character:"#",inConstruct:"headingAtx",after:`(?:[\r
]|$)`},{character:"&",after:"[#A-Za-z]",inConstruct:"phrasing"},{character:"'",inConstruct:"titleApostrophe"},{character:"(",inConstruct:"destinationRaw"},{before:"\\]",character:"(",inConstruct:"phrasing",notInConstruct:ae},{atBreak:!0,before:"\\d+",character:")"},{character:")",inConstruct:"destinationRaw"},{atBreak:!0,character:"*",after:`(?:[ 	\r
*])`},{character:"*",inConstruct:"phrasing",notInConstruct:ae},{atBreak:!0,character:"+",after:`(?:[ 	\r
])`},{atBreak:!0,character:"-",after:`(?:[ 	\r
-])`},{atBreak:!0,before:"\\d+",character:".",after:`(?:[ 	\r
]|$)`},{atBreak:!0,character:"<",after:"[!/?A-Za-z]"},{character:"<",after:"[!/?A-Za-z]",inConstruct:"phrasing",notInConstruct:ae},{character:"<",inConstruct:"destinationLiteral"},{atBreak:!0,character:"="},{atBreak:!0,character:">"},{character:">",inConstruct:"destinationLiteral"},{atBreak:!0,character:"["},{character:"[",inConstruct:"phrasing",notInConstruct:ae},{character:"[",inConstruct:["label","reference"]},{character:"\\",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"]",inConstruct:["label","reference"]},{atBreak:!0,character:"_"},{character:"_",inConstruct:"phrasing",notInConstruct:ae},{atBreak:!0,character:"`"},{character:"`",inConstruct:["codeFencedLangGraveAccent","codeFencedMetaGraveAccent"]},{character:"`",inConstruct:"phrasing",notInConstruct:ae},{atBreak:!0,character:"~"}];function ao(r){return r.label||!r.identifier?r.label||"":Xr(r.identifier)}function co(r){if(!r._compiled){const e=(r.atBreak?"[\\r\\n][\\t ]*":"")+(r.before?"(?:"+r.before+")":"");r._compiled=new RegExp((e?"("+e+")":"")+(/[|\\{}()[\]^$+*?.-]/.test(r.character)?"\\":"")+r.character+(r.after?"(?:"+r.after+")":""),"g")}return r._compiled}function lo(r,e,t){const n=e.indexStack,s=r.children||[],o=[];let i=-1,a=t.before;n.push(-1);let c=e.createTracker(t);for(;++i<s.length;){const u=s[i];let l;if(n[n.length-1]=i,i+1<s.length){let d=e.handle.handlers[s[i+1].type];d&&d.peek&&(d=d.peek),l=d?d(s[i+1],r,e,{before:"",after:"",...c.current()}).charAt(0):""}else l=t.after;o.length>0&&(a==="\r"||a===`
`)&&u.type==="html"&&(o[o.length-1]=o[o.length-1].replace(/(\r?\n|\r)$/," "),a=" ",c=e.createTracker(t),c.move(o.join(""))),o.push(c.move(e.handle(u,r,e,{...c.current(),before:a,after:l}))),a=o[o.length-1].slice(-1)}return n.pop(),o.join("")}function uo(r,e,t){const n=e.indexStack,s=r.children||[],o=e.createTracker(t),i=[];let a=-1;for(n.push(-1);++a<s.length;){const c=s[a];n[n.length-1]=a,i.push(o.move(e.handle(c,r,e,{before:`
`,after:`
`,...o.current()}))),c.type!=="list"&&(e.bulletLastUsed=void 0),a<s.length-1&&i.push(o.move(po(c,s[a+1],r,e)))}return n.pop(),i.join("")}function po(r,e,t,n){let s=n.join.length;for(;s--;){const o=n.join[s](r,e,t,n);if(o===!0||o===1)break;if(typeof o=="number")return`
`.repeat(1+o);if(o===!1)return`

<!---->

`}return`

`}const ho=/\r?\n|\r/g;function fo(r,e){const t=[];let n=0,s=0,o;for(;o=ho.exec(r);)i(r.slice(n,o.index)),t.push(o[0]),n=o.index+o[0].length,s++;return i(r.slice(n)),t.join("");function i(a){t.push(e(a,s,!a))}}function mo(r,e,t){const n=(t.before||"")+(e||"")+(t.after||""),s=[],o=[],i={};let a=-1;for(;++a<r.unsafe.length;){const l=r.unsafe[a];if(!Ur(r.stack,l))continue;const d=r.compilePattern(l);let h;for(;h=d.exec(n);){const p="before"in l||!!l.atBreak,f="after"in l,g=h.index+(p?h[1].length:0);s.includes(g)?(i[g].before&&!p&&(i[g].before=!1),i[g].after&&!f&&(i[g].after=!1)):(s.push(g),i[g]={before:p,after:f})}}s.sort(go);let c=t.before?t.before.length:0;const u=n.length-(t.after?t.after.length:0);for(a=-1;++a<s.length;){const l=s[a];l<c||l>=u||l+1<u&&s[a+1]===l+1&&i[l].after&&!i[l+1].before&&!i[l+1].after||s[a-1]===l-1&&i[l].before&&!i[l-1].before&&!i[l-1].after||(c!==l&&o.push(Rt(n.slice(c,l),"\\")),c=l,/[!-/:-@[-`{-~]/.test(n.charAt(l))&&(!t.encode||!t.encode.includes(n.charAt(l)))?o.push("\\"):(o.push("&#x"+n.charCodeAt(l).toString(16).toUpperCase()+";"),c++))}return o.push(Rt(n.slice(c,u),t.after)),o.join("")}function go(r,e){return r-e}function Rt(r,e){const t=/\\(?=[!-/:-@[-`{-~])/g,n=[],s=[],o=r+e;let i=-1,a=0,c;for(;c=t.exec(o);)n.push(c.index);for(;++i<n.length;)a!==n[i]&&s.push(r.slice(a,n[i])),s.push("\\"),a=n[i];return s.push(r.slice(a)),s.join("")}function Mo(r){const e=r||{},t=e.now||{};let n=e.lineShift||0,s=t.line||1,o=t.column||1;return{move:c,current:i,shift:a};function i(){return{now:{line:s,column:o},lineShift:n}}function a(u){n+=u}function c(u){const l=u||"",d=l.split(/\r?\n|\r/g),h=d[d.length-1];return s+=d.length-1,o=d.length===1?o+h.length:1+h.length+n,l}}function No(r,e={}){const t={enter:s,indentLines:fo,associationId:ao,containerPhrasing:xo,containerFlow:Co,createTracker:Mo,compilePattern:co,safe:Eo,stack:[],unsafe:[...io],join:[...so],handlers:{...zr},options:{},indexStack:[],handle:void 0};pn(t,e),t.options.tightDefinitions&&t.join.push(yo),t.handle=to("type",{invalid:ko,unknown:wo,handlers:t.handlers});let n=t.handle(r,void 0,t,{before:`
`,after:`
`,now:{line:1,column:1},lineShift:0});return n&&n.charCodeAt(n.length-1)!==10&&n.charCodeAt(n.length-1)!==13&&(n+=`
`),n;function s(o){return t.stack.push(o),i;function i(){t.stack.pop()}}}function ko(r){throw new Error("Cannot handle value `"+r+"`, expected node")}function wo(r){const e=r;throw new Error("Cannot handle unknown node `"+e.type+"`")}function yo(r,e){if(r.type==="definition"&&r.type===e.type)return 0}function xo(r,e){return lo(r,this,e)}function Co(r,e){return uo(r,this,e)}function Eo(r,e){return mo(this,r,e)}const bo=(r,e,t,n)=>r.children.map(s=>t.handle(s,void 0,t,n)).join(""),vo=(r,e,t,n)=>t.safe(r.value,n).replaceAll("\\[","[").replaceAll("\\&","&"),Po=r=>`\\(${r.value}\\)`;function So(){const r=this;r.compiler=e;function e(t){return No(t,{...r.data("settings"),fences:!0,bullet:"-",bulletOther:"*",listItemIndent:"one",resourceLink:!0,tightDefinitions:!0,rule:"-",handlers:{text:vo,startend:bo,inlineMath:Po},extensions:r.data("toMarkdownExtensions")||[]})}}const To=[le],Ro=()=>r=>{Jt(r,"textDirective",e=>{To.includes(e.name)||(e.type="text",e.value=`:${e.name}`)})},Do=[Yr,Hr,[Fr,{singleDollarTextMath:!1}],Kr,jr,Gr,Ro,eo,So];class Io extends ir{dependencies(){const e=Xe(),t=Wt();return[new zs,new Zn,new Cs,new Ss,new As,new Fe,new Jn,new Os,new _s,...t?[new Ls,new qs]:[],new Vs,new tn,new et,new Xs,new Qn,new Ge,new Qs,new Ys,new Ie,new Js,new dn,new un,...e?[new an]:[]]}unifiedInitializationHook(e){return e.use(Do)}}class Ao{rules;constructor(e,t){this.rules=[].concat.apply([],e.syntaxExtensions().map(n=>n.proseMirrorInputRules(t)))}build(){return er({rules:this.rules})}}class Bo{keymap;constructor(e,t){this.keymap=new Map;for(const n of e.syntaxExtensions())this.addKeymap(n.proseMirrorKeymap(t));this.addKeymap(yr)}build(){const e={};return this.keymap.forEach((t,n)=>{e[n]=jt(...t)}),Ye(e)}addKeymap(e){for(const t in e)this.keymap.get(t)||this.keymap.set(t,[]),De(this.keymap.get(t)).push(e[t])}}class Oo{nodeViews;constructor(e){this.nodeViews={};for(const t of e.nodeExtensions()){const n=t.proseMirrorNodeName(),s=t.proseMirrorNodeView();n!==an.proseMirrorNodeName()&&n!=null&&s!=null&&(this.nodeViews[n]=s)}}build(){return this.nodeViews}}class _o{nodes={};marks={};constructor(e){for(const t of e.nodeExtensions()){const n=t.proseMirrorNodeName(),s=t.proseMirrorNodeSpec();n!=null&&s!=null&&(n!=="text"&&(s.attrs={...s.attrs,start:{default:void 0},end:{default:void 0}}),this.nodes[n]=s)}for(const t of e.markExtensions()){const n=t.proseMirrorMarkName(),s=t.proseMirrorMarkSpec();n!=null&&s!=null&&(this.marks[n]=s)}}build(){return new xr({nodes:this.nodes,marks:this.marks})}}class Lo{extensionManager;constructor(e){this.extensionManager=e}build(){let e=Zr();for(const t of this.extensionManager.extensions())e=t.unifiedInitializationHook(e);return e}}function Vo(r){return r instanceof B}function $o(r){return r instanceof ge}class Uo{markExtensionList;nodeExtensionList;otherExtensionList;constructor(e){this.markExtensionList=new Map,this.nodeExtensionList=new Map,this.otherExtensionList=new Map;for(const t of e)this.add(t)}extensions(){return this.syntaxExtensions().concat(Array.from(this.otherExtensionList.values()))}markExtensions(){return Array.from(this.markExtensionList.values())}getMarkExtension(e){return this.markExtensionList.get(e)??null}nodeExtensions(){return Array.from(this.nodeExtensionList.values())}getNodeExtension(e){return this.nodeExtensionList.get(e)??null}syntaxExtensions(){return this.nodeExtensions().concat(this.markExtensions())}add(e){for(const t of e.dependencies())this.add(t);if($o(e)){this.markExtensionList.set(e.constructor.name,e);return}if(Vo(e)){this.nodeExtensionList.set(e.constructor.name,e);return}this.otherExtensionList.set(e.constructor.name,e)}}class zo{extensionManager;constructor(e){this.extensionManager=e}convert(e){const t=this.convertNode(e);if(t.length!==1)throw new Error("Couldn't find any way to convert the root ProseMirror node.");return t[0]}convertNode(e){let t=null;const n=[];for(const s of this.extensionManager.nodeExtensions()){if(!s.proseMirrorToUnistTest(e))continue;n.push(s);let o=[];for(let i=0;i<e.childCount;++i)o=o.concat(this.convertNode(e.child(i)));t=s.proseMirrorNodeToUnistNodes(e,o)}return t==null?(console.warn(`Couldn't find any way to convert ProseMirror node of type "`+e.type.name+'" to a unist node.'),[]):t.map(s=>{for(const o of e.marks){const{type:{name:i}}=o;if(n.some(u=>{const l=u.proseMirrorNodeSpec()?.marks;return l!=null&&!l.includes(i)}))continue;let c=!1;for(const u of this.extensionManager.markExtensions())o.type.name===u.proseMirrorMarkName()&&(s=u.processConvertedUnistNode(s,o),c=!0);c||console.warn(`Couldn't find any way to convert ProseMirror mark of type "`+i+'" to a unist node.')}return s})}}class tt{extensionManager;proseMirrorSchema;constructor(e,t){this.extensionManager=e,this.proseMirrorSchema=t}static unistNodeIsParent(e){return"children"in e}convert(e){const t={},n=this.convertNode(e,t);for(const s of this.extensionManager.syntaxExtensions())s.postUnistToProseMirrorHook(t);if(n.length!==1)throw new Error("Couldn't find any way to convert the root unist node.");return n[0]}convertNode(e,t){let n=0;const s=(o,i)=>{for(const a of this.extensionManager.syntaxExtensions()){if(!a.unistToProseMirrorTest(o)||en(o)&&a.customDirectiveName()!=null&&a.customDirectiveName()!==o.name)continue;let c=[];tt.unistNodeIsParent(o)&&(c=o.children.flatMap(f=>s(f,i)));const{position:u}=o;let l=u?.start.offset??n,d=u?.end.offset;if(d==null&&"value"in o&&typeof o.value=="string"){const{value:f}=o;d=l+f.length}d==null&&(d=l),n=d;const h={start:l,end:d};return Rr(a.unistNodeToProseMirrorNodes({node:o,schema:this.proseMirrorSchema,convertedChildren:c,context:i,attrs:h})).filter(Dr)}return console.warn(`Couldn't find any way to convert unist node of type "`+o.type+'" to a ProseMirror node.'),[]};return s(e,t)}}const Ho=5;class Fo{builtSchema;inputRulesBuilder;keymapBuilder;nodeViewBuilder;unistToProseMirrorConverter;proseMirrorToUnistConverter;unified;memoizedProsemirrorDocs=new Map;constructor(e=[]){const t=new Uo(e);this.builtSchema=new _o(t).build(),this.inputRulesBuilder=new Ao(t,this.builtSchema),this.keymapBuilder=new Bo(t,this.builtSchema),this.nodeViewBuilder=new Oo(t),this.unistToProseMirrorConverter=new tt(t,this.builtSchema),this.proseMirrorToUnistConverter=new zo(t),this.unified=new Lo(t).build()}parse(e){try{if(this.memoizedProsemirrorDocs.has(e))return De(this.memoizedProsemirrorDocs.get(e));const t=this.unistToProseMirrorConverter.convert(this.parseUnist(e));if(this.memoizedProsemirrorDocs.set(e,t),this.memoizedProsemirrorDocs.size>Ho){const n=this.memoizedProsemirrorDocs.keys().next().value;this.memoizedProsemirrorDocs.delete(n)}return t}catch(t){J.logError("Failed to parse document",t)}return this.schema().text(" ")}parseUnist(e){return this.unified.runSync(this.unified.parse(e))}schema(){return this.builtSchema}inputRulesPlugin(){return this.inputRulesBuilder.build()}keymapPlugin(){return this.keymapBuilder.build()}nodeViews(){return this.nodeViewBuilder.build()}serialize(e){const t=this.proseMirrorToUnistConverter.convert(e);return this.unified.stringify(t)}}let Dt=null;function ue(){return Dt??=new Fo([new Io]),Dt}const Ko=(r,e,t,n)=>{const s=[];for(const o of e)for(const i of t)s.push({from:o,to:i,parentNodeNamesAtStart:o.parentNodeTypeNameStack,slice:r.slice(o.pmPos,i.pmPos)});return s.sort((o,i)=>{const a=Math.abs(o.from.sourcePos-n.start)+Math.abs(o.to.sourcePos-n.end),c=Math.abs(i.from.sourcePos-n.start)+Math.abs(i.to.sourcePos-n.end);return a===c?i.slice.size-o.slice.size:a-c}),s},jo=(r,e)=>In(r.parentNodeNamesAtStart,e.parentNodeTypeNameStack),It=new WeakMap,Go=({diff:r})=>{const e=new Ir(Ar.GetDiffedDoc,{debug:!1});e.startBlock("get_diffed_doc");const t=ue(),{contentAfter:n,contentBefore:s,edits:o}=r,i=t.parse(n),a=t.parse(s),c=o.concat().sort((y,x)=>y.positionBefore.start-x.positionBefore.start),u=[],l=[];e.startBlock("init_position_transformers");const{sourceRangeToPmRange:d}=be(a),{sourceRangeToPmRange:h}=be(i);e.endBlock("init_position_transformers");let p=a,f=0,g=0;const k=[],b=(y,x,w)=>{for(const[v,G]of w.entries())try{if(!jo(x,G))continue;const{pmPos:P}=G,{slice:L}=x;return p=p.replace(P,P,L),u.push({editId:y,start:P,end:P+L.size}),[v,G]}catch(P){k.push(P)}return null};for(let y=0;y<c.length;y++){const{id:x,positionBefore:w,positionAfter:v}=c[y];e.startBlock("transform_positions");const G=d(w),P=h(v);e.endBlock("transform_positions");const{start:L,end:H}=G,{start:I,end:N}=P,C=v.start!==v.end,M=C?Ko(i,I,N,v):null;e.startBlock("get_merged_doc_positions");const{positions:S}=be(p);e.endBlock("get_merged_doc_positions");const F=Math.max(...L.map(({pmPos:$})=>$)),O=Math.min(...H.map(({pmPos:$})=>$)),q=[].concat(H).concat(L),W=w.start!==w.end&&a.textBetween(F,O).length>0;let V=!1;if(W&&!C)l.push({editId:x,start:F+f,end:O+f}),V=!0;else if(!W&&!C)V=!0;else{const $=q.map(({pmPos:T})=>S[T+f]);for(const T of M??[]){const K=b(x,T,$);if(K==null)continue;const ne=K[0],Ne=T.slice.size,pe=ne<H.length;pe||(f+=Ne),W&&l.push({editId:x,start:F+f,end:O+f}),pe&&(f+=Ne),V=!0;break}}if(!V&&M!=null){const T=Math.min(...L.map(({pmPos:K})=>K))+f-1;for(const K of M)try{p=p.replace(T,T,K.slice),u.push({editId:x,start:T,end:T+K.slice.size}),f+=K.slice.size,W&&l.push({editId:x,start:F+f,end:O+f}),V=!0;break}catch(ne){k.push(ne)}}V?J.logEvent(re.canvasDiffEditSuccess):(J.logEvent(re.canvasDiffEditFail),J.logError("Failed to insert edit for diffed doc",$t(k),{errors:k.map(Br),replaceFromCandidates:L,replaceToCandidates:H,sliceFromCandidates:I,sliceToCandidates:N}),g++)}return J.logDistribution(re.canvasDiffEditSuccessRatio,(c.length-g)/c.length),J.logDistribution(re.canvasDiffEditFailCount,g),J.logDistribution(re.canvasDiffEditSuccessCount,c.length-g),J.logDistribution(re.canvasDiffEditCount,c.length),e.endBlock("get_diffed_doc"),{doc:p,addedRanges:u,deletedRanges:l}},Wo=({diff:r})=>{const e=It.get(r);if(e!=null)return e;const t=Go({diff:r});return It.set(r,t),t},Ce=new z("focus"),qo=(r,e)=>new U({key:Ce,state:{init:()=>!1,apply(t,n){const s=t.getMeta(Ce);return typeof s=="boolean"?s:n}},props:{handleDOMEvents:{blur:(t,n)=>{const{relatedTarget:s}=n;return s!=null&&Qe.isInCodeBlockView(s)||(e(n),t.dispatch(t.state.tr.setMeta(Ce,!1))),!1},focus:(t,n)=>(r(n),t.dispatch(t.state.tr.setMeta(Ce,!0)),!1)}}}),Xo=500;class Q{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let n=this.items.length;for(;;n--)if(this.items.get(n-1).selection){--n;break}let s,o;t&&(s=this.remapping(n,this.items.length),o=s.maps.length);let i=e.tr,a,c,u=[],l=[];return this.items.forEach((d,h)=>{if(!d.step){s||(s=this.remapping(n,h+1),o=s.maps.length),o--,l.push(d);return}if(s){l.push(new Z(d.map));let p=d.step.map(s.slice(o)),f;p&&i.maybeStep(p).doc&&(f=i.mapping.maps[i.mapping.maps.length-1],u.push(new Z(f,void 0,void 0,u.length+l.length))),o--,f&&s.appendMap(f,o)}else i.maybeStep(d.step);if(d.selection)return a=s?d.selection.map(s.slice(o)):d.selection,c=new Q(this.items.slice(0,n).append(l.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:c,transform:i,selection:a}}addTransform(e,t,n,s){let o=[],i=this.eventCount,a=this.items,c=!s&&a.length?a.get(a.length-1):null;for(let l=0;l<e.steps.length;l++){let d=e.steps[l].invert(e.docs[l]),h=new Z(e.mapping.maps[l],d,t),p;(p=c&&c.merge(h))&&(h=p,l?o.pop():a=a.slice(0,a.length-1)),o.push(h),t&&(i++,t=void 0),s||(c=h)}let u=i-n.depth;return u>Zo&&(a=Yo(a,u),i-=u),new Q(a.append(o),i)}remapping(e,t){let n=new Kt;return this.items.forEach((s,o)=>{let i=s.mirrorOffset!=null&&o-s.mirrorOffset>=e?n.maps.length-s.mirrorOffset:void 0;n.appendMap(s.map,i)},e,t),n}addMaps(e){return this.eventCount==0?this:new Q(this.items.append(e.map(t=>new Z(t))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let n=[],s=Math.max(0,this.items.length-t),o=e.mapping,i=e.steps.length,a=this.eventCount;this.items.forEach(h=>{h.selection&&a--},s);let c=t;this.items.forEach(h=>{let p=o.getMirror(--c);if(p==null)return;i=Math.min(i,p);let f=o.maps[p];if(h.step){let g=e.steps[p].invert(e.docs[p]),k=h.selection&&h.selection.map(o.slice(c+1,p));k&&a++,n.push(new Z(f,g,k))}else n.push(new Z(f))},s);let u=[];for(let h=t;h<i;h++)u.push(new Z(o.maps[h]));let l=this.items.slice(0,s).append(u).append(n),d=new Q(l,a);return d.emptyItemCount()>Xo&&(d=d.compress(this.items.length-n.length)),d}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),n=t.maps.length,s=[],o=0;return this.items.forEach((i,a)=>{if(a>=e)s.push(i),i.selection&&o++;else if(i.step){let c=i.step.map(t.slice(n)),u=c&&c.getMap();if(n--,u&&t.appendMap(u,n),c){let l=i.selection&&i.selection.map(t.slice(n));l&&o++;let d=new Z(u.invert(),c,l),h,p=s.length-1;(h=s.length&&s[p].merge(d))?s[p]=h:s.push(d)}}else i.map&&n--},this.items.length,0),new Q(ft.from(s.reverse()),o)}static empty=new Q(ft.empty,0)}function Yo(r,e){let t;return r.forEach((n,s)=>{if(n.selection&&e--==0)return t=s,!1}),r.slice(t)}class Z{constructor(e,t,n,s){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=s}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new Z(t.getMap().invert(),t,this.selection)}}}class se{constructor(e,t,n,s,o){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=s,this.prevComposition=o}}const Zo=20;function Jo(r,e,t,n){let s=t.getMeta(de),o;if(s)return s.historyState;t.getMeta(ti)&&(r=new se(r.done,r.undone,null,0,-1));let i=t.getMeta("appendedTransaction");if(t.steps.length==0)return r;if(i&&i.getMeta(de))return i.getMeta(de).redo?new se(r.done.addTransform(t,void 0,n,ve(e)),r.undone,At(t.mapping.maps),r.prevTime,r.prevComposition):new se(r.done,r.undone.addTransform(t,void 0,n,ve(e)),null,r.prevTime,r.prevComposition);if(t.getMeta("addToHistory")!==!1&&!(i&&i.getMeta("addToHistory")===!1)){let a=t.getMeta("composition"),c=r.prevTime==0||!i&&r.prevComposition!=a&&(r.prevTime<(t.time||0)-n.newGroupDelay||!Qo(t,r.prevRanges)),u=i?_e(r.prevRanges,t.mapping):At(t.mapping.maps);return new se(r.done.addTransform(t,c?e.selection.getBookmark():void 0,n,ve(e)),Q.empty,u,t.time,a??r.prevComposition)}else return(o=t.getMeta("rebased"))?new se(r.done.rebased(t,o),r.undone.rebased(t,o),_e(r.prevRanges,t.mapping),r.prevTime,r.prevComposition):new se(r.done.addMaps(t.mapping.maps),r.undone.addMaps(t.mapping.maps),_e(r.prevRanges,t.mapping),r.prevTime,r.prevComposition)}function Qo(r,e){if(!e)return!1;if(!r.docChanged)return!0;let t=!1;return r.mapping.maps[0].forEach((n,s)=>{for(let o=0;o<e.length;o+=2)n<=e[o+1]&&s>=e[o]&&(t=!0)}),t}function At(r){let e=[];for(let t=r.length-1;t>=0&&e.length==0;t--)r[t].forEach((n,s,o,i)=>e.push(o,i));return e}function _e(r,e){if(!r)return null;let t=[];for(let n=0;n<r.length;n+=2){let s=e.map(r[n],1),o=e.map(r[n+1],-1);s<=o&&t.push(s,o)}return t}function ei(r,e,t){let n=ve(e),s=de.get(e).spec.config,o=(t?r.undone:r.done).popEvent(e,n);if(!o)return null;let i=o.selection.resolve(o.transform.doc),a=(t?r.done:r.undone).addTransform(o.transform,e.selection.getBookmark(),s,n),c=new se(t?a:o.remaining,t?o.remaining:a,null,0,-1);return o.transform.setSelection(i).setMeta(de,{redo:t,historyState:c})}let Le=!1,Bt=null;function ve(r){let e=r.plugins;if(Bt!=e){Le=!1,Bt=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){Le=!0;break}}return Le}const de=new z("history"),ti=new z("closeHistory");function Ve(r={},e=void 0){return r={depth:r.depth||100,newGroupDelay:r.newGroupDelay||500},new U({key:de,state:{init(){return e??new se(Q.empty,Q.empty,null,0,-1)},apply(t,n,s){return Jo(n,s,t,r)}},config:r,props:{handleDOMEvents:{beforeinput(t,n){let s=n.inputType,o=s=="historyUndo"?fn:s=="historyRedo"?Ke:null;return!o||!t.editable?!1:(n.preventDefault(),o(t.state,t.dispatch))}}}})}function hn(r,e){return(t,n)=>{let s=de.getState(t);if(!s||(r?s.undone:s.done).eventCount==0)return!1;if(n){let o=ei(s,t,r);o&&n(e?o.scrollIntoView():o)}return!0}}const fn=hn(!1,!0),Ke=hn(!0,!0),ni=()=>new U({key:new z("katex"),props:{decorations(r){const e=[];return r.doc.descendants((t,n)=>{(t.type.name==="inline_math"||t.type.name==="math_block")&&e.push(oe.widget(n+1,()=>{const s=document.createElement("span"),o=Wr.renderToString(t.attrs.latex,{throwOnError:!1,displayMode:t.type.name==="math_block"});return s.innerHTML=o,s}))}),A.create(r.doc,e)}}});function ri(r,e){const t=e&&r.dom?.querySelectorAll(`[data-edit-id="${e}"]`);return t?Array.from(t):[]}function Hi(r,e){return ri(r,e).flatMap(n=>Array.from(n.getClientRects()))}function je(r,e,t){return r>=t.left&&r<=t.right&&e>=t.top&&e<=t.bottom}function si(r){const e=Math.min(...r.map(o=>o.left)),t=Math.max(...r.map(o=>o.right)),n=Math.min(...r.map(o=>o.top)),s=Math.max(...r.map(o=>o.bottom));return{left:e,right:t,top:n,bottom:s}}function oi(r,e,t){return t.some(s=>je(r,e,s))?!0:t.length<2?!1:t.some(s=>r>=s.left&&r<=s.right&&e>s.bottom)&&t.some(s=>r>=s.left&&r<=s.right&&e<s.top)}const ii=new z("linkTooltip"),ai=36;class ci{tooltipElement;button;onMouseLeave;constructor(e){this.tooltipElement=document.createElement("div"),this.tooltipElement.className=me("absolute  py-1.5 px-2.5 bg-token-main-surface-primary border border-token-border-light rounded-lg text-xs z-50 items-center cursor-pointer shadow-md flex justify-center cursor-pointer","transform -translate-x-1/2"),this.button=document.createElement("button"),this.button.textContent="Open link",this.button.className=me("bg-none","border-none","text-token-text-primary ","text-sm"),this.tooltipElement.appendChild(this.button),this.onMouseLeave=e,this.tooltipElement.addEventListener("mouseleave",e)}show(e,t,n){document.body.appendChild(this.tooltipElement),this.tooltipElement.style.left=`${e}px`,this.tooltipElement.style.top=`${t}px`;const s=()=>{window.open(n,"_blank"),this.hide()};this.button.addEventListener("click",s,{once:!0})}hide(){this.tooltipElement.parentNode&&this.tooltipElement.parentNode.removeChild(this.tooltipElement)}}function li(){let r=null,e=null;const t=o=>{if(r==null||e==null)return!1;const i=Array.from(e.getClientRects()),a=r.tooltipElement.getBoundingClientRect();if(i.length===1){const c=i[0];return!je(o.clientX,o.clientY,si([c,a]))}else return!oi(o.clientX,o.clientY,[a,...i])},n=(o,i)=>{r&&(r.hide(),r=null);const a=o.getAttribute("href");if(!a)return;const c=Array.from(o.getClientRects()),u=c.find(h=>je(i.clientX,i.clientY,h))??c[0],l=u.left+u.width/2,d=u.top-ai;r=new ci(h=>{t(h)&&s()}),r.show(l,d,a),e=o},s=()=>{r&&(r.hide(),r=null),e=null};return new U({key:ii,props:{handleDOMEvents:{mousemove(o,i){const a=()=>{const{target:u}=i;if(!(u instanceof HTMLElement))return!1;const l=u.closest("a[href]");return l!=null&&l!==e?(n(l,i),!0):!1},c=()=>{r==null||!t(i)||s()};a()||c()}}},view:()=>({destroy:s})})}function mn(r){return ue().serialize(r).length}const ui=new z("maxLength"),di=(r,e,t)=>new U({key:ui,state:{init(){return t},apply:()=>{}},filterTransaction(n){if(r==null||!n.steps.some(i=>i instanceof Cr||i instanceof ye?i.slice.size>i.to-i.from:!1))return!0;const o=mn(n.doc);return o<=t?!0:(e&&Ze(e,r),J.logEvent(re.canvasProsemirrorMaxLength,{maxLength:t,newLength:o}),!1)}});function pi(r,e){const{state:t}=r,{selection:n}=t,s=n.content(),{schema:o}=t,i=o.topNodeType.create(null,s.content),a=hi(i,r),c=t.doc.textBetween(n.from,n.to,`
`);e.clipboardData?.setData("application/x-prosemirror",c),e.clipboardData?.setData("text/plain",a),e.preventDefault()}function hi(r,e){let t="";function n(s){if(s.type.name==="paragraph")return s.content.forEach(o=>{n(o)}),t+=`
`,!1;if(s.type.name==="contentReference"){const o=s.attrs.index,i=fi(o,e);return i&&(t+=`[${i}]`),!1}else s.isText&&s.text!==void 0&&(t+=s.text);return!0}return r.descendants(n),t.endsWith(`
`)&&(t=t.slice(0,-1)),t}function fi(r,e){const t=qt.getState(e.state),n=parseInt(r);if(t==null||n==null)return null;const s=t?.displayedContentReferences?.[n];return s==null||s.type!=="grouped_webpages"?null:s.items?.[0]?.url}class mi{dom;node;view;getPos;key;collectReactElement;constructor(e,t,n,s){this.node=e,this.getPos=n,this.view=t,this.dom=document.createElement("span"),this.dom.className="content-reference-node";const o=()=>`${Sn()}`;this.key=`content-reference-node-${o()}`,this.collectReactElement=s,this.renderReactComponent()}renderReactComponent(){const{index:e}=this.node.attrs,t=qt.getState(this.view.state);if(e==null)return;const n=t?.displayedContentReferences?.[e];if(!n||n.type!=="grouped_webpages")return;const s=ce.jsx(qr,{webpageRef:n,trackContentReferenceEvent:()=>{},index:e}),o=Pn.createPortal(s,this.dom);this.collectReactElement(this.key,o)}update(e){return e.attrs!==this.node.attrs&&(this.node=e,this.renderReactComponent()),!0}destroy(){this.collectReactElement(this.key,null)}}function gi(r={}){return new U({view(e){return new Mi(e,r)}})}class Mi{constructor(e,t){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(n=t.width)!==null&&n!==void 0?n:1,this.color=t.color===!1?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(s=>{let o=i=>{this[s](i)};return e.dom.addEventListener(s,o),{name:s,handler:o}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){this.cursorPos!=null&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),t=!e.parent.inlineContent,n;if(t){let a=e.nodeBefore,c=e.nodeAfter;if(a||c){let u=this.editorView.nodeDOM(this.cursorPos-(a?a.nodeSize:0));if(u){let l=u.getBoundingClientRect(),d=a?l.bottom:l.top;a&&c&&(d=(d+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),n={left:l.left,right:l.right,top:d-this.width/2,bottom:d+this.width/2}}}}if(!n){let a=this.editorView.coordsAtPos(this.cursorPos);n={left:a.left-this.width/2,right:a.left+this.width/2,top:a.top,bottom:a.bottom}}let s=this.editorView.dom.offsetParent;this.element||(this.element=s.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",t),this.element.classList.toggle("prosemirror-dropcursor-inline",!t);let o,i;if(!s||s==document.body&&getComputedStyle(s).position=="static")o=-pageXOffset,i=-pageYOffset;else{let a=s.getBoundingClientRect();o=a.left-s.scrollLeft,i=a.top-s.scrollTop}this.element.style.left=n.left-o+"px",this.element.style.top=n.top-i+"px",this.element.style.width=n.right-n.left+"px",this.element.style.height=n.bottom-n.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),s=n&&n.type.spec.disableDropCursor,o=typeof s=="function"?s(this.editorView,t,e):s;if(t&&!o){let i=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=Er(this.editorView.state.doc,i,this.editorView.dragging.slice);a!=null&&(i=a)}this.setCursor(i),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){(e.target==this.editorView.dom||!this.editorView.dom.contains(e.relatedTarget))&&this.setCursor(null)}}function Ee(r){return(e,t,n)=>{const{doc:s,selection:o}=e,{empty:i,$head:a}=o;if(i&&n?.endOfTextblock(r)){const c=r==="left"||r==="up"?-1:1,u=qe.near(s.resolve(c>0?a.after():a.before()),c);if(u.$head?.parent.type.name===Ae)return t?.(e.tr.setSelection(u)),!0}return!1}}const Ni=Ye({ArrowLeft:Ee("left"),ArrowRight:Ee("right"),ArrowUp:Ee("up"),ArrowDown:Ee("down")}),Re=new z("modelCursor");function ki(r,e){return r.setMeta(Re,{modelCursor:e})}function wi(r){return r.getMeta(Re)??null}const Ot=(r,e)=>{const{doc:t}=r,n=[];if(!e)return A.empty;const{modelSelectionPositionRange:s,modelCursorPosition:o}=e,{sourceRangeToPmRange:i,sourceEndToPmPos:a}=be(t);if(o!=null){const c=Oe(o,a(o),"min");if(c==null)return A.empty;if(c!=null&&zt(t,c)){const u=t.resolve(c);if(t.nodeAt(c)?.type.name===Fe.proseMirrorNodeName()||u.nodeBefore?.type.name===Fe.proseMirrorNodeName())return A.empty}n.push(oe.widget(c,()=>{const u=document.createElement("span");return u.className=tr.modelCursor,u},{ignoreSelection:!0,side:1}))}else if(s!=null){const{start:c,end:u}=i(s),l=Oe(s.start,c,"max"),d=Oe(s.end,u,"min");if(l==null||d==null)return A.empty;n.push(oe.inline(l,d,{class:`${Lr} !bg-[Highlight]`}))}return n.length?A.create(t,n):A.empty},yi=(r,e)=>{let n=r.domAtPos(e)?.node;if(n===r.dom)return null;for(;n&&!(n instanceof HTMLElement);)n=n.parentNode;return n},xi=(r,e)=>{yi(r,e.to)?.scrollIntoView({behavior:"smooth",block:"center"})},Ci=(r,e)=>{if(r&&!e)return!0;const t=r?.modelSelectionPositionRange?.start,n=e?.modelSelectionPositionRange?.start;return t!==void 0&&(n===void 0||t!==n)};function _t(r=void 0,e=void 0){return new U({key:Re,state:{init:(t,n)=>({modelCursor:r,deco:Ot(n,r),isNewCursor:!1,isCursorActive:e?.isCursorActive??!1}),apply:(t,n,s,o)=>{const a=wi(t)?.modelCursor??n.modelCursor,c=Ot(o,a),u=!!((!n.isCursorActive||Ci(a,n.modelCursor))&&c&&c.find()[0]),l=!!a&&(u||n.isCursorActive);return{modelCursor:a,deco:c,isNewCursor:u,isCursorActive:l}}},props:{decorations(t){return this.getState(t)?.deco}},view(t){return{update(n){const{deco:s,isNewCursor:o}=Re.getState(n.state),i=s&&s.find()[0];i&&o&&xi(n,i)}}}})}const gn="ignoreDocChange";function Ei(r){return r.setMeta(gn,!0)}function bi(r){return r.getMeta(gn)===!0}function vi(r){const e=r.content.size-(r.lastChild?.content.size??0)-1;if(zt(r,e))return j.create(r,e)}const Mn=({intl:r,toaster:e,value:t,comments:n,diff:s,maxLength:o=Qt,selection:i,onFocus:a,onBlur:c,onSave:u,safeUrls:l,modelCursor:d,isDisabled:h,prevState:p,contentRefereces:f,shouldUseContentReferencePlugin:g})=>{const k=ue(),b=k.schema();let y=t;o!=null&&y.length>o&&(y=y.slice(0,o),e!=null&&r!=null&&Ze(e,r,o));let x,w=[],v=[];s&&s.edits.length>0?{doc:x,addedRanges:w,deletedRanges:v}=Wo({diff:s}):x=k.parse(y);const G=i?xs(x,i):vi(x),P=()=>{const I=p?.plugins.find(N=>N.spec.key===Ve().spec.key);return I==null||p==null?Ve():Ve({},I.getState(p))},L=I=>{const N=p?.plugins.find(M=>M.spec.key===_t().spec.key),C=p&&N?.getState(p);return _t(I,C)},H=Wt();return Xt.create({doc:x,schema:b,selection:G,plugins:[...g?[br(f)]:[],di(r,e,o),k.inputRulesPlugin(),k.keymapPlugin(),Ye({"Mod-s":()=>(u(),!0),"Mod-z":fn,"Mod-shift-z":Ke,"Mod-y":Ke}),Ni,...H?[ni()]:[],gi(),vr(),P(),qo(a,c),Ht(n??[]),...s?[ds(w,v)]:[],L(d),rs(new Set(l??[])),is(r,h),Ms(p?fe.getState(p).suggestion:null),li(),...ms()]})},Pi=(r,e)=>{const t=ue(),n=t.schema(),s=t.parse(r);return Xt.create({doc:s,schema:n,plugins:[Ht(e??[])]})},Fi=({mount:r,value:e,comments:t,isDarkMode:n})=>new Yt({mount:r},{editable:()=>!1,state:Pi(e,t),nodeViews:{[Ae]:(o,i,a)=>new Qe(o,i,a,n)}}),Si=(r,{intl:e,toaster:t,comments:n,value:s,maxLength:o=Qt,onBlur:i,onFocus:a,onChange:c,onUpdate:u,onSave:l,safeUrls:d,modelCursor:h,selection:p,isDisabled:f,diff:g,prevState:k,contentRefereces:b,collectReactElement:y},x=!1)=>{const w=Xe(),v=Mn({intl:e,toaster:t,comments:n,value:s,maxLength:o,onBlur:i,onFocus:a,onSave:l,safeUrls:d,modelCursor:h,selection:p,isDisabled:f,diff:g,prevState:k,contentRefereces:b,collectReactElement:y,shouldUseContentReferencePlugin:w});u(v);const G=N=>{const C=I.state.apply(N);if(I.updateState(C),u(C),!N.docChanged||bi(N))return;const M=rn(C);if(!M)return;const{doc:S}=C,{changeset:F}=M;c?.({transaction:N,changeset:F,doc:S,getSerializedDocument:()=>ue().serialize(S),getAdjustedComments:()=>{const O=nr(Ft,C);if(O==null)return[];const q=ue(),W=q.parse(q.serialize(S)),V=ar(W,O.positions);return cr(O.comments,V)}})},P=ue(),H={...P.nodeViews(),...w?{[le]:(N,C,M)=>new mi(N,C,M,y)}:{},...g!=null?{}:{[Ae]:(N,C,M)=>new Qe(N,C,M,x)}},I=new Yt({mount:r},{state:v,editable:()=>!f,dispatchTransaction:G,nodeViews:H,...w?{handleDOMEvents:{copy:(N,C)=>pi(N,C)}}:{},handlePaste(N,C){const M=Lt("4242210007");let S;if(w&&(S=C.clipboardData?.getData("application/x-prosemirror")),S||=C.clipboardData?.getData("text/plain"),S==null)return!1;J.logEvent(re.canvasProsemirrorPaste,{textLength:S.length});const F=mn(N.state.doc),O=F+S.length,q=o!=null&&O>o;q&&t!=null&&e!=null&&Ze(t,e,o);const W=C.clipboardData?.getData("text/html");if(M&&W){const $=Ti(W),T=new window.DOMParser().parseFromString($,"text/html"),K=Pr.fromSchema(N.state.schema).parse(T.body),ne=new Me(K.content,1,1);return N.dispatch(N.state.tr.replaceSelection(ne)),!0}let V=S;if(q){const T=o-F-50;V=T>0?S.slice(0,T):""}return Sr(N,V,w),!0}});return{view:I,pmu:P}},Ti=r=>r.replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3"),Ri="_main_5jn6z_1",Di={main:Ri};function Ii(r,e){const t=e.target;if(t instanceof Element&&[we.PROSEMIRROR_EDITOR_CONTAINER,we.PROSEMIRROR_CONTEXT_CHILDREN].some(c=>t.closest(`#${c}`)!=null))return!1;r.focus();const n=ks(r.dom.getBoundingClientRect(),{x:e.clientX,y:e.clientY}),s=r.state.tr,o=r.posAtCoords({left:n.x,top:n.y});if(o!=null){const i=Math.min(o.pos,rr(r.state.doc)-1);s.setSelection(new j(s.doc.resolve(i))),r.dispatch(s)}return!0}const Nn=({editorRef:r,wrapperClassName:e,transparentBackground:t=!1,comments:n,commentingOn:s,diff:o,paddingBottom:i,hoveredCommentId:a,focusedCommentId:c,hoveredEditId:u,rejectedEdits:l,showChanges:d,isDisabled:h=!1,value:p,onBlur:f,onFocus:g,onChange:k,onMouseLeave:b,onSave:y,getAutocompleteSuggestion:x,safeUrls:w,children:v,width:G,modelCursor:P,shouldResetSelection:L=!1,contentRefereces:H})=>{const I=Tn(),N=An(),C=E.useRef(null),M=E.useRef(null),[S,F]=E.useState(null),O=Bn(),q=On(),[{width:W},V]=Or(),$=E.useRef(f);$.current=f;const T=E.useRef(g);T.current=g;const K=Ns(M,x),ne=async m=>{k?.(m),Jr()&&K(m.getSerializedDocument)},Ne=E.useRef(ne);Ne.current=ne;const pe=E.useRef(y);pe.current=y;const xe=Xe(),[yn,xn]=E.useState(()=>new Map),Be=E.useCallback((m,R)=>{xn(X=>{const Y=new Map(X);return R==null?Y.delete(m):Y.set(m,R),Y})},[]),nt=E.useCallback((m=p)=>Mn({intl:I,toaster:N,comments:n,diff:o,value:m,selection:L?void 0:M.current?.state.selection,onBlur:R=>$.current?.(R),onFocus:R=>T.current?.(R),onSave:()=>pe.current?.(),modelCursor:P,isDisabled:h,safeUrls:w,prevState:S,contentRefereces:H,collectReactElement:Be,shouldUseContentReferencePlugin:xe}),[I,N,n,o,p,L,P,h,w,S,H,Be,xe]),Cn=E.useCallback(m=>{const R=nt(m);M.current?.updateState(R),F(R)},[nt]);E.useImperativeHandle(r,()=>({UNSAFE_setValue:Cn,revertChanges:()=>{if(M.current==null)throw new Error("Tried to call revertChanges, but viewRef.current is null");fs(M.current)},flushChanges:()=>{if(M.current==null)throw new Error("Tried to call flushChanges, but viewRef.current is null");hs(M.current)},maybeFocusOnEditor:m=>{if(M.current==null)throw new Error("Tried to call maybeFocus, but viewRef.current is null");return Ii(M.current,m)},viewRef:M})),_n(()=>{const{current:m}=C;if(!m)return;const{view:R}=Si(m,{intl:I,toaster:N,comments:n,diff:o,value:p,onBlur:X=>$.current?.(X),onFocus:X=>T.current?.(X),onChange:X=>Ne.current?.(X),onUpdate:F,onSave:()=>pe.current?.(),isDisabled:h,safeUrls:w,prevState:S,contentRefereces:H,collectReactElement:Be,shouldUseContentReferencePlugin:xe},O);return M.current=R,()=>{R?.destroy()}},[o]),E.useEffect(()=>{M.current?.setProps({editable:()=>!h})},[h]),ie(m=>ss(m,h),M,[h]),ie(m=>{if(!q)return;const{schema:R}=m.doc.type,X=R.nodes.code_block;return X?(m.doc.descendants((Y,ot)=>{if(Y.type===X){const bn=Y.type.create({...Y.attrs,isDarkMode:O},Y.content,Y.marks);m.replaceWith(ot,ot+Y.nodeSize,bn)}}),Ei(m)):m},M,[q,O]),ie(m=>m.setMeta(He,d),M,[d]),ie(m=>ki(m,P),M,[P]),ie(m=>m.setMeta(Ft,{comments:n,commentingOn:s,hoveredCommentId:a,focusedCommentId:c}),M,[n,a,c,s]),ie(m=>m.setMeta(ze,{hoveredEditId:u,rejectedEdits:l??new Set}),M,[u,l]),ie(m=>ts(m,new Set(w??[])),M,[w]);const En=E.useCallback(()=>M.current,[M]),rt=[],st=[];return E.Children.forEach(v,m=>{if(!E.isValidElement(m))return;const{type:R}=m;if(R===wn)rt.push(m);else if(R===kn)st.push(m);else throw new Error("Invalid Prosemirror child: "+JSON.stringify(R))}),ce.jsx(lr.Provider,{value:En,children:ce.jsx(ur.Provider,{value:S,children:ce.jsxs(dr.Provider,{value:W,children:[ce.jsx("div",{id:we.PROSEMIRROR_CONTEXT_CHILDREN,children:rt}),ce.jsxs("div",{className:e,onMouseLeave:b,id:we.PROSEMIRROR_EDITOR_CONTAINER,style:{paddingBottom:i},children:[ce.jsx("div",{ref:_r(C,V),className:me(Di.main,Vr.composer,"markdown prose contain-inline-size dark:prose-invert focus:outline-none",t?"bg-transparent":"bg-token-main-surface-primary"),style:{width:G}}),st,xe?Array.from(yn.values()):null]})]})})})},kn=({children:r})=>r,wn=({children:r})=>r;Nn.EditorChildren=kn;Nn.ContextChildren=wn;export{Ss as B,Vs as I,Nn as P,we as T,Pi as a,Hi as b,Fi as c,si as d,ri as g,Di as s,Ps as t};
//# sourceMappingURL=meykrts0f231390r.js.map
