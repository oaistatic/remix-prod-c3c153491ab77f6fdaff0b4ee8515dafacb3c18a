import{V as w,c5 as j,aq as L,bw as N,cD as B,d as O,c3 as F,c4 as z,fR as ne,bT as ve,cG as Je,dW as Ke,d6 as Xe,h7 as Qe,bH as $e,Z as Y,M as es,f9 as ss}from"./njq6ygky3ttysgdk.js";import{d as H,r as u,j as e,e as y,u as I,a5 as Ce,M as o,h as ts,c as W,a7 as Me}from"./fs6h2trisr1juto6.js";import{e as as,a as ns,b as ls}from"./cn7wv05uhldre230.js";import{d as we,e as ke,f as Ne,b as ue,g as T,a as is}from"./jf4562axgfhj93oj.js";import{e as v,bi as os,dn as rs,bJ as cs,pU as le,iK as ds,iJ as us,c6 as ms,pV as se,dE as Se,ad as xs,hr as De,ho as fs,gB as Ae,kw as gs,di as Fe,ae as ps,bt as hs,bx as js,gt as _s,pW as ys,dD as bs,k0 as vs,gW as Cs,gY as me,gV as Ms,pX as xe,pY as ws,fJ as ks,pZ as Ns,ga as S,bY as Ss,bZ as Ds}from"./d7a6rc8fexfzu7dt.js";import{P as R,a as Ee}from"./gfo75oujoeaedm5y.js";import{S as As}from"./jfi01owl9mian83i.js";import{S as Fs}from"./urpjyx0x5i92521t.js";import{S as Es}from"./gs82yh7xpb1qjtsc.js";import{A as Rs}from"./gyif1j2ovuhfzvqr.js";import{S as Is}from"./hiayljqmnpspmyun.js";import{b as Ps}from"./cm0hdcditutj2jz2.js";import{a as Os,g as fe}from"./kl5nk3ovt5mr5uj0.js";import{c as Re}from"./b8zlh79k7yo0fu3r.js";import"./o634nz6bc7e8bevz.js";import"./ijutvl794yycgs5p.js";import"./csg4i0wk6hi0jvkd.js";import"./lj0prj6na7gf1jpf.js";import"./n9whwsbg0rx5cs8k.js";import"./ohq33fk3dbalo2mk.js";import"./wqepkoieaii7q4ep.js";import"./en8ogvlmn3lccz09.js";import"./dip320knbmcdpl7g.js";import"./jva3s9kefqoq05e1.js";import"./ll7abbx3or9l4k2y.js";import"./ngj3h1w6uuxrb6ri.js";import"./k9j493gfhjdl3k26.js";import"./gunpso70jnmarvod.js";import"./m3ph5kqqbcm52gd5.js";const Ls=Re("Search16Regular","16",["M9.3 10.02a4.5 4.5 0 1 1 .7-.7l3.85 3.83a.5.5 0 0 1-.7.7L9.3 10.02ZM10 6.5a3.5 3.5 0 1 0-7 0 3.5 3.5 0 0 0 7 0Z"]),Ts=Re("SettingsCogMultiple20Filled","20",["M8 2c-.37 0-.73.04-1.08.1a.5.5 0 0 0-.4.4l-.26 1.36c-.05.25-.3.4-.54.31l-1.3-.45a.5.5 0 0 0-.55.14A5.5 5.5 0 0 0 2.8 5.74c-.07.2-.01.4.14.54l1.05.9c.19.17.19.47 0 .63l-1.05.91a.5.5 0 0 0-.14.54c.23.7.6 1.34 1.08 1.88.14.15.35.2.54.14l1.3-.45c.25-.08.5.06.55.31l.27 1.36c.03.2.19.35.39.4a5.52 5.52 0 0 0 2.17 0 .5.5 0 0 0 .4-.4l.25-1.36c.05-.25.3-.4.55-.31l1.3.45c.19.06.4 0 .54-.14a5.5 5.5 0 0 0 1.08-1.89.5.5 0 0 0-.14-.53l-1.04-.9a.42.42 0 0 1 0-.63l1.04-.9a.5.5 0 0 0 .14-.54 5.5 5.5 0 0 0-1.08-1.89.5.5 0 0 0-.54-.14l-1.3.45a.42.42 0 0 1-.55-.31L9.48 2.5a.5.5 0 0 0-.4-.4C8.75 2.05 8.39 2 8 2ZM6.5 7.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm4.66 4.95a.46.46 0 0 1 .53-.15l.8.27c.26.1.54-.07.6-.34l.15-.83c.04-.2.2-.36.4-.38a3.55 3.55 0 0 1 .72 0c.2.02.35.18.4.38l.15.83c.06.27.34.43.6.34l.8-.27c.19-.07.4-.02.52.15.14.2.27.4.36.62.09.19.03.4-.13.53l-.64.56c-.2.18-.2.5 0 .68l.64.56c.16.13.22.34.13.53-.1.22-.22.43-.36.62a.46.46 0 0 1-.52.15l-.8-.27a.45.45 0 0 0-.6.34l-.16.83c-.04.2-.19.36-.4.38a3.55 3.55 0 0 1-.71 0 .46.46 0 0 1-.4-.38l-.16-.83a.45.45 0 0 0-.6-.34l-.8.27c-.18.07-.4.02-.52-.15a3.5 3.5 0 0 1-.36-.62.46.46 0 0 1 .13-.53l.64-.56c.21-.18.21-.5 0-.68l-.64-.56a.46.46 0 0 1-.13-.53c.1-.22.22-.43.36-.62ZM15 14.5a1 1 0 1 0-2 0 1 1 0 0 0 2 0Z"]),P=H({fileSingular:{id:"TKyiaj",defaultMessage:"file"},filesPlural:{id:"krAMi5",defaultMessage:"files"},domainSingular:{id:"ExZP9r",defaultMessage:"domain"},domainsPlural:{id:"PmkQD7",defaultMessage:"domains"}});function ge(s,t){return s==="google_drive_dwd"||s==="google_drive_oauth"?{objectTypeSingular:t.formatMessage(P.fileSingular),objectTypePlural:t.formatMessage(P.filesPlural),externalLinkableUnitSingular:t.formatMessage(P.domainSingular),externalLinkableUnitPlural:t.formatMessage(P.domainsPlural)}:s==="slack"?{objectTypeSingular:t.formatMessage({id:"Y22i2G",defaultMessage:"channel"}),objectTypePlural:t.formatMessage({id:"UXSOIk",defaultMessage:"channels"}),externalLinkableUnitSingular:t.formatMessage({id:"yyIyWp",defaultMessage:"workspace"}),externalLinkableUnitPlural:t.formatMessage({id:"LuznzN",defaultMessage:"workspaces"})}:{objectTypeSingular:t.formatMessage(P.fileSingular),objectTypePlural:t.formatMessage(P.filesPlural),externalLinkableUnitSingular:t.formatMessage(P.domainSingular),externalLinkableUnitPlural:t.formatMessage(P.domainsPlural)}}const Bs=-1;function J(s){switch(s.knowledge_connector_type){case void 0:return 0;case"slack":case"github":case"google_drive_dwd":return Bs;case"google_drive_oauth":return 10;case"merge_file_storage":return 10}}function Us(s){switch(s){case"google_drive_dwd":return 3;case"google_drive_oauth":return 3;case"slack":return 3;case"github":return 3;case"merge_file_storage":return 3}}const Gs=s=>u.createElement("svg",{width:20,height:20,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},u.createElement("g",{id:"icon / connected, dynamic, gpt"},u.createElement("path",{id:"vector",d:"M5.23841 3.95847C5.73982 3.95517 6.38371 4.09048 7.13793 4.39217C7.58 4.569 8.04665 4.79764 8.52798 5.07508C7.9105 5.56392 7.29772 6.10893 6.70332 6.70333C6.10893 7.29772 5.56392 7.9105 5.07508 8.52798C4.79764 8.04665 4.569 7.58 4.39217 7.13793C4.09048 6.38371 3.95517 5.73982 3.95847 5.23841C3.96174 4.74203 4.09727 4.4464 4.27183 4.27183C4.4464 4.09727 4.74203 3.96174 5.23841 3.95847ZM10.0001 4.02079C9.23413 3.52937 8.47766 3.13301 7.75692 2.84471C6.87793 2.49312 6.01323 2.28667 5.22743 2.29184C4.4366 2.29705 3.66642 2.52023 3.09332 3.09332C2.52023 3.66642 2.29705 4.4366 2.29184 5.22743C2.28667 6.01323 2.49312 6.87793 2.84471 7.75692C3.13301 8.47766 3.52937 9.23413 4.02079 10.0001C3.52937 10.766 3.13301 11.5225 2.84471 12.2432C2.49312 13.1222 2.28667 13.9869 2.29184 14.7727C2.29705 15.5636 2.52023 16.3337 3.09332 16.9068C3.66642 17.4799 4.4366 17.7031 5.22743 17.7083C6.01323 17.7135 6.87793 17.507 7.75692 17.1555C8.47766 16.8672 9.23413 16.4708 10.0001 15.9794C10.766 16.4708 11.5225 16.8672 12.2432 17.1555C13.1222 17.507 13.9869 17.7135 14.7727 17.7083C15.5636 17.7031 16.3337 17.4799 16.9068 16.9068C17.4799 16.3337 17.7031 15.5636 17.7083 14.7727C17.7135 13.9869 17.507 13.1222 17.1555 12.2432C16.8672 11.5225 16.4708 10.766 15.9794 10.0001C16.4708 9.23413 16.8672 8.47766 17.1555 7.75692C17.507 6.87793 17.7135 6.01323 17.7083 5.22743C17.7031 4.43661 17.4799 3.66642 16.9068 3.09332C16.3337 2.52023 15.5636 2.29705 14.7727 2.29184C13.9869 2.28667 13.1222 2.49312 12.2432 2.84471C11.5225 3.13301 10.766 3.52937 10.0001 4.02079ZM10.0001 6.04624C10.7059 6.57001 11.4212 7.18471 12.1183 7.88184C12.8154 8.57896 13.4301 9.29429 13.9539 10.0001C13.4301 10.7059 12.8154 11.4212 12.1183 12.1183C11.4212 12.8154 10.7059 13.4301 10.0001 13.9539C9.29429 13.4301 8.57896 12.8154 7.88184 12.1183C7.18471 11.4212 6.57001 10.7059 6.04624 10.0001C6.57001 9.29429 7.18471 8.57896 7.88184 7.88184C8.57896 7.18471 9.29429 6.57001 10.0001 6.04624ZM14.9251 8.52798C14.4362 7.9105 13.8912 7.29772 13.2968 6.70332C12.7024 6.10893 12.0897 5.56392 11.4722 5.07508C11.9535 4.79764 12.4202 4.569 12.8622 4.39217C13.6164 4.09048 14.2603 3.95517 14.7618 3.95847C15.2581 3.96174 15.5538 4.09727 15.7283 4.27184C15.9029 4.4464 16.0384 4.74203 16.0417 5.23841C16.045 5.73982 15.9097 6.38371 15.608 7.13793C15.4312 7.58 15.2025 8.04665 14.9251 8.52798ZM14.9251 11.4722C15.2025 11.9535 15.4312 12.4202 15.608 12.8622C15.9097 13.6164 16.045 14.2603 16.0417 14.7618C16.0384 15.2581 15.9029 15.5538 15.7283 15.7283C15.5538 15.9029 15.2581 16.0384 14.7618 16.0417C14.2603 16.045 13.6164 15.9097 12.8622 15.608C12.4202 15.4312 11.9535 15.2025 11.4722 14.9251C12.0897 14.4362 12.7024 13.8912 13.2968 13.2968C13.8912 12.7024 14.4362 12.0897 14.9251 11.4722ZM8.52798 14.9251C8.04665 15.2025 7.58 15.4312 7.13793 15.608C6.38371 15.9097 5.73982 16.045 5.23841 16.0417C4.74203 16.0384 4.4464 15.9029 4.27183 15.7283C4.09727 15.5538 3.96174 15.2581 3.95847 14.7618C3.95517 14.2603 4.09048 13.6164 4.39217 12.8622C4.569 12.4202 4.79764 11.9535 5.07508 11.4722C5.56392 12.0897 6.10893 12.7024 6.70332 13.2968C7.29772 13.8912 7.91049 14.4362 8.52798 14.9251Z",fill:"currentColor"})));function q({label:s,value:t}){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full border-t border-token-border-medium"}),e.jsxs("div",{className:"flex w-full flex-row justify-between py-2",children:[e.jsx("span",{className:"text-token-text-primary",children:s}),e.jsx("span",{className:"text-token-text-secondary",children:t})]})]})}function qs({connection:s}){switch(s.connection_config.knowledge_connector_type){case"google_drive_oauth":return e.jsx(Ws,{connectionConfig:s.connection_config});case"slack":return e.jsx(Zs,{connectionConfig:s.connection_config,connectionStatus:s.connection_status});case"github":case"merge_file_storage":case"google_drive_dwd":return e.jsx(Vs,{});case void 0:return null}}function Ws({connectionConfig:s}){const t=y();return e.jsxs("div",{className:"px-4",children:[e.jsx(q,{label:t.formatMessage({id:"bVi1Vt",defaultMessage:"Connection type"}),value:t.formatMessage({id:"DSWj22",defaultMessage:"Self-service"})}),e.jsx(q,{label:t.formatMessage({id:"DtrjbM",defaultMessage:"Domain name"}),value:s.domain_name})]})}function Vs(){const s=y();return e.jsx("div",{className:"px-4",children:e.jsx(q,{label:s.formatMessage({id:"bVi1Vt",defaultMessage:"Connection type"}),value:s.formatMessage({id:"voo3FC",defaultMessage:"Admin-managed"})})})}function Zs({connectionConfig:s,connectionStatus:t}){const n=y();return e.jsxs("div",{className:"px-4",children:[t==="activating"&&e.jsx(Ys,{connectionConfig:s}),e.jsx(q,{label:n.formatMessage({id:"JXKtnI",defaultMessage:"Slack domain"}),value:s.team_domain}),e.jsx(q,{label:n.formatMessage({id:"a1Cjhf",defaultMessage:"Team ID"}),value:s.team_id})]})}function Ys({connectionConfig:s}){const{data:t,isLoading:n}=I({queryKey:["user_connection_status"],queryFn:v.user_connection_status}),a=t?.connection_statuses.some(l=>l.user_connection_details.connection_instance_id===s.connection_config_id&&l.user_connection_details.auth_status==="user_connected");return n||a?null:e.jsxs(Ce.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{delay:.2,duration:.5},className:"mb-2 flex flex-col gap-2 rounded-xl bg-token-hint-bg p-4 dark:bg-token-main-surface-tertiary",children:[e.jsxs("div",{className:"flex flex-row items-start gap-4",children:[e.jsx(os,{className:"icon-lg"}),e.jsx("span",{className:"text-sm",children:e.jsx(o,{id:"gdALIj",defaultMessage:"This connection will not finish activating until a user connects."})})]}),e.jsx(zs,{connectionConfig:s})]})}function zs({connectionConfig:s}){const t=y(),n=ts(),a=w(),l=async()=>{try{const i=await v.user_request_connect(s.connection_config_id,`${n.pathname}${n.search}${n.hash}`);window.location.href=i.oauth_flow_url}catch{a.danger(t.formatMessage({id:"FNXFnS",defaultMessage:"Encountered an error connecting your account. Please try again later."}))}};return e.jsx(j,{onClick:l,color:"primary",children:e.jsx(o,{id:"9ZiK24",defaultMessage:"Connect"})})}const Hs=s=>u.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},u.createElement("path",{d:"M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12Z",fill:"currentColor"}),u.createElement("path",{d:"M13.3 12.0002C13.3 12.7182 12.718 13.3002 12 13.3002C11.282 13.3002 10.7 12.7182 10.7 12.0002C10.7 11.2822 11.282 10.7002 12 10.7002C12.718 10.7002 13.3 11.2822 13.3 12.0002Z",fill:"currentColor"}),u.createElement("path",{d:"M17.3 12.0002C17.3 12.7182 16.718 13.3002 16 13.3002C15.282 13.3002 14.7 12.7182 14.7 12.0002C14.7 11.2822 15.282 10.7002 16 10.7002C16.718 10.7002 17.3 11.2822 17.3 12.0002Z",fill:"currentColor"}),u.createElement("path",{d:"M9.30001 12.0002C9.30001 12.7182 8.71798 13.3002 8.00001 13.3002C7.28204 13.3002 6.70001 12.7182 6.70001 12.0002C6.70001 11.2822 7.28204 10.7002 8.00001 10.7002C8.71798 10.7002 9.30001 11.2822 9.30001 12.0002Z",fill:"currentColor"})),V={isOpen:!0,type:"success",size:"custom",className:"max-w-xl",showCloseButton:!0,shouldIgnoreClickOutside:!0};function K({onClose:s,footerContent:t,primaryButton:n,secondaryButton:a,pageSize:l=us,accountId:i,connectionId:r,maxAllowedUsers:c}){const f=y(),[d,x]=u.useState(""),m=L(),[g,p]=u.useState(0),{data:h,isLoading:b}=rs(m?.getWorkspaceId(),g*l,d,l),{data:_,isLoading:C,refetch:M,error:D}=I({queryKey:["admin_connection_get_access_policy",r],queryFn:()=>v.admin_connection_get_access_policy(i,r)}),E=Math.ceil((h?.total??0)/l);g>=E&&E!==0&&p(Math.max(E-1,0));const[A,We]=u.useState(!1),[Ve,Ze]=u.useState(0),Q=Ve>0||A,ce=C||b||Q,$=c===-1,Ye=$||(_?.allowed_users.length??0)<c;return e.jsxs(N,{...V,onClose:s,title:f.formatMessage({id:"CRS4/4",defaultMessage:"Select users"}),footerContent:t,primaryButton:Q&&n?u.cloneElement(n,{disabled:!0,onClick:()=>{}}):n,secondaryButton:Q&&a?u.cloneElement(a,{disabled:!0,onClick:()=>{}}):a,children:[e.jsx("p",{className:"mb-1 text-token-text-secondary",children:e.jsx(o,{id:"cF1VVu",defaultMessage:"Select which workspace members can use this connection."})}),e.jsx("div",{className:"mb-4 flex flex-row justify-between",children:$?null:C?e.jsx(R,{lines:1,className:"w-full"}):e.jsx("p",{children:e.jsx(Xs,{numSelectedUsers:_?.allowed_users.length??0,maxAllowedUsers:c})})}),e.jsxs("div",{className:"mb-4 flex flex-row items-center",children:[e.jsxs("div",{className:"group relative",children:[e.jsx("input",{type:"text",value:d,onChange:G=>{x(G.target.value),p(0)},disabled:!!_?.allow_all_in_workspace,placeholder:f.formatMessage({id:"RWqomV",defaultMessage:"Search"}),className:"rounded-lg border border-solid border-token-border-light bg-token-main-surface-primary pl-10 text-token-text-primary"}),e.jsx("div",{className:"absolute left-2 top-0 flex h-full w-8 items-center justify-center",children:e.jsx(cs,{className:"icon-md text-token-text-tertiary group-focus-within:text-token-text-secondary"})})]}),ce&&e.jsx(B,{className:"ml-4 h-4 w-4"})]}),D&&e.jsxs("div",{className:"my-2 flex flex-row items-center gap-2 rounded-lg bg-red-500 p-2 text-white",children:[e.jsx(le,{className:"icon-md inline"}),e.jsx(o,{id:"ZhxtEO",defaultMessage:"Failed to load allowed users."}),e.jsx("button",{onClick:()=>M(),className:"underline",children:e.jsx(o,{id:"y/IEAC",defaultMessage:"Try again"})})]}),e.jsx("div",{className:O("h-[200px] max-h-[600px] overflow-y-auto px-2",_?.allow_all_in_workspace&&"opacity-50"),children:e.jsx("table",{children:e.jsx("tbody",{children:h?.items.length?h.items.map(({id:G,name:ze,email:He})=>{const de=!!_?.allowed_users.includes(G);return e.jsx("tr",{className:"mb-2",children:e.jsx("td",{children:e.jsx(Js,{controlDisabled:!de&&!Ye||!!_?.allow_all_in_workspace||A,userId:G,isUserEnabled:de||!!_?.allow_all_in_workspace,accountId:i,connectionId:r,refetch:M,setNumPendingUserOperations:Ze,name:ze,email:He})})},G)}):e.jsx("tr",{children:e.jsx("td",{children:e.jsx(o,{id:"n3uhaN",defaultMessage:"No users found"})})})})})}),E>1&&e.jsx("div",{className:"my-4",children:e.jsx(ds,{currentPage:g,onChangeIndex:p,length:E})}),$&&e.jsx(Ks,{allowAllInWorkspace:!!_?.allow_all_in_workspace,controlDisabled:ce,refetch:M,accountId:i,connectionId:r,setShouldBlockOtherInteractions:We})]})}function Js({userId:s,controlDisabled:t,isUserEnabled:n,refetch:a,setNumPendingUserOperations:l,accountId:i,connectionId:r,name:c,email:f}){const d=y(),x=w(),[m,g]=u.useState(!1),p=async _=>{if(!t){g(!0),l(C=>C+1);try{await v.admin_connection_allow_user(i,r,_),await a()}catch{x.danger(d.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}finally{g(!1),l(C=>C-1)}}},h=async _=>{g(!0),l(C=>C+1);try{await v.admin_connection_disallow_user(i,r,_),await a()}catch{x.danger(d.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}finally{g(!1),l(C=>C-1)}},b=e.jsxs("p",{children:[e.jsx("span",{className:"text-token-text-primary",children:c}),e.jsx("span",{className:"ml-2 text-token-text-tertiary",children:f})]});return e.jsx(Ie,{isLoading:m,id:`is-user-enabled--${s}`,disabled:t,checked:n,onChange:_=>{t||m||(_.currentTarget.checked?p(s):h(s))},label:b})}function Ks({allowAllInWorkspace:s,controlDisabled:t=!1,accountId:n,connectionId:a,refetch:l,setShouldBlockOtherInteractions:i}){const r=y(),c=w(),[f,d]=u.useState(!1),x=async m=>{if(!t){d(!0),i(!0);try{await v.admin_connection_update_access_policy(n,a,m),await l()}catch{await l(),c.danger(r.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}finally{d(!1),i(!1)}}};return e.jsx(Ie,{isLoading:f,id:"enabled-for-everyone-checkbox",checked:s,disabled:t,onChange:m=>{t||x(m.currentTarget.checked)},label:e.jsx("span",{className:"ml-2 text-token-text-primary",children:e.jsx(o,{id:"MsFKpF",defaultMessage:"Enable for everyone"})})})}function Ie({isLoading:s,...t}){return s?e.jsxs("div",{className:"form-check flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("div",{className:"form-check-label text-token-text-primary",children:t.label})]}):e.jsx(ms,{...t})}function Xs({maxAllowedUsers:s,numSelectedUsers:t}){return t>=s?e.jsx(o,{id:"JWJ5gc",defaultMessage:`{numSelectedUsers, plural,
          =0 {No users}
          one {# user}
          other {# users}
        } selected. You cannot select any more.`,values:{numSelectedUsers:t}}):t>0?e.jsx(o,{id:"dYtUgP",defaultMessage:`{numSelectedUsers, plural,
          =0 {No users}
          one {# user}
          other {# users}
        } selected. You can select up to {remainingAllowedUsers} more.`,values:{numSelectedUsers:t,remainingAllowedUsers:s-t}}):e.jsx(o,{id:"nVfqBL",defaultMessage:`Select up to {maxAllowedUsers, plural,
          =0 {No users}
          one {# user}
          other {# users}
        }.`,values:{maxAllowedUsers:s}})}const ie=s=>u.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},u.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.53 2.5C18.9777 2.5 18.53 2.94772 18.53 3.5V5.07196C16.8313 3.47759 14.5452 2.5 12.03 2.5C6.78329 2.5 2.53 6.75329 2.53 12C2.53 17.2467 6.78329 21.5 12.03 21.5C16.8993 21.5 20.9117 17.8375 21.465 13.1164C21.5293 12.5679 21.1367 12.0711 20.5882 12.0068C20.0397 11.9425 19.5429 12.3351 19.4786 12.8836C19.042 16.6089 15.8729 19.5 12.03 19.5C7.88786 19.5 4.53 16.1421 4.53 12C4.53 7.85786 7.88786 4.5 12.03 4.5C14.2504 4.5 16.2464 5.46469 17.6205 7H15.5C14.9477 7 14.5 7.44772 14.5 8C14.5 8.55228 14.9477 9 15.5 9H19.53C20.0694 9 20.509 8.57299 20.5293 8.03859C20.5302 8.01771 20.5304 7.99677 20.53 7.9758V3.5C20.53 2.94772 20.0823 2.5 19.53 2.5Z",fill:"currentColor"}));function Qs({isOpen:s,onClose:t,objectType:n,connectionId:a,accountId:l}){const[i,r]=u.useState(null),[c,f]=u.useState([]),[d,x]=u.useState(!1),[m,g]=u.useState(!1),p=y(),h=async C=>{x(!0),g(!1);try{const M=await v.admin_connection_list_item_scopes(l,a,n,C);r(M.page_token??null),f(D=>[...D,...M.object_selections.map(E=>E.object_handle)])}catch{g(!0)}finally{x(!1)}},b=async()=>{r(null),x(!1),f([]),g(!1),h(null)},_=u.useRef(!1);return u.useEffect(()=>{_.current||(_.current=!0,b())},[]),e.jsx(N,{isOpen:s,onClose:t,type:"success",size:"custom",className:"max-w-xl",showCloseButton:!0,title:p.formatMessage({id:"BVUVRc",defaultMessage:"Block items"}),children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-sm text-token-text-secondary",children:e.jsx(o,{id:"LYXIh1",defaultMessage:"Found something that shouldn't be synced? You can block items here to prevent them from being synced or shown in search results."})}),e.jsx(st,{connectionId:a,accountId:l,onItemBlocked:b,objectType:n}),e.jsx($s,{connectionId:a,accountId:l,isLoading:d,hasError:m,hasMoreItems:i!=null,loadMoreItems:()=>h(i),objectType:n,objectHandles:c,onItemUnblocked:b})]})})}function $s({connectionId:s,accountId:t,objectHandles:n,isLoading:a,hasError:l,hasMoreItems:i,loadMoreItems:r,onItemUnblocked:c,objectType:f}){return e.jsxs("div",{children:[e.jsx("h3",{className:"mb-2 font-medium",children:e.jsx(o,{id:"gimLZo",defaultMessage:"Currently blocked items"})}),l?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(o,{id:"3BZzpX",defaultMessage:"Something went wrong"})}),e.jsx("div",{children:e.jsx(j,{color:"secondary",icon:ie,onClick:r,children:e.jsx(o,{id:"fFd9RR",defaultMessage:"Try again"})})})]}):e.jsxs(e.Fragment,{children:[n.length>0||a?e.jsx("ul",{className:"flex flex-col gap-1",children:n.map(d=>e.jsx(et,{connectionId:s,accountId:t,objectType:f,objectHandle:d,onItemUnblocked:c},d))}):e.jsx("p",{className:"text-sm text-token-text-secondary",children:e.jsx(o,{id:"IGg+fh",defaultMessage:"No items are currently being blocked."})}),a?e.jsx(R,{lines:1}):i&&e.jsx(j,{color:"ghost",icon:Fs,onClick:r,children:e.jsx(o,{id:"g+Tw+y",defaultMessage:"See more"})})]})]})}function et({connectionId:s,accountId:t,objectHandle:n,onItemUnblocked:a,objectType:l}){const i=w(),r=y();return e.jsx(te,{scopeChangeIcon:se,scopeChangeLabel:r.formatMessage({id:"yaj/om",defaultMessage:"Unblock item"}),scopeChangeTarget:"include",objectHandle:n,objectType:l,onError:()=>{i.danger(r.formatMessage({id:"yRm6yX",defaultMessage:"Failed to unblock item. Please try again later."}))},onScopeUpdated:()=>{i.success(r.formatMessage({id:"Xot/uQ",defaultMessage:"Item successfully unblocked."})),a()},connectionId:s,accountId:t})}function te({connectionId:s,accountId:t,objectType:n,objectHandle:a,scopeChangeTarget:l,scopeChangeLabel:i,scopeChangeIcon:r,onScopeUpdated:c,onError:f}){const[d,x]=u.useState(!1),{isPending:m,mutate:g}=W({mutationFn:async()=>l==="exclude"?await v.admin_connection_block_items(t,s,n,[a]):await v.admin_connection_unblock_items(t,s,n,[a]),mutationKey:["admin_connection_update_item_scope",s,n,l,a],onSuccess:()=>{c(),x(!1)},onError:()=>{x(!1),f()}});return e.jsxs("li",{className:"group flex w-full flex-row rounded-xl px-4 py-1 text-sm hover:bg-token-surface-hover",children:[e.jsx("span",{className:"flex-1",children:a}),e.jsxs(F.Root,{open:d||m,onOpenChange:x,children:[e.jsx(F.Trigger,{className:O("flex-0 h-6 group-hover:visible",!d&&"invisible"),children:e.jsx(Se,{className:"icon-sm"})}),e.jsx(F.Portal,{children:e.jsx(F.Content,{size:"small",children:e.jsx(F.Item,{icon:m?B:r,onSelect:()=>g(),disabled:m,children:i})})})]})]})}function st({accountId:s,connectionId:t,onItemBlocked:n,objectType:a}){const l=w(),i=y();return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-medium",children:e.jsx(o,{id:"dU+IPT",defaultMessage:"Block an item"})}),e.jsx("p",{className:"text-sm text-token-text-secondary",children:e.jsx(o,{id:"y6yn/t",defaultMessage:"Enter the ID or URL of the item you want to block."})}),e.jsx(ae,{accountId:s,connectionId:t,objectType:a,onSuccess:()=>{l.success(i.formatMessage({id:"Q+KnAh",defaultMessage:"Item successfully blocked."})),n()},onError:()=>{l.danger(i.formatMessage({id:"UH92LU",defaultMessage:"Failed to block item. Please try again later."}))},targetScopeSelection:"exclude",buttonLabel:e.jsx(o,{id:"5FIVI9",defaultMessage:"Block"})})]})}function ae({accountId:s,connectionId:t,objectType:n,onSuccess:a,onError:l,placeholder:i,targetScopeSelection:r,buttonLabel:c}){const f=y(),[d,x]=u.useState(""),{isPending:m,mutate:g}=W({mutationFn:async()=>{if(d.trim())return r==="exclude"?await v.admin_connection_block_items(s,t,n,[d]):await v.admin_connection_unblock_items(s,t,n,[d])},mutationKey:["admin_connection_update_item_scope",t,n,r,d],onSuccess:()=>{a(),x("")},onError:l});return e.jsx("form",{onSubmit:p=>{p.preventDefault(),d.trim()&&g()},children:e.jsxs("div",{className:"flex w-full flex-row gap-2",children:[e.jsx(xs,{type:"text",className:"flex-1",name:"objectHandle",ariaLabel:"object handle",value:d,onChange:p=>x(p.target.value),placeholder:i??f.formatMessage({id:"sPUyj/",defaultMessage:"ID or URL"}),disabled:m}),e.jsx(j,{color:"primary",type:"button",onClick:()=>g(),loading:m,disabled:m||!d.trim(),className:"flex-0",children:c})]})})}function Pe({accountId:s,connectionId:t,onClose:n,onNext:a,secondaryButton:l,footerContent:i}){const r=y(),c=w(),f=u.useId(),[d,x]=u.useState(""),[m,g]=u.useState(null),[p,h]=u.useState(!1),{isLoading:b,refetch:_,data:C}=I({queryKey:["admin:connection_instance",t],queryFn:async()=>await v.admin_get_connection_instance(s,t)});u.useEffect(()=>{C?.connection_config.knowledge_connector_type==="google_drive_dwd"&&x(C.connection_config.admin_email_address??"")},[C]);const M=C?.connection_config.knowledge_connector_type==="google_drive_dwd"?C.connection_config.service_account_credential_id:void 0,D=d.trim().length>0&&(!!m||M),E=async()=>{if(!(!D||!s||p)){h(!0);try{let A;m&&(A=await m.text()),await v.admin_connection_update_credential(s,t,{admin_email:d,new_service_credential_content:A,credential_id:M&&!A?M:void 0}),c.success(r.formatMessage({id:"q/AX/d",defaultMessage:"Credentials successfully updated."})),a()}catch{c.danger(r.formatMessage({id:"qbD4Az",defaultMessage:"Failed to update credentials."}))}finally{_(),h(!1)}}};return e.jsx(N,{...V,onClose:n,title:r.formatMessage({id:"/LIRh9",defaultMessage:"Configure credentials"}),primaryButton:e.jsx(j,{loading:p,color:"primary",disabled:!D||p,onClick:E,children:e.jsx(o,{id:"+itf/D",defaultMessage:"Save"})}),secondaryButton:l,footerContent:i,children:b?e.jsx(R,{lines:4}):e.jsxs("form",{onSubmit:A=>{A.preventDefault(),D&&E()},className:"flex flex-col",children:[e.jsx("button",{type:"submit",className:"display-none"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(tt,{existingServiceKeyId:M,serviceKeyFile:m,setServiceKeyFile:g}),e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsx("label",{htmlFor:f,className:"text-base font-medium text-token-text-secondary",children:e.jsx(o,{id:"sPqjJA",defaultMessage:"Google Workspace admin email address"})}),e.jsx("input",{type:"text",value:d,onChange:A=>x(A.target.value),placeholder:r.formatMessage({id:"+zP1RE",defaultMessage:"admin@example.com"}),id:f,className:"rounded-lg border border-solid border-token-border-light bg-token-main-surface-primary text-token-text-primary"}),e.jsx("p",{className:"text-sm text-token-text-secondary",children:e.jsx(o,{id:"Y8w9Sz",defaultMessage:"We require a Google Workspace admin user's email to perform administrative actions like listing users and discovering Shared Drives with the provided service account key."})})]})]})]})})}function tt({existingServiceKeyId:s,serviceKeyFile:t,setServiceKeyFile:n}){const a=u.useRef(null),l=u.useId();return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-base font-medium text-token-text-secondary",children:e.jsx(o,{id:"gI0O53",defaultMessage:"Service account key"})}),!!s&&!t&&e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(z,{className:"icon-sm"}),e.jsx(o,{id:"B+/4/L",defaultMessage:"Service account key already exists."})]}),!!t&&e.jsx("p",{className:"text-token-text-secondary",children:t.name}),e.jsxs("div",{className:"flex flex-row gap-2",children:[!s&&!t&&e.jsx(j,{color:"primary",type:"button",onClick:()=>a.current?.click(),children:e.jsx(o,{id:"4GjErm",defaultMessage:"Upload key"})}),(!!s&&!t||!s&&!!t)&&e.jsx(j,{color:"secondary",type:"button",onClick:()=>a.current?.click(),children:e.jsx(o,{id:"qV3zuG",defaultMessage:"Replace key"})}),!!s&&!!t&&e.jsx(j,{color:"danger-outline",type:"button",onClick:()=>n(null),children:e.jsx(o,{id:"NFpNok",defaultMessage:"Clear"})})]}),e.jsx("input",{type:"file",className:"hidden",id:l,ref:a,onChange:i=>{i.target.files&&i.target.files.length>0?n(i.target.files[0]):n(null)},accept:".json"})]})}function Oe({isOpen:s,onClose:t,connectionId:n,accountId:a,primaryButton:l,secondaryButton:i,footerContent:r}){const c=y(),{refetch:f,data:d,error:x,isLoading:m}=I({queryFn:()=>nt({accountId:a,connectionId:n}),queryKey:["admin_connection_list_item_scopes",n,"shared_drive"]});return e.jsx(N,{isOpen:s,onClose:t,type:"success",size:"custom",className:"max-w-xl",showCloseButton:!0,title:c.formatMessage({id:"wPzMk8",defaultMessage:"Shared drives"}),primaryButton:l,secondaryButton:i,footerContent:r,children:e.jsx("div",{className:"flex flex-col gap-6",children:m?e.jsx(R,{lines:4}):x?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(o,{id:"3BZzpX",defaultMessage:"Something went wrong"})}),e.jsx("div",{children:e.jsx(j,{color:"secondary",icon:ie,onClick:()=>f(),children:e.jsx(o,{id:"fFd9RR",defaultMessage:"Try again"})})})]}):e.jsx(e.Fragment,{children:d&&e.jsx(at,{accountId:a,connectionId:n,sharedDriveDefaultScope:d.default_selection,sharedDriveScopes:d.object_selections,refetch:f})})})})}function at({refetch:s,accountId:t,connectionId:n,sharedDriveDefaultScope:a,sharedDriveScopes:l}){const i=y(),r=w(),{isPending:c,mutate:f}=W({mutationFn:async d=>await v.admin_connection_update_item_default_scope(t,n,"shared_drive",d),mutationKey:["admin_connection_update_item_default_scope",n,"shared_drive"],onError:()=>{r.danger(i.formatMessage({id:"YnlDV7",defaultMessage:"Failed to update policy."}))},onSettled:()=>{s()}});return e.jsxs("div",{className:"mb-6 flex flex-col gap-2",children:[e.jsx(Es,{ariaLabel:{id:"ca.scope-selector.aria-label",defaultMessage:"Select whether Shared drives are included or exlcuded from syncing by default.",description:"@nocommit"},onChange:d=>{c||f(d)},value:a,leftItem:{ariaLabel:Z.includeToggleLabel,label:Z.includeToggleLabel,value:"include"},rightItem:{ariaLabel:Z.excludeToggleLabel,label:Z.excludeToggleLabel,value:"exclude"}}),c?e.jsx(R,{lines:3}):a==="include"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-token-text-secondary",children:e.jsx(o,{id:"dmDuO6",defaultMessage:"All Shared drives will be synced except for ones you choose to exclude."})}),e.jsx("p",{className:"font-medium text-token-text-secondary",children:e.jsx(o,{id:"buyi/M",defaultMessage:"Excluded Shared drives"})}),e.jsx("ul",{children:l.filter(d=>d.selection==="exclude").map(d=>e.jsx(te,{objectHandle:d.object_handle,objectType:"shared_drive",accountId:t,connectionId:n,scopeChangeIcon:se,scopeChangeLabel:i.formatMessage({id:"NLi7nF",defaultMessage:"Remove exclusion"}),scopeChangeTarget:"include",onError:()=>{r.danger(i.formatMessage({id:"tdBT+A",defaultMessage:"Failed to remove exclusion. Please try again later."}))},onScopeUpdated:()=>{r.success(i.formatMessage({id:"AC/4a7",defaultMessage:"Sucessfully removed exclusion."})),s()}},d.object_handle))}),e.jsx(ae,{objectType:"shared_drive",targetScopeSelection:"exclude",accountId:t,connectionId:n,buttonLabel:i.formatMessage({id:"ThGxVh",defaultMessage:"Exclude"}),onSuccess:()=>{r.success(i.formatMessage({id:"1hsj8s",defaultMessage:"Shared drive has been excluded."})),s()},onError:()=>{r.danger(i.formatMessage({id:"4JkX1y",defaultMessage:"Failed to exclude Shared drive. Please try again later."}))}})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-token-text-secondary",children:e.jsx(o,{id:"Pa+iyD",defaultMessage:"Only the Shared drives you select will be synced."})}),e.jsx("p",{className:"font-medium text-token-text-secondary",children:e.jsx(o,{id:"e4EV27",defaultMessage:"Included Shared drives"})}),e.jsx("ul",{children:l.filter(d=>d.selection==="include").map(d=>e.jsx(te,{objectHandle:d.object_handle,objectType:"shared_drive",accountId:t,connectionId:n,scopeChangeIcon:se,scopeChangeLabel:i.formatMessage({id:"/oSk2L",defaultMessage:"Remove inclusion"}),scopeChangeTarget:"exclude",onError:()=>{r.danger(i.formatMessage({id:"JhaVH0",defaultMessage:"Failed to remove inclusion. Please try again later."}))},onScopeUpdated:()=>{r.success(i.formatMessage({id:"m6h3gf",defaultMessage:"Sucessfully removed inclusion."})),s()}},d.object_handle))}),e.jsx(ae,{objectType:"shared_drive",targetScopeSelection:"include",accountId:t,connectionId:n,buttonLabel:i.formatMessage({id:"At82Iq",defaultMessage:"Include"}),onSuccess:()=>{r.success(i.formatMessage({id:"IMoGWZ",defaultMessage:"Shared drive has been included."})),s()},onError:()=>{r.danger(i.formatMessage({id:"De2z4Y",defaultMessage:"Failed to include Shared drive. Please try again later."}))}})]})]})}const Z=H({includeToggleLabel:{id:"ca.scope-selection.include-by-default",defaultMessage:"Include by default"},excludeToggleLabel:{id:"ca.scope-selection.exclude-by-default",defaultMessage:"Exclude by default"},includeUserDrivesLabel:{id:"pDGrBu",defaultMessage:"Include user-owned files?"}});async function nt({accountId:s,connectionId:t}){const n=[];let a=await v.admin_connection_list_item_scopes(s,t,"shared_drive",null);for(n.push(a);a.page_token!=null;)a=await v.admin_connection_list_item_scopes(s,t,"shared_drive",a.page_token),n.push(a);return{object_type:"shared_drive",default_selection:n[0].default_selection,object_selections:n.flatMap(i=>i.object_selections)}}const Le=s=>u.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},u.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM9.70711 8.29289C9.31658 7.90237 8.68342 7.90237 8.29289 8.29289C7.90237 8.68342 7.90237 9.31658 8.29289 9.70711L10.5858 12L8.29289 14.2929C7.90237 14.6834 7.90237 15.3166 8.29289 15.7071C8.68342 16.0976 9.31658 16.0976 9.70711 15.7071L12 13.4142L14.2929 15.7071C14.6834 16.0976 15.3166 16.0976 15.7071 15.7071C16.0976 15.3166 16.0976 14.6834 15.7071 14.2929L13.4142 12L15.7071 9.70711C16.0976 9.31658 16.0976 8.68342 15.7071 8.29289C15.3166 7.90237 14.6834 7.90237 14.2929 8.29289L12 10.5858L9.70711 8.29289Z",fill:"currentColor"}));function Te({isOpen:s,onClose:t,connectionId:n,accountId:a,isPostActivation:l,footerContent:i,primaryButton:r,secondaryButton:c}){const f=y(),d=w(),{refetch:x,data:m,error:g,isLoading:p}=I({queryFn:async()=>await v.admin_connection_list_item_scopes(a,n,"user_drive"),queryKey:["admin_connection_list_item_scopes",n,"user_drive"]}),{isPending:h,mutate:b}=W({mutationFn:async C=>await v.admin_connection_update_item_default_scope(a,n,"user_drive",C?"include":"exclude"),mutationKey:["admin_connection_update_item_default_scope",n,"user_drive"],onError:()=>{d.danger(f.formatMessage({id:"YnlDV7",defaultMessage:"Failed to update policy."}))},onSettled:()=>{x()}}),_=m?.default_selection==="include";return e.jsx(N,{isOpen:s,onClose:t,type:"success",size:"custom",className:"max-w-xl",showCloseButton:!0,title:f.formatMessage({id:"4+gACg",defaultMessage:"User files"}),footerContent:i,primaryButton:r,secondaryButton:c,children:e.jsx("div",{className:"mb-6 flex flex-col gap-6",children:p?e.jsx(R,{lines:4}):g?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2",children:[e.jsx("div",{className:"text-token-text-error",children:e.jsx(o,{id:"3BZzpX",defaultMessage:"Something went wrong"})}),e.jsx("div",{children:e.jsx(j,{color:"secondary",icon:ie,onClick:()=>x(),children:e.jsx(o,{id:"fFd9RR",defaultMessage:"Try again"})})})]}):l?e.jsx("div",{className:"group flex w-full flex-row items-center gap-4 rounded-xl border border-token-border-medium px-8 py-4",children:_?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"icon-lg"}),e.jsx("p",{className:"grow",children:e.jsx(o,{id:"rWqZ31",defaultMessage:"User owned files in My Drives are being synced."})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"icon-lg"}),e.jsx("p",{className:"grow",children:e.jsx(o,{id:"/dUChW",defaultMessage:"User owned files in My Drives are not being synced."})})]})}):e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex w-full flex-row items-center gap-4 rounded-xl bg-token-main-surface-secondary p-4 text-token-text-primary",children:[e.jsx(ne,{className:"icon-lg"}),e.jsx("span",{className:"text-sm",children:e.jsx(o,{id:"4vN9WK",defaultMessage:"You will not be able to change whether user My Drives are included once the connection starts syncing data."})})]}),e.jsxs("div",{className:"group flex w-full flex-row items-center gap-4 rounded-xl border border-token-border-medium px-8 py-4",children:[e.jsx(De,{enabled:_,disabled:h,label:f.formatMessage(pe.includeUserDrivesLabel),onChange:()=>{!h&&b(!_)}}),e.jsx("p",{children:e.jsx(o,{...pe.includeUserDrivesLabel})}),h&&e.jsx(B,{}),e.jsx("div",{className:"grow"}),e.jsx(ve,{label:e.jsx("p",{children:e.jsx(o,{id:"xJvlxk",defaultMessage:"Enable this setting to sync files in users' individual My Drives."})}),children:e.jsx(fs,{className:"icon-lg text-token-text-tertiary"})})]})]})})})}const pe=H({includeUserDrivesLabel:{id:"75ojp7",defaultMessage:"Include user My Drives?"}});function Be({connectionDisplayInfo:s}){return e.jsxs("span",{className:"whitespace-nowrap rounded-xl bg-token-main-surface-secondary px-2 py-1 font-bold",children:[s.icon_url&&e.jsx("img",{src:s.icon_url,alt:"",className:"icon-sm mr-2 inline"}),s.display_name]})}function X({isOpen:s,onClose:t,onActivate:n,connectionId:a,accountId:l,connectionDisplayInfo:i,footerContent:r,secondaryButton:c}){const f=y(),d=w(),[x,m]=u.useState(!1),g=()=>{m(!0),v.admin_activate_connection_instance(l,a).then(()=>{d.success(f.formatMessage({id:"y5DD0Z",defaultMessage:"Connection successfully activated."})),n?.(),t?.()}).catch(()=>{d.danger(f.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}).finally(()=>{m(!1)})};return e.jsx(N,{isOpen:s,onClose:t,type:"success",size:"custom",className:"max-w-xl",showCloseButton:!0,title:f.formatMessage({id:"6UJLk/",defaultMessage:"Review and activate"}),primaryButton:e.jsx(j,{color:"primary",loading:x,onClick:g,children:e.jsx(o,{id:"xiwfPc",defaultMessage:"Start syncing"})}),secondaryButton:c,footerContent:r,children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-sm text-token-text-secondary",children:e.jsx(o,{id:"+Pu3rR",defaultMessage:"If everything looks good, click the button to activate the connection and start syncing."})}),e.jsx(Be,{connectionDisplayInfo:i})]})})}function Ue({isOpen:s,onClose:t,connectionId:n,accountId:a,isPostActivation:l,footerContent:i,primaryButton:r,secondaryButton:c}){const f=y(),{data:d,isLoading:x,error:m,refetch:g}=I({queryKey:["slack_channel_type_scopes",n],queryFn:()=>v.admin_connection_list_item_scopes(a,n,"channel_type")});let p,h;return d?.object_selections.forEach(({object_handle:b,selection:_})=>{b==="public"?p=_==="include":b==="private"&&(h=_==="include")}),e.jsx(N,{isOpen:s,onClose:t,type:"success",size:"custom",className:"max-w-xl",showCloseButton:!0,title:f.formatMessage({id:"+qvqCO",defaultMessage:"Sync policy"}),footerContent:i,primaryButton:r,secondaryButton:c,children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-token-text-primary",children:e.jsx(o,{id:"Ot9UkQ",defaultMessage:"Control which types of channels should be synced."})}),!l&&e.jsxs("div",{className:"flex w-full flex-row items-center gap-4 rounded-xl bg-token-main-surface-secondary p-4 text-token-text-primary",children:[e.jsx(ne,{className:"icon-lg"}),e.jsx("span",{className:"text-sm",children:e.jsx(o,{id:"qByMz2",defaultMessage:"You will not be able to modify the sync policy once the connection starts syncing data."})})]}),m&&e.jsxs("div",{className:"my-2 flex flex-row items-center gap-2 rounded-lg bg-red-500 p-2 text-white",children:[e.jsx(le,{className:"icon-md inline"}),e.jsx(o,{id:"F9HsRh",defaultMessage:"Something went wrong."}),e.jsx("button",{onClick:()=>g(),className:"underline",children:e.jsx(o,{id:"y/IEAC",defaultMessage:"Try again"})})]}),x?e.jsx(R,{lines:4}):e.jsxs(e.Fragment,{children:[p!=null&&e.jsx(he,{connectionId:n,accountId:a,slackChannelScope:"public",title:f.formatMessage({id:"CXSVXf",defaultMessage:"Public channels"}),refetch:g,value:p,isPostActivation:l}),h!=null&&e.jsx(he,{connectionId:n,accountId:a,slackChannelScope:"private",title:f.formatMessage({id:"5XrboJ",defaultMessage:"Private channels"}),refetch:g,value:h,isPostActivation:l})]})]})})}function he({connectionId:s,accountId:t,slackChannelScope:n,title:a,refetch:l,value:i,isPostActivation:r}){const c=w(),f=y(),[d,x]=u.useState(!1),m=async g=>{if(!d){x(!0);try{g?await v.admin_connection_unblock_items(t,s,"channel_type",[n]):await v.admin_connection_block_items(t,s,"channel_type",[n]),l()}catch{c.danger(f.formatMessage({id:"7QF5n6",defaultMessage:"Failed to update policy. Please try again later."}))}finally{x(!1)}}};return r?e.jsxs("div",{className:"group flex w-full flex-row items-center gap-4 rounded-xl border border-token-border-medium px-8 py-4",children:[i?e.jsx(z,{className:"icon-lg"}):e.jsx(Le,{className:"icon-lg"}),e.jsx("p",{className:"flex-1",children:a})]}):e.jsxs("div",{className:"group flex w-full flex-row items-center gap-4 rounded-xl border border-token-border-medium px-8 py-4",children:[e.jsx(De,{enabled:i,disabled:d,label:a,onChange:m}),e.jsx("p",{children:a}),d&&e.jsx(B,{})]})}const lt=s=>u.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},u.createElement("path",{d:"M8.7587 3H15.2413C16.0463 2.99999 16.7106 2.99998 17.2518 3.04419C17.8139 3.09012 18.3306 3.18868 18.816 3.43597C19.5686 3.81947 20.1805 4.43139 20.564 5.18404C20.8113 5.66937 20.9099 6.18608 20.9558 6.74817C21 7.28936 21 7.95372 21 8.75868V15.2413C21 16.0463 21 16.7106 20.9558 17.2518C20.9099 17.8139 20.8113 18.3306 20.564 18.816C20.1805 19.5686 19.5686 20.1805 18.816 20.564C18.3306 20.8113 17.8139 20.9099 17.2518 20.9558C16.7106 21 16.0463 21 15.2413 21H8.75868C7.95372 21 7.28936 21 6.74817 20.9558C6.18608 20.9099 5.66937 20.8113 5.18404 20.564C4.43139 20.1805 3.81947 19.5686 3.43597 18.816C3.18868 18.3306 3.09012 17.8139 3.04419 17.2518C2.99998 16.7106 2.99999 16.0463 3 15.2413V8.7587C2.99999 7.95373 2.99998 7.28937 3.04419 6.74817C3.09012 6.18608 3.18868 5.66937 3.43597 5.18404C3.81947 4.43139 4.43139 3.81947 5.18404 3.43597C5.66937 3.18868 6.18608 3.09012 6.74817 3.04419C7.28937 2.99998 7.95373 2.99999 8.7587 3ZM6.91104 5.03755C6.47262 5.07337 6.24842 5.1383 6.09202 5.21799C5.7157 5.40973 5.40973 5.7157 5.21799 6.09202C5.1383 6.24842 5.07337 6.47262 5.03755 6.91104C5.00078 7.36113 5 7.94342 5 8.8V15.2C5 16.0566 5.00078 16.6389 5.03755 17.089C5.07337 17.5274 5.1383 17.7516 5.21799 17.908C5.40973 18.2843 5.7157 18.5903 6.09202 18.782C6.24842 18.8617 6.47262 18.9266 6.91104 18.9624C7.36113 18.9992 7.94342 19 8.8 19H15.2C16.0566 19 16.6389 18.9992 17.089 18.9624C17.5274 18.9266 17.7516 18.8617 17.908 18.782C18.2843 18.5903 18.5903 18.2843 18.782 17.908C18.8617 17.7516 18.9266 17.5274 18.9624 17.089C18.9992 16.6389 19 16.0566 19 15.2V8.8C19 7.94342 18.9992 7.36113 18.9624 6.91104C18.9266 6.47262 18.8617 6.24842 18.782 6.09202C18.5903 5.7157 18.2843 5.40973 17.908 5.21799C17.7516 5.1383 17.5274 5.07337 17.089 5.03755C16.6389 5.00078 16.0566 5 15.2 5H8.8C7.94342 5 7.36113 5.00078 6.91104 5.03755ZM16.3255 7.93219C16.7772 8.25003 16.8856 8.87383 16.5678 9.32549L11.8178 16.0755C11.6431 16.3237 11.3652 16.4792 11.0623 16.4981C10.7593 16.517 10.4642 16.3973 10.2601 16.1727L7.76006 13.4227C7.38855 13.014 7.41867 12.3816 7.82733 12.0101C8.23599 11.6386 8.86843 11.6687 9.23994 12.0773L10.9004 13.9039L14.9322 8.17451C15.25 7.72285 15.8738 7.61436 16.3255 7.93219Z",fill:"currentColor"}));function U({label:s,onClick:t}){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full px-4",children:e.jsx("div",{className:"w-full border-t border-token-border-medium"})}),e.jsxs("div",{className:"flew-row flex cursor-pointer items-center gap-4 px-4 py-2 hover:bg-token-surface-hover",onClick:t,children:[e.jsx("p",{className:"flex-1",children:s}),t&&e.jsx(Je,{className:"icon-md flex-0 text-token-text-secondary"})]})]})}function it({accountId:s,connectionId:t,refetch:n}){const[a,l]=u.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(U,{onClick:()=>l(!0),label:e.jsx(o,{id:"wM9lvD",defaultMessage:"Configure credentials"})}),a&&e.jsx(Pe,{onClose:()=>l(!1),onNext:()=>{n(),l(!1)},accountId:s,connectionId:t})]})}function ot({accountId:s,connectionId:t,isPostActivation:n}){const[a,l]=u.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(U,{onClick:()=>l(!0),label:e.jsx(o,{id:"lTeSGb",defaultMessage:"Sync policy"})}),a&&e.jsx(Ue,{isOpen:!0,onClose:()=>l(!1),accountId:s,connectionId:t,isPostActivation:n})]})}function rt({accountId:s,connectionId:t,isPostActivation:n}){const[a,l]=u.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(U,{onClick:()=>l(!0),label:e.jsx(o,{id:"AgDWHl",defaultMessage:"User drives"})}),a&&e.jsx(Te,{isOpen:!0,isPostActivation:n,onClose:()=>l(!1),accountId:s,connectionId:t})]})}function ct({accountId:s,connectionId:t}){const[n,a]=u.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(U,{onClick:()=>a(!0),label:e.jsx(o,{id:"gsRcYT",defaultMessage:"Shared drives"})}),n&&e.jsx(Oe,{isOpen:!0,onClose:()=>a(!1),accountId:s,connectionId:t})]})}function dt({accountId:s,connectionId:t,objectType:n}){const[a,l]=u.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(U,{onClick:()=>l(!0),label:e.jsx(o,{id:"tisZLQ",defaultMessage:"Block items"})}),a&&e.jsx(Qs,{isOpen:!0,onClose:()=>l(!1),accountId:s,connectionId:t,objectType:n})]})}function ut({accountId:s,connection:t}){const[n,a]=u.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(U,{onClick:()=>a(!0),label:e.jsx(o,{id:"9iRaQo",defaultMessage:"User access"})}),n&&e.jsx(K,{maxAllowedUsers:J(t.connection_config),onClose:()=>a(!1),accountId:s,connectionId:t.connection_config.connection_config_id})]})}function mt({accountId:s,connectionId:t,connectionDisplayInfo:n,onActivate:a,activationBlockingError:l}){const[i,r]=u.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full px-4",children:e.jsx("div",{className:"w-full border-t border-token-border-medium"})}),e.jsxs("div",{className:"flex w-full flex-col gap-2 p-4",children:[l&&e.jsx("p",{className:"text-sm text-token-text-secondary",children:l}),e.jsx(j,{color:l?"secondary":"primary",disabled:!!l,icon:lt,onClick:()=>r(!0),children:e.jsx(o,{id:"Tf31Mt",defaultMessage:"Review and start syncing"})})]}),i&&e.jsx(X,{isOpen:!0,onClose:()=>r(!1),accountId:s,connectionId:t,connectionDisplayInfo:n,onActivate:a})]})}const xt=({open:s,onOpenChange:t,deleteConnection:n,isDeleting:a,connectionDisplayInfo:l})=>{const i=y();return e.jsx(N,{isOpen:s,onClose:()=>t(!1),shouldIgnoreClickOutside:!0,title:i.formatMessage({id:"oXdl2Z",defaultMessage:"Confirm deletion"}),type:"danger",icon:ne,primaryButton:e.jsx(j,{color:"danger",onClick:n,disabled:a,loading:a,children:e.jsx(o,{id:"knS5PY",defaultMessage:"Delete"})}),secondaryButton:e.jsx(j,{color:"secondary",disabled:a,onClick:()=>{t(!1)},children:e.jsx(o,{id:"KnPHlG",defaultMessage:"Cancel"})}),children:e.jsxs("ul",{className:"px-4",children:[e.jsx("li",{className:"mb-2 list-disc pl-2",children:e.jsx(o,{id:"BvnNwE",defaultMessage:"You are about to delete the connection {connection_name}.",values:{connection_name:e.jsx(Be,{connectionDisplayInfo:l})}})}),e.jsx("li",{className:"mb-2 list-disc pl-2",children:e.jsx(o,{id:"0m+fk7",defaultMessage:"Deleting this connection will stop syncing and delete synced data."})}),e.jsx("li",{className:"mb-2 list-disc pl-2 font-bold",children:e.jsx(o,{id:"a86dO+",defaultMessage:"This action cannot be undone."})})]})})},ft=({open:s,onOpenChange:t,defaultName:n,accountId:a,connectionId:l,refetch:i})=>{const r=y(),[c,f]=u.useState(n),[d,x]=u.useState(!1),m=u.useId(),g=w(),p=u.useCallback(()=>{x(!0),v.admin_edit_name_connection_instance(a,l,{name:c}).then(()=>{g.success(r.formatMessage({id:"pepxEP",defaultMessage:"Connection updated successfully."})),i(),t(!1)}).catch(()=>{g.danger(r.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}).finally(()=>{x(!1)})},[a,l,r,c,t,i,g]);return e.jsx(N,{isOpen:s,onClose:()=>t(!1),shouldIgnoreClickOutside:!0,title:r.formatMessage({id:"mmCJWI",defaultMessage:"Rename"}),type:"success",icon:Ae,primaryButton:e.jsx(j,{onClick:()=>p(),loading:d,children:e.jsx(o,{id:"LebexD",defaultMessage:"Rename"})}),secondaryButton:e.jsx(j,{color:"secondary",onClick:()=>{t(!1)},children:e.jsx(o,{id:"KnPHlG",defaultMessage:"Cancel"})}),children:e.jsxs("form",{onSubmit:h=>{h.preventDefault(),p()},className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:m,className:"text-base font-medium text-token-text-secondary",children:e.jsx(o,{id:"Gk2g3Q",defaultMessage:"Connection name"})}),e.jsx("input",{type:"text",value:c,onChange:h=>f(h.target.value),id:m,className:"rounded-lg border border-solid border-token-border-light bg-token-main-surface-primary text-token-text-primary"}),e.jsx("button",{type:"submit",className:"display-none"})]})})};function Ge({accountId:s,refetchConnectionInstances:t,connection:n,showIcon:a=!1}){const[l,i]=u.useState(!1),r=y();let c;switch(n.connection_config.knowledge_connector_type){case void 0:break;case"github":case"merge_file_storage":case"google_drive_oauth":case"google_drive_dwd":c="synced_object";break;case"slack":c="synced_channel";break}return e.jsxs(Ce.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},className:"group w-full rounded-xl bg-token-main-surface-secondary pb-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 p-4 pb-6",children:[a&&n.display_info.icon_url&&e.jsx("img",{src:n.display_info.icon_url,alt:"",className:"icon-xl self-center"}),e.jsxs("div",{className:"w-full flex-shrink overflow-hidden",children:[e.jsx("div",{className:"mb-1 overflow-hidden text-ellipsis whitespace-nowrap font-medium text-token-text-primary",children:e.jsx(ve,{label:n.display_info.display_name,side:"top",align:"center",children:n.display_info.display_name})}),e.jsx("div",{children:e.jsx(gt,{connectionStatus:n.connection_status})})]}),e.jsx(pt,{isOpen:l,setIsOpen:i,accountId:s,refetch:t,connectionId:n.connection_config.connection_config_id,connectionDisplayInfo:n.display_info,className:O("h-8 w-8 hover:bg-token-main-surface-secondary-selected",l?"bg-token-main-surface-secondary-selected":"bg-transparent")})]}),e.jsx(qs,{connection:n}),e.jsx(ut,{connection:n,accountId:s}),n.connection_config.knowledge_connector_type==="google_drive_dwd"&&e.jsxs(e.Fragment,{children:[e.jsx(it,{connectionId:n.connection_config.connection_config_id,accountId:s,refetch:t}),e.jsx(rt,{connectionId:n.connection_config.connection_config_id,accountId:s,isPostActivation:n.connection_status!=="draft"}),e.jsx(ct,{connectionId:n.connection_config.connection_config_id,accountId:s})]}),n.connection_config.knowledge_connector_type==="slack"&&e.jsx(ot,{connectionId:n.connection_config.connection_config_id,accountId:s,isPostActivation:n.connection_status!=="draft"}),c!=null&&e.jsx(dt,{connectionId:n.connection_config.connection_config_id,accountId:s,objectType:c}),n.connection_status==="draft"&&e.jsx(mt,{connectionId:n.connection_config.connection_config_id,accountId:s,connectionDisplayInfo:n.display_info,onActivate:t,activationBlockingError:ht(n,r)})]})}const gt=({connectionStatus:s})=>{switch(s){case"active":case"partially_activated":case"activating":return e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ke,{className:"icon-sm text-token-text-primary"}),e.jsx("span",{className:"ml-1 text-sm text-token-text-primary",children:e.jsx(o,{id:"S8qgX3",defaultMessage:"Enabled"})}),e.jsx(gs,{className:"icon-sm ml-2 text-token-text-primary"}),e.jsx("span",{className:"ml-1 text-sm text-token-text-primary",children:e.jsx(o,{id:"RGpIWk",defaultMessage:"Syncing"})})]});case"draft":return e.jsxs("div",{className:"flex items-center",children:[e.jsx(Hs,{className:"icon-sm text-token-text-primary"}),e.jsx("span",{className:"ml-1 text-sm text-token-text-primary",children:e.jsx(o,{id:"m4Lx1j",defaultMessage:"Draft"})}),e.jsx(As,{className:"icon-sm ml-2 text-token-text-primary"}),e.jsx("span",{className:"ml-1 text-sm text-token-text-primary",children:e.jsx(o,{id:"BBCFFM",defaultMessage:"Nothing synced"})})]});case"deleting":case"deleted":return null}};function pt({isOpen:s,setIsOpen:t,className:n,connectionId:a,connectionDisplayInfo:l,accountId:i,refetch:r}){const c=w(),f=y(),[d,x]=u.useState(!1),[m,g]=u.useState(!1),[p,h]=u.useState(!1),b=async()=>{if(!p){h(!0);try{await v.admin_delete_connection_instance(i,a),c.success(f.formatMessage({id:"zM0Z9u",defaultMessage:"Connection deleted."}))}catch{c.danger(f.formatMessage({id:"3lBGk2",defaultMessage:"Failed to delete this connection. Please try again later."}))}finally{r(),h(!1),g(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs(F.Root,{open:s,onOpenChange:t,children:[e.jsx(F.Trigger,{className:n,children:e.jsx(Se,{className:"icon-lg"})}),e.jsx(F.Portal,{children:e.jsxs(F.Content,{size:"medium",children:[e.jsx(F.Item,{icon:Ae,onSelect:()=>x(!0),disabled:p||m,children:e.jsx(o,{id:"XSQcFy",defaultMessage:"Rename connection"})}),e.jsx(F.Item,{icon:p||m?B:Fe,onSelect:()=>g(!0),color:"danger",disabled:p||m,children:e.jsx(o,{id:"EAIYOb",defaultMessage:"Delete connection"})}),!1]})})]}),e.jsx(ft,{open:d,onOpenChange:x,defaultName:l.display_name,connectionId:a,accountId:i,refetch:r}),e.jsx(xt,{open:m,onOpenChange:g,deleteConnection:b,isDeleting:p,connectionDisplayInfo:l})]})}function ht(s,t){if(s.connection_config.knowledge_connector_type==="google_drive_dwd"&&(!s.connection_config.admin_email_address||!s.connection_config.service_account_credential_id))return t.formatMessage({id:"BfNdzb",defaultMessage:"Credential configuration is incomplete"})}function oe({steps:s,onClose:t}){const n=s.length,[a,l]=u.useState(0);return a<s.length?s[a]({goForward:a<n-1?()=>l(a+1):void 0,goBackward:a>0?()=>l(a-1):void 0,close:t,stepNumber:a,totalSteps:n}):null}function jt({onClose:s,backButton:t}){const[n,a]=u.useState(),l=L();return l?n?e.jsx(yt,{accountId:l.id,connection:n,onClose:s}):e.jsx(_t,{onClose:s,backButton:t,setConnection:a}):null}function _t({onClose:s,setConnection:t,backButton:n}){const a=y(),l=w(),i=L(),r=u.useId(),[c,f]=u.useState(""),d=c.length>128,x=c.trim().length>0&&!d,[m,g]=u.useState(!1),p=u.useCallback(()=>{!x||!i||m||(g(!0),v.admin_create_connection_instance(i.id,{knowledge_connector_type:"google_drive_dwd",connection_config_id:"--fake-local-id"},c.trim()).then(h=>{l.success(a.formatMessage({id:"RFxwaf",defaultMessage:"Connection created successfully."})),t(h)}).catch(()=>{l.danger(a.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}).finally(()=>{g(!1)}))},[i,c,a,x,m,t,l]);return e.jsx(N,{...V,onClose:()=>s?.(),title:a.formatMessage({id:"ZwGofJ",defaultMessage:"Create connection"}),primaryButton:e.jsx(j,{color:"primary",disabled:!x||m,loading:m,onClick:p,children:e.jsx(o,{id:"lZthRm",defaultMessage:"Save Draft and Continue"})}),secondaryButton:n,children:e.jsxs("form",{onSubmit:h=>{h.preventDefault(),x&&p()},className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsx("label",{htmlFor:r,className:"text-base font-medium text-token-text-secondary",children:e.jsx(o,{id:"e2yF8/",defaultMessage:"Connection display name"})}),e.jsx("input",{type:"text",value:c,onChange:h=>f(h.target.value),id:r,className:"rounded-lg border border-solid border-token-border-light bg-token-main-surface-primary text-token-text-primary"}),d?e.jsx("p",{className:"text-red-500",children:e.jsx(o,{id:"vT7EGU",defaultMessage:"Name is too long."})}):null]}),e.jsx("button",{type:"submit",className:"display-none"})]})})}function yt({connection:s,accountId:t,onClose:n}){return e.jsx(oe,{onClose:n,steps:[({goForward:a,close:l,stepNumber:i,totalSteps:r})=>e.jsx(Pe,{onClose:()=>l?.(),accountId:t,connectionId:s.connection_config.connection_config_id,onNext:a??(()=>null),footerContent:e.jsx("span",{className:"flex-1 align-middle font-medium text-token-text-secondary",children:e.jsx(o,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:i+1,totalSteps:r}})})}),({goForward:a,goBackward:l,close:i,stepNumber:r,totalSteps:c})=>e.jsx(Te,{onClose:()=>i?.(),accountId:t,connectionId:s.connection_config.connection_config_id,primaryButton:a&&e.jsx(j,{color:"primary",onClick:a,children:e.jsx(o,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:l&&e.jsx(j,{color:"secondary",onClick:l,children:e.jsx(o,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"flex-1 align-middle font-medium text-token-text-secondary",children:e.jsx(o,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:r+1,totalSteps:c}})}),isOpen:!0,isPostActivation:!1}),({goForward:a,goBackward:l,close:i,stepNumber:r,totalSteps:c})=>e.jsx(Oe,{onClose:()=>i?.(),accountId:t,connectionId:s.connection_config.connection_config_id,primaryButton:a&&e.jsx(j,{color:"primary",onClick:a,children:e.jsx(o,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:l&&e.jsx(j,{color:"secondary",onClick:l,children:e.jsx(o,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"flex-1 align-middle font-medium text-token-text-secondary",children:e.jsx(o,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:r+1,totalSteps:c}})}),isOpen:!0}),({goForward:a,goBackward:l,close:i,stepNumber:r,totalSteps:c})=>e.jsx(K,{maxAllowedUsers:J(s.connection_config),onClose:()=>i?.(),accountId:t,connectionId:s.connection_config.connection_config_id,primaryButton:a&&e.jsx(j,{color:"primary",onClick:a,children:e.jsx(o,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:l&&e.jsx(j,{color:"secondary",onClick:l,children:e.jsx(o,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"flex-1 align-middle font-medium text-token-text-secondary",children:e.jsx(o,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:r+1,totalSteps:c}})})}),({goBackward:a,close:l,stepNumber:i,totalSteps:r})=>e.jsx(X,{isOpen:!0,onClose:()=>l?.(),accountId:t,connectionId:s.connection_config.connection_config_id,connectionDisplayInfo:s.display_info,secondaryButton:a&&e.jsx(j,{color:"secondary",onClick:a,children:e.jsx(o,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"flex-1 align-middle font-medium text-token-text-secondary",children:e.jsx(o,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:i+1,totalSteps:r}})})})]})}function bt({onClose:s,backButton:t}){const[n,a]=u.useState(),l=L();return l?n?e.jsx(Ct,{accountId:l.id,connection:n,onClose:s}):e.jsx(vt,{onClose:s,backButton:t,setConnection:a}):null}function vt({onClose:s,setConnection:t,backButton:n}){const a=y(),l=w(),i=L(),r=u.useId(),[c,f]=u.useState(""),[d,x]=u.useState(!1),m=u.useCallback(()=>{!c||!i||(x(!0),v.admin_create_connection_instance(i.id,{knowledge_connector_type:"google_drive_oauth",domain_name:c,connection_config_id:"--fake-local-id"}).then(h=>{l.success(a.formatMessage({id:"RFxwaf",defaultMessage:"Connection created successfully."})),t(h)}).catch(()=>{l.danger(a.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}).finally(()=>{x(!1)}))},[i,c,a,t,l]),g=c.trim().toLocaleLowerCase()==="gmail.com",p=!!c.trim()&&c.includes(".")&&!g;return e.jsx(N,{...V,onClose:()=>s?.(),title:a.formatMessage({id:"BmsoRl",defaultMessage:"Select workspace"}),primaryButton:e.jsx(j,{color:"primary",disabled:!p,loading:d,onClick:m,children:e.jsx(o,{id:"lZthRm",defaultMessage:"Save Draft and Continue"})}),secondaryButton:n,children:e.jsxs("form",{onSubmit:h=>{h.preventDefault(),p&&m()},className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:r,className:"text-base font-medium text-token-text-secondary",children:e.jsx(o,{id:"qFHnSd",defaultMessage:"Enter domain name"})}),e.jsx("input",{type:"text",value:c,onChange:h=>f(h.target.value),id:r,className:"rounded-lg border border-solid border-token-border-light bg-token-main-surface-primary text-token-text-primary"}),g?e.jsx("p",{className:"text-red-500",children:e.jsx(o,{id:"Nl2esx",defaultMessage:"This domain is not allowed."})}):null,e.jsx(ps,{href:"https://support.google.com/cloudidentity/answer/182080",openNewTab:!0,type:"neutral",children:e.jsx(o,{id:"eDBsIT",defaultMessage:"How to find your domain name"})}),e.jsx("button",{type:"submit",className:"display-none"})]})})}function Ct({connection:s,accountId:t,onClose:n}){return e.jsx(oe,{onClose:n,steps:[({goForward:a,close:l,stepNumber:i,totalSteps:r})=>e.jsx(K,{maxAllowedUsers:J(s.connection_config),onClose:()=>l?.(),accountId:t,connectionId:s.connection_config.connection_config_id,primaryButton:a&&e.jsx(j,{color:"primary",onClick:a,children:e.jsx(o,{id:"z5fExR",defaultMessage:"Next"})}),footerContent:e.jsx("span",{className:"flex-1 align-middle font-medium text-token-text-secondary",children:e.jsx(o,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:i+1,totalSteps:r}})})}),({goBackward:a,close:l,stepNumber:i,totalSteps:r})=>e.jsx(X,{isOpen:!0,onClose:()=>l?.(),accountId:t,connectionId:s.connection_config.connection_config_id,connectionDisplayInfo:s.display_info,secondaryButton:a&&e.jsx(j,{color:"secondary",onClick:a,children:e.jsx(o,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"flex-1 align-middle font-medium text-token-text-secondary",children:e.jsx(o,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:i+1,totalSteps:r}})})})]})}function Mt({isOpen:s,onClose:t}){const n=y(),[a,l]=u.useState("gdrive-oauth"),[i,r]=u.useState(!0);return e.jsxs(e.Fragment,{children:[e.jsx(N,{isOpen:s&&i,onClose:t,type:"success",title:n.formatMessage({id:"/WA6Rw",defaultMessage:"Add workspace"}),size:"custom",className:"max-w-xl",primaryButton:e.jsx(j,{color:"primary",onClick:()=>r(!1),children:e.jsx(o,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:e.jsx(j,{color:"secondary",onClick:t,children:e.jsx(o,{id:"5Oo8TW",defaultMessage:"Cancel"})}),showCloseButton:!0,shouldIgnoreClickOutside:!0,children:e.jsx(wt,{selectedConnector:a,setSelectedConnector:l})}),s&&!i&&(a==="gdrive-oauth"?e.jsx(bt,{onClose:()=>{t(),r(!0)},backButton:e.jsx(j,{color:"secondary",onClick:()=>r(!0),children:e.jsx(o,{id:"xJnONr",defaultMessage:"Back"})})}):a==="gdrive-dwd"?e.jsx(jt,{onClose:()=>{t(),r(!0)},backButton:e.jsx(j,{color:"secondary",onClick:()=>r(!0),children:e.jsx(o,{id:"xJnONr",defaultMessage:"Back"})})}):null)]})}function wt({selectedConnector:s,setSelectedConnector:t}){const n=y();return e.jsxs(hs,{value:s,onValueChange:a=>t(a),className:"flex w-full flex-row justify-stretch gap-4",children:[e.jsx(je,{optionValue:"gdrive-oauth",optionName:n.formatMessage({id:"DSWj22",defaultMessage:"Self-service"}),isSelected:s==="gdrive-oauth",checkedBulletPoints:[n.formatMessage({id:"w/XlYp",defaultMessage:"Users connect their Google accounts"}),n.formatMessage({id:"XNvGNW",defaultMessage:"Limited to {maxConnectedAccounts} connected users"},{maxConnectedAccounts:n.formatNumber(10)}),n.formatMessage({id:"jprz3h",defaultMessage:"ChatGPT can access all files visible to the user"})]}),e.jsx(je,{optionValue:"gdrive-dwd",optionName:n.formatMessage({id:"voo3FC",defaultMessage:"Admin-managed"}),isSelected:s==="gdrive-dwd",checkedBulletPoints:[n.formatMessage({id:"zUPZUJ",defaultMessage:"Automatic setup for users"}),n.formatMessage({id:"fIhOqd",defaultMessage:"Best for large teams"}),n.formatMessage({id:"HcMyHL",defaultMessage:"Granular settings for shared drives, exclusions and more"})]})]})}function je({optionName:s,optionValue:t,badgeText:n,badgeColor:a="gray",isSelected:l,checkedBulletPoints:i=[],disabled:r}){const c=l?z:Qe;return e.jsxs(js,{value:t,id:`connector-group-option-${t}`,className:O("flex flex-1 flex-col rounded-xl border border-solid p-4",r&&"opacity-50"),disabled:r,children:[e.jsxs("div",{className:"flex-0 flex flex-row flex-wrap items-center gap-2",children:[e.jsx(c,{className:"icon-md flex-0"}),e.jsx("span",{className:"shrink-0 grow text-start text-lg",children:s}),n&&e.jsx("span",{className:O("flex-0 rounded border border-solid px-1 text-xs font-semibold uppercase",a==="green"&&"border-[#43A080] text-[#43A080]",a==="gray"&&"border-gray-500 text-gray-500"),children:n})]}),i.length&&e.jsx("ul",{className:"my-4 flex-1 text-token-text-secondary",children:i.map((f,d)=>e.jsxs("li",{className:"flex flex-row items-baseline text-start",children:[e.jsx(Xe,{className:"icon-sm relative top-1 mr-2"}),e.jsx("span",{className:"text-sm",children:f})]},d))})]})}function kt({onClose:s}){const[t,n]=u.useState(),a=L();return a?t?e.jsx(St,{accountId:a.id,connection:t,onClose:s}):e.jsx(Nt,{accountId:a.id,onClose:s,setConnection:n}):null}function Nt({onClose:s,setConnection:t,accountId:n}){const a=y(),l=w(),[i,r]=u.useState({teamDomain:"app"}),[c,f]=u.useState(!1),d=u.useCallback(()=>{!(i.teamDomain&&i.teamId)||!n||(f(!0),v.admin_create_connection_instance(n,{connection_config_id:"--fake-local-id",knowledge_connector_type:"slack",team_id:i.teamId,team_domain:i.teamDomain},i.connectionName).then(b=>{l.success(a.formatMessage({id:"RFxwaf",defaultMessage:"Connection created successfully."})),t(b)}).catch(()=>{l.danger(a.formatMessage({id:"aqpeYE",defaultMessage:"Something went wrong. Please try again."}))}).finally(()=>{f(!1)}))},[n,i.connectionName,i.teamDomain,i.teamId,a,t,l]),x=!!i.connectionName?.length&&i.connectionName.length>128,m=!!(i.teamDomain&&i.teamId&&!x),g=u.useId(),p=u.useId(),h=u.useId();return e.jsx(N,{...V,onClose:s,title:a.formatMessage({id:"aECB4v",defaultMessage:"Slack workspace info"}),primaryButton:e.jsx(j,{color:"primary",disabled:!m,onClick:d,loading:c,children:e.jsx(o,{id:"lZthRm",defaultMessage:"Save Draft and Continue"})}),children:e.jsxs("form",{onSubmit:b=>{b.preventDefault(),m&&d()},className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsx("label",{htmlFor:g,className:"text-base font-medium text-token-text-secondary",children:e.jsx(o,{id:"e2yF8/",defaultMessage:"Connection display name"})}),e.jsx("input",{type:"text",value:i.connectionName??"",onChange:b=>r(_=>({..._,connectionName:b.target.value})),placeholder:a.formatMessage({id:"0gZ+BA",defaultMessage:"(optional)"}),id:g,className:"rounded-lg border border-solid border-token-border-light bg-token-main-surface-primary text-token-text-primary"}),x?e.jsx("p",{className:"text-red-500",children:e.jsx(o,{id:"vT7EGU",defaultMessage:"Name is too long."})}):null]}),e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsx("label",{htmlFor:p,className:"text-base font-medium text-token-text-secondary",children:e.jsx(o,{id:"hEnKIS",defaultMessage:"Slack workspace domain"})}),e.jsxs("p",{children:[e.jsx("input",{type:"text",value:i.teamDomain??"",onChange:b=>r(_=>({..._,teamDomain:b.target.value})),id:p,className:"rounded-lg border border-solid border-token-border-light bg-token-main-surface-primary text-token-text-primary"}),e.jsx("span",{className:"ml-1 font-medium text-token-text-secondary",children:".slack.com"})]})]}),e.jsxs("div",{className:"mb-2 flex flex-col gap-2",children:[e.jsx("label",{htmlFor:h,className:"text-base font-medium text-token-text-secondary",children:e.jsx(o,{id:"azUOrk",defaultMessage:"Slack workspace ID"})}),e.jsx("input",{type:"text",value:i.teamId??"",onChange:b=>r(_=>({..._,teamId:b.target.value})),placeholder:a.formatMessage({id:"vUK9Kc",defaultMessage:"T0000000000"}),id:h,className:"rounded-lg border border-solid border-token-border-light bg-token-main-surface-primary text-token-text-primary"})]}),e.jsx("button",{type:"submit",className:"display-none"})]})})}function St({connection:s,accountId:t,onClose:n}){return e.jsx(oe,{onClose:n,steps:[({goForward:a,close:l,stepNumber:i,totalSteps:r})=>e.jsx(K,{maxAllowedUsers:J(s.connection_config),onClose:()=>l?.(),accountId:t,connectionId:s.connection_config.connection_config_id,primaryButton:a&&e.jsx(j,{color:"primary",onClick:a,children:e.jsx(o,{id:"z5fExR",defaultMessage:"Next"})}),footerContent:e.jsx("span",{className:"flex-1 align-middle font-medium text-token-text-secondary",children:e.jsx(o,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:i+1,totalSteps:r}})})}),({goForward:a,goBackward:l,close:i,stepNumber:r,totalSteps:c})=>e.jsx(Ue,{isOpen:!0,isPostActivation:!1,onClose:()=>i?.(),accountId:t,connectionId:s.connection_config.connection_config_id,primaryButton:a&&e.jsx(j,{color:"primary",onClick:a,children:e.jsx(o,{id:"z5fExR",defaultMessage:"Next"})}),secondaryButton:l&&e.jsx(j,{color:"secondary",onClick:l,children:e.jsx(o,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"flex-1 align-middle font-medium text-token-text-secondary",children:e.jsx(o,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:r+1,totalSteps:c}})})}),({goBackward:a,close:l,stepNumber:i,totalSteps:r})=>e.jsx(X,{isOpen:!0,onClose:()=>l?.(),accountId:t,connectionId:s.connection_config.connection_config_id,connectionDisplayInfo:s.display_info,secondaryButton:a&&e.jsx(j,{color:"secondary",onClick:a,children:e.jsx(o,{id:"xJnONr",defaultMessage:"Back"})}),footerContent:e.jsx("span",{className:"flex-1 align-middle font-medium text-token-text-secondary",children:e.jsx(o,{id:"Wp0nVY",defaultMessage:"Step {stepNum} of {totalSteps}",values:{stepNum:i+1,totalSteps:r}})})})]})}const re=$e.div`w-full border-b-2 border-token-border-medium`;async function Dt(s){const[t,n]=await Promise.all([v.admin_list_knowledge_connectors(s),v.admin_list_connection_instances(s)]),a=new Map;return t.knowledge_conectors.forEach(l=>a.set(l.connector_details.knowledge_connector_type,{displayInfo:l.display_info,availability:l.connector_details.availability,connections:[]})),n.connection_instances.forEach(l=>{if(!l.connection_config.knowledge_connector_type)return;let i=a.get(l.connection_config.knowledge_connector_type)?.connections;i!=null?i.push(l):a.set(l.connection_config.knowledge_connector_type,{displayInfo:l.display_info,availability:"unavailable",connections:[l]})}),a}function ee(s){return!(s.connection_status==="deleted"||s.connection_status==="deleting")}function At(){const s=y(),t=L(),[n,a]=u.useState(!1),[l,i]=u.useState(!1),{data:r,isLoading:c,error:f,refetch:d}=I({queryKey:["admin:knowledge_connectors_with_connections",t?.id],queryFn:async()=>{if(!t)throw new Error("No current account");return await Dt(t.id)},enabled:!!t}),x=r?.get("google_drive_oauth")?.availability==="available"&&r?.get("google_drive_dwd")?.availability==="available",{combinedGoogleDriveConnections:m,slackConnections:g,otherConnections:p}=u.useMemo(()=>{const b=[],_=[],C=[];return r?.forEach((M,D)=>{if(M.availability!=="available"){C.push(...M.connections.filter(ee));return}D==="google_drive_dwd"||D==="google_drive_oauth"?b.push(...M.connections.filter(ee)):D==="slack"&&_.push(...M.connections.filter(ee))}),{combinedGoogleDriveConnections:b,slackConnections:_,otherConnections:C}},[r]),h=r?.get("slack")?.availability==="available";return t?.id?e.jsxs(we,{children:[e.jsx(ke,{children:s.formatMessage({id:"80FWVq",defaultMessage:"Synced services"})}),e.jsx(Ne,{className:"text-token-text-secondary",children:s.formatMessage({id:"1GghHm",defaultMessage:"Connect services to ChatGPT to enable your workspace members to use ChatGPT with up-to-date information from custom sources."})}),f&&e.jsxs("div",{className:"my-2 flex flex-row items-center gap-2 rounded-lg bg-red-500 p-2 text-white",children:[e.jsx(le,{className:"icon-md inline"}),e.jsx(o,{id:"zNCx93",defaultMessage:"Failed to get connection instances. Please refresh to try again."})]}),e.jsx(re,{}),c&&e.jsx(R,{lines:4}),x&&e.jsx(_e,{connectorType:"google_drive_oauth",accountId:t.id,connectorName:s.formatMessage({id:"oDI3Mt",defaultMessage:"Google Drive"}),description:s.formatMessage({id:"3yZLm6",defaultMessage:"Connect Google Drives, Docs, Sheets, Slides and other files."}),onClickConnect:()=>a(!0),Icon:_s,connectionInstancesLoading:c,connectionInstances:m,refetchConnectionInstances:d,singularNounConnectedObjectName:ge("google_drive_oauth",s).externalLinkableUnitSingular}),h&&e.jsx(_e,{connectorType:"slack",accountId:t.id,connectorName:s.formatMessage({id:"pUDRLC",defaultMessage:"Slack"}),description:s.formatMessage({id:"p1qvhM",defaultMessage:"Connect messages and channels."}),Icon:ys,onClickConnect:()=>i(!0),connectionInstancesLoading:c,connectionInstances:g,refetchConnectionInstances:d,singularNounConnectedObjectName:ge("slack",s).externalLinkableUnitSingular}),p.length>0&&e.jsx(Ft,{accountId:t.id,connectionInstancesLoading:c,connectionInstances:p,refetchConnectionInstances:d}),e.jsx(Mt,{isOpen:n,onClose:()=>{a(!1),d()}}),l&&e.jsx(kt,{onClose:()=>{i(!1),d()}})]}):null}function _e({accountId:s,Icon:t,connectorName:n,description:a,onClickConnect:l,connectionInstances:i,connectionInstancesLoading:r,refetchConnectionInstances:c,singularNounConnectedObjectName:f,connectorType:d}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4 flex w-full flex-col gap-4",children:[e.jsxs("div",{className:"flex w-full flex-row flex-wrap items-center gap-4",children:[e.jsx(t,{className:"icon-2xl flex-0 my-1"}),e.jsxs("div",{className:"flex min-w-[240px] flex-1 flex-col gap-1",children:[e.jsx("p",{className:"font-semibold",children:n}),e.jsx("p",{className:"text-xs text-token-text-secondary",children:a})]}),!r&&i!=null&&i.length<Us(d)&&e.jsx("div",{className:"flex-0 flex items-center",children:e.jsx(j,{color:i?.length?"secondary":"primary",onClick:l,icon:bs,children:i?.length?e.jsx(o,{id:"Ou779X",defaultMessage:"Connect another {connectedKnowledgeSource}",values:{connectedKnowledgeSource:f}}):e.jsx(o,{id:"Uvs01u",defaultMessage:"Connect"})})})]}),r?e.jsx(R,{lines:2}):i?.length?e.jsx(Me,{children:e.jsxs("div",{className:"grid w-full gap-4",style:{gridTemplateColumns:"repeat(auto-fit, minmax(360px, 1fr))"},children:[i.filter(x=>!["deleted","deleting"].includes(x.connection_status)).map(x=>e.jsx(Ge,{connection:x,accountId:s,refetchConnectionInstances:c},x.connection_config.connection_config_id)),i.length===1&&e.jsx("div",{},"grid-spacer")]})}):null]}),e.jsx(re,{className:"mt-4"})]})}function Ft({accountId:s,connectionInstances:t,connectionInstancesLoading:n,refetchConnectionInstances:a}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4 flex w-full flex-col gap-4",children:[e.jsxs("div",{className:"flex w-full flex-row flex-wrap items-center gap-4",children:[e.jsx(Gs,{className:"icon-2xl flex-0 my-1"}),e.jsx("div",{className:"flex min-w-[240px] flex-1 flex-col gap-1",children:e.jsx("p",{className:"font-semibold",children:e.jsx(o,{id:"WFgOAD",defaultMessage:"Other connections"})})})]}),n?e.jsx(R,{lines:2}):t?.length?e.jsx(Me,{children:e.jsxs("div",{className:"grid w-full gap-4",style:{gridTemplateColumns:"repeat(auto-fit, minmax(360px, 1fr))"},children:[t.map(l=>e.jsx(Ge,{connection:l,showIcon:!0,accountId:s,refetchConnectionInstances:a},l.connection_config.connection_config_id)),t.length===1&&e.jsx("div",{},"grid-spacer")]})}):null]}),e.jsx(re,{className:"mt-4"})]})}function Et({feedbackMetadata:s,currentWorkspaceId:t,onClose:n,onFeedbackActionTaken:a}){const l=y(),{data:i,refetch:r,isLoading:c}=I({queryKey:["adminGetCaMessageFeedback",t,s.feedback_id],queryFn:()=>Y.adminGetCaMessageFeedback({accountId:t,feedbackId:s.feedback_id})}),f=w(),d=W({mutationFn:m=>m.operation==="delete"?Y.adminDeleteCaMessageFeedback({accountId:m.workspaceId,feedbackId:m.feedbackId}):Y.adminApproveCaMessageFeedback({accountId:m.workspaceId,feedbackId:m.feedbackId,withSources:m.withSources}),onSuccess:(m,g)=>{a(),n(),f.success(g.operation==="approve"?l.formatMessage(k.feedbackApproved):l.formatMessage(k.feedbackDeleted))},onError:(m,g)=>{r(),f.warning(g.operation==="approve"?l.formatMessage(k.errorApprovingFeedback):l.formatMessage(k.errorDeletingFeedback))}}),x=u.useMemo(()=>{const m=s.review_status==="unreviewed",g=s.review_status==="unreviewed";let p;switch(s.review_status){case"approved_with_sources":case"approved_without_sources_data_expired":{p=l.formatMessage(k.actionMessageNoActionsAvailable);break}case"approved_without_sources_data_available":{p=l.formatMessage(k.actionMessageApprovedWithoutSources);break}case"deleted":{p=l.formatMessage(k.actionMessageFeedbackDeleted);break}}const h={workspaceId:t,feedbackId:s.feedback_id,withSources:!0};return e.jsxs("div",{className:"sticky bottom-0 flex w-full flex-col gap-2 rounded-lg bg-token-main-surface-secondary p-4",children:[!!p&&e.jsx("div",{children:e.jsx("p",{children:p})}),e.jsxs("div",{className:"flex flex-row gap-2",children:[m&&e.jsx(j,{color:"primary",icon:vs,onClick:()=>d.mutate({...h,operation:"approve"}),loading:d.isPending,children:e.jsx(o,{id:"Zq8YOH",defaultMessage:"Approve Feedback"})}),g&&e.jsx(j,{color:"danger-outline",icon:Fe,onClick:()=>d.mutate({...h,operation:"delete"}),loading:d.isPending,children:e.jsx(o,{id:"qeIjD9",defaultMessage:"Delete Feedback"})})]})]})},[s.review_status,s.feedback_id,d,t,l]);return e.jsx(Rt,{actionBar:x,onClose:n,isLoading:c,feedbackData:i,feedbackMetadata:s})}function Rt({actionBar:s=null,onClose:t=()=>{},isLoading:n=!1,isDebugView:a=!1,feedbackData:l,feedbackMetadata:i}){const r=y();return e.jsx(N,{size:"custom",className:"max-w-lg overflow-y-auto text-base",isOpen:!0,icon:Is,onClose:t,showCloseButton:!0,type:"success",title:r.formatMessage(k.modalTitle),children:e.jsx("div",{className:"flex flex-col",children:l&&!n?e.jsxs(e.Fragment,{children:[e.jsx(It,{feedbackData:l,feedbackMetadata:i,isDebugView:a}),e.jsx(ue,{className:"my-4"}),e.jsx(Ot,{fileRefs:l.file_references}),e.jsx(ue,{className:"my-4"}),e.jsx(Lt,{retrievalMessages:l.retrieval_messages,userDisplayName:i.submitter_display_name??i.submitter_email,isDebugView:a}),s]}):e.jsx(Ee,{lines:8})})})}function It({feedbackMetadata:s,feedbackData:t,isDebugView:n=!1}){const a=y(),l=s.submitter_display_name&&s.submitter_email?a.formatMessage(k.userDisplayName,{displayName:s.submitter_display_name,email:s.submitter_email}):s.submitter_id,i=u.useMemo(()=>t.sources_feedback?Object.entries(t.sources_feedback).map(([r,c])=>{if(!c.rating&&!(c.tags&&c.tags.length>0))return null;const f=t.file_references.find(x=>x.document_id===r)?.title,d=c.tags&&c.tags.length===1&&c.tags[0]===Os;return e.jsxs("li",{className:"flex flex-col break-words p-1 text-sm",children:[e.jsxs("div",{className:"mb-1 flex flex-row items-center gap-2",children:[c.rating==="thumbsUp"?e.jsx(Cs,{className:"icon-sm"}):c.rating==="thumbsDown"?e.jsx(me,{className:"icon-sm"}):null,e.jsx("a",{href:c.url??void 0,className:"text-sm font-semibold",children:f??c.url??r})]}),e.jsx("div",{className:"flex flex-row flex-wrap gap-1",children:d?e.jsx("span",{className:"italic",children:e.jsx(o,{id:"yNGc6H",defaultMessage:"This source should have been used."})}):c.tags?.map(x=>e.jsx("div",{className:"rounded-lg border border-token-border-light px-3 py-1 text-xs text-token-text-secondary",children:fe(x,a)},x))})]},r)}).filter(r=>!!r):[],[t.file_references,t.sources_feedback,a]);return e.jsxs("div",{children:[!n&&e.jsx("div",{className:"mb-2",children:e.jsx(qe,{reviewStatus:s.review_status})}),e.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[t.rating==="thumbsUp"?e.jsx(Ms,{className:"icon-xl m-2"}):e.jsx(me,{className:"icon-xl m-2"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{children:l}),s.submitted_at&&e.jsx("p",{className:"text-xs text-token-text-secondary",children:new Date(s.submitted_at).toLocaleString()})]})]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"mb-2 flex flex-wrap gap-1",children:t.tags?.map(r=>e.jsx("div",{className:"rounded-lg border border-token-border-light px-3 py-1 text-sm text-token-text-secondary",children:fe(r,a)},r))}),e.jsxs("div",{className:"mb-2",children:[e.jsx(T,{className:"mb-1",children:e.jsx(o,{id:"VrPx6x",defaultMessage:"Feedback"})}),e.jsx("p",{className:"break-words rounded border p-2 text-sm",children:t.text?t.text:e.jsx("span",{className:"italic",children:e.jsx(o,{id:"pEEJ/8",defaultMessage:"No written feedback was provided."})})})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx(T,{className:"mb-1",children:e.jsx(o,{id:"LUg6Vl",defaultMessage:"Additional Sources"})}),e.jsx("p",{className:"break-words rounded border p-2 text-sm",children:t.additional_sources?t.additional_sources:e.jsx("span",{className:"italic",children:e.jsx(o,{id:"u24Zo5",defaultMessage:"No additional sources were provided."})})})]}),i.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx(T,{className:"mb-1",children:e.jsx(o,{id:"lNSdNZ",defaultMessage:"Sources Feedback"})}),e.jsx("ul",{className:"flex flex-col gap-1",children:i})]})]})}const Pt=["citation","context_stuff","search_result"];function ye(s){return Array.from(s.map(t=>Ns({type:"file",id:t.document_id,cloud_doc_url:t.external_url??void 0,name:t.title??"",source:"google_drive",extra:{cloud_doc_url:t.external_url??void 0}})).filter(t=>!!t))}function Ot({fileRefs:s}){const[t,n]=u.useMemo(()=>{const a=new Map,l=new Map;return s.forEach(i=>{Pt.includes(i.reference_source)&&i.external_url&&!a.has(i.document_id)?a.set(i.document_id,i):i.reference_source==="user_feedback"&&i.external_url&&!l.has(i.document_id)&&l.set(i.document_id,i)}),[ye(Array.from(a.values())),ye(Array.from(l.values()))]},[s]);return e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx(T,{className:"mb-2",children:e.jsx(o,{id:"FB4YIA",defaultMessage:"Sources In Conversation"})}),t.length>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mb-2 text-xs text-token-text-secondary",children:e.jsx(o,{id:"iTNNoN",defaultMessage:"These sources were considered or cited in the conversation. Snapshots of these sources will be included with the feedback if you choose to approve the feedback."})}),e.jsx("div",{className:"flex flex-col gap-1",children:t.map(a=>e.jsx(xe,{compact:!0,citationMetadata:a},a.url))})]}):e.jsx("p",{className:"text-xs text-token-text-secondary",children:e.jsx(o,{id:"Q+DKpB",defaultMessage:"No synced sources were considered or cited in the conversation, however there may be other sources present such as user uploaded files. If you choose to approve this feedback, only the snippets of those files that ChatGPT looked at will be shared with this feedback."})})]}),n.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsx(T,{className:"mb-2",children:e.jsx(o,{id:"SCwQnr",defaultMessage:"Sources From Feedback"})}),e.jsx("p",{className:"mb-2 text-xs text-token-text-secondary",children:e.jsx(o,{id:"Rr+4KZ",defaultMessage:"The feedback submitter mentioned these documents in their feedback. Snapshots of these documents will be included with the feedback if you choose to approve the feedback with sources and the user had access to them."})}),e.jsx("div",{className:"flex flex-col gap-1",children:n.map(a=>e.jsx(xe,{compact:!0,citationMetadata:a},a.url))})]})]})}function Lt({retrievalMessages:s,userDisplayName:t,isDebugView:n=!1}){return e.jsxs("div",{className:"mb-8",children:[e.jsx(T,{className:"mb-4",children:e.jsx(o,{id:"pOb00r",defaultMessage:"Conversation"})}),s.map(a=>e.jsx(Tt,{message:a,userDisplayName:t,isDebugView:n},a.id))]})}function Tt({message:s,userDisplayName:t,isDebugView:n=!1}){const a=y();switch(s.type){case"visible_text":{if(s.author==="unknown")return null;const l={id:s.id,author:{role:s.author},clientMetadata:{canRetry:!1},metadata:{citations:s.citations??[],attachments:s.attachments??[],content_references:s.content_refs?s.content_refs:(s.citations??[]).map(i=>i.metadata?.type!=="file"?null:{start_idx:i.start_ix,end_idx:i.end_ix,refs:[],matched_text:s.text.slice(i.start_ix,i.end_ix),type:"file",source:i.metadata.source,name:i.metadata.name,id:i.metadata.id,cloud_doc_url:i.metadata.cloud_doc_url??i.metadata.extra?.cloud_doc_url}).filter(i=>!!i)},content:{content_type:es.Text,parts:[s.text]}};return e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:O("mb-1 text-xs text-token-text-secondary",s.author==="user"?"pr-4 text-end":"text-start"),children:s.author==="assistant"?a.formatMessage(k.authorChatGPT):s.author==="user"?t??a.formatMessage(k.authorUser):s.author}),e.jsx(Ps,{id:s.id,messages:[l],attachments:l.metadata?.attachments,citations:l.metadata?.citations,contentReferences:l.metadata?.content_references,parts:[s.text],displayParts:ks({isUserTurn:s.author==="user",parts:[s.text]}),isActivelyStreaming:!1,isCompletionInProgress:!1,isFinalUserTurn:!1,hasActiveRequest:!1,clientThreadId:"--fake-thread-id--",isUserTurn:s.author==="user",turnIndex:0,isFeedbackEnabled:!1})]})}case"query":return e.jsxs("div",{className:"my-2 text-xs text-token-text-primary",children:[e.jsx(Ls,{className:"mr-2"}),n?e.jsx(o,{id:"AVzRit",defaultMessage:"ChatGPT performed a search: {query}",values:{query:s.query}}):e.jsx(o,{id:"bJ9BXd",defaultMessage:"ChatGPT performed a search."})]});case"result":return n?e.jsx(Bt,{message:s}):null;case"fetch":return n?e.jsxs("div",{className:"my-2 text-xs text-token-text-primary",children:[e.jsx(ws,{className:"mr-2"}),e.jsx(o,{id:"uH5X47",defaultMessage:"Read file: {fileName}",values:{fileName:s.content.content_type==="tether_quote"?s.content.title:"unknown"}})]}):null;case"generic_file_search_tool":return n?e.jsxs("div",{className:"my-2 text-xs text-token-text-primary",children:[e.jsx(Ts,{className:"mr-2"}),e.jsx(o,{id:"pJmg4S",defaultMessage:"Tool message with command: {command}.",values:{command:s.command}})]}):null;case"system":case void 0:return null}}function Bt({message:s}){const[t,n]=u.useState(!1);return s.type!=="result"?null:e.jsxs("div",{className:"mb-4 mt-2 text-xs text-token-text-primary",children:[e.jsxs("div",{onClick:()=>n(a=>!a),className:"flex flex-row",children:[e.jsx(Rs,{checked:t,className:"flex-0"}),e.jsx("div",{className:"flex-1",children:e.jsx(o,{id:"94EEkt",defaultMessage:"Found {numResults} results.",values:{numResults:s.result.chunks.length}})})]}),t&&e.jsxs("div",{className:"mt-2",children:[s.result.chunks.map(a=>e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"mb-1 text-sm font-bold text-token-text-primary",children:e.jsx(o,{id:"zyGUoc",defaultMessage:"Result {number}: {title}",values:{number:a.result_num,title:a.title}})}),e.jsx("h4",{className:"mb-1 text-xs text-token-text-secondary",children:a.document_id}),e.jsx("pre",{className:"max-h-[200px] max-w-full overflow-auto text-wrap p-2",children:a.contents})]},a.result_num)),e.jsxs("div",{className:"p-2 text-center",onClick:()=>n(!1),children:[e.jsx("p",{className:"mb-1 font-bold text-token-text-secondary",children:e.jsx(o,{id:"8UUzYt",defaultMessage:"Collapse Results"})}),e.jsx("hr",{className:""})]})]})]})}function qe({reviewStatus:s,onClick:t,disabled:n}){let a;const l=y();switch(s){case"unreviewed":a=l.formatMessage(k.reviewStatusUnreviewed);break;case"approved_with_sources":a=l.formatMessage(k.reviewStatusApprovedWithSouces);break;case"approved_without_sources_data_available":case"approved_without_sources_data_expired":a=l.formatMessage(k.reviewStatusApprovedWithoutSources);break;case"deleted":a=l.formatMessage(k.reviewStatusDeleted);break}return e.jsx("button",{className:O("rounded-2xl px-3 py-1 text-sm text-token-text-primary",s==="unreviewed"&&"bg-[#e2c541] dark:bg-[#EA8444]"),onClick:t,disabled:!!n||!t,children:a})}const k=H({modalTitle:{id:"zufVun",defaultMessage:"Review Feedback"},feedbackApproved:{id:"DS+YGt",defaultMessage:"Feedback approved."},feedbackDeleted:{id:"Rz/tmW",defaultMessage:"Feedback deleted."},errorApprovingFeedback:{id:"UVsTlf",defaultMessage:"Encountered an error approving this feedback. Please refresh and try again."},errorDeletingFeedback:{id:"cI6gt9",defaultMessage:"Encountered an error deleting this feedback. Please refresh and try again."},actionMessageFeedbackCreating:{id:"urBely",defaultMessage:"You can't take actions on this feedback yet because it's still being processed. Once it's done processing, it will be available for review."},actionMessageNoActionsAvailable:{id:"JGNhjT",defaultMessage:"This feedback has been reviewed."},actionMessageApprovedWithoutSources:{id:"68PAfK",defaultMessage:"This feedback has already been approved without sources, but you can re-approve it with sources."},actionMessageFeedbackDeleted:{id:"Kel9lE",defaultMessage:"This feedback has been deleted."},labelIncludeSources:{id:"8UlZM0",defaultMessage:"Include Sources"},authorChatGPT:{id:"7Fo5p2",defaultMessage:"ChatGPT"},authorUser:{id:"TpT0hg",defaultMessage:"User"},userDisplayName:{id:"3OKTcX",defaultMessage:"{displayName} ({email})"},reviewStatusUnreviewed:{id:"FEHKZj",defaultMessage:"Needs Review"},reviewStatusCreating:{id:"7lVVU7",defaultMessage:"Preparing for Review"},reviewStatusApprovedWithSouces:{id:"kpZ41g",defaultMessage:"Approved With Sources"},reviewStatusApprovedWithoutSources:{id:"Y0lc+p",defaultMessage:"Approved Without Sources"},reviewStatusDeleted:{id:"gKoYhr",defaultMessage:"Deleted"}});function Ut({currentWorkspaceId:s}){const{data:t,refetch:n,isLoading:a}=I({queryKey:["adminListCaMessageFeedback",s],queryFn:()=>Y.adminListCaMessageFeedback({accountId:s})}),[l,i]=u.useState();return e.jsxs(we,{className:"mb-8",children:[e.jsx(ke,{children:e.jsx(o,{id:"r4Y3mj",defaultMessage:"Review Feedback"})}),e.jsx(Ne,{className:"text-token-text-secondary",children:e.jsx(o,{id:"mqh7NS",defaultMessage:"Review feedback your workspace users have submitted. Feedback is not shared with OpenAI until you approve it."})}),t&&!a?e.jsx(Gt,{feedbackList:t.feedback,setSelectedFeedback:i}):e.jsx(Ee,{lines:12,widthVariance:0}),l&&e.jsx(Et,{feedbackMetadata:l,currentWorkspaceId:s,onClose:()=>i(void 0),onFeedbackActionTaken:()=>n()})]})}function be(s){switch(s){case"unreviewed":return 1;case"approved_with_sources":return 2;case"approved_without_sources_data_available":return 3;case"approved_without_sources_data_expired":return 4;case"deleted":return 5}}function Gt({feedbackList:s,setSelectedFeedback:t}){const n=u.useMemo(()=>[...s].sort((a,l)=>{const i=be(a.review_status)-be(l.review_status);return i!==0?i:a.submitted_at>l.submitted_at?-1:a.submitted_at<l.submitted_at?1:0}),[s]);return e.jsxs(S.Root,{size:"normal",children:[e.jsxs(S.Header,{children:[e.jsx(S.HeaderCell,{className:"bg-token-main-surface-primary",children:e.jsx(o,{id:"KcGNl2",defaultMessage:"Review Status"})}),e.jsx(S.HeaderCell,{className:"w-40 bg-token-main-surface-primary",children:e.jsx(o,{id:"joba0B",defaultMessage:"Submitted By"})}),e.jsx(S.HeaderCell,{className:"w-40 bg-token-main-surface-primary",children:e.jsx(o,{id:"yl1cCR",defaultMessage:"Submitted At"})})]}),e.jsx(S.Body,{children:n.length===0?e.jsx(S.Row,{children:e.jsx(S.Cell,{children:e.jsx(o,{id:"AYwCJD",defaultMessage:"No feedback yet."})})}):n.map(a=>{const l=a.review_status==="deleted",i=l?void 0:()=>t(a);return e.jsxs(S.Row,{className:O("my-2",l?"bg-token-main-surface-tertiary":"hover:cursor-pointer hover:bg-token-main-surface-secondary"),onClick:i,children:[e.jsx(S.Cell,{className:"truncate",children:e.jsx(qe,{reviewStatus:a.review_status,onClick:i,disabled:l})}),e.jsx(S.Cell,{className:"truncate",children:e.jsx("span",{children:a.submitter_display_name&&a.submitter_email?e.jsx(o,{id:"3OKTcX",defaultMessage:"{displayName} ({email})",values:{displayName:a.submitter_display_name,email:a.submitter_email}}):e.jsx("code",{children:a.submitter_id.split("__")[0]})})}),e.jsx(S.Cell,{className:"truncate",children:e.jsx("span",{children:new Date(a.submitted_at).toLocaleString()})})]},a.feedback_id)})})]})}function qt(){const s=y();as(!0);const t=L(),n=Ss();return e.jsxs(e.Fragment,{children:[e.jsx(ns,{title:s.formatMessage({id:"fZLAcK",defaultMessage:"Connections"})}),e.jsx(ls,{skipLegacyWorkspaceCheck:!0,children:e.jsxs(is,{className:"mt-6 gap-6",children:[e.jsx(At,{}),t!=null&&n===Ds.ALPHA&&e.jsx(Ut,{currentWorkspaceId:t.id})]})})]})}const ja=ss(function(){return e.jsx(qt,{})});export{ja as default};
//# sourceMappingURL=lt972vyoyjg2b62v.js.map
