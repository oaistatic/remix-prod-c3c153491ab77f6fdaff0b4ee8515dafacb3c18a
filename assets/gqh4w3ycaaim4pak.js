import{e as b,j as r,a7 as j,a5 as _}from"./fs6h2trisr1juto6.js";import{M as w,fz as a,y as k,d as S,fA as E,Z as F,bH as Q}from"./njq6ygky3ttysgdk.js";import{bD as v,bE as B,bC as L,bF as T,bG as q,bH as N,bI as D,bJ as O}from"./d7a6rc8fexfzu7dt.js";import{T as p,a as U}from"./m97sb2fnwj0a6vyo.js";import"./gunpso70jnmarvod.js";import"./csg4i0wk6hi0jvkd.js";import"./lj0prj6na7gf1jpf.js";import"./cm0hdcditutj2jz2.js";import"./jcoe6v231ph25bfi.js";import"./ijutvl794yycgs5p.js";import"./n9whwsbg0rx5cs8k.js";function ce({messages:e,isRequestActive:t,isLastMessageInTurn:n,isRetrieval:o,isUsingGizmo:l,isUsingSnorlax:g}){const c=W(e),s=c.filter(u=>V(u,!1)&&!J(u)),m=s[s.length-1]??void 0,i=b();if(Z(e).some(({content:u})=>u.content_type===w.SystemError))return null;let d=p.Running;const h=s.filter(u=>u.type===a.Search).length,M={count:s.length-h,domain:m?v(y(m)??""):void 0,query:m?C(m):void 0};let f=o?l?g?i.formatMessage(B.searchingProjectFiles):i.formatMessage({id:"browsingMessage.searchingKnowledge",defaultMessage:"Searching my knowledge"}):i.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"}):i.formatMessage({id:"message.tools.browse.running",defaultMessage:"Searching the web"});return e.some(L)?(d=p.Stopped,f=o?l?i.formatMessage({id:"browsingMessage.searchingKnowledgeStopped",defaultMessage:"Stopped searching knowledge"}):i.formatMessage({id:"browsingMessage.retrievalStopped",defaultMessage:"Stopped reading documents"}):i.formatMessage({id:"message.tools.browse.stopped",defaultMessage:"Search stopped"})):!n||!t?c.length>0&&c.every(u=>u.didError)?(d=p.Error,f=o?l?i.formatMessage({id:"browsingMessage.searchingKnowledgeFailed",defaultMessage:"Error searching knowledge"}):i.formatMessage({id:"browsingMessage.retrievalFailed",defaultMessage:"Error reading documents"}):i.formatMessage({id:"message.tools.browse.failed",defaultMessage:"Search failed"})):(d=p.Finished,f=o?null:M.count===0?i.formatMessage({id:"message.tools.browse.started",defaultMessage:"Searching the web..."}):i.formatMessage({id:"message.tools.browse.finished",defaultMessage:"Searched {count, plural, =0 {0 sites} one {# site} other {# sites}}"},M)):s.length>0&&(f=I(i,M,o,l,s[s.length-1])),(s.length>0||o&&n)&&d!==p.Error?r.jsx(U,{highlightedCommand:f,showWorkUserSetting:!1,status:d,children:s.length===0?null:r.jsx(H,{commands:s})}):r.jsx(X,{$isError:d===p.Error,children:f})}function x(e){return e.metadata?.command==="quote"||e.metadata?.command==="quote_full"||e.metadata?.command==="quote_lines"}function W(e){return e.map((t,n)=>{if(t.author.role!==k.Tool||n>0&&x(t)&&x(e[n-1]))return null;const o=t.metadata;if(!o)return null;const{command:l,status:g}=o;return l?{type:l,status:g,didError:t.content.content_type===w.SystemError,message:t}:null}).filter(T)}function H({commands:e}){const t=b();return r.jsx("div",{className:"mb-4 divide-y divide-token-border-light rounded-xl border border-token-border-light text-sm",children:r.jsx(j,{initial:!1,children:e.map((n,o)=>{const l=$(n);if(l==null)return null;const{icon:g,url:c,title:s,externalLink:m}=l,i=c?v(c):void 0,d=s?typeof s=="string"?s:t.formatMessage(s):null,h=c&&q(c);return r.jsx(_.div,{initial:"collapsed",animate:"open",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},children:r.jsxs(K,{url:m??c,className:S("flex items-start gap-3 px-4 py-3",s?"text-token-text-secondary":"text-token-text-primary",o===0&&"rounded-t-xl",o===e.length-1&&"rounded-b-xl"),children:[g?r.jsx(g,{className:"icon-sm mt-0.5 flex-shrink-0 text-token-text-secondary"}):c?r.jsx(N,{url:c,className:"mt-1"}):null,r.jsxs("div",{children:[d&&r.jsxs("div",{className:"line-clamp-1 text-token-text-primary",children:[h&&`${h} — `,d]}),r.jsx("div",{children:i})]})]})},o)})})})}function K({url:e,children:t,className:n}){return e?r.jsxs("a",{href:e,target:"_blank",className:S(n,"group relative hover:bg-token-main-surface-secondary"),rel:"noreferrer",children:[t,r.jsx("div",{className:"invisible absolute right-3 bg-gradient-to-l from-token-main-surface-secondary to-transparent pl-4 group-hover:visible",children:r.jsx(D,{className:"icon-md text-token-text-secondary"})})]}):r.jsx("div",{className:n,children:t})}function P(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type!=="file"?t.title:null}function C(e){return e.message.metadata?.args?.[0]}function $(e){switch(e.type){case a.Search:{const t=e.message.metadata?.search_engine;if(t&&t!==E.Bing)return null;const n=C(e);return{icon:O,url:e.message.metadata?.message_source==="apple"?null:"bing.com",externalLink:A(e),title:n?`“${n}”`:{id:"message.tools.browse.querying",defaultMessage:"Querying",description:"Status message when issuing a query"}}}case a.Click:case a.MultiClick:case a.Lookup:case a.OpenUrl:case a.Open:case a.Quote:case a.QuoteFull:case a.QuoteLines:case a.Scroll:return{url:y(e),title:P(e)??void 0};case a.Back:return null}}function A(e){const t=e.message.metadata?.args?.[0];return t===void 0?null:F.getBingLink({query:t})}function I(e,t,n,o,l){switch(l?.type){case a.Click:case a.MultiClick:case a.Lookup:case a.OpenUrl:case a.Quote:case a.QuoteFull:case a.QuoteLines:case a.Scroll:case a.Open:case a.Back:return e.formatMessage({id:"message.tools.browse.reading",defaultMessage:"Browsing {domain}"},t);case a.Search:case void 0:return n?o?e.formatMessage({id:"browsingMessage.searchingKnowledge",defaultMessage:"Searching my knowledge"}):e.formatMessage({id:"browsingMessage.startingRetrieval",defaultMessage:"Reading documents"}):e.formatMessage({id:"message.tools.browse.searching",defaultMessage:'Searching "{query}"'},t)}}function R(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type==="file"?t.name:null}function V(e,t){switch(e.type){case a.Search:return!0;case a.Click:case a.Lookup:case a.MultiClick:case a.OpenUrl:case a.Quote:case a.QuoteFull:case a.QuoteLines:return t?R(e)!=null:y(e)!=null;case a.Open:case a.Back:case a.Scroll:return!1}}function J(e){return e.message.metadata?.message_source==="apple"}function y(e){const t=e.message.metadata?._cite_metadata?.metadata_list[0];return t!=null&&t.type!=="file"?t.url:null}function Z(e){return e.filter(t=>t.author.role===k.Tool)}const X=Q.p`first:mt-0 my-1.5 h-8 flex items-center ltr:mr-auto rtl:ml-auto empty:hidden
${({$isError:e})=>e?"text-token-text-error":"text-token-text-secondary"}`;export{ce as BrowsingMessage,y as getVisitedUrl};
//# sourceMappingURL=gqh4w3ycaaim4pak.js.map
